[{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\about\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\access-denied\\page.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`handleLogout` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\access-denied\\page.tsx:17:11\n  15 |         if (prev <= 1) {\n  16 |           clearInterval(timer);\n> 17 |           handleLogout();\n     |           ^^^^^^^^^^^^ `handleLogout` accessed before it is declared\n  18 |           return 0;\n  19 |         }\n  20 |         return prev - 1;\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\access-denied\\page.tsx:27:3\n  25 |   }, []);\n  26 |\n> 27 |   const handleLogout = () => {\n     |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 28 |     clearAuth();\n     | ^^^^^^^^^^^^^^^^\n> 29 |     router.push('/login');\n     | ^^^^^^^^^^^^^^^^\n> 30 |   };\n     | ^^^^^ `handleLogout` is declared here\n  31 |\n  32 |   return (\n  33 |     <div className=\"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center p-4\">","line":17,"column":11,"nodeType":null,"endLine":17,"endColumn":23},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'handleLogout'. Either include it or remove the dependency array.","line":25,"column":6,"nodeType":"ArrayExpression","endLine":25,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [handleLogout]","fix":{"range":[611,613],"text":"[handleLogout]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { clearAuth } from '@/lib/auth';\r\n\r\nexport default function AccessDenied() {\r\n  const router = useRouter();\r\n  const [countdown, setCountdown] = useState(10);\r\n\r\n  useEffect(() => {\r\n    // Countdown timer\r\n    const timer = setInterval(() => {\r\n      setCountdown((prev) => {\r\n        if (prev <= 1) {\r\n          clearInterval(timer);\r\n          handleLogout();\r\n          return 0;\r\n        }\r\n        return prev - 1;\r\n      });\r\n    }, 1000);\r\n\r\n    return () => clearInterval(timer);\r\n  }, []);\r\n\r\n  const handleLogout = () => {\r\n    clearAuth();\r\n    router.push('/login');\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center p-4\">\r\n      <div className=\"max-w-md w-full\">\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 text-center space-y-6\">\r\n          {/* Icon */}\r\n          <div className=\"flex justify-center\">\r\n            <div className=\"w-24 h-24 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center\">\r\n              <svg \r\n                className=\"w-12 h-12 text-red-600 dark:text-red-400\" \r\n                fill=\"none\" \r\n                stroke=\"currentColor\" \r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path \r\n                  strokeLinecap=\"round\" \r\n                  strokeLinejoin=\"round\" \r\n                  strokeWidth={2} \r\n                  d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" \r\n                />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Title */}\r\n          <div className=\"space-y-2\">\r\n            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n              Akses Ditolak\r\n            </h1>\r\n            <p className=\"text-gray-600 dark:text-gray-400\">\r\n              Dashboard web hanya untuk OWNER dan MANAGER\r\n            </p>\r\n          </div>\r\n\r\n          {/* Message */}\r\n          <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4 space-y-3\">\r\n            <div className=\"flex items-start gap-3\">\r\n              <svg \r\n                className=\"w-5 h-5 text-red-600 dark:text-red-400 mt-0.5 flex-shrink-0\" \r\n                fill=\"currentColor\" \r\n                viewBox=\"0 0 20 20\"\r\n              >\r\n                <path \r\n                  fillRule=\"evenodd\" \r\n                  d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" \r\n                  clipRule=\"evenodd\" \r\n                />\r\n              </svg>\r\n              <div className=\"text-left\">\r\n                <p className=\"text-sm font-semibold text-red-900 dark:text-red-200\">\r\n                  Role KASIR tidak diizinkan mengakses web dashboard\r\n                </p>\r\n                <p className=\"text-xs text-red-700 dark:text-red-300 mt-1\">\r\n                  Silakan gunakan aplikasi desktop untuk akses sistem kasir\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Instructions */}\r\n          <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-4 text-left\">\r\n            <h3 className=\"text-sm font-semibold text-blue-900 dark:text-blue-200 mb-2 flex items-center gap-2\">\r\n              <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n              Cara Akses Desktop App:\r\n            </h3>\r\n            <ol className=\"text-xs text-blue-800 dark:text-blue-300 space-y-1 list-decimal list-inside\">\r\n              <li>Download aplikasi desktop Pelaris.id</li>\r\n              <li>Install dan jalankan aplikasi di komputer kasir</li>\r\n              <li>Login dengan akun KASIR Anda</li>\r\n              <li>Gunakan fitur POS untuk transaksi penjualan</li>\r\n            </ol>\r\n          </div>\r\n\r\n          {/* Countdown */}\r\n          <div className=\"space-y-3\">\r\n            <div className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n              Anda akan logout otomatis dalam{' '}\r\n              <span className=\"font-bold text-red-600 dark:text-red-400 text-lg\">\r\n                {countdown}\r\n              </span>{' '}\r\n              detik\r\n            </div>\r\n\r\n            {/* Buttons */}\r\n            <div className=\"flex gap-3\">\r\n              <button\r\n                onClick={handleLogout}\r\n                className=\"flex-1 px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-xl font-medium transition-colors shadow-lg shadow-red-200 dark:shadow-red-900/30\"\r\n              >\r\n                Logout Sekarang\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Support */}\r\n          <p className=\"text-xs text-gray-500 dark:text-gray-500\">\r\n            Butuh bantuan? Hubungi admin atau manager Anda\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\contact\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1652,1655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1652,1655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useRef } from 'react';\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport emailjs from '@emailjs/browser';\r\nimport { Sun, Moon, ArrowLeft, Mail, Phone, MapPin, Send, MessageCircle } from 'lucide-react';\r\nimport { useTheme } from '@/contexts/ThemeContext';\r\nimport { EMAILJS_CONFIG } from '@/lib/emailjs.config';\r\n\r\nconst contactInfo = [\r\n  {\r\n    icon: Mail,\r\n    title: 'Email',\r\n    value: 'ziqrishahab@gmail.com',\r\n    href: 'mailto:ziqrishahab@gmail.com',\r\n  },\r\n  {\r\n    icon: Phone,\r\n    title: 'WhatsApp',\r\n    value: '+62 821-1240-6540',\r\n    href: 'https://wa.me/6282112406540',\r\n  },\r\n  {\r\n    icon: MapPin,\r\n    title: 'Lokasi',\r\n    value: 'Jakarta, Indonesia',\r\n    href: null,\r\n  },\r\n];\r\n\r\nexport default function ContactPage() {\r\n  const { resolvedTheme, toggleTheme } = useTheme();\r\n  const formRef = useRef<HTMLFormElement>(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isSubmitted, setIsSubmitted] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n    setError('');\r\n\r\n    try {\r\n      if (!formRef.current) return;\r\n\r\n      const result = await emailjs.sendForm(\r\n        EMAILJS_CONFIG.SERVICE_ID,\r\n        EMAILJS_CONFIG.TEMPLATE_ID,\r\n        formRef.current,\r\n        EMAILJS_CONFIG.PUBLIC_KEY\r\n      );\r\n\r\n      if (result.status === 200) {\r\n        setIsSubmitted(true);\r\n        formRef.current.reset();\r\n      } else {\r\n        throw new Error('Failed to send email');\r\n      }\r\n    } catch (err: any) {\r\n      console.error('EmailJS Error:', err);\r\n      setError('Gagal mengirim pesan. Silakan coba lagi atau hubungi kami via WhatsApp.');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950\">\r\n      {/* Navbar */}\r\n      <nav className=\"fixed top-0 left-0 right-0 z-50 bg-white/95 dark:bg-slate-900/95 backdrop-blur-md border-b border-slate-200 dark:border-slate-800\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"flex items-center justify-between h-16\">\r\n            <Link href=\"/\" className=\"flex items-center\">\r\n              <Image\r\n                src=\"/images/logo.png\"\r\n                alt=\"Pelaris\"\r\n                width={120}\r\n                height={32}                \r\n                style={{ width: 'auto', height: 'auto' }}\r\n              />\r\n            </Link>\r\n\r\n            <div className=\"flex items-center gap-3\">\r\n              <button\r\n                onClick={toggleTheme}\r\n                className=\"p-2 text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors\"\r\n                aria-label=\"Toggle theme\"\r\n              >\r\n                {resolvedTheme === 'dark' ? <Sun className=\"w-5 h-5\" /> : <Moon className=\"w-5 h-5\" />}\r\n              </button>\r\n              <Link\r\n                href=\"/\"\r\n                className=\"flex items-center gap-2 px-4 py-2 text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white transition-colors\"\r\n              >\r\n                <ArrowLeft className=\"w-4 h-4\" />\r\n                Kembali\r\n              </Link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </nav>\r\n\r\n      {/* Content */}\r\n      <main className=\"pt-24 pb-16 px-4\">\r\n        <div className=\"max-w-5xl mx-auto\">\r\n          {/* Header */}\r\n          <div className=\"text-center mb-12\">\r\n            <h1 className=\"text-3xl md:text-4xl font-bold text-slate-900 dark:text-white mb-4\">\r\n              Hubungi Kami\r\n            </h1>\r\n            <p className=\"text-slate-600 dark:text-slate-400 max-w-xl mx-auto\">\r\n              Punya pertanyaan, saran, atau butuh bantuan? Tim kami siap membantu Anda kapan saja.\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"grid lg:grid-cols-2 gap-12\">\r\n            {/* Contact Info */}\r\n            <div>\r\n              <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-6\">\r\n                Informasi Kontak\r\n              </h2>\r\n              \r\n              <div className=\"space-y-4 mb-8\">\r\n                {contactInfo.map((info, index) => (\r\n                  <div key={index} className=\"flex items-start gap-4 p-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                    <div className=\"w-10 h-10 bg-slate-500/10 rounded-lg flex items-center justify-center flex-shrink-0\">\r\n                      <info.icon className=\"w-5 h-5 text-slate-600 dark:text-slate-400\" />\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-slate-500 dark:text-slate-400\">{info.title}</p>\r\n                      {info.href ? (\r\n                        <a\r\n                          href={info.href}\r\n                          className=\"text-slate-900 dark:text-white font-medium hover:underline\"\r\n                          target={info.href.startsWith('http') ? '_blank' : undefined}\r\n                          rel={info.href.startsWith('http') ? 'noopener noreferrer' : undefined}\r\n                        >\r\n                          {info.value}\r\n                        </a>\r\n                      ) : (\r\n                        <p className=\"text-slate-900 dark:text-white font-medium\">{info.value}</p>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              {/* WhatsApp CTA */}\r\n              <div className=\"p-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl\">\r\n                <div className=\"flex items-center gap-3 mb-3\">\r\n                  <MessageCircle className=\"w-6 h-6 text-green-600 dark:text-green-400\" />\r\n                  <h3 className=\"font-semibold text-slate-900 dark:text-white\">Chat via WhatsApp</h3>\r\n                </div>\r\n                <p className=\"text-slate-600 dark:text-slate-400 text-sm mb-4\">\r\n                  Dapatkan respon cepat dengan menghubungi kami langsung via WhatsApp.\r\n                </p>\r\n                <a\r\n                  href=\"https://wa.me/6282112406540\"\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                  className=\"inline-flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors\"\r\n                >\r\n                  <MessageCircle className=\"w-4 h-4\" />\r\n                  Chat Sekarang\r\n                </a>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Contact Form */}\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 p-8\">\r\n              <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-6\">\r\n                Kirim Pesan\r\n              </h2>\r\n\r\n              {error && (\r\n                <div className=\"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\r\n                  <p className=\"text-red-600 dark:text-red-400 text-sm\">{error}</p>\r\n                </div>\r\n              )}\r\n\r\n              {isSubmitted ? (\r\n                <div className=\"text-center py-12\">\r\n                  <div className=\"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                    <Send className=\"w-8 h-8 text-green-600 dark:text-green-400\" />\r\n                  </div>\r\n                  <h3 className=\"text-lg font-semibold text-slate-900 dark:text-white mb-2\">\r\n                    Pesan Terkirim!\r\n                  </h3>\r\n                  <p className=\"text-slate-600 dark:text-slate-400 mb-6\">\r\n                    Terima kasih! Kami akan merespon pesan Anda dalam 1x24 jam.\r\n                  </p>\r\n                  <button\r\n                    onClick={() => {\r\n                      setIsSubmitted(false);\r\n                      setError('');\r\n                    }}\r\n                    className=\"text-slate-600 dark:text-slate-400 hover:underline\"\r\n                  >\r\n                    Kirim pesan lagi\r\n                  </button>\r\n                </div>\r\n              ) : (\r\n                <form ref={formRef} onSubmit={handleSubmit} className=\"space-y-5\">\r\n                  {/* Hidden field for recipient name (used in template) */}\r\n                  <input type=\"hidden\" name=\"to_name\" value=\"Pelaris Support\" />\r\n                  \r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\r\n                      Nama Lengkap\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      name=\"from_name\"\r\n                      required\r\n                      placeholder=\"Nama Anda\"\r\n                      className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\r\n                      Alamat Email\r\n                    </label>\r\n                    <input\r\n                      type=\"email\"\r\n                      name=\"from_email\"\r\n                      required\r\n                      placeholder=\"nama@email.com\"\r\n                      className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\r\n                      Subjek\r\n                    </label>\r\n                    <select\r\n                      name=\"subject\"\r\n                      required\r\n                      className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all\"\r\n                    >\r\n                      <option value=\"\">Pilih subjek</option>\r\n                      <option value=\"Pertanyaan Umum\">Pertanyaan Umum</option>\r\n                      <option value=\"Bantuan Teknis\">Bantuan Teknis</option>\r\n                      <option value=\"Saran & Masukan\">Saran & Masukan</option>\r\n                      <option value=\"Kerjasama\">Kerjasama</option>\r\n                      <option value=\"Lainnya\">Lainnya</option>\r\n                    </select>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\r\n                      Pesan\r\n                    </label>\r\n                    <textarea\r\n                      name=\"message\"\r\n                      required\r\n                      rows={4}\r\n                      placeholder=\"Tulis pesan Anda di sini...\"\r\n                      className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all resize-none\"\r\n                    />\r\n                  </div>\r\n\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={isSubmitting}\r\n                    className=\"w-full py-3.5 bg-slate-600 hover:bg-slate-700 disabled:bg-slate-600/50 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2\"\r\n                  >\r\n                    {isSubmitting ? (\r\n                      <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                    ) : (\r\n                      <>\r\n                        <Send className=\"w-5 h-5\" />\r\n                        Kirim Pesan\r\n                      </>\r\n                    )}\r\n                  </button>\r\n                </form>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\branches\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\branches\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\categories\\loading.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonList' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { SkeletonList, SkeletonPageHeader, SkeletonButton, Skeleton } from '@/components/ui/Skeleton';\r\n\r\nexport default function Loading() {\r\n  return (\r\n    <div className=\"px-4 md:px-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex justify-between items-center\">\r\n        <SkeletonPageHeader />\r\n        <SkeletonButton className=\"w-40\" />\r\n      </div>\r\n      \r\n      {/* Category Grid */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n        {Array.from({ length: 9 }).map((_, i) => (\r\n          <div key={i} className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <Skeleton className=\"h-10 w-10 rounded-full\" />\r\n                <div>\r\n                  <Skeleton className=\"h-5 w-32 mb-1\" />\r\n                  <Skeleton className=\"h-4 w-20\" />\r\n                </div>\r\n              </div>\r\n              <div className=\"flex gap-2\">\r\n                <Skeleton className=\"h-8 w-8 rounded\" />\r\n                <Skeleton className=\"h-8 w-8 rounded\" />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\categories\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[600,603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[600,603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect } from 'react';\r\nimport { Plus } from 'lucide-react';\r\nimport { useCategoryStore } from '@/stores/useCategoryStore';\r\n\r\nexport default function CategoriesPage() {\r\n  const {\r\n    categories,\r\n    loading,\r\n    formData,\r\n    editingCategoryId,\r\n    showModal,\r\n    fetchCategories,\r\n    setFormData,\r\n    setEditingCategory,\r\n    resetForm,\r\n    createCategory,\r\n    updateCategory,\r\n    deleteCategory,\r\n    setShowModal,\r\n  } = useCategoryStore();\r\n\r\n  useEffect(() => {\r\n    fetchCategories();\r\n  }, [fetchCategories]);\r\n\r\n  const handleOpenModal = (category?: any) => {\r\n    if (category) {\r\n      setEditingCategory(category);\r\n    } else {\r\n      resetForm();\r\n    }\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleCloseModal = () => {\r\n    setShowModal(false);\r\n    resetForm();\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    let success = false;\r\n    \r\n    if (editingCategoryId) {\r\n      success = await updateCategory(editingCategoryId, formData);\r\n      if (success) alert('Kategori berhasil diupdate!');\r\n    } else {\r\n      success = await createCategory(formData);\r\n      if (success) alert('Kategori berhasil ditambahkan!');\r\n    }\r\n    \r\n    if (success) {\r\n      setShowModal(false);\r\n    } else {\r\n      alert('Gagal menyimpan kategori');\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id: string, name: string) => {\r\n    if (!confirm(`Yakin ingin menghapus kategori \"${name}\"?`)) return;\r\n    \r\n    const success = await deleteCategory(id);\r\n    if (success) {\r\n      alert('Kategori berhasil dihapus!');\r\n    } else {\r\n      alert('Gagal menghapus kategori');\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"text-gray-600 dark:text-gray-400\">Loading...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4 md:space-y-6 px-4 md:px-6\">\r\n      {/* Breadcrumb + Action */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\r\n        <nav className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n          <a href=\"/dashboard\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Dashboard</a>\r\n          <span>ΓÇ║</span>\r\n          <span className=\"text-gray-900 dark:text-white font-medium\">Kategori</span>\r\n        </nav>\r\n        \r\n        <button\r\n          onClick={() => handleOpenModal()}\r\n          className=\"w-full sm:w-auto px-4 py-2.5 bg-gradient-to-r from-slate-600 to-slate-700 text-white rounded-lg font-semibold hover:shadow-lg transform hover:scale-105 transition-all flex items-center justify-center gap-2\"\r\n        >\r\n          <Plus className=\"w-4 h-4\" />\r\n          Tambah Kategori\r\n        </button>\r\n      </div>\r\n\r\n      {/* Categories Grid */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6\">\r\n        {categories.map((category) => (\r\n          <div\r\n            key={category.id}\r\n            className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 md:p-6 hover:shadow-md transition-all\"\r\n          >\r\n            <div className=\"flex items-start justify-between mb-3 md:mb-4\">\r\n              <div className=\"flex-1 min-w-0\">\r\n                <h3 className=\"text-base md:text-lg font-bold text-gray-900 dark:text-white truncate\">{category.name}</h3>\r\n                {category.description && (\r\n                  <p className=\"text-xs md:text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-2\">{category.description}</p>\r\n                )}\r\n              </div>\r\n              <div className=\"flex items-center gap-1 md:gap-2 ml-2\">\r\n                <button\r\n                  onClick={() => handleOpenModal(category)}\r\n                  className=\"p-1.5 md:p-2 text-slate-600 hover:bg-slate-50 dark:hover:bg-slate-900/30 rounded-lg transition-colors\"\r\n                  title=\"Edit\"\r\n                >\r\n                  <svg className=\"w-4 h-4 md:w-5 md:h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                  </svg>\r\n                </button>\r\n                <button\r\n                  onClick={() => handleDelete(category.id, category.name)}\r\n                  className=\"p-1.5 md:p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors\"\r\n                  title=\"Hapus\"\r\n                >\r\n                  <svg className=\"w-4 h-4 md:w-5 md:h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"pt-3 md:pt-4 border-t border-gray-200 dark:border-gray-700\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <span className=\"text-xs md:text-sm text-gray-600 dark:text-gray-400\">Total Produk</span>\r\n                <span className=\"text-xl md:text-2xl font-bold text-slate-600 dark:text-slate-400\">\r\n                  {category._count?.products || 0}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {categories.length === 0 && (\r\n        <div className=\"text-center py-8 md:py-12 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700\">\r\n          <svg className=\"w-12 h-12 md:w-16 md:h-16 mx-auto text-gray-400 dark:text-gray-600 mb-3 md:mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\r\n          </svg>\r\n          <h3 className=\"text-base md:text-lg font-semibold text-gray-900 dark:text-white mb-2\">Belum ada kategori</h3>\r\n          <p className=\"text-sm md:text-base text-gray-600 dark:text-gray-400 mb-3 md:mb-4\">Mulai dengan menambahkan kategori pertama Anda</p>\r\n          <button\r\n            onClick={() => handleOpenModal()}\r\n            className=\"px-4 md:px-6 py-2 text-sm md:text-base bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors\"\r\n          >\r\n            Tambah Kategori\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Modal */}\r\n      {showModal && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl md:rounded-2xl shadow-2xl w-full max-w-md mx-4\">\r\n            <div className=\"px-4 md:px-6 py-3 md:py-4 border-b border-gray-200 dark:border-gray-700\">\r\n              <h2 className=\"text-lg md:text-xl font-bold text-gray-900 dark:text-white\">\r\n                {editingCategoryId ? 'Edit Kategori' : 'Tambah Kategori Baru'}\r\n              </h2>\r\n            </div>\r\n            \r\n            <form onSubmit={handleSubmit} className=\"p-4 md:p-6 space-y-3 md:space-y-4\">\r\n              <div>\r\n                <label className=\"block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Nama Kategori *\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  value={formData.name}\r\n                  onChange={(e) => setFormData({ name: e.target.value })}\r\n                  className=\"w-full px-3 md:px-4 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 dark:bg-gray-700 dark:text-white\"\r\n                  placeholder=\"Contoh: Seragam, Perlengkapan\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Deskripsi\r\n                </label>\r\n                <textarea\r\n                  value={formData.description}\r\n                  onChange={(e) => setFormData({ description: e.target.value })}\r\n                  rows={3}\r\n                  className=\"w-full px-3 md:px-4 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 dark:bg-gray-700 dark:text-white\"\r\n                  placeholder=\"Deskripsi kategori (opsional)\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"flex gap-2 md:gap-3 pt-3 md:pt-4\">\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"flex-1 py-2 md:py-2.5 text-sm md:text-base bg-slate-600 text-white rounded-lg font-semibold hover:bg-slate-700 transition-colors\"\r\n                >\r\n                  {editingCategoryId ? 'Simpan Perubahan' : 'Tambah Kategori'}\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleCloseModal}\r\n                  className=\"px-4 md:px-6 py-2 md:py-2.5 text-sm md:text-base bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors\"\r\n                >\r\n                  Batal\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\layout.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":3,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":3,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'History' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Repeat2' is defined but never used.","line":22,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":25,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":27,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Printer' is defined but never used.","line":29,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":10},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Shield' is defined but never used.","line":30,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Menu' is defined but never used.","line":32,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":33,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":33,"endColumn":4},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sun' is defined but never used.","line":34,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":6},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Moon' is defined but never used.","line":35,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":35,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LogOut' is defined but never used.","line":36,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":9},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1250,1253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1250,1253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`menuItems` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\layout.tsx:84:5\n  82 |     \n  83 |     // Auto-expand menu based on current path\n> 84 |     menuItems.forEach(item => {\n     |     ^^^^^^^^^ `menuItems` accessed before it is declared\n  85 |       if (item.subMenu) {\n  86 |         const isActive = item.subMenu.some(sub => \n  87 |           pathname === sub.path || pathname.startsWith(sub.path + '/')\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\layout.tsx:122:3\n  120 |\n  121 |   // Menu structure with parent-submenu\n> 122 |   const menuItems = [\n      |   ^^^^^^^^^^^^^^^^^^^\n> 123 |     {\n      | ^^^^^\n> 124 |       name: 'Dashboard',\n      ΓÇª\n      | ^^^^^\n> 188 |     },\n      | ^^^^^\n> 189 |   ];\n      | ^^^^^ `menuItems` is declared here\n  190 |\n  191 |   // Filter menu items by role\n  192 |   const filteredMenuItems = menuItems.filter(item => {","line":84,"column":5,"nodeType":null,"endLine":84,"endColumn":14},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'menuItems'. Either include it or remove the dependency array.","line":95,"column":6,"nodeType":"ArrayExpression","endLine":95,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [menuItems, pathname]","fix":{"range":[2539,2549],"text":"[menuItems, pathname]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState, useCallback, useMemo } from 'react';\r\nimport { useRouter, usePathname } from 'next/navigation';\r\nimport { getAuth, clearAuth } from '@/lib/auth';\r\nimport ProtectedRoute from '@/components/ProtectedRoute';\r\nimport ErrorBoundary from '@/components/ErrorBoundary';\r\nimport { useTheme } from '@/contexts/ThemeContext';\r\nimport Image from 'next/image';\r\nimport {\r\n  LayoutDashboard,\r\n  Clock,\r\n  RotateCcw,\r\n  ArrowLeftRight,\r\n  ShoppingCart,\r\n  Receipt,\r\n  History,\r\n  Package,\r\n  Tags,\r\n  BarChart3,\r\n  ClipboardList,\r\n  Repeat2,\r\n  Store,\r\n  Building2,\r\n  Users,\r\n  FileText,\r\n  TrendingUp,\r\n  Settings,\r\n  Printer,\r\n  Shield,\r\n  ChevronDown,\r\n  Menu,\r\n  X,\r\n  Sun,\r\n  Moon,\r\n  LogOut\r\n} from 'lucide-react';\r\n\r\nexport default function DashboardLayout({ children }: { children: React.ReactNode }) {\r\n  return (\r\n    <ProtectedRoute>\r\n      <ErrorBoundary>\r\n        <DashboardLayoutInner>{children}</DashboardLayoutInner>\r\n      </ErrorBoundary>\r\n    </ProtectedRoute>\r\n  );\r\n}\r\n\r\nfunction DashboardLayoutInner({ children }: { children: React.ReactNode }) {\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const { theme, toggleTheme } = useTheme();\r\n  const [user, setUser] = useState<any>(null);\r\n  const [sidebarOpen, setSidebarOpen] = useState(false);\r\n  const [userMenuOpen, setUserMenuOpen] = useState(false);\r\n  const [currentTime, setCurrentTime] = useState(new Date());\r\n  \r\n  // Submenu open states\r\n  const [openMenus, setOpenMenus] = useState<{ [key: string]: boolean }>({});\r\n\r\n  useEffect(() => {\r\n    // Set sidebar open by default on desktop only\r\n    const handleResize = () => {\r\n      if (window.innerWidth >= 768) { // md breakpoint\r\n        setSidebarOpen(true);\r\n      } else {\r\n        setSidebarOpen(false);\r\n      }\r\n    };\r\n    \r\n    // Set initial state\r\n    handleResize();\r\n    \r\n    // Listen to resize\r\n    window.addEventListener('resize', handleResize);\r\n    return () => window.removeEventListener('resize', handleResize);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const { user: authUser } = getAuth();\r\n    setUser(authUser);\r\n    \r\n    // Auto-expand menu based on current path\r\n    menuItems.forEach(item => {\r\n      if (item.subMenu) {\r\n        const isActive = item.subMenu.some(sub => \r\n          pathname === sub.path || pathname.startsWith(sub.path + '/')\r\n        );\r\n        if (isActive) {\r\n          // Hanya expand menu yang aktif, tutup yang lain\r\n          setOpenMenus({ [item.name]: true });\r\n        }\r\n      }\r\n    });\r\n  }, [pathname]);\r\n\r\n  useEffect(() => {\r\n    // Update clock every second\r\n    const timer = setInterval(() => {\r\n      setCurrentTime(new Date());\r\n    }, 1000);\r\n    return () => clearInterval(timer);\r\n  }, []);\r\n\r\n  const handleLogout = () => {\r\n    clearAuth();\r\n    router.push('/login');\r\n  };\r\n\r\n  const toggleMenu = (menuName: string) => {\r\n    setOpenMenus(prev => {\r\n      // Jika menu yang diklik sudah open, tutup\r\n      if (prev[menuName]) {\r\n        return { [menuName]: false };\r\n      }\r\n      // Jika menu yang diklik belum open, buka dan tutup semua yang lain\r\n      return { [menuName]: true };\r\n    });\r\n  };\r\n\r\n  // Menu structure with parent-submenu\r\n  const menuItems = [\r\n    {\r\n      name: 'Dashboard',\r\n      path: '/dashboard',\r\n      icon: <LayoutDashboard className=\"w-5 h-5\" />,\r\n      roles: ['OWNER', 'MANAGER', 'ADMIN'],\r\n    },\r\n    {\r\n      name: 'Penjualan',\r\n      icon: <ShoppingCart className=\"w-5 h-5\" />,\r\n      roles: ['OWNER', 'MANAGER', 'ADMIN'],\r\n      subMenu: [\r\n        { name: 'Transactions', path: '/dashboard/transactions', roles: ['OWNER', 'MANAGER', 'ADMIN'] },\r\n        { name: 'Returns & Refunds', path: '/dashboard/returns', roles: ['OWNER', 'MANAGER', 'ADMIN'] },\r\n      ],\r\n    },\r\n    {\r\n      name: 'Listing',\r\n      icon: <Package className=\"w-5 h-5\" />,\r\n      roles: ['OWNER', 'MANAGER', 'ADMIN'],\r\n      subMenu: [\r\n        { name: 'Products', path: '/dashboard/products', roles: ['OWNER', 'MANAGER', 'ADMIN'] },\r\n        { name: 'Categories', path: '/dashboard/categories', roles: ['OWNER', 'MANAGER', 'ADMIN'] },\r\n      ],\r\n    },\r\n    {\r\n      name: 'Stock',\r\n      icon: <BarChart3 className=\"w-5 h-5\" />,\r\n      roles: ['OWNER', 'MANAGER', 'ADMIN'],\r\n      subMenu: [\r\n        { name: 'Overview', path: '/dashboard/stock', roles: ['OWNER', 'MANAGER', 'ADMIN'] },\r\n        { name: 'Stock Opname', path: '/dashboard/stock-opname', roles: ['OWNER', 'MANAGER', 'ADMIN'] },\r\n        { name: 'Transfer Stock', path: '/dashboard/stock-transfers', roles: ['OWNER', 'MANAGER', 'ADMIN'] },\r\n      ],\r\n    },\r\n    {\r\n      name: 'Marketplace',\r\n      path: '/dashboard/marketplace',\r\n      icon: <Store className=\"w-5 h-5\" />,\r\n      roles: ['OWNER', 'MANAGER'],\r\n    },\r\n    {\r\n      name: 'Branches',\r\n      path: '/dashboard/branches',\r\n      icon: <Building2 className=\"w-5 h-5\" />,\r\n      roles: ['OWNER'],\r\n    },\r\n    {\r\n      name: 'Laporan',\r\n      icon: <FileText className=\"w-5 h-5\" />,\r\n      roles: ['OWNER', 'MANAGER'],\r\n      subMenu: [\r\n        { name: 'Sales Report', path: '/dashboard/reports/sales', roles: ['OWNER', 'MANAGER'] },\r\n        { name: 'Stock Report', path: '/dashboard/reports/stock', roles: ['OWNER', 'MANAGER'] },\r\n      ],\r\n    },\r\n    {\r\n      name: 'Settings',\r\n      icon: <Settings className=\"w-5 h-5\" />,\r\n      roles: ['OWNER', 'MANAGER'],\r\n      subMenu: [\r\n        { name: 'General', path: '/dashboard/settings/general', roles: ['OWNER', 'MANAGER'] },\r\n        { name: 'User Management', path: '/dashboard/settings/users', roles: ['OWNER'] },\r\n        { name: 'Printer', path: '/dashboard/settings/printer', roles: ['OWNER', 'MANAGER'] },\r\n        { name: 'Backup Data', path: '/dashboard/settings/backup', roles: ['OWNER'] },\r\n      ],\r\n    },\r\n  ];\r\n\r\n  // Filter menu items by role\r\n  const filteredMenuItems = menuItems.filter(item => {\r\n    if (!user?.role || !item.roles.includes(user.role)) return false;\r\n    return true;\r\n  }).map(item => {\r\n    if (item.subMenu) {\r\n      return {\r\n        ...item,\r\n        subMenu: item.subMenu.filter(sub => !sub.roles || sub.roles.includes(user?.role))\r\n      };\r\n    }\r\n    return item;\r\n  });\r\n\r\n  return (\r\n    <ProtectedRoute>\r\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300\">\r\n        {/* Mobile Overlay - untuk close sidebar saat klik di luar (HANYA MOBILE) */}\r\n        <div\r\n          className={`fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden transition-opacity duration-300 ${\r\n            sidebarOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'\r\n          }`}\r\n          onClick={() => setSidebarOpen(false)}\r\n        />\r\n        \r\n        {/* Sidebar */}\r\n        <aside\r\n          className={`fixed top-0 left-0 z-40 h-screen transition-all duration-300 ease-in-out bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 shadow-xl ${\r\n            sidebarOpen ? 'w-72' : 'w-16 -translate-x-full md:translate-x-0'\r\n          }`}\r\n        >\r\n          <div className=\"h-full flex flex-col overflow-hidden\">\r\n            {/* Logo & Hamburger - STICKY */}\r\n            <div className=\"flex items-center justify-between px-3 py-6 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 sticky top-0 z-10\">\r\n              {sidebarOpen ? (\r\n                <>\r\n                  <div className=\"flex flex-col\">\r\n                    <span className=\"text-lg font-bold text-gray-900 dark:text-white truncate max-w-[180px]\">\r\n                      {user?.storeName || 'Nama Tenant'}\r\n                    </span>\r\n                    <span className=\"text-xs text-gray-500 dark:text-gray-400\">By Pelaris system</span>\r\n                  </div>\r\n                  <button\r\n                    onClick={() => setSidebarOpen(false)}\r\n                    className=\"p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all flex-shrink-0 ml-2\"\r\n                  >\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                    </svg>\r\n                  </button>\r\n                </>\r\n              ) : (\r\n                <button\r\n                  onClick={() => setSidebarOpen(true)}\r\n                  className=\"w-10 h-10 mx-auto flex items-center justify-center text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all\"\r\n                >\r\n                  <Image\r\n                    src=\"/images/logo-icon.png\"\r\n                    alt=\"Pelaris\"\r\n                    width={32}\r\n                    height={32}                    \r\n                    style={{ width: 'auto', height: 'auto' }}\r\n                  />\r\n                </button>\r\n              )}\r\n            </div>\r\n\r\n            {/* Navigation Menu - Parent/Submenu Structure */}\r\n            <nav className=\"flex-1 px-3 py-4 overflow-y-auto space-y-1\">\r\n              {filteredMenuItems.map((item) => {\r\n                // Check if this is a parent with submenu\r\n                if (item.subMenu && item.subMenu.length > 0) {\r\n                  const isAnySubActive = item.subMenu.some(sub => \r\n                    pathname === sub.path || pathname.startsWith(sub.path + '/')\r\n                  );\r\n                  const isOpen = openMenus[item.name] || false;\r\n                  \r\n                  return (\r\n                    <div key={item.name}>\r\n                      {/* Parent Menu Button */}\r\n                      <button\r\n                        onClick={() => {\r\n                          if (sidebarOpen) {\r\n                            toggleMenu(item.name);\r\n                          } else {\r\n                            setSidebarOpen(true);\r\n                            // Buka menu ini, tutup yang lain\r\n                            setOpenMenus({ [item.name]: true });\r\n                          }\r\n                        }}\r\n                        className={`w-full flex items-center ${sidebarOpen ? 'justify-between px-3' : 'justify-center px-2'} py-2.5 rounded-lg font-medium text-sm transition-all duration-150 ${\r\n                          isAnySubActive\r\n                            ? 'bg-gradient-to-r from-slate-600 to-slate-700 text-white shadow-md'\r\n                            : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                        }`}\r\n                        title={!sidebarOpen ? item.name : ''}\r\n                      >\r\n                        <div className={`flex items-center ${sidebarOpen ? 'gap-3' : ''}`}>\r\n                          {item.icon}\r\n                          {sidebarOpen && <span>{item.name}</span>}\r\n                        </div>\r\n                        {sidebarOpen && (\r\n                          <ChevronDown className={`w-4 h-4 transition-transform duration-200 ${isOpen ? 'rotate-180' : ''}`} />\r\n                        )}\r\n                      </button>\r\n                      \r\n                      {/* Submenu Items */}\r\n                      {sidebarOpen && (\r\n                        <div className={`overflow-hidden transition-all duration-200 ${isOpen ? 'max-h-96 mt-1' : 'max-h-0'}`}>\r\n                          <div className=\"space-y-0.5 ml-4 pl-4 border-l-2 border-gray-200 dark:border-gray-700\">\r\n                            {item.subMenu.map((subItem) => {\r\n                              const isSubActive = pathname === subItem.path || \r\n                                (subItem.path !== '/dashboard/stock' && pathname.startsWith(subItem.path + '/'));\r\n                              \r\n                              return (\r\n                                <a\r\n                                  key={subItem.path}\r\n                                  href={subItem.path}\r\n                                  className={`block px-3 py-2 rounded-lg text-sm font-medium transition-all ${\r\n                                    isSubActive\r\n                                      ? 'bg-slate-100 dark:bg-slate-900/50 text-slate-700 dark:text-slate-300'\r\n                                      : 'text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-200'\r\n                                  }`}\r\n                                >\r\n                                  {subItem.name}\r\n                                </a>\r\n                              );\r\n                            })}\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  );\r\n                }\r\n                \r\n                // Regular menu item without submenu\r\n                const isActive = pathname === item.path;\r\n                return (\r\n                  <a\r\n                    key={item.path}\r\n                    href={item.path}\r\n                    className={`flex items-center ${sidebarOpen ? 'gap-3 px-3' : 'justify-center px-2'} py-2.5 rounded-lg font-medium text-sm transition-all duration-150 ${\r\n                      isActive\r\n                        ? 'bg-gradient-to-r from-slate-600 to-slate-700 text-white shadow-md'\r\n                        : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'\r\n                    }`}\r\n                    title={!sidebarOpen ? item.name : ''}\r\n                  >\r\n                    {item.icon}\r\n                    {sidebarOpen && <span>{item.name}</span>}\r\n                  </a>\r\n                );\r\n              })}\r\n            </nav>\r\n          </div>\r\n        </aside>\r\n\r\n        {/* Main Content */}\r\n        <div className=\"transition-all duration-300\">\r\n          {/* Header - STICKY dengan margin sesuai sidebar */}\r\n          <header className={`bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm transition-all duration-300 sticky top-0 z-30 ${sidebarOpen ? 'md:ml-72' : 'md:ml-16'}`}>\r\n            <div className=\"px-4 md:px-6 py-3 md:py-4\">\r\n              {/* Mobile: Hamburger + Page Title + User Dropdown */}\r\n              <div className=\"flex items-center justify-between md:hidden\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <button\r\n                    onClick={() => setSidebarOpen(!sidebarOpen)}\r\n                    className=\"p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all\"\r\n                  >\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\r\n                    </svg>\r\n                  </button>\r\n                  <h1 className=\"text-base font-bold text-gray-900 dark:text-white truncate max-w-[150px]\">\r\n                    {pathname === '/dashboard' ? 'Dashboard' :\r\n                     pathname === '/dashboard/stock' ? 'Stock Overview' :\r\n                     pathname === '/dashboard/stock-opname' ? 'Stock Opname' :\r\n                     pathname === '/dashboard/stock-transfers' ? 'Transfer Stock' :\r\n                     pathname.includes('/products') ? 'Produk' :\r\n                     pathname.includes('/categories') ? 'Kategori' :\r\n                     pathname.includes('/transactions') ? 'Transaksi' :\r\n                     pathname.includes('/returns') ? 'Retur' :\r\n                     pathname.includes('/reports') ? 'Reports' :\r\n                     pathname.includes('/branches') ? 'Cabang' :\r\n                     pathname.includes('/marketplace') ? 'Marketplace' :\r\n                     pathname.includes('/settings') ? 'Settings' : 'Dashboard'}\r\n                  </h1>\r\n                </div>\r\n                \r\n                <div className=\"flex items-center gap-2\">\r\n                {/* User Dropdown - Mobile (NO POS BUTTON - POS is desktop only) */}\r\n                {user && (\r\n                  <div className=\"relative\">\r\n                    <button\r\n                      onClick={() => setUserMenuOpen(!userMenuOpen)}\r\n                      className=\"flex items-center gap-2 px-2 py-1.5 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors\"\r\n                    >\r\n                      <div className=\"w-7 h-7 flex items-center justify-center bg-white/20 rounded-full text-xs font-bold\">\r\n                        {user.name?.charAt(0).toUpperCase()}\r\n                      </div>\r\n                      <span className=\"text-sm font-semibold\">{user.name.split(' ')[0]}</span>\r\n                      <svg className={`w-4 h-4 transition-transform ${userMenuOpen ? 'rotate-180' : ''}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                      </svg>\r\n                    </button>\r\n                    \r\n                    {/* Dropdown Menu */}\r\n                    {userMenuOpen && (\r\n                      <>\r\n                        <div className=\"fixed inset-0 z-40\" onClick={() => setUserMenuOpen(false)} />\r\n                        <div className=\"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50\">\r\n                          {/* Current Time */}\r\n                          <div className=\"px-4 py-2 bg-gradient-to-r from-slate-50 to-blue-50 dark:from-slate-900/50 dark:to-slate-800/50 border-b border-gray-200 dark:border-gray-700\">\r\n                            <div className=\"flex items-center gap-2 text-slate-700 dark:text-slate-300\">\r\n                              <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z\" clipRule=\"evenodd\" />\r\n                              </svg>\r\n                              <div className=\"flex-1\">\r\n                                <p className=\"text-lg font-bold\">{currentTime.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}</p>\r\n                                <p className=\"text-xs\">{currentTime.toLocaleDateString('id-ID', { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' })}</p>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                          \r\n                          {/* User Info */}\r\n                          <div className=\"px-4 py-3 border-b border-gray-200 dark:border-gray-700\">\r\n                            <p className=\"text-sm font-semibold text-gray-900 dark:text-white\">{user.name}</p>\r\n                            <p className=\"text-xs text-gray-600 dark:text-gray-400 mt-0.5\">{user.email}</p>\r\n                            <span className=\"inline-block mt-2 px-2 py-0.5 text-xs font-bold bg-slate-600 text-white rounded uppercase\">\r\n                              {user.role}\r\n                            </span>\r\n                          </div>\r\n                          \r\n                          {/* Branch Info */}\r\n                          {user.cabang && (\r\n                            <div className=\"px-4 py-2 border-b border-gray-200 dark:border-gray-700\">\r\n                              <p className=\"text-xs text-gray-500 dark:text-gray-400\">Cabang</p>\r\n                              <p className=\"text-sm font-semibold text-gray-900 dark:text-white\">{user.cabang.name}</p>\r\n                            </div>\r\n                          )}\r\n                          \r\n                          {/* Dark Mode Toggle */}\r\n                          <button\r\n                            onClick={() => {\r\n                              toggleTheme();\r\n                              setUserMenuOpen(false);\r\n                            }}\r\n                            className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3\"\r\n                          >\r\n                            {theme === 'dark' ? (\r\n                              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z\" />\r\n                              </svg>\r\n                            ) : (\r\n                              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z\" />\r\n                              </svg>\r\n                            )}\r\n                            <span>{theme === 'dark' ? 'Mode Terang' : 'Mode Gelap'}</span>\r\n                          </button>\r\n                          \r\n                          {/* Logout */}\r\n                          <button\r\n                            onClick={() => {\r\n                              handleLogout();\r\n                              setUserMenuOpen(false);\r\n                            }}\r\n                            className=\"w-full px-4 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-3\"\r\n                          >\r\n                            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\r\n                            </svg>\r\n                            <span>Logout</span>\r\n                          </button>\r\n                        </div>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                )}\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Desktop: Navbar with Page Title + POS Button + User Dropdown */}\r\n              <div className=\"hidden md:flex items-center justify-between\">\r\n                {/* Left: Page Icon + Title + Description */}\r\n                <div className=\"flex items-center gap-4\">\r\n                  <div className={`p-3.5 rounded-xl ${\r\n                    pathname === '/dashboard' ? 'bg-purple-100 dark:bg-purple-900/30' :\r\n                    pathname.includes('/reports') ? 'bg-teal-100 dark:bg-teal-900/30' :\r\n                    pathname.includes('/stock') && !pathname.includes('/stock-transfers') && !pathname.includes('/stock-opname') ? 'bg-emerald-100 dark:bg-emerald-900/30' :\r\n                    pathname.includes('/stock-opname') ? 'bg-orange-100 dark:bg-orange-900/30' :\r\n                    pathname.includes('/stock-transfers') ? 'bg-cyan-100 dark:bg-cyan-900/30' :\r\n                    pathname.includes('/products') ? 'bg-blue-100 dark:bg-blue-900/30' :\r\n                    pathname.includes('/categories') ? 'bg-amber-100 dark:bg-amber-900/30' :\r\n                    pathname.includes('/transactions') ? 'bg-indigo-100 dark:bg-indigo-900/30' :\r\n                    pathname.includes('/returns') ? 'bg-rose-100 dark:bg-rose-900/30' :\r\n                    pathname.includes('/branches') ? 'bg-sky-100 dark:bg-sky-900/30' :\r\n                    pathname.includes('/marketplace') ? 'bg-pink-100 dark:bg-pink-900/30' :\r\n                    pathname.includes('/settings') ? 'bg-slate-100 dark:bg-slate-900/30' :\r\n                    'bg-gray-100 dark:bg-gray-900/30'\r\n                  }`}>\r\n                    {pathname === '/dashboard' && <LayoutDashboard className=\"w-8 h-8 text-purple-600 dark:text-purple-400\" />}\r\n                    {pathname.includes('/reports') && <BarChart3 className=\"w-8 h-8 text-teal-600 dark:text-teal-400\" />}\r\n                    {pathname.includes('/stock') && !pathname.includes('/stock-transfers') && !pathname.includes('/stock-opname') && !pathname.includes('/reports') && <Package className=\"w-8 h-8 text-emerald-600 dark:text-emerald-400\" />}\r\n                    {pathname.includes('/stock-opname') && <ClipboardList className=\"w-8 h-8 text-orange-600 dark:text-orange-400\" />}\r\n                    {pathname.includes('/stock-transfers') && <ArrowLeftRight className=\"w-8 h-8 text-cyan-600 dark:text-cyan-400\" />}\r\n                    {pathname.includes('/products') && <Package className=\"w-8 h-8 text-blue-600 dark:text-blue-400\" />}\r\n                    {pathname.includes('/categories') && <Tags className=\"w-8 h-8 text-amber-600 dark:text-amber-400\" />}\r\n                    {pathname.includes('/transactions') && <Receipt className=\"w-8 h-8 text-indigo-600 dark:text-indigo-400\" />}\r\n                    {pathname.includes('/returns') && <RotateCcw className=\"w-8 h-8 text-rose-600 dark:text-rose-400\" />}\r\n                    {pathname.includes('/branches') && <Building2 className=\"w-8 h-8 text-sky-600 dark:text-sky-400\" />}\r\n                    {pathname.includes('/marketplace') && <Store className=\"w-8 h-8 text-pink-600 dark:text-pink-400\" />}\r\n                    {pathname.includes('/settings') && <Settings className=\"w-8 h-8 text-slate-600 dark:text-slate-400\" />}\r\n                  </div>\r\n                  <div>\r\n                    <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                      {pathname === '/dashboard' ? 'Dashboard' :\r\n                       pathname === '/dashboard/stock' ? 'Stock Overview' :\r\n                       pathname === '/dashboard/stock-opname' ? 'Stock Opname' :\r\n                       pathname === '/dashboard/stock-transfers' ? 'Transfer Stock' :\r\n                       pathname.includes('/products/new') ? 'Tambah Produk' :\r\n                       pathname.includes('/products') && pathname.includes('/edit') ? 'Edit Produk' :\r\n                       pathname.includes('/products') ? 'Kelola Produk' :\r\n                       pathname.includes('/categories') ? 'Kategori Produk' :\r\n                       pathname.includes('/transactions') ? 'Riwayat Transaksi' :\r\n                       pathname.includes('/returns') ? 'Retur & Refund' :\r\n                       pathname.includes('/reports/sales') ? 'Sales Report' :\r\n                       pathname.includes('/reports/stock') ? 'Stock Report' :\r\n                       pathname.includes('/reports') ? 'Reports' :\r\n                       pathname.includes('/branches') ? 'Kelola Cabang' :\r\n                       pathname.includes('/marketplace') ? 'Marketplace Integration' :\r\n                       pathname.includes('/settings/general') ? 'General Settings' :\r\n                       pathname.includes('/settings/users') ? 'User Management' :\r\n                       pathname.includes('/settings/printer') ? 'Printer Settings' :\r\n                       pathname.includes('/settings/backup') ? 'Backup & Restore' :\r\n                       pathname.includes('/settings') ? 'Settings' : 'Dashboard'}\r\n                    </h1>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                      {pathname === '/dashboard' ? (user ? `Selamat datang, ${user.name}` : 'Ringkasan bisnis') :\r\n                       pathname === '/dashboard/stock' ? 'Kelola stok dan peringatan' :\r\n                       pathname === '/dashboard/stock-opname' ? 'Validasi stok fisik' :\r\n                       pathname === '/dashboard/stock-transfers' ? 'Transfer antar cabang' :\r\n                       pathname.includes('/products') ? 'Kelola produk & varian' :\r\n                       pathname.includes('/categories') ? 'Kelompokkan produk' :\r\n                       pathname.includes('/transactions') ? 'Lihat semua transaksi' :\r\n                       pathname.includes('/returns') ? 'Kelola permintaan retur' :\r\n                       pathname.includes('/reports/sales') ? 'Analisis penjualan' :\r\n                       pathname.includes('/reports/stock') ? 'Laporan inventori' :\r\n                       pathname.includes('/reports') ? 'Analisis & laporan' :\r\n                       pathname.includes('/branches') ? 'Kelola cabang toko' :\r\n                       pathname.includes('/marketplace') ? 'Integrasi marketplace' :\r\n                       pathname.includes('/settings/users') ? 'Kelola akun pengguna' :\r\n                       pathname.includes('/settings/printer') ? 'Konfigurasi printer' :\r\n                       pathname.includes('/settings/backup') ? 'Backup & restore data' :\r\n                       pathname.includes('/settings') ? 'Pengaturan aplikasi' : ''}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* Right: POS Button + User Dropdown */}\r\n                <div className=\"flex items-center gap-3\">\r\n                  {/* POS Button */}\r\n                  <a\r\n                    href=\"/pos\"\r\n                    className=\"flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-semibold shadow-md hover:shadow-lg transition-all\"\r\n                  >\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z\" />\r\n                    </svg>\r\n                    Buka POS\r\n                  </a>\r\n                  \r\n                  {/* User Dropdown - Desktop */}\r\n                  {user && (\r\n                    <div className=\"relative\">\r\n                      <button\r\n                        onClick={() => setUserMenuOpen(!userMenuOpen)}\r\n                        className=\"flex items-center gap-2 px-3 py-1.5 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors\"\r\n                      >\r\n                        <div className=\"w-7 h-7 flex items-center justify-center bg-white/20 rounded-full text-xs font-bold\">\r\n                          {user.name?.charAt(0).toUpperCase()}\r\n                        </div>\r\n                        <div className=\"text-left\">\r\n                          <p className=\"text-xs font-semibold\">{user.name}</p>\r\n                          <p className=\"text-xs opacity-80\">{user.role}</p>\r\n                        </div>\r\n                        <svg className={`w-4 h-4 transition-transform ${userMenuOpen ? 'rotate-180' : ''}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\r\n                        </svg>\r\n                      </button>\r\n                      \r\n                      {/* Dropdown Menu */}\r\n                      {userMenuOpen && (\r\n                        <>\r\n                          <div className=\"fixed inset-0 z-40\" onClick={() => setUserMenuOpen(false)} />\r\n                          <div className=\"absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 z-50\">\r\n                            {/* Current Time */}\r\n                            <div className=\"px-4 py-2 bg-gradient-to-r from-slate-50 to-blue-50 dark:from-slate-900/50 dark:to-slate-800/50 border-b border-gray-200 dark:border-gray-700\">\r\n                              <div className=\"flex items-center gap-2 text-slate-700 dark:text-slate-300\">\r\n                                <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                                  <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z\" clipRule=\"evenodd\" />\r\n                                </svg>\r\n                                <div className=\"flex-1\">\r\n                                  <p className=\"text-lg font-bold\">{currentTime.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}</p>\r\n                                  <p className=\"text-xs\">{currentTime.toLocaleDateString('id-ID', { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' })}</p>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                            \r\n                            {/* User Info */}\r\n                            <div className=\"px-4 py-3 border-b border-gray-200 dark:border-gray-700\">\r\n                              <p className=\"text-sm font-semibold text-gray-900 dark:text-white\">{user.name}</p>\r\n                              <p className=\"text-xs text-gray-600 dark:text-gray-400 mt-0.5\">{user.email}</p>\r\n                              <span className=\"inline-block mt-2 px-2 py-0.5 text-xs font-bold bg-slate-600 text-white rounded uppercase\">\r\n                                {user.role}\r\n                              </span>\r\n                            </div>\r\n                            \r\n                            {/* Branch Info */}\r\n                            <div className=\"px-4 py-2 border-b border-gray-200 dark:border-gray-700\">\r\n                              <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Cabang</p>\r\n                              {user.hasMultiCabangAccess ? (\r\n                                <span className=\"inline-flex items-center gap-1 px-2 py-1 text-xs font-semibold rounded-full bg-slate-100 text-slate-800 dark:bg-slate-900 dark:text-slate-300\">\r\n                                  <Building2 className=\"w-3 h-3\" />\r\n                                  Semua Cabang\r\n                                </span>\r\n                              ) : user.cabang ? (\r\n                                <span className=\"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300\">\r\n                                  {user.cabang.name}\r\n                                </span>\r\n                              ) : (\r\n                                <p className=\"text-sm text-gray-500 dark:text-gray-400\">-</p>\r\n                              )}\r\n                            </div>\r\n                            \r\n                            {/* Dark Mode Toggle */}\r\n                            <button\r\n                              onClick={() => {\r\n                                toggleTheme();\r\n                                setUserMenuOpen(false);\r\n                              }}\r\n                              className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3\"\r\n                            >\r\n                              {theme === 'dark' ? (\r\n                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z\" />\r\n                                </svg>\r\n                              ) : (\r\n                                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z\" />\r\n                                </svg>\r\n                              )}\r\n                              <span>{theme === 'dark' ? 'Mode Terang' : 'Mode Gelap'}</span>\r\n                            </button>\r\n                            \r\n                            {/* Logout */}\r\n                            <button\r\n                              onClick={() => {\r\n                                handleLogout();\r\n                                setUserMenuOpen(false);\r\n                              }}\r\n                              className=\"w-full px-4 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-3\"\r\n                            >\r\n                              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\r\n                              </svg>\r\n                              <span>Logout</span>\r\n                            </button>\r\n                          </div>\r\n                        </>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </header>\r\n\r\n          {/* Page Content dengan margin sesuai sidebar */}\r\n          <main className={`p-6 min-h-screen transition-all duration-300 ${sidebarOpen ? 'md:ml-72' : 'md:ml-16'}`}>\r\n            <ErrorBoundary>\r\n              {children}\r\n            </ErrorBoundary>\r\n          </main>\r\n        </div>\r\n      </div>\r\n    </ProtectedRoute>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\marketplace\\listing\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\marketplace\\listing\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\marketplace\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\marketplace\\orders\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\marketplace\\orders\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\marketplace\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\marketplace\\promo\\loading.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonList' is defined but never used.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { SkeletonList, SkeletonPageHeader, SkeletonButton, Skeleton } from '@/components/ui/Skeleton';\r\n\r\nexport default function Loading() {\r\n  return (\r\n    <div className=\"px-4 md:px-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex justify-between items-center\">\r\n        <SkeletonPageHeader />\r\n        <SkeletonButton className=\"w-36\" />\r\n      </div>\r\n      \r\n      {/* Promo List */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n        {Array.from({ length: 6 }).map((_, i) => (\r\n          <div key={i} className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n            <Skeleton className=\"h-32 w-full rounded-lg mb-4\" />\r\n            <Skeleton className=\"h-5 w-3/4 mb-2\" />\r\n            <Skeleton className=\"h-4 w-full mb-2\" />\r\n            <div className=\"flex justify-between items-center mt-4\">\r\n              <Skeleton className=\"h-6 w-20 rounded-full\" />\r\n              <Skeleton className=\"h-8 w-16 rounded\" />\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\marketplace\\promo\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used.","line":3,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":3,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingDown' is defined but never used.","line":7,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EyeOff' is defined but never used.","line":7,"column":131,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":137},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LayoutDashboard' is defined but never used.","line":7,"column":139,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":154},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":23,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8359,8362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8359,8362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":276,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12811,12814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12811,12814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":360,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":360,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17322,17325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17322,17325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":387,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":387,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18642,18645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18642,18645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":454,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":454,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22378,22381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22378,22381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useMemo, useCallback } from 'react';\r\nimport { getAuth } from '@/lib/auth';\r\nimport { useDashboardStore, WIDGET_LABELS } from '@/stores/useDashboardStore';\r\nimport type { WidgetVisibility } from '@/stores/useDashboardStore';\r\nimport { TrendingUp, TrendingDown, DollarSign, ShoppingBag, Package, AlertTriangle, Clock, Calendar, ChevronDown, ChevronUp, Eye, EyeOff, LayoutDashboard } from 'lucide-react';\r\nimport { \r\n  DynamicLineChart as LineChart, \r\n  DynamicBarChart as BarChart, \r\n  Line, \r\n  Bar, \r\n  XAxis, \r\n  YAxis, \r\n  CartesianGrid, \r\n  Tooltip, \r\n  Legend, \r\n  ResponsiveContainer \r\n} from '@/components/charts';\r\nimport { SkeletonDashboardPage } from '@/components/ui/Skeleton';\r\n\r\nexport default function DashboardPage() {\r\n  const { user } = getAuth();\r\n  \r\n  // Use store for all state\r\n  const {\r\n    summary,\r\n    lowStockAlerts,\r\n    salesTrend,\r\n    topProducts,\r\n    branchPerformance,\r\n    timeStats,\r\n    loading,\r\n    showScreenOptions,\r\n    widgetVisibility,\r\n    setShowScreenOptions,\r\n    toggleWidget,\r\n    loadWidgetVisibility,\r\n    fetchDashboardData,\r\n  } = useDashboardStore();\r\n\r\n  // Load visibility preferences from localStorage\r\n  useEffect(() => {\r\n    loadWidgetVisibility();\r\n  }, [loadWidgetVisibility]);\r\n\r\n  useEffect(() => {\r\n    fetchDashboardData();\r\n  }, [fetchDashboardData]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"px-4 md:px-6\">\r\n        <SkeletonDashboardPage />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 px-4 md:px-6\">\r\n      {/* Screen Options Button */}\r\n      <div className=\"flex justify-end\">\r\n        <div className=\"relative\">\r\n          <button\r\n            onClick={() => setShowScreenOptions(!showScreenOptions)}\r\n            className=\"flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors shadow-sm\"\r\n          >\r\n            <Eye className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />\r\n            <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Opsi Layar</span>\r\n            {showScreenOptions ? (\r\n              <ChevronUp className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />\r\n            ) : (\r\n              <ChevronDown className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />\r\n            )}\r\n          </button>\r\n\r\n          {/* Screen Options Dropdown */}\r\n          {showScreenOptions && (\r\n            <div className=\"absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50 p-4\">\r\n              <h3 className=\"text-sm font-semibold text-gray-900 dark:text-white mb-3\">Tampilkan Widget</h3>\r\n              <div className=\"space-y-2\">\r\n                {Object.entries(WIDGET_LABELS).map(([key, label]) => (\r\n                  <label key={key} className=\"flex items-center gap-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={widgetVisibility[key as keyof WidgetVisibility]}\r\n                      onChange={() => toggleWidget(key as keyof WidgetVisibility)}\r\n                      className=\"w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 focus:ring-2\"\r\n                    />\r\n                    <span className=\"text-sm text-gray-700 dark:text-gray-300\">{label}</span>\r\n                  </label>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Stats Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n        {/* Total Transaksi */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 hover:shadow-md transition-shadow\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1\">Total Transaksi</p>\r\n              <p className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n                {summary?.totalTransactions || 0}\r\n              </p>\r\n              <div className=\"flex items-center mt-2 text-sm text-green-600 dark:text-green-400\">\r\n                <TrendingUp className=\"w-4 h-4 mr-1\" />\r\n                <span>Hari ini</span>\r\n              </div>\r\n            </div>\r\n            <div className=\"p-3 bg-purple-100 dark:bg-purple-900/30 rounded-lg\">\r\n              <ShoppingBag className=\"w-8 h-8 text-purple-600 dark:text-purple-400\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Total Pendapatan */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 hover:shadow-md transition-shadow\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1\">Total Pendapatan</p>\r\n              <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                {new Intl.NumberFormat('id-ID', {\r\n                  style: 'currency',\r\n                  currency: 'IDR',\r\n                  minimumFractionDigits: 0\r\n                }).format(summary?.totalRevenue || 0)}\r\n              </p>\r\n              <div className=\"flex items-center mt-2 text-sm text-green-600 dark:text-green-400\">\r\n                <TrendingUp className=\"w-4 h-4 mr-1\" />\r\n                <span>+12% dari kemarin</span>\r\n              </div>\r\n            </div>\r\n            <div className=\"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg\">\r\n              <DollarSign className=\"w-8 h-8 text-green-600 dark:text-green-400\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stok Menipis */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 hover:shadow-md transition-shadow\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1\">Stok Menipis</p>\r\n              <p className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n                {lowStockAlerts.length}\r\n              </p>\r\n              <div className=\"flex items-center mt-2 text-sm text-orange-600 dark:text-orange-400\">\r\n                <AlertTriangle className=\"w-4 h-4 mr-1\" />\r\n                <span>Perlu perhatian</span>\r\n              </div>\r\n            </div>\r\n            <div className=\"p-3 bg-orange-100 dark:bg-orange-900/30 rounded-lg\">\r\n              <Package className=\"w-8 h-8 text-orange-600 dark:text-orange-400\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Sales Trend Chart */}\r\n      {widgetVisibility.salesTrend && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6\">\r\n          <div className=\"flex items-center mb-4\">\r\n            <TrendingUp className=\"w-5 h-5 text-blue-600 dark:text-blue-400 mr-2\" />\r\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n              Tren Penjualan (7 Hari Terakhir)\r\n            </h2>\r\n          </div>\r\n          {salesTrend.length > 0 ? (\r\n          <div>\r\n              <ResponsiveContainer width=\"100%\" height={300}>\r\n                <LineChart data={salesTrend}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-gray-200 dark:stroke-gray-700\" />\r\n                  <XAxis \r\n                    dataKey=\"date\" \r\n                    className=\"text-xs text-gray-600 dark:text-gray-400\"\r\n                    tickFormatter={(value) => new Date(value).toLocaleDateString('id-ID', { month: 'short', day: 'numeric' })}\r\n                  />\r\n                  <YAxis className=\"text-xs text-gray-600 dark:text-gray-400\" />\r\n                  <Tooltip \r\n                    contentStyle={{ backgroundColor: 'rgba(255, 255, 255, 0.95)', border: '1px solid #e5e7eb' }}\r\n                    labelFormatter={(value) => new Date(value).toLocaleDateString('id-ID', { weekday: 'long', month: 'long', day: 'numeric' })}\r\n                    formatter={(value: any) => ['Rp ' + value.toLocaleString('id-ID'), 'Total Penjualan']}\r\n                  />\r\n                  <Legend />\r\n                  <Line \r\n                    type=\"monotone\" \r\n                    dataKey=\"total\" \r\n                    stroke=\"#8b5cf6\" \r\n                    strokeWidth={3}\r\n                    name=\"Total Penjualan\"\r\n                    dot={{ fill: '#8b5cf6', r: 4 }}\r\n                    activeDot={{ r: 6 }}\r\n                  />\r\n              </LineChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n          ) : (\r\n            <div className=\"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400\">\r\n              <TrendingUp className=\"w-12 h-12 mb-2 opacity-30\" />\r\n              <p className=\"text-sm\">Belum ada data penjualan</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Top Products & Branch Performance */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        {/* Top Products */}\r\n        {widgetVisibility.topProducts && (\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6\">\r\n            <div className=\"flex items-center mb-4\">\r\n              <Package className=\"w-5 h-5 text-green-600 dark:text-green-400 mr-2\" />\r\n              <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n                Produk Terlaris\r\n              </h2>\r\n            </div>\r\n            {topProducts.length > 0 ? (\r\n            <div className=\"space-y-3\">\r\n              {topProducts.map((product, index) => (\r\n                <div key={product.productVariantId} className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg\">\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <div className=\"flex items-center justify-center w-8 h-8 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-full font-bold text-sm\">\r\n                      {index + 1}\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm font-medium text-gray-900 dark:text-white\">{product.productName}</p>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">{product.category}</p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-right\">\r\n                    <p className=\"text-sm font-bold text-gray-900 dark:text-white\">{product.totalQuantity} unit</p>\r\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                      Rp {product.totalRevenue.toLocaleString('id-ID')}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n            ) : (\r\n              <div className=\"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400\">\r\n                <Package className=\"w-12 h-12 mb-2 opacity-30\" />\r\n                <p className=\"text-sm\">Belum ada data produk terlaris</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Branch Performance */}\r\n        {widgetVisibility.branchPerformance && (\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6\">\r\n            <div className=\"flex items-center mb-4\">\r\n              <ShoppingBag className=\"w-5 h-5 text-purple-600 dark:text-purple-400 mr-2\" />\r\n              <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n                Performa Cabang\r\n              </h2>\r\n            </div>\r\n            {branchPerformance.length > 0 ? (\r\n            <div>\r\n            <ResponsiveContainer width=\"100%\" height={250}>\r\n              <BarChart data={branchPerformance}>\r\n                <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-gray-200 dark:stroke-gray-700\" />\r\n                <XAxis \r\n                  dataKey=\"cabangName\" \r\n                  className=\"text-xs text-gray-600 dark:text-gray-400\"\r\n                  angle={-45}\r\n                  textAnchor=\"end\"\r\n                  height={80}\r\n                />\r\n                <YAxis className=\"text-xs text-gray-600 dark:text-gray-400\" />\r\n                <Tooltip \r\n                  contentStyle={{ backgroundColor: 'rgba(255, 255, 255, 0.95)', border: '1px solid #e5e7eb' }}\r\n                  formatter={(value: any) => 'Rp ' + value.toLocaleString('id-ID')}\r\n                />\r\n                <Bar dataKey=\"totalRevenue\" fill=\"#8b5cf6\" name=\"Total Pendapatan\" radius={[8, 8, 0, 0]} />\r\n              </BarChart>\r\n            </ResponsiveContainer>\r\n            </div>\r\n            ) : (\r\n              <div className=\"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400\">\r\n                <ShoppingBag className=\"w-12 h-12 mb-2 opacity-30\" />\r\n                <p className=\"text-sm\">Belum ada data performa cabang</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Time Statistics */}\r\n      {widgetVisibility.timeStats && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6\">\r\n          <div className=\"flex items-center mb-4\">\r\n            <Clock className=\"w-5 h-5 text-orange-600 dark:text-orange-400 mr-2\" />\r\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n              Waktu Tersibuk\r\n            </h2>\r\n          </div>\r\n          {timeStats ? (\r\n          <div>\r\n            <div className=\"space-y-4\">\r\n              <div className=\"p-4 bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-900/10 rounded-lg border border-orange-200 dark:border-orange-800\">\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                  <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Jam Tersibuk</span>\r\n                  <Clock className=\"w-4 h-4 text-orange-600 dark:text-orange-400\" />\r\n                </div>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-white mb-1\">\r\n                  {timeStats.busiestHour.hour}:00\r\n                </p>\r\n                <p className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                  {timeStats.busiestHour.count} transaksi ┬╖ Rp {timeStats.busiestHour.total.toLocaleString('id-ID')}\r\n                </p>\r\n              </div>\r\n              <div className=\"p-4 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-900/10 rounded-lg border border-blue-200 dark:border-blue-800\">\r\n                <div className=\"flex items-center justify-between mb-2\">\r\n                  <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Hari Tersibuk</span>\r\n                  <Calendar className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />\r\n                </div>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-white mb-1\">\r\n                  {timeStats.busiestDay.day}\r\n                </p>\r\n                <p className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                  {timeStats.busiestDay.count} transaksi ┬╖ Rp {timeStats.busiestDay.total.toLocaleString('id-ID')}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          ) : (\r\n            <div className=\"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400\">\r\n              <Clock className=\"w-12 h-12 mb-2 opacity-30\" />\r\n              <p className=\"text-sm\">Belum ada data waktu tersibuk</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Daily Distribution */}\r\n      {widgetVisibility.dailyDistribution && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6\">\r\n          <div className=\"flex items-center mb-4\">\r\n            <Calendar className=\"w-5 h-5 text-blue-600 dark:text-blue-400 mr-2\" />\r\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n              Distribusi Transaksi per Hari\r\n            </h2>\r\n          </div>\r\n          {timeStats?.dailyStats && timeStats.dailyStats.length > 0 ? (\r\n          <div>\r\n            <ResponsiveContainer width=\"100%\" height={200}>\r\n              <BarChart data={timeStats.dailyStats}>\r\n                <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-gray-200 dark:stroke-gray-700\" />\r\n                <XAxis \r\n                  dataKey=\"day\" \r\n                  className=\"text-xs text-gray-600 dark:text-gray-400\"\r\n                />\r\n                <YAxis className=\"text-xs text-gray-600 dark:text-gray-400\" />\r\n                <Tooltip \r\n                  contentStyle={{ backgroundColor: 'rgba(255, 255, 255, 0.95)', border: '1px solid #e5e7eb' }}\r\n                  formatter={(value: any) => [value + ' transaksi', 'Total']}\r\n                />\r\n                <Bar dataKey=\"count\" fill=\"#3b82f6\" name=\"Jumlah Transaksi\" radius={[8, 8, 0, 0]} />\r\n              </BarChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n          ) : (\r\n            <div className=\"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400\">\r\n              <Calendar className=\"w-12 h-12 mb-2 opacity-30\" />\r\n              <p className=\"text-sm\">Belum ada data distribusi harian</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Payment Method Breakdown */}\r\n      {widgetVisibility.paymentMethods && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6\">\r\n          <div className=\"flex items-center mb-4\">\r\n            <DollarSign className=\"w-5 h-5 text-purple-600 dark:text-purple-400 mr-2\" />\r\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n              Metode Pembayaran\r\n            </h2>\r\n          </div>\r\n          {summary?.paymentMethodBreakdown && summary.paymentMethodBreakdown.length > 0 ? (\r\n          <div>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                {summary.paymentMethodBreakdown.map((method: any) => (\r\n                  <div\r\n                    key={method.paymentMethod}\r\n                    className=\"p-4 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-750 rounded-lg border border-gray-200 dark:border-gray-600 hover:shadow-md transition-shadow\"\r\n                  >\r\n                    <div className=\"flex items-center justify-between mb-2\">\r\n                      <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">{method.paymentMethod}</span>\r\n                      <span className=\"px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 text-xs font-semibold rounded\">\r\n                        {method._count.id}x\r\n                      </span>\r\n                    </div>\r\n                    <p className=\"text-xl font-bold text-gray-900 dark:text-white mb-1\">\r\n                      Rp {(method._sum.total || 0).toLocaleString('id-ID')}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                      Total transaksi {method.paymentMethod.toLowerCase()}\r\n                    </p>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n          </div>\r\n          ) : (\r\n            <div className=\"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400\">\r\n              <DollarSign className=\"w-12 h-12 mb-2 opacity-30\" />\r\n              <p className=\"text-sm\">Belum ada data metode pembayaran</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Low Stock Alerts */}\r\n      {widgetVisibility.lowStock && (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6\">\r\n          <div className=\"flex items-center gap-3 mb-4\">\r\n            <AlertTriangle className=\"w-5 h-5 text-orange-600 dark:text-orange-400\" />\r\n            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n              Peringatan Stok Menipis\r\n            </h2>\r\n            {lowStockAlerts.length > 0 && (\r\n              <span className=\"px-3 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 text-sm font-semibold rounded-full\">\r\n                {lowStockAlerts.length} item\r\n              </span>\r\n            )}\r\n          </div>\r\n          {lowStockAlerts.length > 0 ? (\r\n          <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\r\n              <thead className=\"bg-gray-50 dark:bg-gray-750\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                    Produk\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                    Variant\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                    SKU\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                    Cabang\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                    Stok\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\r\n                {lowStockAlerts.map((alert: any) => (\r\n                  <tr key={alert.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors\">\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                        {alert.productName}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"text-sm text-gray-600 dark:text-gray-300\">\r\n                        {alert.variantName}\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <code className=\"text-sm text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded\">\r\n                        {alert.sku}\r\n                      </code>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-300\">\r\n                      {alert.cabangName}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300\">\r\n                        <AlertTriangle className=\"w-3 h-3 mr-1\" />\r\n                        {alert.currentStock}\r\n                      </span>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          ) : (\r\n            <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">\r\n              <Package className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\r\n              <p>Tidak ada stok yang menipis</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\products\\[id]\\edit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setPrice' is assigned a value but never used.","line":18,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[789,792],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[789,792],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[843,846],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[843,846],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[899,902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[899,902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":37,"column":6,"nodeType":"ArrayExpression","endLine":37,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData, params.id]","fix":{"range":[1237,1248],"text":"[fetchData, params.id]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1921,1924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1921,1924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2261,2264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2261,2264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2323,2326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2323,2326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5512,5515],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5512,5515],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6388,6391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6388,6391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":199,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":199,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6567,6570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6567,6570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":225,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7427,7430],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7427,7430],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":243,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8054,8057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8054,8057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":253,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8340,8343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8340,8343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":273,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":273,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9059,9062],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9059,9062],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":285,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":285,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9404,9407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9404,9407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":443,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":443,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16647,16650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16647,16650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":878,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":878,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41860,41863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41860,41863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":936,"column":45,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[45423,45517],"text":"\r\n              Belum ada varian. Klik tombol &quot;Tambah Varian\" untuk menambahkan.\r\n            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[45423,45517],"text":"\r\n              Belum ada varian. Klik tombol &ldquo;Tambah Varian\" untuk menambahkan.\r\n            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[45423,45517],"text":"\r\n              Belum ada varian. Klik tombol &#34;Tambah Varian\" untuk menambahkan.\r\n            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[45423,45517],"text":"\r\n              Belum ada varian. Klik tombol &rdquo;Tambah Varian\" untuk menambahkan.\r\n            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":936,"column":59,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[45423,45517],"text":"\r\n              Belum ada varian. Klik tombol \"Tambah Varian&quot; untuk menambahkan.\r\n            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[45423,45517],"text":"\r\n              Belum ada varian. Klik tombol \"Tambah Varian&ldquo; untuk menambahkan.\r\n            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[45423,45517],"text":"\r\n              Belum ada varian. Klik tombol \"Tambah Varian&#34; untuk menambahkan.\r\n            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[45423,45517],"text":"\r\n              Belum ada varian. Klik tombol \"Tambah Varian&rdquo; untuk menambahkan.\r\n            "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":18,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { productsAPI, categoriesAPI, cabangAPI } from '@/lib/api';\r\n\r\nexport default function EditProductPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(true);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  \r\n  const [name, setName] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [categoryId, setCategory] = useState('');\r\n  const [isActive, setIsActive] = useState(true);\r\n  const [productType, setProductType] = useState<'SINGLE' | 'VARIANT'>('VARIANT');\r\n  const [price, setPrice] = useState<number>(0);\r\n  \r\n  const [categories, setCategories] = useState<any[]>([]);\r\n  const [cabangs, setCabangs] = useState<any[]>([]);\r\n  const [variants, setVariants] = useState<any[]>([]);\r\n  const [variantTypes, setVariantTypes] = useState({\r\n    type1: '',\r\n    type2: '',\r\n    type3: ''\r\n  });\r\n  const [attributeCount, setAttributeCount] = useState<1 | 2 | 3>(1);\r\n  const [bulkApply, setBulkApply] = useState({\r\n    sku: '',\r\n    price: '',\r\n    stock: ''\r\n  });\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, [params.id]);\r\n\r\n  const fetchData = async () => {\r\n    try {\r\n      const [productRes, categoriesRes, cabangsRes] = await Promise.all([\r\n        productsAPI.getProduct(params.id as string),\r\n        categoriesAPI.getCategories(),\r\n        cabangAPI.getCabangs(),\r\n      ]);\r\n\r\n      const product = productRes.data;\r\n      setName(product.name);\r\n      setDescription(product.description || '');\r\n      setCategory(product.categoryId);\r\n      setIsActive(product.isActive);\r\n      setProductType(product.productType || 'VARIANT');\r\n      \r\n      // Transform variants for editing (include price per cabang and marketplace fields)\r\n      const variantsData = product.variants.map((v: any) => ({\r\n        id: v.id,\r\n        variantName: v.variantName,\r\n        variantValue: v.variantValue,\r\n        sku: v.sku,\r\n        weight: v.weight || '',\r\n        length: v.length || '',\r\n        width: v.width || '',\r\n        height: v.height || '',\r\n        imageUrl: v.imageUrl || '',\r\n        stocks: cabangsRes.data.map((cabang: any) => {\r\n          const existingStock = v.stocks?.find((s: any) => s.cabangId === cabang.id);\r\n          return {\r\n            cabangId: cabang.id,\r\n            cabangName: cabang.name,\r\n            quantity: existingStock?.quantity || 0,\r\n            price: existingStock?.price || 0,\r\n          };\r\n        }),\r\n      }));\r\n      \r\n      setVariants(variantsData);\r\n      setCategories(categoriesRes.data);\r\n      setCabangs(cabangsRes.data);\r\n      \r\n      // Extract variant types from first variant\r\n      if (variantsData.length > 0 && variantsData[0].variantName) {\r\n        const types = variantsData[0].variantName.split(' | ');\r\n        setVariantTypes({\r\n          type1: types[0] || '',\r\n          type2: types[1] || '',\r\n          type3: types[2] || ''\r\n        });\r\n        // Set attribute count based on existing types\r\n        const count = types.filter((t: string) => t && t !== 'Default').length;\r\n        setAttributeCount(Math.max(1, Math.min(3, count)) as 1 | 2 | 3);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching data:', error);\r\n      alert('Gagal memuat data produk');\r\n      router.push('/dashboard/products');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAddVariant = () => {\r\n    // Auto-generate variantName from defined types based on attributeCount\r\n    const typesArray = [variantTypes.type1];\r\n    if (attributeCount >= 2) typesArray.push(variantTypes.type2);\r\n    if (attributeCount >= 3) typesArray.push(variantTypes.type3);\r\n    const types = typesArray.filter(t => t).join(' | ');\r\n    setVariants([\r\n      ...variants,\r\n      {\r\n        variantName: types || 'Default',\r\n        variantValue: '',\r\n        sku: '',\r\n        weight: '',\r\n        length: '',\r\n        width: '',\r\n        height: '',\r\n        imageUrl: '',\r\n        stocks: cabangs.map((cabang) => ({\r\n          cabangId: cabang.id,\r\n          cabangName: cabang.name,\r\n          quantity: 0,\r\n          price: 0,\r\n        })),\r\n      },\r\n    ]);\r\n  };\r\n\r\n  const handleRemoveVariant = (index: number) => {\r\n    setVariants(variants.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleProductTypeChange = (newType: 'SINGLE' | 'VARIANT') => {\r\n    setProductType(newType);\r\n    \r\n    if (newType === 'SINGLE' && variants.length === 0) {\r\n      // Create default variant for SINGLE product\r\n      setVariants([{\r\n        variantName: 'Default',\r\n        variantValue: 'Standard',\r\n        sku: name.toUpperCase().replace(/\\s+/g, '-') + '-01',\r\n        stocks: cabangs.map((cabang) => ({\r\n          cabangId: cabang.id,\r\n          cabangName: cabang.name,\r\n          quantity: 0,\r\n          price: price || 0, // Price per cabang\r\n        })),\r\n      }]);\r\n    }\r\n  };\r\n\r\n  const handleVariantChange = (index: number, field: string, value: string) => {\r\n    const updated = [...variants];\r\n    updated[index][field] = value;\r\n    setVariants(updated);\r\n  };\r\n\r\n  const handleStockChange = (variantIndex: number, cabangIndex: number, field: string, value: string) => {\r\n    setVariants(prevVariants => {\r\n      const updated = prevVariants.map((variant, vIdx) => {\r\n        if (vIdx === variantIndex) {\r\n          return {\r\n            ...variant,\r\n            stocks: variant.stocks.map((stock: any, sIdx: number) => {\r\n              if (sIdx === cabangIndex) {\r\n                // Handle both quantity and price fields\r\n                if (field === 'price') {\r\n                  return {\r\n                    ...stock,\r\n                    [field]: parseFloat(value) || 0\r\n                  };\r\n                } else {\r\n                  return {\r\n                    ...stock,\r\n                    [field]: parseInt(value) || 0\r\n                  };\r\n                }\r\n              }\r\n              return stock;\r\n            })\r\n          };\r\n        }\r\n        return variant;\r\n      });\r\n      return updated;\r\n    });\r\n  };\r\n\r\n  const applyBulkValues = () => {\r\n    const updated = variants.map((v, index) => ({\r\n      ...v,\r\n      ...(bulkApply.sku && { sku: `${bulkApply.sku}${index + 1}` }),\r\n      ...(bulkApply.stock && {\r\n        stocks: v.stocks.map((s: any) => ({\r\n          ...s,\r\n          quantity: parseInt(bulkApply.stock) || s.quantity\r\n        }))\r\n      }),\r\n      ...(bulkApply.price && {\r\n        stocks: v.stocks.map((s: any) => ({\r\n          ...s,\r\n          price: parseFloat(bulkApply.price) || s.price\r\n        }))\r\n      })\r\n    }));\r\n    setVariants(updated);\r\n    setBulkApply({ sku: '', price: '', stock: '' });\r\n    alert(`Nilai berhasil diterapkan ke ${variants.length} varian!`);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!name || !categoryId) {\r\n      alert('Nama dan kategori wajib diisi!');\r\n      return;\r\n    }\r\n\r\n    // Validation based on product type\r\n    if (productType === 'SINGLE') {\r\n      // Validate SINGLE product has default variant with stocks\r\n      if (variants.length === 0 || !variants[0].stocks || variants[0].stocks.length === 0) {\r\n        alert('Produk harus punya harga dan stok minimal di 1 cabang!');\r\n        return;\r\n      }\r\n      const hasPrice = variants[0].stocks.some((s: any) => s.price && s.price > 0);\r\n      if (!hasPrice) {\r\n        alert('Harga produk harus diisi minimal di 1 cabang!');\r\n        return;\r\n      }\r\n    } else {\r\n      // VARIANT validation\r\n      if (variants.length === 0) {\r\n        alert('Minimal harus ada 1 varian!');\r\n        return;\r\n      }\r\n\r\n      for (const variant of variants) {\r\n        if (!variant.variantName || !variant.variantValue || !variant.sku) {\r\n          alert('Semua varian harus lengkap (Nama, Value, SKU)!');\r\n          return;\r\n        }\r\n        // Validate that at least one cabang has a price\r\n        const hasPrice = variant.stocks.some((s: any) => s.price && s.price > 0);\r\n        if (!hasPrice) {\r\n          alert(`Varian \"${variant.variantName}: ${variant.variantValue}\" harus punya harga minimal di 1 cabang!`);\r\n          return;\r\n        }\r\n      }\r\n    }\r\n\r\n    setSubmitting(true);\r\n    try {\r\n      const updateData: any = {\r\n        name,\r\n        description,\r\n        categoryId,\r\n        isActive,\r\n        productType,\r\n      };\r\n\r\n      // Send variants with stocks and marketplace fields\r\n      if (variants.length > 0) {\r\n        updateData.variants = variants.map((v) => ({\r\n          id: v.id,\r\n          variantName: v.variantName || 'Default',\r\n          variantValue: v.variantValue || 'Standard',\r\n          sku: v.sku,\r\n          weight: v.weight ? parseInt(v.weight) : null,\r\n          length: v.length ? parseInt(v.length) : null,\r\n          width: v.width ? parseInt(v.width) : null,\r\n          height: v.height ? parseInt(v.height) : null,\r\n          imageUrl: v.imageUrl || null,\r\n          stocks: v.stocks.map((s: any) => ({\r\n            cabangId: s.cabangId,\r\n            quantity: s.quantity,\r\n            price: s.price\r\n          })),\r\n        }));\r\n      }\r\n\r\n      await productsAPI.updateProduct(params.id as string, updateData);\r\n\r\n      alert('Produk berhasil diupdate!');\r\n      router.push(`/dashboard/products/${params.id}`);\r\n    } catch (error: any) {\r\n      console.error('Error updating product:', error);\r\n      alert(error.response?.data?.message || 'Gagal update produk');\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-5xl mx-auto px-4\">\r\n      <div className=\"mb-6\">\r\n        <button\r\n          onClick={() => router.back()}\r\n          className=\"text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 font-medium mb-2 flex items-center\"\r\n        >\r\n          <svg className=\"w-5 h-5 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n          </svg>\r\n          Kembali\r\n        </button>\r\n      </div>\r\n\r\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n        {/* Product Info */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6\">\r\n          <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">Informasi Produk</h2>\r\n          \r\n          {/* Product Type Toggle */}\r\n          <div className=\"mb-6\">\r\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3\">\r\n              Tipe Produk *\r\n            </label>\r\n            <div className=\"flex space-x-3\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => handleProductTypeChange('SINGLE')}\r\n                className={`flex-1 px-6 py-3 rounded-lg font-medium transition-all ${\r\n                  productType === 'SINGLE'\r\n                    ? 'bg-slate-600 dark:bg-slate-700 text-white shadow-md'\r\n                    : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                }`}\r\n              >\r\n                Produk Single\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => handleProductTypeChange('VARIANT')}\r\n                className={`flex-1 px-6 py-3 rounded-lg font-medium transition-all ${\r\n                  productType === 'VARIANT'\r\n                    ? 'bg-slate-600 dark:bg-slate-700 text-white shadow-md'\r\n                    : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                }`}\r\n              >\r\n                Produk Variant\r\n              </button>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              {productType === 'SINGLE' \r\n                ? 'Produk dengan harga tunggal tanpa variasi'\r\n                : 'Produk dengan multiple varian (ukuran, warna, dll)'\r\n              }\r\n            </p>\r\n          </div>\r\n          \r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Nama Produk *\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                value={name}\r\n                onChange={(e) => setName(e.target.value)}\r\n                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                required\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Kategori *\r\n              </label>\r\n              <select\r\n                value={categoryId}\r\n                onChange={(e) => setCategory(e.target.value)}\r\n                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                required\r\n              >\r\n                <option value=\"\">Pilih Kategori</option>\r\n                {categories.map((cat) => (\r\n                  <option key={cat.id} value={cat.id}>\r\n                    {cat.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Status\r\n              </label>\r\n              <select\r\n                value={isActive ? 'true' : 'false'}\r\n                onChange={(e) => setIsActive(e.target.value === 'true')}\r\n                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n              >\r\n                <option value=\"true\">Aktif</option>\r\n                <option value=\"false\">Nonaktif</option>\r\n              </select>\r\n            </div>\r\n\r\n            {/* SKU for SINGLE products only */}\r\n            {productType === 'SINGLE' && variants.length > 0 && (\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  SKU\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={variants[0].sku || ''}\r\n                  onChange={(e) => {\r\n                    const newVariants = [...variants];\r\n                    newVariants[0].sku = e.target.value;\r\n                    setVariants(newVariants);\r\n                  }}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                  placeholder=\"Contoh: PROD-001\"\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"mt-4\">\r\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n              Deskripsi\r\n            </label>\r\n            <textarea\r\n              value={description}\r\n              onChange={(e) => setDescription(e.target.value)}\r\n              className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n              rows={3}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Stock Management for SINGLE products */}\r\n        {productType === 'SINGLE' && variants.length > 0 && variants[0].stocks && (\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6\">\r\n            <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">Harga & Stok per Cabang</h2>\r\n            <div className=\"space-y-3\">\r\n              {variants[0].stocks.map((stock: any, stockIndex: number) => (\r\n                <div key={`stock-${stockIndex}-${stock.cabangId}`} className=\"grid grid-cols-1 md:grid-cols-3 gap-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg\">\r\n                  <div className=\"flex items-center text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                    {stock.cabangName}\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">Harga</label>\r\n                    <div className=\"relative\">\r\n                      <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 text-sm\">\r\n                        Rp\r\n                      </span>\r\n                      <input\r\n                        type=\"text\"\r\n                        inputMode=\"numeric\"\r\n                        value={variants[0].stocks[stockIndex]?.price ? Number(variants[0].stocks[stockIndex].price).toLocaleString('id-ID') : ''}\r\n                        onChange={(e) => {\r\n                          const val = e.target.value.replace(/[^0-9]/g, '').replace(/^0+(?=\\d)/, '');\r\n                          handleStockChange(0, stockIndex, 'price', val);\r\n                        }}\r\n                        onBlur={(e) => {\r\n                          const num = parseFloat(e.target.value.replace(/\\./g, '')) || 0;\r\n                          handleStockChange(0, stockIndex, 'price', String(num));\r\n                        }}\r\n                        className=\"w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                        placeholder=\"50.000\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">Jumlah Stok</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      inputMode=\"numeric\"\r\n                      value={variants[0].stocks[stockIndex]?.quantity || ''}\r\n                      onChange={(e) => {\r\n                        const val = e.target.value.replace(/[^0-9]/g, '').replace(/^0+/, '') || '0';\r\n                        handleStockChange(0, stockIndex, 'quantity', val);\r\n                      }}\r\n                      onBlur={(e) => {\r\n                        const num = parseInt(e.target.value) || 0;\r\n                        handleStockChange(0, stockIndex, 'quantity', String(num));\r\n                      }}\r\n                      className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                      placeholder=\"Jumlah\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Variants - Only show for VARIANT type */}\r\n        {productType === 'VARIANT' && (\r\n        <>\r\n          {/* Variant Type Definition */}\r\n          <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800 p-5 mb-4\">\r\n            <div className=\"flex items-center justify-between mb-3\">\r\n              <h3 className=\"text-sm font-semibold text-blue-900 dark:text-blue-300 flex items-center gap-2\">\r\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\r\n                </svg>\r\n                Definisi Tipe Varian\r\n              </h3>\r\n              <div className=\"flex items-center gap-1\">\r\n                {attributeCount > 1 && (\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => {\r\n                      setAttributeCount((prev) => Math.max(1, prev - 1) as 1 | 2 | 3);\r\n                      if (attributeCount === 3) setVariantTypes(v => ({ ...v, type3: '' }));\r\n                      if (attributeCount === 2) setVariantTypes(v => ({ ...v, type2: '' }));\r\n                    }}\r\n                    className=\"w-8 h-8 flex items-center justify-center rounded-lg bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-200 dark:hover:bg-red-900/50 transition text-lg font-bold\"\r\n                    title=\"Kurangi tipe\"\r\n                  >\r\n                    ΓêÆ\r\n                  </button>\r\n                )}\r\n                {attributeCount < 3 && (\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setAttributeCount((prev) => Math.min(3, prev + 1) as 1 | 2 | 3)}\r\n                    className=\"w-8 h-8 flex items-center justify-center rounded-lg bg-blue-200 dark:bg-blue-800 text-blue-700 dark:text-blue-300 hover:bg-blue-300 dark:hover:bg-blue-700 transition text-lg font-bold\"\r\n                    title=\"Tambah tipe\"\r\n                  >\r\n                    +\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            <div className={`grid gap-3 ${attributeCount === 1 ? 'grid-cols-1' : attributeCount === 2 ? 'grid-cols-1 sm:grid-cols-2' : 'grid-cols-1 sm:grid-cols-3'}`}>\r\n              <div>\r\n                <label className=\"block text-xs font-medium text-blue-900 dark:text-blue-300 mb-1.5\">\r\n                  Tipe 1 <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={variantTypes.type1}\r\n                  onChange={(e) => {\r\n                    const newType1 = e.target.value;\r\n                    setVariantTypes({ ...variantTypes, type1: newType1 });\r\n                    const typesArray = [newType1];\r\n                    if (attributeCount >= 2) typesArray.push(variantTypes.type2);\r\n                    if (attributeCount >= 3) typesArray.push(variantTypes.type3);\r\n                    const newTypes = typesArray.filter(t => t).join(' | ');\r\n                    setVariants(variants.map(v => ({ ...v, variantName: newTypes || 'Default' })));\r\n                  }}\r\n                  className=\"w-full px-3 py-2 border border-blue-300 dark:border-blue-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                  placeholder=\"Contoh: Warna\"\r\n                />\r\n              </div>\r\n              {attributeCount >= 2 && (\r\n                <div>\r\n                  <label className=\"block text-xs font-medium text-blue-900 dark:text-blue-300 mb-1.5\">\r\n                    Tipe 2\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={variantTypes.type2}\r\n                    onChange={(e) => {\r\n                      const newType2 = e.target.value;\r\n                      setVariantTypes({ ...variantTypes, type2: newType2 });\r\n                      const typesArray = [variantTypes.type1, newType2];\r\n                      if (attributeCount >= 3) typesArray.push(variantTypes.type3);\r\n                      const newTypes = typesArray.filter(t => t).join(' | ');\r\n                      setVariants(variants.map(v => ({ ...v, variantName: newTypes || 'Default' })));\r\n                    }}\r\n                    className=\"w-full px-3 py-2 border border-blue-300 dark:border-blue-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                    placeholder=\"Contoh: Ukuran\"\r\n                  />\r\n                </div>\r\n              )}\r\n              {attributeCount >= 3 && (\r\n                <div>\r\n                  <label className=\"block text-xs font-medium text-blue-900 dark:text-blue-300 mb-1.5\">\r\n                    Tipe 3\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={variantTypes.type3}\r\n                    onChange={(e) => {\r\n                      const newType3 = e.target.value;\r\n                      setVariantTypes({ ...variantTypes, type3: newType3 });\r\n                      const typesArray = [variantTypes.type1, variantTypes.type2, newType3];\r\n                      const newTypes = typesArray.filter(t => t).join(' | ');\r\n                      setVariants(variants.map(v => ({ ...v, variantName: newTypes || 'Default' })));\r\n                    }}\r\n                    className=\"w-full px-3 py-2 border border-blue-300 dark:border-blue-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                    placeholder=\"Contoh: Model\"\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            {attributeCount < 3 && (\r\n              <p className=\"text-xs text-blue-600 dark:text-blue-400 mt-3 flex items-center gap-1\">\r\n                <svg className=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n                Klik + untuk menambah tipe varian (maks. 3)\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white\">Varian Produk</h2>\r\n            {variantTypes.type1 && (\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleAddVariant}\r\n                className=\"px-4 py-2 bg-slate-600 dark:bg-slate-700 text-white rounded-lg hover:bg-slate-700 dark:hover:bg-slate-600 text-sm font-medium flex items-center gap-2\"\r\n              >\r\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n                </svg>\r\n                Tambah Varian\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Bulk Apply Form - Always visible */}\r\n          <div className=\"mb-6 p-4 bg-slate-50 dark:bg-gray-700 rounded-lg border border-slate-200 dark:border-gray-600\">\r\n            <h3 className=\"text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3\">Terapkan ke Semua Varian</h3>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-3\">\r\n              <div>\r\n                <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\r\n                  SKU Prefix\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={bulkApply.sku}\r\n                  onChange={(e) => setBulkApply({...bulkApply, sku: e.target.value})}\r\n                  className=\"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                  placeholder=\"e.g., PRD-\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\r\n                  Stok (ke semua cabang)\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  value={bulkApply.stock}\r\n                  onChange={(e) => setBulkApply({...bulkApply, stock: e.target.value})}\r\n                  className=\"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                  placeholder=\"0\"\r\n                  min=\"0\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\r\n                  Harga (Rp)\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  inputMode=\"numeric\"\r\n                  value={bulkApply.price ? Number(bulkApply.price).toLocaleString('id-ID') : ''}\r\n                  onChange={(e) => {\r\n                    const val = e.target.value.replace(/[^0-9]/g, '');\r\n                    setBulkApply({...bulkApply, price: val});\r\n                  }}\r\n                  className=\"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                  placeholder=\"50.000\"\r\n                />\r\n              </div>\r\n              <div className=\"flex items-end\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={applyBulkValues}\r\n                  className=\"w-full px-4 py-1.5 bg-slate-600 dark:bg-slate-700 text-white rounded-lg hover:bg-slate-700 dark:hover:bg-slate-600 text-sm font-medium\"\r\n                >\r\n                  Terapkan\r\n                </button>\r\n              </div>\r\n            </div>\r\n            <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n              SKU akan menambahkan nomor urut (e.g., PRD-1, PRD-2). Kosongkan field yang tidak ingin diubah.\r\n            </p>\r\n          </div>\r\n\r\n          \r\n\r\n          {variants.map((variant, variantIndex) => (\r\n            <div key={variantIndex} className=\"mb-4 p-4 md:p-5 border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 hover:border-slate-400 dark:hover:border-slate-600 transition-colors\">\r\n              {/* Header */}\r\n              <div className=\"flex items-center justify-between mb-4 pb-3 border-b border-gray-100 dark:border-gray-700\">\r\n                <div className=\"flex items-center gap-2.5\">\r\n                  <div className=\"flex items-center justify-center w-7 h-7 bg-slate-600 dark:bg-slate-700 text-white rounded-md font-semibold text-sm\">\r\n                    {variantIndex + 1}\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-sm font-semibold text-gray-900 dark:text-white\">\r\n                      {variant.variantValue \r\n                        ? variant.variantValue \r\n                        : `Varian #${variantIndex + 1}`}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-0.5\">{variant.sku || 'SKU belum diisi'}</p>\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => handleRemoveVariant(variantIndex)}\r\n                  className=\"px-3 py-1.5 text-xs font-medium text-red-600 dark:text-red-400 hover:text-white hover:bg-red-600 dark:hover:bg-red-700 border border-red-600 dark:border-red-500 rounded-md transition-colors\"\r\n                >\r\n                  Hapus\r\n                </button>\r\n              </div>\r\n\r\n              {/* Variant Details */}\r\n              <div className=\"space-y-3\">\r\n                {/* Value Inputs */}\r\n                <div className={`grid grid-cols-1 gap-3 ${attributeCount === 1 ? 'md:grid-cols-1' : attributeCount === 2 ? 'md:grid-cols-2' : 'md:grid-cols-3'}`}>\r\n                  {variantTypes.type1 && (\r\n                    <div>\r\n                      <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5\">\r\n                        {variantTypes.type1} <span className=\"text-red-500\">*</span>\r\n                      </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={variant.variantValue.split(' | ')[0] || ''}\r\n                        onChange={(e) => {\r\n                          const values = variant.variantValue.split(' | ');\r\n                          values[0] = e.target.value;\r\n                          const newValues = values.slice(0, attributeCount).filter((v: string) => v);\r\n                          handleVariantChange(variantIndex, 'variantValue', newValues.join(' | '));\r\n                        }}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm focus:ring-1 focus:ring-slate-500 focus:border-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                        placeholder={`Contoh: ${variantTypes.type1 === 'Warna' ? 'Merah' : variantTypes.type1 === 'Ukuran' ? '25' : 'Value'}`}\r\n                      />\r\n                    </div>\r\n                  )}\r\n\r\n                  {attributeCount >= 2 && variantTypes.type2 && (\r\n                    <div>\r\n                      <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5\">\r\n                        {variantTypes.type2}\r\n                      </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={variant.variantValue.split(' | ')[1] || ''}\r\n                        onChange={(e) => {\r\n                          const values = variant.variantValue.split(' | ');\r\n                          while (values.length < 2) values.push('');\r\n                          values[1] = e.target.value;\r\n                          const newValues = values.slice(0, attributeCount).filter((v: string) => v);\r\n                          handleVariantChange(variantIndex, 'variantValue', newValues.join(' | '));\r\n                        }}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm focus:ring-1 focus:ring-slate-500 focus:border-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                        placeholder={`Contoh: ${variantTypes.type2 === 'Ukuran' ? '25' : variantTypes.type2 === 'Model' ? '2024' : 'Value'}`}\r\n                      />\r\n                    </div>\r\n                  )}\r\n\r\n                  {attributeCount >= 3 && variantTypes.type3 && (\r\n                    <div>\r\n                      <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5\">\r\n                        {variantTypes.type3}\r\n                      </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={variant.variantValue.split(' | ')[2] || ''}\r\n                        onChange={(e) => {\r\n                          const values = variant.variantValue.split(' | ');\r\n                          while (values.length < 3) values.push('');\r\n                          values[2] = e.target.value;\r\n                          const newValues = values.slice(0, attributeCount).filter((v: string) => v);\r\n                          handleVariantChange(variantIndex, 'variantValue', newValues.join(' | '));\r\n                        }}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm focus:ring-1 focus:ring-slate-500 focus:border-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                        placeholder={`Contoh: ${variantTypes.type3 === 'Model' ? '2024' : 'Value'}`}\r\n                      />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5\">\r\n                    SKU\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={variant.sku}\r\n                    onChange={(e) => handleVariantChange(variantIndex, 'sku', e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-mono focus:ring-1 focus:ring-slate-500 focus:border-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                    placeholder=\"VAR-009\"\r\n                  />\r\n                </div>\r\n\r\n                {/* Marketplace Info - Collapsible */}\r\n                <details className=\"group border border-gray-200 dark:border-gray-600 rounded-md\">\r\n                  <summary className=\"px-3 py-2 bg-gray-50 dark:bg-gray-700 cursor-pointer text-xs font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2 rounded-md\">\r\n                    <svg className=\"w-4 h-4 transition-transform group-open:rotate-90\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n                    </svg>\r\n                    Info Marketplace (Opsional)\r\n                  </summary>\r\n                  <div className=\"p-3 space-y-3 bg-white dark:bg-gray-800\">\r\n                    <div>\r\n                      <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\r\n                        URL Gambar\r\n                      </label>\r\n                      <input\r\n                        type=\"url\"\r\n                        value={variant.imageUrl || ''}\r\n                        onChange={(e) => handleVariantChange(variantIndex, 'imageUrl', e.target.value)}\r\n                        className=\"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                        placeholder=\"https://example.com/image.jpg\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\r\n                          Berat (gram)\r\n                        </label>\r\n                        <input\r\n                          type=\"number\"\r\n                          min=\"0\"\r\n                          value={variant.weight || ''}\r\n                          onChange={(e) => handleVariantChange(variantIndex, 'weight', e.target.value)}\r\n                          className=\"w-full px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                          placeholder=\"100\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\r\n                          Panjang (cm)\r\n                        </label>\r\n                        <input\r\n                          type=\"number\"\r\n                          min=\"0\"\r\n                          value={variant.length || ''}\r\n                          onChange={(e) => handleVariantChange(variantIndex, 'length', e.target.value)}\r\n                          className=\"w-full px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                          placeholder=\"10\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\r\n                          Lebar (cm)\r\n                        </label>\r\n                        <input\r\n                          type=\"number\"\r\n                          min=\"0\"\r\n                          value={variant.width || ''}\r\n                          onChange={(e) => handleVariantChange(variantIndex, 'width', e.target.value)}\r\n                          className=\"w-full px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                          placeholder=\"5\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\r\n                          Tinggi (cm)\r\n                        </label>\r\n                        <input\r\n                          type=\"number\"\r\n                          min=\"0\"\r\n                          value={variant.height || ''}\r\n                          onChange={(e) => handleVariantChange(variantIndex, 'height', e.target.value)}\r\n                          className=\"w-full px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                          placeholder=\"3\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </details>\r\n\r\n                {/* Harga & Stock per Cabang Section */}\r\n                <div className=\"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700\">\r\n                  <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                    Harga & Stok per Cabang\r\n                  </label>\r\n                  <div className=\"space-y-2\">\r\n                    {variant.stocks.map((stock: any, stockIndex: number) => (\r\n                      <div key={stockIndex} className=\"grid grid-cols-1 md:grid-cols-3 gap-3 p-2.5 bg-gray-50 dark:bg-gray-700 rounded-md\">\r\n                        <div className=\"flex items-center\">\r\n                          <span className=\"text-sm text-gray-700 dark:text-gray-300 font-medium\">\r\n                            {stock.cabangName}\r\n                          </span>\r\n                        </div>\r\n                        <div>\r\n                          <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">Harga</label>\r\n                          <div className=\"relative\">\r\n                            <span className=\"absolute left-2 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 text-xs\">\r\n                              Rp\r\n                            </span>\r\n                            <input\r\n                              type=\"text\"\r\n                              inputMode=\"numeric\"\r\n                              value={stock.price ? Number(stock.price).toLocaleString('id-ID') : ''}\r\n                              onChange={(e) => {\r\n                                const val = e.target.value.replace(/[^0-9]/g, '').replace(/^0+(?=\\d)/, '');\r\n                                handleStockChange(variantIndex, stockIndex, 'price', val);\r\n                              }}\r\n                              onBlur={(e) => {\r\n                                const num = parseFloat(e.target.value.replace(/\\./g, '')) || 0;\r\n                                handleStockChange(variantIndex, stockIndex, 'price', String(num));\r\n                              }}\r\n                              className=\"w-full pl-8 pr-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md text-sm focus:ring-1 focus:ring-slate-500 focus:border-slate-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                              placeholder=\"50.000\"\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">Stok</label>\r\n                          <input\r\n                            type=\"text\"\r\n                            inputMode=\"numeric\"\r\n                            value={stock.quantity || ''}\r\n                            onChange={(e) => {\r\n                              const val = e.target.value.replace(/[^0-9]/g, '').replace(/^0+/, '') || '0';\r\n                              handleStockChange(variantIndex, stockIndex, 'quantity', val);\r\n                            }}\r\n                            onBlur={(e) => {\r\n                              const num = parseInt(e.target.value) || 0;\r\n                              handleStockChange(variantIndex, stockIndex, 'quantity', String(num));\r\n                            }}\r\n                            className=\"w-full px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md text-sm text-center font-semibold focus:ring-1 focus:ring-slate-500 focus:border-slate-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                            placeholder=\"0\"\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n\r\n          {variants.length === 0 && variantTypes.type1 && (\r\n            <p className=\"text-center text-gray-500 dark:text-gray-400 py-8\">\r\n              Belum ada varian. Klik tombol \"Tambah Varian\" untuk menambahkan.\r\n            </p>\r\n          )}\r\n          {variants.length === 0 && !variantTypes.type1 && (\r\n            <p className=\"text-center text-orange-600 dark:text-orange-400 py-8\">\r\n              Isi Type 1 terlebih dahulu untuk menambahkan varian.\r\n            </p>\r\n          )}\r\n        </div>\r\n        </>\r\n        )}\r\n\r\n        {/* Submit */}\r\n        <div className=\"flex items-center justify-end space-x-4\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => router.back()}\r\n            className=\"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 font-medium\"\r\n          >\r\n            Batal\r\n          </button>\r\n          <button\r\n            type=\"submit\"\r\n            disabled={submitting}\r\n            className=\"px-6 py-3 bg-slate-600 text-white rounded-lg hover:bg-slate-700 font-medium disabled:opacity-50\"\r\n          >\r\n            {submitting ? 'Menyimpan...' : 'Simpan Perubahan'}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\products\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[353,356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[353,356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":13,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchProduct'. Either include it or remove the dependency array.","line":19,"column":6,"nodeType":"ArrayExpression","endLine":19,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [fetchProduct, params.id]","fix":{"range":[526,537],"text":"[fetchProduct, params.id]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1238,1241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1238,1241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5063,5066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5063,5066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5116,5119],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5116,5119],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":171,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7531,7534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7531,7534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7610,7613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7610,7613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":210,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9667,9670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9667,9670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":211,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9724,9727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9724,9727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { productsAPI } from '@/lib/api';\r\nimport { getAuth } from '@/lib/auth';\r\n\r\nexport default function ProductDetailPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const [product, setProduct] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const { user } = getAuth();\r\n\r\n  useEffect(() => {\r\n    if (params.id) {\r\n      fetchProduct();\r\n    }\r\n  }, [params.id]);\r\n\r\n  const fetchProduct = async () => {\r\n    try {\r\n      const res = await productsAPI.getProduct(params.id as string);\r\n      setProduct(res.data);\r\n    } catch (error) {\r\n      console.error('Error fetching product:', error);\r\n      alert('Produk tidak ditemukan');\r\n      router.push('/dashboard/products');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    if (!confirm('Yakin ingin menghapus produk ini? Data tidak bisa dikembalikan!')) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await productsAPI.deleteProduct(params.id as string);\r\n      alert('Produk berhasil dihapus!');\r\n      router.push('/dashboard/products');\r\n    } catch (error: any) {\r\n      console.error('Error deleting product:', error);\r\n      alert(error.response?.data?.message || 'Gagal menghapus produk');\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!product) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-6xl mx-auto px-4 sm:px-6\">\r\n      {/* Header */}\r\n      <div className=\"mb-4 md:mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n        <div className=\"flex-1\">\r\n          <button\r\n            onClick={() => router.back()}\r\n            className=\"text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 font-medium mb-2 flex items-center text-sm md:text-base\"\r\n          >\r\n            <svg className=\"w-4 h-4 md:w-5 md:h-5 mr-1\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\r\n            </svg>\r\n            Kembali\r\n          </button>\r\n          <h1 className=\"text-2xl md:text-3xl font-bold text-gray-900 dark:text-white\">{product.name}</h1>\r\n          <p className=\"text-gray-600 dark:text-gray-400 mt-1 text-sm md:text-base\">{product.category?.name}</p>\r\n        </div>\r\n        <div className=\"flex items-center gap-2 md:gap-3\">\r\n          <a\r\n            href={`/dashboard/products/${product.id}/edit`}\r\n            className=\"flex-1 sm:flex-none px-4 md:px-6 py-2 md:py-3 bg-slate-600 dark:bg-slate-700 text-white rounded-lg hover:bg-slate-700 dark:hover:bg-slate-600 font-medium text-center text-sm md:text-base transition\"\r\n          >\r\n            Edit Produk\r\n          </a>\r\n          <button\r\n            onClick={handleDelete}\r\n            className=\"flex-1 sm:flex-none px-4 md:px-6 py-2 md:py-3 bg-red-600 dark:bg-red-700 text-white rounded-lg hover:bg-red-700 dark:hover:bg-red-600 font-medium text-sm md:text-base transition\"\r\n          >\r\n            Hapus\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Product Info */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6 mb-4 md:mb-6\">\r\n        <div className=\"lg:col-span-2 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 md:p-6\">\r\n          <h2 className=\"text-lg md:text-xl font-semibold text-gray-900 dark:text-white mb-4\">Informasi Produk</h2>\r\n          \r\n          <div className=\"space-y-3 md:space-y-4\">\r\n            <div>\r\n              <label className=\"text-xs md:text-sm font-medium text-gray-600 dark:text-gray-400\">Nama Produk</label>\r\n              <p className=\"text-base md:text-lg font-semibold text-gray-900 dark:text-white\">{product.name}</p>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"text-xs md:text-sm font-medium text-gray-600 dark:text-gray-400\">Deskripsi</label>\r\n              <p className=\"text-sm md:text-base text-gray-900 dark:text-gray-300\">{product.description || '-'}</p>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4\">\r\n              <div>\r\n                <label className=\"text-xs md:text-sm font-medium text-gray-600 dark:text-gray-400\">Kategori</label>\r\n                <p className=\"text-sm md:text-base text-gray-900 dark:text-white\">{product.category?.name}</p>\r\n              </div>\r\n              <div>\r\n                <label className=\"text-xs md:text-sm font-medium text-gray-600 dark:text-gray-400\">Range Harga</label>\r\n                {(() => {\r\n                  // Get all prices from all stocks across all variants\r\n                  const prices: number[] = [];\r\n                  product.variants?.forEach((v: any) => {\r\n                    v.stocks?.forEach((s: any) => {\r\n                      if (s.price) prices.push(s.price);\r\n                    });\r\n                  });\r\n                  \r\n                  if (prices.length === 0) {\r\n                    return <p className=\"text-xl md:text-2xl font-bold text-slate-600 dark:text-slate-400\">-</p>;\r\n                  }\r\n                  \r\n                  const minPrice = Math.min(...prices);\r\n                  const maxPrice = Math.max(...prices);\r\n                  return (\r\n                    <p className=\"text-xl md:text-2xl font-bold text-slate-600 dark:text-slate-400\">\r\n                      {minPrice === maxPrice \r\n                        ? `Rp ${minPrice.toLocaleString('id-ID')}`\r\n                        : `Rp ${minPrice.toLocaleString('id-ID')} - ${maxPrice.toLocaleString('id-ID')}`\r\n                      }\r\n                    </p>\r\n                  );\r\n                })()}\r\n              </div>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"text-xs md:text-sm font-medium text-gray-600 dark:text-gray-400\">Status</label>\r\n              <p className=\"mt-1\">\r\n                <span\r\n                  className={`px-2 md:px-3 py-0.5 md:py-1 text-xs md:text-sm font-semibold rounded-full ${\r\n                    product.isActive\r\n                      ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300'\r\n                      : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300'\r\n                  }`}\r\n                >\r\n                  {product.isActive ? 'Aktif' : 'Nonaktif'}\r\n                </span>\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-gradient-to-br from-slate-500 to-slate-600 dark:from-slate-700 dark:to-slate-800 rounded-xl shadow-lg p-4 md:p-6 text-white\">\r\n          <h3 className=\"text-base md:text-lg font-semibold mb-3 md:mb-4\">Ringkasan</h3>\r\n          <div className=\"space-y-3 md:space-y-4\">\r\n            <div>\r\n              <p className=\"text-slate-100 text-xs md:text-sm\">Total Varian</p>\r\n              <p className=\"text-2xl md:text-3xl font-bold\">{product.variants?.length || 0}</p>\r\n            </div>\r\n            <div>\r\n              <p className=\"text-slate-100 text-xs md:text-sm\">Total Stok (Semua Cabang)</p>\r\n              <p className=\"text-2xl md:text-3xl font-bold\">\r\n                {product.variants?.reduce((total: number, v: any) => {\r\n                  return total + (v.stocks?.reduce((sum: number, s: any) => sum + s.quantity, 0) || 0);\r\n                }, 0) || 0}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Variants & Stock */}\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 md:p-6\">\r\n        <h2 className=\"text-lg md:text-xl font-semibold text-gray-900 dark:text-white mb-4\">Varian & Stok</h2>\r\n        \r\n        {product.variants && product.variants.length > 0 ? (\r\n          <div className=\"overflow-x-auto -mx-4 md:mx-0\">\r\n            <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\r\n              <thead className=\"bg-gray-50 dark:bg-gray-900\">\r\n                <tr>\r\n                  <th className=\"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">\r\n                    Varian\r\n                  </th>\r\n                  <th className=\"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">\r\n                    SKU\r\n                  </th>\r\n                  <th className=\"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">\r\n                    Harga\r\n                  </th>\r\n                  <th className=\"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">\r\n                    Cabang\r\n                  </th>\r\n                  <th className=\"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">\r\n                    Stok\r\n                  </th>\r\n                  <th className=\"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">\r\n                    Status\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\r\n                {product.variants.map((variant: any) => (\r\n                  variant.stocks?.map((stock: any) => (\r\n                    <tr key={`${variant.id}-${stock.id}`} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50\">\r\n                      <td className=\"px-3 md:px-6 py-3 md:py-4 whitespace-nowrap\">\r\n                        <div className=\"text-xs md:text-sm font-medium text-gray-900 dark:text-white\">\r\n                          {variant.variantValue}\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-3 md:px-6 py-3 md:py-4 whitespace-nowrap\">\r\n                        <div className=\"text-xs md:text-sm text-gray-600 dark:text-gray-400 font-mono\">{variant.sku}</div>\r\n                      </td>\r\n                      <td className=\"px-3 md:px-6 py-3 md:py-4 whitespace-nowrap\">\r\n                        <div className=\"text-xs md:text-sm font-semibold text-slate-600 dark:text-slate-400\">\r\n                          Rp {stock.price.toLocaleString('id-ID')}\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-3 md:px-6 py-3 md:py-4 whitespace-nowrap\">\r\n                        <div className=\"text-xs md:text-sm text-gray-600 dark:text-gray-400\">{stock.cabang?.name}</div>\r\n                      </td>\r\n                      <td className=\"px-3 md:px-6 py-3 md:py-4 whitespace-nowrap\">\r\n                        <div className=\"text-base md:text-lg font-bold text-gray-900 dark:text-white\">{stock.quantity}</div>\r\n                      </td>\r\n                      <td className=\"px-3 md:px-6 py-3 md:py-4 whitespace-nowrap\">\r\n                        {stock.quantity <= 5 ? (\r\n                          <span className=\"px-2 py-0.5 md:py-1 text-xs font-semibold rounded-full bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-300\">\r\n                            Menipis\r\n                          </span>\r\n                        ) : (\r\n                          <span className=\"px-2 py-0.5 md:py-1 text-xs font-semibold rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300\">\r\n                            Aman\r\n                          </span>\r\n                        )}\r\n                      </td>\r\n                    </tr>\r\n                  )) || (\r\n                    <tr key={variant.id}>\r\n                      <td colSpan={6} className=\"px-3 md:px-6 py-4 text-center text-xs md:text-sm text-gray-500 dark:text-gray-400\">\r\n                        Belum ada stok untuk varian ini\r\n                      </td>\r\n                    </tr>\r\n                  )\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-center text-gray-500 dark:text-gray-400 py-6 md:py-8 text-sm md:text-base\">Belum ada varian untuk produk ini</p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\products\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\products\\new\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleGeneratedVariantsWithAlert' is assigned a value but never used.","line":48,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":48,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":755,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":755,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42549,42552],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42549,42552],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useNewProductStore } from '@/stores/useNewProductStore';\r\n\r\nexport default function NewProductPage() {\r\n  const router = useRouter();\r\n  \r\n  // Use store for all state\r\n  const {\r\n    categories,\r\n    cabangs,\r\n    loading,\r\n    formData,\r\n    variantTypes,\r\n    attributeCount,\r\n    singleProductStocks,\r\n    variants,\r\n    bulkApply,\r\n    singleBulkApply,\r\n    singleMarketplaceInfo,\r\n    // Actions\r\n    setFormData,\r\n    setVariantTypes,\r\n    setAttributeCount,\r\n    setVariants,\r\n    setBulkApply,\r\n    setSingleBulkApply,\r\n    setSingleMarketplaceInfo,\r\n    initializeData,\r\n    addVariant,\r\n    removeVariant,\r\n    updateVariant,\r\n    handleStockChange,\r\n    handleGeneratedVariants,\r\n    applyBulkValues,\r\n    handleSingleStockChange,\r\n    applySingleBulkValues,\r\n    submitProduct,\r\n  } = useNewProductStore();\r\n\r\n  useEffect(() => {\r\n    initializeData();\r\n  }, [initializeData]);\r\n\r\n  // Handle generated variants with alert\r\n  const handleGeneratedVariantsWithAlert = (generated: Array<{ variantName: string; variantValue: string; sku: string; price: string; stock: string }>) => {\r\n    if (cabangs.length === 0) {\r\n      alert('Belum ada cabang! Tunggu sebentar atau refresh halaman.');\r\n      return;\r\n    }\r\n    handleGeneratedVariants(generated);\r\n    alert(`${generated.length} varian berhasil di-generate!`);\r\n  };\r\n\r\n  // Handle bulk apply with alert\r\n  const handleApplyBulkValues = () => {\r\n    applyBulkValues();\r\n    alert('Nilai berhasil diterapkan ke semua varian!');\r\n  };\r\n\r\n  // Handle single bulk apply with alert\r\n  const handleApplySingleBulkValues = () => {\r\n    applySingleBulkValues();\r\n    alert('Harga & stok berhasil diterapkan ke semua cabang!');\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    const result = await submitProduct();\r\n    \r\n    if (result.success) {\r\n      alert('Produk berhasil ditambahkan!');\r\n      router.push('/dashboard/products');\r\n    } else {\r\n      alert(result.error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto px-4 md:px-6\">\r\n      {/* Breadcrumb */}\r\n      <nav className=\"flex items-center gap-2 text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-4 sm:mb-6\">\r\n        <button onClick={() => router.push('/dashboard')} className=\"hover:text-gray-900 dark:hover:text-white transition\">\r\n          Home\r\n        </button>\r\n        <span>ΓÇ║</span>\r\n        <button onClick={() => router.push('/dashboard/products')} className=\"hover:text-gray-900 dark:hover:text-white transition\">\r\n          Kelola Produk\r\n        </button>\r\n        <span>ΓÇ║</span>\r\n        <span className=\"font-semibold text-gray-900 dark:text-white\">Tambah Produk Baru</span>\r\n      </nav>\r\n\r\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n        {/* Basic Info */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6\">\r\n          <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Informasi Produk</h2>\r\n          \r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Nama Produk *\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                required\r\n                value={formData.name}\r\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                placeholder=\"Contoh: Kaos Putih\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                Deskripsi\r\n              </label>\r\n              <textarea\r\n                value={formData.description}\r\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                rows={3}\r\n                className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                placeholder=\"Deskripsi produk...\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 gap-4\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Kategori *\r\n                </label>\r\n                <select\r\n                  required\r\n                  value={formData.categoryId}\r\n                  onChange={(e) => setFormData({ ...formData, categoryId: e.target.value })}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                >\r\n                  <option value=\"\">Pilih Kategori</option>\r\n                  {categories.map((cat) => (\r\n                    <option key={cat.id} value={cat.id}>\r\n                      {cat.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Tipe Produk *\r\n                </label>\r\n                <div className=\"grid grid-cols-2 gap-2\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setFormData({ ...formData, productType: 'SINGLE' })}\r\n                    className={`px-3 py-2.5 rounded-lg border-2 font-medium transition-all text-sm ${\r\n                      formData.productType === 'SINGLE'\r\n                        ? 'border-slate-500 bg-slate-50 dark:bg-slate-900/50 text-slate-700 dark:text-slate-300'\r\n                        : 'border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-400 dark:hover:border-gray-500'\r\n                    }`}\r\n                  >\r\n                    Produk Tunggal\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setFormData({ ...formData, productType: 'VARIANT' })}\r\n                    className={`px-3 py-2.5 rounded-lg border-2 font-medium transition-all text-sm ${\r\n                      formData.productType === 'VARIANT'\r\n                        ? 'border-slate-500 bg-slate-50 dark:bg-slate-900/50 text-slate-700 dark:text-slate-300'\r\n                        : 'border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-400 dark:hover:border-gray-500'\r\n                    }`}\r\n                  >\r\n                    Produk Varian\r\n                  </button>\r\n                </div>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n                  {formData.productType === 'SINGLE' \r\n                    ? 'Produk tanpa varian (contoh: Pulpen merek X)' \r\n                    : 'Produk dengan varian (contoh: Baju SD nomor 6, 8, 10)'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Show SKU input and per-cabang pricing for SINGLE product */}\r\n            {formData.productType === 'SINGLE' && (\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                    SKU <span className=\"text-red-500\">*</span>\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    required\r\n                    value={formData.sku || ''}\r\n                    onChange={(e) => setFormData({ ...formData, sku: e.target.value })}\r\n                    className=\"w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-slate-500 font-mono text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition\"\r\n                    placeholder=\"Contoh: kaos-putih-001\"\r\n                  />\r\n                </div>\r\n\r\n                {/* Per-Cabang Pricing for SINGLE product */}\r\n                <div className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4 space-y-3 bg-gray-50 dark:bg-gray-700/50\">\r\n                  <div className=\"flex items-center justify-between mb-2\">\r\n                    <h4 className=\"text-sm font-semibold text-gray-900 dark:text-white\">\r\n                      Harga & Stok per Cabang <span className=\"text-red-500\">*</span>\r\n                    </h4>\r\n                  </div>\r\n\r\n                  {/* Bulk Apply */}\r\n                  <div className=\"p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg\">\r\n                    <div className=\"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2\">Terapkan ke Semua Cabang</div>\r\n                    <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2\">\r\n                      <div>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={singleBulkApply.price}\r\n                          onChange={(e) => setSingleBulkApply({ ...singleBulkApply, price: e.target.value })}\r\n                          placeholder=\"Harga\"\r\n                          min=\"0\"\r\n                          className=\"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <input\r\n                          type=\"number\"\r\n                          value={singleBulkApply.stock}\r\n                          onChange={(e) => setSingleBulkApply({ ...singleBulkApply, stock: e.target.value })}\r\n                          placeholder=\"Stok\"\r\n                          min=\"0\"\r\n                          className=\"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                        />\r\n                      </div>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={handleApplySingleBulkValues}\r\n                        className=\"px-3 py-1.5 bg-slate-600 text-white rounded text-sm font-medium hover:bg-slate-700 transition\"\r\n                      >\r\n                        Terapkan\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Per-Cabang Grid */}\r\n                  <div className=\"space-y-2\">\r\n                    {singleProductStocks.length === 0 && (\r\n                      <div className=\"text-sm text-red-500\">Tidak ada cabang aktif! Tambahkan cabang di Settings ΓåÆ Cabang</div>\r\n                    )}\r\n                    {singleProductStocks.map((stock, idx) => (\r\n                      <div key={stock.cabangId} className=\"grid grid-cols-3 gap-2 items-center p-2 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-600\">\r\n                        <div className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                          {stock.cabangName}\r\n                        </div>\r\n                        <div className=\"relative\">\r\n                          <span className=\"absolute left-2 top-1/2 -translate-y-1/2 text-xs text-gray-500 dark:text-gray-400\">Rp</span>\r\n                          <input\r\n                            type=\"number\"\r\n                            min=\"0\"\r\n                            value={stock.price || ''}\r\n                            onChange={(e) => handleSingleStockChange(idx, 'price', e.target.value)}\r\n                            className=\"w-full pl-8 pr-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                            placeholder=\"0\"\r\n                          />\r\n                        </div>\r\n                        <input\r\n                          type=\"number\"\r\n                          min=\"0\"\r\n                          value={stock.quantity || ''}\r\n                          onChange={(e) => handleSingleStockChange(idx, 'quantity', e.target.value)}\r\n                          className=\"w-full px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm text-center bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                          placeholder=\"0\"\r\n                        />\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400 italic\">\r\n                    Minimal 1 cabang harus punya harga untuk bisa menyimpan produk\r\n                  </p>\r\n                </div>\r\n\r\n                {/* Marketplace Info for Single Product */}\r\n                <details className=\"group border border-gray-200 dark:border-gray-600 rounded-lg\">\r\n                  <summary className=\"px-4 py-3 bg-gray-50 dark:bg-gray-700 cursor-pointer text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2 rounded-lg\">\r\n                    <svg className=\"w-4 h-4 transition-transform group-open:rotate-90\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n                    </svg>\r\n                    Info Marketplace (Opsional)\r\n                  </summary>\r\n                  <div className=\"p-4 space-y-4 bg-white dark:bg-gray-800\">\r\n                    <div>\r\n                      <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1.5\">\r\n                        URL Gambar\r\n                      </label>\r\n                      <input\r\n                        type=\"url\"\r\n                        value={singleMarketplaceInfo.imageUrl}\r\n                        onChange={(e) => setSingleMarketplaceInfo({ ...singleMarketplaceInfo, imageUrl: e.target.value })}\r\n                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                        placeholder=\"https://example.com/image.jpg\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1.5\">\r\n                          Berat (gram)\r\n                        </label>\r\n                        <input\r\n                          type=\"number\"\r\n                          min=\"0\"\r\n                          value={singleMarketplaceInfo.weight}\r\n                          onChange={(e) => setSingleMarketplaceInfo({ ...singleMarketplaceInfo, weight: e.target.value })}\r\n                          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                          placeholder=\"100\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1.5\">\r\n                          Panjang (cm)\r\n                        </label>\r\n                        <input\r\n                          type=\"number\"\r\n                          min=\"0\"\r\n                          value={singleMarketplaceInfo.length}\r\n                          onChange={(e) => setSingleMarketplaceInfo({ ...singleMarketplaceInfo, length: e.target.value })}\r\n                          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                          placeholder=\"10\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1.5\">\r\n                          Lebar (cm)\r\n                        </label>\r\n                        <input\r\n                          type=\"number\"\r\n                          min=\"0\"\r\n                          value={singleMarketplaceInfo.width}\r\n                          onChange={(e) => setSingleMarketplaceInfo({ ...singleMarketplaceInfo, width: e.target.value })}\r\n                          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                          placeholder=\"5\"\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1.5\">\r\n                          Tinggi (cm)\r\n                        </label>\r\n                        <input\r\n                          type=\"number\"\r\n                          min=\"0\"\r\n                          value={singleMarketplaceInfo.height}\r\n                          onChange={(e) => setSingleMarketplaceInfo({ ...singleMarketplaceInfo, height: e.target.value })}\r\n                          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                          placeholder=\"3\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </details>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Variants - Only show for VARIANT product type */}\r\n        {formData.productType === 'VARIANT' && (\r\n          <>\r\n                {/* Variant Type Definition */}\r\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800 p-5 mb-4\">\r\n                  <div className=\"flex items-center justify-between mb-3\">\r\n                    <h3 className=\"text-sm font-semibold text-blue-900 dark:text-blue-300 flex items-center gap-2\">\r\n                      <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\r\n                      </svg>\r\n                      Definisi Tipe Varian\r\n                    </h3>\r\n                    <div className=\"flex items-center gap-1\">\r\n                      {attributeCount > 1 && (\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => {\r\n                            setAttributeCount((prev) => Math.max(1, prev - 1) as 1 | 2 | 3);\r\n                            if (attributeCount === 3) setVariantTypes(v => ({ ...v, type3: '' }));\r\n                            if (attributeCount === 2) setVariantTypes(v => ({ ...v, type2: '' }));\r\n                          }}\r\n                          className=\"w-8 h-8 flex items-center justify-center rounded-lg bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-200 dark:hover:bg-red-900/50 transition text-lg font-bold\"\r\n                          title=\"Kurangi tipe\"\r\n                        >\r\n                          ΓêÆ\r\n                        </button>\r\n                      )}\r\n                      {attributeCount < 3 && (\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => setAttributeCount((prev) => Math.min(3, prev + 1) as 1 | 2 | 3)}\r\n                          className=\"w-8 h-8 flex items-center justify-center rounded-lg bg-blue-200 dark:bg-blue-800 text-blue-700 dark:text-blue-300 hover:bg-blue-300 dark:hover:bg-blue-700 transition text-lg font-bold\"\r\n                          title=\"Tambah tipe\"\r\n                        >\r\n                          +\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className={`grid gap-3 ${attributeCount === 1 ? 'grid-cols-1' : attributeCount === 2 ? 'grid-cols-1 sm:grid-cols-2' : 'grid-cols-1 sm:grid-cols-3'}`}>\r\n                    <div>\r\n                      <label className=\"block text-xs font-medium text-blue-900 dark:text-blue-300 mb-1.5\">\r\n                        Tipe 1 <span className=\"text-red-500\">*</span>\r\n                      </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={variantTypes.type1}\r\n                        onChange={(e) => {\r\n                          const newType1 = e.target.value;\r\n                          setVariantTypes({ ...variantTypes, type1: newType1 });\r\n                          // Auto-update all variants' variantName based on attribute count\r\n                          const typesArray = [newType1];\r\n                          if (attributeCount >= 2) typesArray.push(variantTypes.type2);\r\n                          if (attributeCount >= 3) typesArray.push(variantTypes.type3);\r\n                          const newTypes = typesArray.filter(t => t).join(' | ');\r\n                          setVariants(variants.map(v => ({ ...v, variantName: newTypes || 'Default' })));\r\n                        }}\r\n                        className=\"w-full px-3 py-2 border border-blue-300 dark:border-blue-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                        placeholder=\"Contoh: Warna\"\r\n                      />\r\n                    </div>\r\n                    {attributeCount >= 2 && (\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-blue-900 dark:text-blue-300 mb-1.5\">\r\n                          Tipe 2\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          value={variantTypes.type2}\r\n                          onChange={(e) => {\r\n                            const newType2 = e.target.value;\r\n                            setVariantTypes({ ...variantTypes, type2: newType2 });\r\n                            // Auto-update all variants' variantName\r\n                            const typesArray = [variantTypes.type1, newType2];\r\n                            if (attributeCount >= 3) typesArray.push(variantTypes.type3);\r\n                            const newTypes = typesArray.filter(t => t).join(' | ');\r\n                            setVariants(variants.map(v => ({ ...v, variantName: newTypes || 'Default' })));\r\n                          }}\r\n                          className=\"w-full px-3 py-2 border border-blue-300 dark:border-blue-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                          placeholder=\"Contoh: Ukuran\"\r\n                        />\r\n                      </div>\r\n                    )}\r\n                    {attributeCount >= 3 && (\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-blue-900 dark:text-blue-300 mb-1.5\">\r\n                          Tipe 3\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          value={variantTypes.type3}\r\n                          onChange={(e) => {\r\n                            const newType3 = e.target.value;\r\n                            setVariantTypes({ ...variantTypes, type3: newType3 });\r\n                            // Auto-update all variants' variantName\r\n                            const typesArray = [variantTypes.type1, variantTypes.type2, newType3];\r\n                            const newTypes = typesArray.filter(t => t).join(' | ');\r\n                            setVariants(variants.map(v => ({ ...v, variantName: newTypes || 'Default' })));\r\n                          }}\r\n                          className=\"w-full px-3 py-2 border border-blue-300 dark:border-blue-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white\"\r\n                          placeholder=\"Contoh: Model\"\r\n                        />\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  \r\n                  {attributeCount < 3 && (\r\n                    <p className=\"text-xs text-blue-600 dark:text-blue-400 mt-3 flex items-center gap-1\">\r\n                      <svg className=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      Klik + untuk menambah tipe varian (maks. 3)\r\n                    </p>\r\n                  )}\r\n                  \r\n                  {!variantTypes.type1 && (\r\n                    <p className=\"text-xs text-orange-600 dark:text-orange-400 mt-2 flex items-center gap-1\">\r\n                      <svg className=\"w-3.5 h-3.5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                        <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\r\n                      </svg>\r\n                      Isi minimal Type 1 sebelum menambah varian\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Add Variant Button */}\r\n                {variantTypes.type1 && (\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={addVariant}\r\n                    className=\"w-full py-3 bg-gradient-to-r from-slate-600 to-slate-700 text-white rounded-xl hover:from-slate-700 hover:to-slate-800 font-medium text-sm transition-all flex items-center justify-center gap-2 shadow-sm\"\r\n                  >\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n                    </svg>\r\n                    Tambah Varian\r\n                  </button>\r\n                )}\r\n\r\n            {variants.length > 0 && (\r\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mt-4\">\r\n                {/* Bulk Apply Section */}\r\n                <div className=\"mb-4 p-4 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-lg\">\r\n              <h4 className=\"text-sm font-semibold text-gray-900 dark:text-white mb-3\">Terapkan ke Semua Varian</h4>\r\n              <div className=\"grid grid-cols-1 md:grid-cols-4 gap-3\">\r\n                <div>\r\n                  <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1\">SKU Prefix</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={bulkApply.sku}\r\n                    onChange={(e) => setBulkApply({ ...bulkApply, sku: e.target.value })}\r\n                    placeholder=\"PRD-\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1\">Stok (semua cabang)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={bulkApply.stock}\r\n                    onChange={(e) => setBulkApply({ ...bulkApply, stock: e.target.value })}\r\n                    placeholder=\"15\"\r\n                    min=\"0\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1\">Harga (semua cabang)</label>\r\n                  <div className=\"relative\">\r\n                    <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 text-xs\">Rp</span>\r\n                    <input\r\n                      type=\"text\"\r\n                      inputMode=\"numeric\"\r\n                      value={bulkApply.price ? Number(bulkApply.price).toLocaleString('id-ID') : ''}\r\n                      onChange={(e) => {\r\n                        const val = e.target.value.replace(/[^0-9]/g, '');\r\n                        setBulkApply({ ...bulkApply, price: val });\r\n                      }}\r\n                      placeholder=\"50.000\"\r\n                      className=\"w-full pl-9 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-end\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={handleApplyBulkValues}\r\n                    className=\"w-full py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 text-sm font-medium transition\"\r\n                  >\r\n                    Terapkan\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n                SKU akan menambahkan nomor urut (e.g., PRD-1, PRD-2). Kosongkan field yang tidak ingin diubah.\r\n              </p>\r\n            </div>\r\n          \r\n                {/* Variant Cards */}\r\n                <div className=\"space-y-4\">\r\n            {variants.map((variant, variantIndex) => (\r\n              <div key={variantIndex} className=\"p-4 md:p-5 border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 hover:border-slate-400 dark:hover:border-slate-600 transition-colors\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center justify-between mb-4 pb-3 border-b border-gray-100 dark:border-gray-700\">\r\n                  <div className=\"flex items-center gap-2.5\">\r\n                    <div className=\"flex items-center justify-center w-7 h-7 bg-slate-600 dark:bg-slate-700 text-white rounded-md font-semibold text-sm\">\r\n                      {variantIndex + 1}\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm font-semibold text-gray-900 dark:text-white\">\r\n                        {variant.variantValue \r\n                          ? variant.variantValue \r\n                          : `Varian #${variantIndex + 1}`}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-0.5\">{variant.sku || 'SKU belum diisi'}</p>\r\n                    </div>\r\n                  </div>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => removeVariant(variantIndex)}\r\n                    className=\"px-3 py-1.5 text-xs font-medium text-red-600 hover:text-white hover:bg-red-600 border border-red-600 rounded-md transition-colors\"\r\n                  >\r\n                    Hapus\r\n                  </button>\r\n                </div>\r\n\r\n                {/* Variant Details */}\r\n                <div className=\"space-y-3\">\r\n                  {/* Value Inputs */}\r\n                  <div className={`grid grid-cols-1 gap-3 ${attributeCount === 1 ? 'md:grid-cols-1' : attributeCount === 2 ? 'md:grid-cols-2' : 'md:grid-cols-3'}`}>\r\n                    {variantTypes.type1 && (\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5\">\r\n                          {variantTypes.type1} <span className=\"text-red-500\">*</span>\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          value={variant.variantValue.split(' | ')[0] || ''}\r\n                          onChange={(e) => {\r\n                            const values = variant.variantValue.split(' | ');\r\n                            values[0] = e.target.value;\r\n                            // Preserve values based on attributeCount\r\n                            const newValues = values.slice(0, attributeCount).filter(v => v);\r\n                            updateVariant(variantIndex, 'variantValue', newValues.join(' | '));\r\n                          }}\r\n                          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm focus:ring-1 focus:ring-slate-500 focus:border-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                          placeholder={`Contoh: ${variantTypes.type1 === 'Warna' ? 'Merah' : variantTypes.type1 === 'Ukuran' ? '25' : 'Value'}`}\r\n                        />\r\n                      </div>\r\n                    )}\r\n\r\n                    {attributeCount >= 2 && variantTypes.type2 && (\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5\">\r\n                          {variantTypes.type2}\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          value={variant.variantValue.split(' | ')[1] || ''}\r\n                          onChange={(e) => {\r\n                            const values = variant.variantValue.split(' | ');\r\n                            while (values.length < 2) values.push('');\r\n                            values[1] = e.target.value;\r\n                            const newValues = values.slice(0, attributeCount).filter(v => v);\r\n                            updateVariant(variantIndex, 'variantValue', newValues.join(' | '));\r\n                          }}\r\n                          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm focus:ring-1 focus:ring-slate-500 focus:border-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                          placeholder={`Contoh: ${variantTypes.type2 === 'Ukuran' ? '25' : variantTypes.type2 === 'Model' ? '2024' : 'Value'}`}\r\n                        />\r\n                      </div>\r\n                    )}\r\n\r\n                    {attributeCount >= 3 && variantTypes.type3 && (\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1.5\">\r\n                          {variantTypes.type3}\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          value={variant.variantValue.split(' | ')[2] || ''}\r\n                          onChange={(e) => {\r\n                            const values = variant.variantValue.split(' | ');\r\n                            while (values.length < 3) values.push('');\r\n                            values[2] = e.target.value;\r\n                            const newValues = values.slice(0, attributeCount).filter(v => v);\r\n                            updateVariant(variantIndex, 'variantValue', newValues.join(' | '));\r\n                          }}\r\n                          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm focus:ring-1 focus:ring-slate-500 focus:border-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                          placeholder={`Contoh: ${variantTypes.type3 === 'Model' ? '2024' : 'Value'}`}\r\n                        />\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div>\r\n                    <label className=\"block text-xs font-medium text-gray-700 mb-1.5\">\r\n                      SKU\r\n                    </label>\r\n                    <input\r\n                      type=\"text\"\r\n                      value={variant.sku}\r\n                      onChange={(e) => updateVariant(variantIndex, 'sku', e.target.value)}\r\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm font-mono focus:ring-1 focus:ring-slate-500 focus:border-slate-500\"\r\n                      placeholder=\"VAR-009\"\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Marketplace Info - Collapsible */}\r\n                  <details className=\"group border border-gray-200 dark:border-gray-600 rounded-md\">\r\n                    <summary className=\"px-3 py-2 bg-gray-50 dark:bg-gray-700 cursor-pointer text-xs font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2 rounded-md\">\r\n                      <svg className=\"w-4 h-4 transition-transform group-open:rotate-90\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n                      </svg>\r\n                      Info Marketplace (Opsional)\r\n                    </summary>\r\n                    <div className=\"p-3 space-y-3 bg-white dark:bg-gray-800\">\r\n                      <div>\r\n                        <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\r\n                          URL Gambar\r\n                        </label>\r\n                        <input\r\n                          type=\"url\"\r\n                          value={variant.imageUrl || ''}\r\n                          onChange={(e) => updateVariant(variantIndex, 'imageUrl', e.target.value)}\r\n                          className=\"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                          placeholder=\"https://example.com/image.jpg\"\r\n                        />\r\n                      </div>\r\n                      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\r\n                        <div>\r\n                          <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\r\n                            Berat (gram)\r\n                          </label>\r\n                          <input\r\n                            type=\"number\"\r\n                            min=\"0\"\r\n                            value={variant.weight || ''}\r\n                            onChange={(e) => updateVariant(variantIndex, 'weight', parseInt(e.target.value) || 0)}\r\n                            className=\"w-full px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                            placeholder=\"100\"\r\n                          />\r\n                        </div>\r\n                        <div>\r\n                          <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\r\n                            Panjang (cm)\r\n                          </label>\r\n                          <input\r\n                            type=\"number\"\r\n                            min=\"0\"\r\n                            value={variant.length || ''}\r\n                            onChange={(e) => updateVariant(variantIndex, 'length', parseInt(e.target.value) || 0)}\r\n                            className=\"w-full px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                            placeholder=\"10\"\r\n                          />\r\n                        </div>\r\n                        <div>\r\n                          <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\r\n                            Lebar (cm)\r\n                          </label>\r\n                          <input\r\n                            type=\"number\"\r\n                            min=\"0\"\r\n                            value={variant.width || ''}\r\n                            onChange={(e) => updateVariant(variantIndex, 'width', parseInt(e.target.value) || 0)}\r\n                            className=\"w-full px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                            placeholder=\"5\"\r\n                          />\r\n                        </div>\r\n                        <div>\r\n                          <label className=\"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1\">\r\n                            Tinggi (cm)\r\n                          </label>\r\n                          <input\r\n                            type=\"number\"\r\n                            min=\"0\"\r\n                            value={variant.height || ''}\r\n                            onChange={(e) => updateVariant(variantIndex, 'height', parseInt(e.target.value) || 0)}\r\n                            className=\"w-full px-2 py-1.5 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                            placeholder=\"3\"\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </details>\r\n\r\n                  {/* Harga & Stock per Cabang Section */}\r\n                  <div className=\"mt-3 pt-3 border-t border-gray-100\">\r\n                    <label className=\"block text-xs font-medium text-gray-700 mb-2\">\r\n                      Harga & Stok per Cabang\r\n                    </label>\r\n                    <div className=\"space-y-2\">\r\n                      {variant.stocks.map((stock: any, stockIndex: number) => (\r\n                        <div key={stockIndex} className=\"grid grid-cols-1 md:grid-cols-3 gap-3 p-2.5 bg-gray-50 rounded-md\">\r\n                          <div className=\"flex items-center\">\r\n                            <span className=\"text-sm text-gray-700 font-medium\">\r\n                              {stock.cabangName}\r\n                            </span>\r\n                          </div>\r\n                          <div>\r\n                            <label className=\"block text-xs text-gray-600 mb-1\">Harga</label>\r\n                            <div className=\"relative\">\r\n                              <span className=\"absolute left-2 top-1/2 -translate-y-1/2 text-gray-500 text-xs\">\r\n                                Rp\r\n                              </span>\r\n                              <input\r\n                                type=\"text\"\r\n                                inputMode=\"numeric\"\r\n                                value={stock.price ? Number(stock.price).toLocaleString('id-ID') : ''}\r\n                                onChange={(e) => {\r\n                                  const val = e.target.value.replace(/[^0-9]/g, '').replace(/^0+(?=\\d)/, '');\r\n                                  handleStockChange(variantIndex, stockIndex, 'price', val);\r\n                                }}\r\n                                onBlur={(e) => {\r\n                                  const num = parseFloat(e.target.value.replace(/\\./g, '')) || 0;\r\n                                  handleStockChange(variantIndex, stockIndex, 'price', String(num));\r\n                                }}\r\n                                className=\"w-full pl-8 pr-2 py-1.5 border border-gray-300 rounded-md text-sm focus:ring-1 focus:ring-slate-500 focus:border-slate-500\"\r\n                                placeholder=\"50.000\"\r\n                              />\r\n                            </div>\r\n                          </div>\r\n                          <div>\r\n                            <label className=\"block text-xs text-gray-600 mb-1\">Stok</label>\r\n                            <input\r\n                              type=\"text\"\r\n                              inputMode=\"numeric\"\r\n                              value={stock.quantity || ''}\r\n                              onChange={(e) => {\r\n                                const val = e.target.value.replace(/[^0-9]/g, '').replace(/^0+/, '') || '0';\r\n                                handleStockChange(variantIndex, stockIndex, 'quantity', val);\r\n                              }}\r\n                              onBlur={(e) => {\r\n                                const num = parseInt(e.target.value) || 0;\r\n                                handleStockChange(variantIndex, stockIndex, 'quantity', String(num));\r\n                              }}\r\n                              className=\"w-full px-2 py-1.5 border border-gray-300 rounded-md text-sm text-center font-semibold focus:ring-1 focus:ring-slate-500 focus:border-slate-500\"\r\n                              placeholder=\"0\"\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n                </div>\r\n          \r\n                <div className=\"mt-4\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={addVariant}\r\n                    className=\"w-full px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 text-sm font-medium transition flex items-center justify-center gap-1\"\r\n                  >\r\n                    <span className=\"text-lg leading-none\">+</span>\r\n                    Tambah Varian\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n\r\n        {/* Actions */}\r\n        <div className=\"flex gap-3\">\r\n          <button\r\n            type=\"submit\"\r\n            disabled={loading}\r\n            className=\"flex-1 py-3 bg-slate-600 text-white rounded-lg font-semibold hover:bg-slate-700 disabled:bg-gray-300\"\r\n          >\r\n            {loading ? 'Menyimpan...' : 'Simpan Produk'}\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => router.back()}\r\n            className=\"px-6 py-3 bg-gray-100 text-gray-700 rounded-lg font-semibold hover:bg-gray-200\"\r\n          >\r\n            Batal\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\products\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Package' is defined but never used.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'socketConnected' is assigned a value but never used.","line":68,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":68,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleStockClick' is assigned a value but never used.","line":86,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":86,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":170,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4743,4746],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4743,4746],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":372,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":372,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17322,17325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17322,17325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":552,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":552,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27133,27136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27133,27136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":553,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":553,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27201,27204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27201,27204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":562,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":562,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27620,27623],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27620,27623],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":568,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":568,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27913,27916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27913,27916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":569,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":569,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27974,27977],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27974,27977],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":697,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":697,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35923,35926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35923,35926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":698,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":698,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35991,35994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35991,35994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":768,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":768,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40247,40250],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40247,40250],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":772,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":772,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40498,40501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40498,40501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":773,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":773,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40576,40579],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40576,40579],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":966,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":966,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50779,50782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50779,50782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":967,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":967,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50874,50877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50874,50877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":996,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":996,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52694,52697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52694,52697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useCallback } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { getAuth } from '@/lib/auth';\r\nimport { useRealtimeRefresh } from '@/hooks/useSocket';\r\nimport { useProductPageStore } from '@/stores/useProductPageStore';\r\nimport { Package, Plus } from 'lucide-react';\r\nimport { SkeletonProductGrid, SkeletonFilterBar, SkeletonPageHeader } from '@/components/ui/Skeleton';\r\n\r\nexport default function ProductsPage() {\r\n  const router = useRouter();\r\n  const { user } = getAuth();\r\n  \r\n  // Use store for all state\r\n  const {\r\n    products,\r\n    categories,\r\n    cabangs,\r\n    loading,\r\n    search,\r\n    selectedCategory,\r\n    selectedProducts,\r\n    deleting,\r\n    activeTab,\r\n    variantModal,\r\n    editingStock,\r\n    newStockQty,\r\n    adjustmentReason,\r\n    savingStock,\r\n    importFile,\r\n    importing,\r\n    importResult,\r\n    exporting,\r\n    // Actions\r\n    setSearch,\r\n    setSelectedCategory,\r\n    setActiveTab,\r\n    setSelectedProducts,\r\n    handleSelectAll,\r\n    handleSelectProduct,\r\n    openVariantModal,\r\n    closeVariantModal,\r\n    startEditingStock,\r\n    setNewStockQty,\r\n    setAdjustmentReason,\r\n    cancelEditingStock,\r\n    saveStock,\r\n    setImportFile,\r\n    setImportResult,\r\n    importProducts,\r\n    exportProducts,\r\n    downloadTemplate,\r\n    fetchData,\r\n    fetchDataSilent,\r\n    bulkDeleteProducts,\r\n  } = useProductPageStore();\r\n  \r\n  // Alias for handleCancelEdit\r\n  const handleCancelEdit = cancelEditingStock;\r\n\r\n  // Realtime refresh callback\r\n  const handleRealtimeRefresh = useCallback(() => {\r\n    fetchDataSilent();\r\n  }, [fetchDataSilent]);\r\n\r\n  // WebSocket for realtime updates\r\n  const { connected: socketConnected } = useRealtimeRefresh(handleRealtimeRefresh);\r\n\r\n  // Lock body scroll when modal is open\r\n  useEffect(() => {\r\n    if (variantModal.isOpen) {\r\n      document.body.style.overflow = 'hidden';\r\n    } else {\r\n      document.body.style.overflow = 'unset';\r\n    }\r\n    return () => {\r\n      document.body.style.overflow = 'unset';\r\n    };\r\n  }, [variantModal.isOpen]);\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, [selectedCategory, search, fetchData]);\r\n\r\n  const handleStockClick = (e: React.MouseEvent, variantId: string, cabangId: string, currentQty: number) => {\r\n    const rect = (e.target as HTMLElement).getBoundingClientRect();\r\n    startEditingStock(variantId, cabangId, currentQty, { x: rect.left, y: rect.bottom + 8 });\r\n  };\r\n\r\n  const handleSaveStock = async () => {\r\n    const success = await saveStock();\r\n    if (success) {\r\n      alert(`Stok berhasil diupdate${adjustmentReason ? ` (${adjustmentReason})` : ''}`);\r\n    } else {\r\n      alert('Gagal update stok');\r\n    }\r\n  };\r\n\r\n  const handleBulkDelete = async () => {\r\n    if (selectedProducts.length === 0) {\r\n      alert('Pilih produk yang ingin dihapus');\r\n      return;\r\n    }\r\n    \r\n    // Check if user has permission\r\n    if (user?.role === 'KASIR') {\r\n      alert('Anda tidak memiliki izin untuk menghapus produk. Hubungi Owner atau Manager.');\r\n      return;\r\n    }\r\n\r\n    if (!confirm(`Yakin ingin menghapus ${selectedProducts.length} produk? Produk dengan riwayat transaksi akan dinonaktifkan.`)) {\r\n      return;\r\n    }\r\n\r\n    const success = await bulkDeleteProducts();\r\n    if (success) {\r\n      alert('Produk berhasil dihapus/dinonaktifkan!');\r\n      // Refresh data to show updated state\r\n      fetchDataSilent();\r\n    } else {\r\n      alert('Gagal menghapus produk. Pastikan Anda memiliki izin sebagai Owner atau Manager.');\r\n    }\r\n  };\r\n\r\n  // Import/Export Functions\r\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      const fileExtension = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();\r\n      \r\n      if (!['.xlsx', '.xls'].includes(fileExtension)) {\r\n        alert('Format file tidak valid. Gunakan Excel (.xlsx atau .xls)');\r\n        return;\r\n      }\r\n      \r\n      if (file.size > 5 * 1024 * 1024) { // 5MB\r\n        alert('Ukuran file terlalu besar. Maksimal 5MB');\r\n        return;\r\n      }\r\n      \r\n      setImportFile(file);\r\n      setImportResult(null);\r\n    }\r\n  };\r\n\r\n  const handleImport = async () => {\r\n    if (!importFile) {\r\n      alert('Pilih file terlebih dahulu');\r\n      return;\r\n    }\r\n    const success = await importProducts();\r\n    if (!success && importResult) {\r\n      // Error shown via importResult\r\n    }\r\n  };\r\n\r\n  const handleDownloadTemplate = async () => {\r\n    try {\r\n      await downloadTemplate();\r\n    } catch {\r\n      alert('Gagal download template');\r\n    }\r\n  };\r\n\r\n  const handleExport = async () => {\r\n    try {\r\n      await exportProducts();\r\n      alert('Berhasil export produk');\r\n    } catch (error: any) {\r\n      alert(error.message || 'Gagal export produk');\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"px-4 md:px-6 space-y-6\">\r\n        <SkeletonPageHeader />\r\n        <SkeletonFilterBar filters={3} />\r\n        <SkeletonProductGrid items={12} columns={4} />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"px-4 md:px-6 space-y-6\">\r\n      {/* Breadcrumb + Action */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\r\n        <nav className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n          <a href=\"/dashboard\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Dashboard</a>\r\n          <span>ΓÇ║</span>\r\n          <span className=\"text-gray-900 dark:text-white font-medium\">Produk</span>\r\n        </nav>\r\n        \r\n        {activeTab === 'products' && (\r\n          <div className=\"flex items-center gap-2\">\r\n            <button\r\n              onClick={() => router.push('/dashboard/products/new')}\r\n              className=\"inline-flex items-center justify-center px-3 sm:px-4 py-2 sm:py-2.5 bg-gradient-to-r from-slate-600 to-slate-700 text-white rounded-lg hover:from-slate-700 hover:to-slate-800 transition-all shadow-lg hover:shadow-xl text-xs sm:text-sm font-medium whitespace-nowrap\"\r\n            >\r\n              <Plus className=\"w-4 h-4 mr-1.5\" />\r\n              Tambah Produk\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Tabs */}\r\n      <div className=\"flex gap-2 mb-6 border-b border-gray-200 dark:border-gray-700\">\r\n        <button\r\n          onClick={() => setActiveTab('products')}\r\n          className={`px-4 py-2.5 text-sm font-medium transition-all ${\r\n            activeTab === 'products'\r\n              ? 'text-slate-600 dark:text-slate-300 border-b-2 border-slate-600 dark:border-slate-400'\r\n              : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'\r\n          }`}\r\n        >\r\n          <span className=\"flex items-center gap-2\">\r\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\" />\r\n            </svg>\r\n            Daftar Produk\r\n          </span>\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab('import-export')}\r\n          className={`px-4 py-2.5 text-sm font-medium transition-all ${\r\n            activeTab === 'import-export'\r\n              ? 'text-slate-600 dark:text-slate-300 border-b-2 border-slate-600 dark:border-slate-400'\r\n              : 'text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'\r\n          }`}\r\n        >\r\n          <span className=\"flex items-center gap-2\">\r\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" />\r\n            </svg>\r\n            Import / Export\r\n          </span>\r\n        </button>\r\n      </div>\r\n\r\n      {/* Tab Content */}\r\n      {activeTab === 'import-export' ? (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 md:p-8\">\r\n          <div className=\"max-w-4xl mx-auto\">\r\n            <div className=\"text-center mb-8\">\r\n              <div className=\"inline-flex items-center justify-center w-16 h-16 bg-slate-100 dark:bg-slate-800 rounded-full mb-4\">\r\n                <svg className=\"w-8 h-8 text-slate-600 dark:text-slate-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" />\r\n                </svg>\r\n              </div>\r\n              <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">Import & Export Produk</h2>\r\n              <p className=\"text-gray-600 dark:text-gray-400\">Upload data produk secara massal atau export data existing</p>\r\n            </div>\r\n\r\n            {/* Import Section */}\r\n            <div className=\"mb-8\">\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Import Produk</h3>\r\n              \r\n              {/* File Upload Area */}\r\n              <div className=\"bg-gray-50 dark:bg-gray-700/50 rounded-xl border-2 border-dashed border-gray-300 dark:border-gray-600 p-8 text-center\">\r\n                <svg className=\"w-12 h-12 text-green-500 dark:text-green-400 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3v-6\" />\r\n                </svg>\r\n                <h4 className=\"text-sm font-medium text-gray-900 dark:text-white mb-2\">Upload File Excel</h4>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-4\">Gunakan file template Excel (.xlsx) hasil download di bawah (Max 5MB)</p>\r\n                \r\n                {/* File Input Hidden */}\r\n                <input\r\n                  type=\"file\"\r\n                  id=\"file-upload\"\r\n                  accept=\".xlsx,.xls\"\r\n                  onChange={handleFileSelect}\r\n                  className=\"hidden\"\r\n                />\r\n                \r\n                {/* Selected File Display */}\r\n                {importFile && (\r\n                  <div className=\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg inline-flex items-center gap-2\">\r\n                    <svg className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                    </svg>\r\n                    <span className=\"text-sm font-medium text-blue-900 dark:text-blue-100\">{importFile.name}</span>\r\n                    <button\r\n                      onClick={() => setImportFile(null)}\r\n                      className=\"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200\"\r\n                    >\r\n                      <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                      </svg>\r\n                    </button>\r\n                  </div>\r\n                )}\r\n                \r\n                {/* Step 1: Download Template */}\r\n                <div className=\"mb-6\">\r\n                  <div className=\"flex items-center justify-center gap-2 mb-3\">\r\n                    <span className=\"flex items-center justify-center w-8 h-8 bg-blue-600 text-white rounded-full text-sm font-bold\">1</span>\r\n                    <h4 className=\"text-sm font-semibold text-gray-900 dark:text-white\">Download Template Import</h4>\r\n                  </div>\r\n                  <button\r\n                    onClick={handleDownloadTemplate}\r\n                    className=\"w-full max-w-md mx-auto block px-6 py-4 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 border-2 border-blue-300 dark:border-blue-700 rounded-xl hover:from-blue-100 hover:to-cyan-100 dark:hover:from-blue-900/30 dark:hover:to-cyan-900/30 transition-all shadow-sm hover:shadow-md\"\r\n                  >\r\n                    <div className=\"flex items-center justify-center gap-3\">\r\n                      <div className=\"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0\">\r\n                        <svg className=\"w-6 h-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                        </svg>\r\n                      </div>\r\n                      <div className=\"text-left flex-1\">\r\n                        <p className=\"text-base font-bold text-gray-900 dark:text-white mb-1\">Download Template Excel</p>\r\n                        <p className=\"text-xs text-gray-600 dark:text-gray-400\">2 Sheet: Referensi & Info + Template Import</p>\r\n                      </div>\r\n                      <svg className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n                      </svg>\r\n                    </div>\r\n                  </button>\r\n                </div>\r\n                \r\n                <div className=\"flex items-center gap-2 justify-center mb-4\">\r\n                  <div className=\"h-px flex-1 bg-gray-300 dark:bg-gray-600\"></div>\r\n                  <span className=\"flex items-center justify-center w-8 h-8 bg-green-600 text-white rounded-full text-sm font-bold\">2</span>\r\n                  <span className=\"text-xs text-gray-500 dark:text-gray-400\">Isi Template & Upload File</span>\r\n                  <div className=\"h-px flex-1 bg-gray-300 dark:bg-gray-600\"></div>\r\n                </div>\r\n                \r\n                <div className=\"flex items-center justify-center gap-3\">\r\n                  <label htmlFor=\"file-upload\" className=\"px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors text-sm font-medium cursor-pointer\">\r\n                    {importFile ? 'Ganti File' : 'Pilih File Excel'}\r\n                  </label>\r\n                  \r\n                  {importFile && (\r\n                    <button\r\n                      onClick={handleImport}\r\n                      disabled={importing}\r\n                      className=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium disabled:opacity-50\"\r\n                    >\r\n                      {importing ? 'Mengupload...' : 'Upload & Import'}\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Import Result */}\r\n              {importResult && (\r\n                <div className={`mt-4 p-4 rounded-lg border ${\r\n                  importResult.success \r\n                    ? 'bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800' \r\n                    : 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800'\r\n                }`}>\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <svg className={`w-5 h-5 flex-shrink-0 ${importResult.success ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      {importResult.success ? (\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      ) : (\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      )}\r\n                    </svg>\r\n                    <div className=\"flex-1\">\r\n                      <h4 className={`text-sm font-semibold mb-2 ${importResult.success ? 'text-green-900 dark:text-green-100' : 'text-red-900 dark:text-red-100'}`}>\r\n                        {importResult.success ? 'Import Berhasil!' : 'Import Gagal'}\r\n                      </h4>\r\n                      <p className={`text-xs mb-2 ${importResult.success ? 'text-green-700 dark:text-green-300' : 'text-red-700 dark:text-red-300'}`}>\r\n                        Berhasil: {importResult.imported} | Gagal: {importResult.failed}\r\n                      </p>\r\n                      \r\n                      {importResult.details?.errors?.length > 0 && (\r\n                        <div className=\"mt-2 space-y-1\">\r\n                          <p className=\"text-xs font-semibold text-gray-900 dark:text-white\">Error Details:</p>\r\n                          {importResult.details.errors.slice(0, 5).map((err: any, idx: number) => (\r\n                            <p key={idx} className=\"text-xs text-gray-700 dark:text-gray-300\">\r\n                              {err.row ? `Baris ${err.row}: ` : ''}{err.error}\r\n                            </p>\r\n                          ))}\r\n                          {importResult.details.errors.length > 5 && (\r\n                            <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                              ... dan {importResult.details.errors.length - 5} error lainnya\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <button\r\n                      onClick={() => setImportResult(null)}\r\n                      className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n                    >\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                      </svg>\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Export Section */}\r\n            <div>\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Export Produk</h3>\r\n              <button\r\n                onClick={handleExport}\r\n                disabled={exporting}\r\n                className=\"w-full max-w-md mx-auto block p-6 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-2 border-green-300 dark:border-green-700 rounded-xl hover:from-green-100 hover:to-emerald-100 dark:hover:from-green-900/30 dark:hover:to-emerald-900/30 transition-all disabled:opacity-50 shadow-sm hover:shadow-md\"\r\n              >\r\n                <div className=\"flex items-center justify-center gap-4\">\r\n                  <div className=\"w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center flex-shrink-0\">\r\n                    {exporting ? (\r\n                      <svg className=\"animate-spin w-6 h-6 text-white\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                        <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                        <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                      </svg>\r\n                    ) : (\r\n                      <svg className=\"w-6 h-6 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                      </svg>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"text-left flex-1\">\r\n                    <p className=\"text-base font-bold text-gray-900 dark:text-white mb-1\">\r\n                      {exporting ? 'Mengexport...' : 'Export ke Excel'}\r\n                    </p>\r\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n                      Download semua produk dalam format Excel\r\n                    </p>\r\n                  </div>\r\n                  {!exporting && (\r\n                    <svg className=\"w-5 h-5 text-green-600 dark:text-green-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n                    </svg>\r\n                  )}\r\n                </div>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <>\r\n      {/* Original Products Content */}\r\n\r\n      {/* Bulk Actions - Only show delete for Owner/Manager */}\r\n      {selectedProducts.length > 0 && (\r\n        <div className=\"mb-4 flex items-center justify-between bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3\">\r\n          <span className=\"text-sm font-medium text-blue-900 dark:text-blue-100\">\r\n            {selectedProducts.length} produk dipilih\r\n          </span>\r\n          {user?.role !== 'KASIR' && (\r\n            <button\r\n              onClick={handleBulkDelete}\r\n              disabled={deleting}\r\n              className=\"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all text-sm font-medium disabled:opacity-50\"\r\n            >\r\n              <svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n              </svg>\r\n              {deleting ? 'Menghapus...' : `Hapus ${selectedProducts.length} Produk`}\r\n            </button>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Filters */}\r\n      <div className=\"bg-gradient-to-br from-white to-slate-50 dark:from-gray-800 dark:to-slate-900/20 rounded-xl md:rounded-2xl shadow-lg border border-slate-100 dark:border-slate-800 p-4 md:p-6 mb-6 md:mb-8\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6\">\r\n          <div>\r\n            <label className=\"block text-xs md:text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2\">\r\n              Cari Produk\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n              placeholder=\"Nama produk atau SKU...\"\r\n              className=\"w-full px-3 md:px-4 py-2 md:py-3 text-sm md:text-base border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg md:rounded-xl focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-xs md:text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2\">\r\n              Kategori\r\n            </label>\r\n            <select\r\n              value={selectedCategory}\r\n              onChange={(e) => setSelectedCategory(e.target.value)}\r\n              className=\"w-full px-3 md:px-4 py-2 md:py-3 text-sm md:text-base border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg md:rounded-xl focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition\"\r\n            >\r\n              <option value=\"\">Semua Kategori</option>\r\n              {categories.map((cat) => (\r\n                <option key={cat.id} value={cat.id}>\r\n                  {cat.name} ({cat._count?.products || 0})\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Products Table/List */}\r\n      {products.length === 0 ? (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-8 md:p-12 text-center\">\r\n          <svg\r\n            className=\"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500\"\r\n            fill=\"none\"\r\n            stroke=\"currentColor\"\r\n            viewBox=\"0 0 24 24\"\r\n          >\r\n            <path\r\n              strokeLinecap=\"round\"\r\n              strokeLinejoin=\"round\"\r\n              strokeWidth={2}\r\n              d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"\r\n            />\r\n          </svg>\r\n          <h3 className=\"mt-2 text-sm font-medium text-gray-900 dark:text-white\">Tidak ada produk</h3>\r\n          <p className=\"mt-1 text-sm text-gray-500 dark:text-gray-400\">\r\n            Mulai dengan menambahkan produk baru.\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <>\r\n          {/* Select All Header */}\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 mb-4 flex items-center justify-between\">\r\n            <label className=\"flex items-center gap-3 cursor-pointer\">\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={selectedProducts.length === products.length && products.length > 0}\r\n                onChange={(e) => handleSelectAll(e.target.checked)}\r\n                className=\"h-5 w-5 text-slate-600 focus:ring-slate-500 border-gray-300 rounded cursor-pointer\"\r\n              />\r\n              <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                {selectedProducts.length === products.length && products.length > 0\r\n                  ? `Semua dipilih (${products.length})`\r\n                  : selectedProducts.length > 0\r\n                    ? `${selectedProducts.length} dari ${products.length} dipilih`\r\n                    : `Pilih Semua (${products.length} produk)`\r\n                }\r\n              </span>\r\n            </label>\r\n            {selectedProducts.length > 0 && (\r\n              <button\r\n                onClick={() => setSelectedProducts([])}\r\n                className=\"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\r\n              >\r\n                Batal Pilih\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Card Grid View */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\r\n            {products.map((product) => {\r\n              // Stock is always in product.variants[].stocks[] for both SINGLE and VARIANT types\r\n              const totalStock = product.variants?.reduce((sum: number, v: any) => \r\n                sum + (v.stocks?.reduce((vSum: number, s: any) => vSum + s.quantity, 0) || 0), 0\r\n              ) || 0;\r\n              const variantCount = product.variants?.length || 0;\r\n              \r\n              // Calculate price range\r\n              let minPrice = 0;\r\n              let maxPrice = 0;\r\n              if (product.productType === 'SINGLE') {\r\n                const variant = product.variants?.[0];\r\n                const prices = variant?.stocks?.map((s: any) => s.price).filter((p: number) => p > 0) || [];\r\n                if (prices.length > 0) {\r\n                  minPrice = Math.min(...prices);\r\n                  maxPrice = Math.max(...prices);\r\n                }\r\n              } else {\r\n                product.variants?.forEach((variant: any) => {\r\n                  variant.stocks?.forEach((stock: any) => {\r\n                    if (stock.price > 0) {\r\n                      if (minPrice === 0 || stock.price < minPrice) minPrice = stock.price;\r\n                      if (stock.price > maxPrice) maxPrice = stock.price;\r\n                    }\r\n                  });\r\n                });\r\n              }\r\n              \r\n              return (\r\n                <div key={product.id} className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow overflow-hidden\">\r\n                  {/* Card Header with Checkbox */}\r\n                  <div className=\"p-3 border-b border-gray-100 dark:border-gray-700 flex items-center justify-between\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={selectedProducts.includes(product.id)}\r\n                      onChange={(e) => handleSelectProduct(product.id, e.target.checked)}\r\n                      className=\"h-4 w-4 text-slate-600 focus:ring-slate-500 border-gray-300 rounded cursor-pointer\"\r\n                    />\r\n                    <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${\r\n                      product.isActive\r\n                        ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'\r\n                        : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'\r\n                    }`}>\r\n                      {product.isActive ? 'Aktif' : 'Nonaktif'}\r\n                    </span>\r\n                  </div>\r\n\r\n                  {/* Product Image */}\r\n                  <div className=\"aspect-square bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-800 flex items-center justify-center\">\r\n                    <span className=\"text-6xl font-bold text-slate-400 dark:text-slate-600\">\r\n                      {product.name.charAt(0).toUpperCase()}\r\n                    </span>\r\n                  </div>\r\n\r\n                  {/* Card Body */}\r\n                  <div className=\"p-4 space-y-3\">\r\n                    {/* Product Name */}\r\n                    <div>\r\n                      <h3 className=\"text-base font-semibold text-gray-900 dark:text-white line-clamp-2 mb-1\">\r\n                        {product.name}\r\n                      </h3>\r\n                      <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300\">\r\n                        {product.category?.name || '-'}\r\n                      </span>\r\n                    </div>\r\n\r\n                    {/* Variant Info */}\r\n                    <div>\r\n                      {product.productType === 'VARIANT' ? (\r\n                        <button\r\n                          onClick={() => openVariantModal(product)}\r\n                          className=\"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium transition-colors hover:ring-2 hover:ring-purple-300 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 w-full justify-center\"\r\n                        >\r\n                          <svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n                          </svg>\r\n                          {variantCount} Varian\r\n                        </button>\r\n                      ) : (\r\n                        <span className=\"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 w-full justify-center\">\r\n                          Produk Tunggal\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/* Price */}\r\n                    <div className=\"pt-2 border-t border-gray-100 dark:border-gray-700\">\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Harga</p>\r\n                      {minPrice > 0 && maxPrice > 0 ? (\r\n                        <p className=\"text-base font-bold text-gray-900 dark:text-white\">\r\n                          {minPrice === maxPrice \r\n                            ? `Rp ${minPrice.toLocaleString('id-ID')}`\r\n                            : `Rp ${minPrice.toLocaleString('id-ID')} - ${maxPrice.toLocaleString('id-ID')}`\r\n                          }\r\n                        </p>\r\n                      ) : (\r\n                        <p className=\"text-base font-bold text-gray-400\">-</p>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/* Stock */}\r\n                    <div>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Total Stock</p>\r\n                      <span className={`inline-flex items-center px-3 py-1 rounded-lg text-sm font-bold ${\r\n                        totalStock === 0\r\n                          ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300'\r\n                          : totalStock <= 20\r\n                          ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300'\r\n                          : 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'\r\n                      }`}>\r\n                        {totalStock} unit\r\n                      </span>\r\n                    </div>\r\n\r\n                    {/* Actions */}\r\n                    <div className=\"flex gap-2 pt-2\">\r\n                      <button\r\n                        onClick={() => router.push(`/dashboard/products/${product.id}`)}\r\n                        className=\"flex-1 px-3 py-2 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1\"\r\n                      >\r\n                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n                        </svg>\r\n                        Detail\r\n                      </button>\r\n                      <button\r\n                        onClick={() => router.push(`/dashboard/products/${product.id}/edit`)}\r\n                        className=\"flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center justify-center gap-1\"\r\n                      >\r\n                        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                        </svg>\r\n                        Edit\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n\r\n          {/* Mobile: Simplified Card View */}\r\n          <div className=\"md:hidden space-y-4\">\r\n            {products.map((product) => {\r\n              // Stock is always in product.variants[].stocks[] for both SINGLE and VARIANT types\r\n              const totalStock = product.variants?.reduce((sum: number, v: any) => \r\n                sum + (v.stocks?.reduce((vSum: number, s: any) => vSum + s.quantity, 0) || 0), 0\r\n              ) || 0;\r\n              const variantCount = product.variants?.length || 0;\r\n              \r\n              return (\r\n                <div\r\n                  key={product.id}\r\n                  className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm\"\r\n                >\r\n                  {/* Header with checkbox and status */}\r\n                  <div className=\"flex items-center justify-between p-3 bg-slate-50 dark:bg-gray-900/50 border-b border-gray-200 dark:border-gray-700\">\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={selectedProducts.includes(product.id)}\r\n                        onChange={(e) => handleSelectProduct(product.id, e.target.checked)}\r\n                        className=\"h-4 w-4 text-slate-600 focus:ring-slate-500 border-gray-300 rounded cursor-pointer\"\r\n                      />\r\n                      <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold ${\r\n                        product.isActive\r\n                          ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'\r\n                          : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'\r\n                      }`}>\r\n                        {product.isActive ? 'Aktif' : 'Nonaktif'}\r\n                      </span>\r\n                    </div>\r\n                    <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold ${\r\n                      product.productType === 'SINGLE'\r\n                        ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300'\r\n                        : 'bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300'\r\n                    }`}>\r\n                      {product.productType === 'SINGLE' ? 'Tunggal' : `${variantCount} Varian`}\r\n                    </span>\r\n                  </div>\r\n                  \r\n                  {/* Content */}\r\n                  <div className=\"p-3 space-y-2.5\">\r\n                    <div>\r\n                      <h3 className=\"text-sm font-bold text-gray-900 dark:text-white mb-0.5 line-clamp-1\">\r\n                        {product.name}\r\n                      </h3>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400 line-clamp-2\">\r\n                        {product.description || '-'}\r\n                      </p>\r\n                    </div>\r\n                    \r\n                    <div className=\"flex items-center justify-between\">\r\n                      <span className=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300\">\r\n                        {product.category?.name || '-'}\r\n                      </span>\r\n                      <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold ${\r\n                        totalStock <= 5\r\n                          ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300'\r\n                          : totalStock <= 20\r\n                          ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300'\r\n                          : 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'\r\n                      }`}>\r\n                        Total: {totalStock}\r\n                      </span>\r\n                    </div>\r\n                    \r\n                    {/* Per-Cabang Stock & Price (Mobile) */}\r\n                    <div className=\"pt-2 border-t border-gray-100 dark:border-gray-700 space-y-1.5\">\r\n                      <p className=\"text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase\">Stok & Harga per Cabang</p>\r\n                      {cabangs.map((cabang) => {\r\n                        let stockQty = 0;\r\n                        let stockPrice = 0;\r\n\r\n                        if (product.productType === 'SINGLE') {\r\n                          const variant = product.variants?.[0];\r\n                          const stock = variant?.stocks?.find((s: any) => s.cabangId === cabang.id);\r\n                          stockQty = stock?.quantity || 0;\r\n                          stockPrice = stock?.price || 0;\r\n                        } else {\r\n                          product.variants?.forEach((variant: any) => {\r\n                            const stock = variant.stocks?.find((s: any) => s.cabangId === cabang.id);\r\n                            stockQty += stock?.quantity || 0;\r\n                            if (stock?.price && (stockPrice === 0 || stock.price < stockPrice)) {\r\n                              stockPrice = stock.price;\r\n                            }\r\n                          });\r\n                        }\r\n\r\n                        return (\r\n                          <div key={cabang.id} className=\"flex items-center justify-between py-1 px-2 bg-gray-50 dark:bg-gray-700/30 rounded\">\r\n                            <span className=\"text-xs font-medium text-gray-700 dark:text-gray-300\">\r\n                              {cabang.name}\r\n                            </span>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <span className={`inline-flex items-center px-2 py-0.5 rounded text-xs font-bold ${\r\n                                stockQty <= 5\r\n                                  ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300'\r\n                                  : stockQty <= 20\r\n                                  ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300'\r\n                                  : 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'\r\n                              }`}>\r\n                                {stockQty}\r\n                              </span>\r\n                              <span className=\"text-xs font-semibold text-gray-700 dark:text-gray-300\">\r\n                                {stockPrice > 0 ? `Rp ${stockPrice.toLocaleString('id-ID')}` : '-'}\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {/* Actions */}\r\n                  <div className=\"flex border-t border-gray-200 dark:border-gray-700 divide-x divide-gray-200 dark:divide-gray-700\">\r\n                    <button\r\n                      onClick={() => router.push(`/dashboard/products/${product.id}`)}\r\n                      className=\"flex-1 flex items-center justify-center py-2.5 text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-gray-700 transition-colors\"\r\n                    >\r\n                      <svg className=\"w-4 h-4 mr-1.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n                      </svg>\r\n                      <span className=\"text-xs font-medium\">Detail</span>\r\n                    </button>\r\n                    <button\r\n                      onClick={() => router.push(`/dashboard/products/${product.id}/edit`)}\r\n                      className=\"flex-1 flex items-center justify-center py-2.5 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors\"\r\n                    >\r\n                      <svg className=\"w-4 h-4 mr-1.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" />\r\n                      </svg>\r\n                      <span className=\"text-xs font-medium\">Edit</span>\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </>\r\n      )}\r\n\r\n      {/* Inline Stock Edit Popup */}\r\n      {editingStock && (\r\n        <>\r\n          {/* Backdrop */}\r\n          <div \r\n            className=\"fixed inset-0 z-40\" \r\n            onClick={handleCancelEdit}\r\n          />\r\n          \r\n          {/* Popup Modal */}\r\n          <div\r\n            className=\"fixed z-50 bg-white dark:bg-gray-800 rounded-lg shadow-2xl border-2 border-slate-300 dark:border-slate-600 p-4 w-72\"\r\n            style={{\r\n              left: `${editingStock.position.x}px`,\r\n              top: `${editingStock.position.y}px`,\r\n              transform: 'translateX(-50%)'\r\n            }}\r\n          >\r\n            <div className=\"space-y-3\">\r\n              {/* Title */}\r\n              <div className=\"flex items-center justify-between pb-2 border-b border-gray-200 dark:border-gray-700\">\r\n                <h3 className=\"text-sm font-bold text-gray-900 dark:text-white\">\r\n                  Edit Stok\r\n                </h3>\r\n                <button\r\n                  onClick={handleCancelEdit}\r\n                  className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n                >\r\n                  <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                  </svg>\r\n                </button>\r\n              </div>\r\n\r\n              {/* Current stock info */}\r\n              <div className=\"text-xs text-gray-600 dark:text-gray-400\">\r\n                Stok saat ini: <span className=\"font-bold text-gray-900 dark:text-white\">{editingStock.currentQty}</span>\r\n              </div>\r\n\r\n              {/* New stock input */}\r\n              <div>\r\n                <label className=\"block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">\r\n                  Stok Baru\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  min=\"0\"\r\n                  value={newStockQty}\r\n                  onChange={(e) => setNewStockQty(e.target.value)}\r\n                  className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-slate-500\"\r\n                  placeholder=\"0\"\r\n                  autoFocus\r\n                />\r\n              </div>\r\n\r\n              {/* Reason dropdown/input */}\r\n              <div>\r\n                <label className=\"block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1.5\">\r\n                  Alasan (opsional)\r\n                </label>\r\n                <select\r\n                  value={adjustmentReason}\r\n                  onChange={(e) => setAdjustmentReason(e.target.value)}\r\n                  className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-slate-500\"\r\n                >\r\n                  <option value=\"\">- Pilih atau skip -</option>\r\n                  <option value=\"Stok opname\">Stok opname</option>\r\n                  <option value=\"Barang rusak\">Barang rusak</option>\r\n                  <option value=\"Barang hilang\">Barang hilang</option>\r\n                  <option value=\"Return supplier\">Return supplier</option>\r\n                  <option value=\"Koreksi input\">Koreksi input</option>\r\n                  <option value=\"Lainnya\">Lainnya</option>\r\n                </select>\r\n              </div>\r\n\r\n              {/* Action buttons */}\r\n              <div className=\"flex gap-2 pt-2\">\r\n                <button\r\n                  onClick={handleCancelEdit}\r\n                  disabled={savingStock}\r\n                  className=\"flex-1 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg transition-colors disabled:opacity-50\"\r\n                >\r\n                  Batal\r\n                </button>\r\n                <button\r\n                  onClick={handleSaveStock}\r\n                  disabled={savingStock}\r\n                  className=\"flex-1 px-3 py-2 text-sm font-medium text-white bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 rounded-lg transition-all disabled:opacity-50\"\r\n                >\r\n                  {savingStock ? 'Menyimpan...' : 'Simpan'}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n      </>\r\n      )}\r\n\r\n      {/* Variant Details Modal */}\r\n      {variantModal.isOpen && variantModal.product && (\r\n        <div \r\n          className=\"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-y-auto\"\r\n          onClick={(e) => {\r\n            if (e.target === e.currentTarget) closeVariantModal();\r\n          }}\r\n        >\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full my-auto flex flex-col max-h-[85vh]\">\r\n            {/* Modal Header */}\r\n            <div className=\"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20\">\r\n              <div>\r\n                <h3 className=\"text-xl font-bold text-gray-900 dark:text-white\">\r\n                  Detail Varian Produk\r\n                </h3>\r\n                <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\r\n                  {variantModal.product.name}\r\n                </p>\r\n              </div>\r\n              <button\r\n                onClick={closeVariantModal}\r\n                className=\"p-2 hover:bg-purple-200 dark:hover:bg-purple-900/50 rounded-lg transition-colors\"\r\n              >\r\n                <svg className=\"w-6 h-6 text-gray-600 dark:text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Modal Body - Scrollable */}\r\n            <div className=\"p-6 overflow-y-auto flex-1\">\r\n              <div className=\"space-y-4\">\r\n                {variantModal.product.variants?.map((variant: any) => {\r\n                  const variantStockTotal = variant.stocks?.reduce((sum: number, s: any) => sum + s.quantity, 0) || 0;\r\n                  \r\n                  return (\r\n                    <div key={variant.id} className=\"bg-purple-50 dark:bg-purple-900/10 rounded-xl p-4 border border-purple-200 dark:border-purple-800\">\r\n                      {/* Variant Header */}\r\n                      <div className=\"flex items-start justify-between mb-3\">\r\n                        <div className=\"flex-1\">\r\n                          <h4 className=\"text-base font-bold text-purple-700 dark:text-purple-400\">\r\n                            {variant.variantValue}\r\n                          </h4>\r\n                          <p className=\"text-xs text-gray-500 dark:text-gray-400 font-mono mt-1\">\r\n                            SKU: {variant.sku}\r\n                          </p>\r\n                        </div>\r\n                        <span className={`inline-flex items-center px-3 py-1 rounded-lg text-sm font-bold ${\r\n                          variantStockTotal === 0\r\n                            ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300'\r\n                            : variantStockTotal <= 10\r\n                            ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300'\r\n                            : 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'\r\n                        }`}>\r\n                          Total: {variantStockTotal}\r\n                        </span>\r\n                      </div>\r\n\r\n                      {/* Stock per Cabang */}\r\n                      <div className=\"space-y-2\">\r\n                        <p className=\"text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase\">Stock per Cabang:</p>\r\n                        {cabangs.map((cabang) => {\r\n                          const stock = variant.stocks?.find((s: any) => s.cabangId === cabang.id);\r\n                          const stockQty = stock?.quantity || 0;\r\n                          const stockPrice = stock?.price || 0;\r\n\r\n                          return (\r\n                            <div key={cabang.id} className=\"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg\">\r\n                              <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                                {cabang.name}\r\n                              </span>\r\n                              <div className=\"flex items-center gap-4\">\r\n                                <span className={`inline-flex items-center px-2.5 py-1 rounded text-sm font-bold ${\r\n                                  stockQty === 0\r\n                                    ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300'\r\n                                    : stockQty <= 5\r\n                                    ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300'\r\n                                    : 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300'\r\n                                }`}>\r\n                                  {stockQty} unit\r\n                                </span>\r\n                                {stockPrice > 0 && (\r\n                                  <span className=\"text-sm font-semibold text-gray-900 dark:text-white\">\r\n                                    Rp {stockPrice.toLocaleString('id-ID')}\r\n                                  </span>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          );\r\n                        })}\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Modal Footer */}\r\n            <div className=\"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50\">\r\n              <button\r\n                onClick={closeVariantModal}\r\n                className=\"px-6 py-2.5 bg-slate-600 hover:bg-slate-700 text-white rounded-lg font-medium transition-colors\"\r\n              >\r\n                Tutup\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\reports\\inventory\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\reports\\inventory\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\reports\\marketing\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\reports\\marketing\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\reports\\sales\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\reports\\sales\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BarChart3' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[474,477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[474,477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useMemo } from 'react';\r\nimport { useSalesReportStore } from '@/stores/useSalesReportStore';\r\nimport { \r\n  TrendingUp, TrendingDown, DollarSign, ShoppingCart, Package, \r\n  Calendar, RefreshCw, Store, CreditCard, Wallet, Building2, \r\n  BarChart3, PieChart, ArrowUpRight, ShoppingBag\r\n} from 'lucide-react';\r\nimport { SkeletonStatCard, SkeletonTable, SkeletonChart } from '@/components/ui/Skeleton';\r\n\r\nconst PAYMENT_ICONS: Record<string, any> = {\r\n  CASH: Wallet,\r\n  DEBIT: CreditCard,\r\n  TRANSFER: Building2,\r\n  QRIS: DollarSign,\r\n};\r\n\r\nconst PAYMENT_COLORS: Record<string, string> = {\r\n  CASH: 'bg-green-500',\r\n  DEBIT: 'bg-blue-500',\r\n  TRANSFER: 'bg-purple-500',\r\n  QRIS: 'bg-orange-500',\r\n};\r\n\r\nexport default function SalesReportPage() {\r\n  // Use store for all state\r\n  const {\r\n    loading,\r\n    summary,\r\n    trend,\r\n    topProducts,\r\n    branchPerformance,\r\n    cabangs,\r\n    channels,\r\n    selectedCabang,\r\n    selectedChannel,\r\n    dateRange,\r\n    startDate,\r\n    endDate,\r\n    showCustomDate,\r\n    // Actions\r\n    setSelectedCabang,\r\n    setSelectedChannel,\r\n    setStartDate,\r\n    setEndDate,\r\n    fetchInitialData,\r\n    fetchReportData,\r\n    handleDateRangeChange,\r\n  } = useSalesReportStore();\r\n\r\n  useEffect(() => {\r\n    fetchInitialData();\r\n  }, [fetchInitialData]);\r\n\r\n  useEffect(() => {\r\n    fetchReportData();\r\n  }, [selectedCabang, selectedChannel, dateRange, startDate, endDate, fetchReportData]);\r\n\r\n  const stats = useMemo(() => {\r\n    if (!summary) return null;\r\n    \r\n    const avgTransaction = summary.totalTransactions > 0 \r\n      ? summary.totalRevenue / summary.totalTransactions \r\n      : 0;\r\n    \r\n    const midPoint = Math.floor(trend.length / 2);\r\n    const firstHalf = trend.slice(0, midPoint).reduce((sum, t) => sum + t.total, 0);\r\n    const secondHalf = trend.slice(midPoint).reduce((sum, t) => sum + t.total, 0);\r\n    const trendPercentage = firstHalf > 0 ? ((secondHalf - firstHalf) / firstHalf) * 100 : 0;\r\n\r\n    return {\r\n      avgTransaction,\r\n      trendPercentage,\r\n      totalItems: topProducts.reduce((sum, p) => sum + p.totalQuantity, 0)\r\n    };\r\n  }, [summary, trend, topProducts]);\r\n\r\n  const maxTrendValue = useMemo(() => Math.max(...trend.map(t => t.total), 1), [trend]);\r\n  const totalPayments = useMemo(() => \r\n    summary?.paymentMethodBreakdown.reduce((sum, p) => sum + p._count.id, 0) || 1, \r\n    [summary]\r\n  );\r\n\r\n  const formatCurrency = (value: number) => {\r\n    return new Intl.NumberFormat('id-ID', {\r\n      style: 'currency',\r\n      currency: 'IDR',\r\n      minimumFractionDigits: 0,\r\n      maximumFractionDigits: 0,\r\n    }).format(value);\r\n  };\r\n\r\n  const formatDate = (dateStr: string) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });\r\n  };\r\n\r\n  return (\r\n    <div className=\"px-4 md:px-6 pb-6 space-y-6\">\r\n      {/* Breadcrumb + Action */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\r\n        <nav className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n          <a href=\"/dashboard\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Dashboard</a>\r\n          <span>ΓÇ║</span>\r\n          <span className=\"text-gray-900 dark:text-white font-medium\">Sales Report</span>\r\n        </nav>\r\n        \r\n        <button\r\n          onClick={fetchReportData}\r\n          disabled={loading}\r\n          className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50\"\r\n        >\r\n          <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\r\n          Refresh\r\n        </button>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 mb-6\">\r\n        <div className=\"flex flex-wrap items-center gap-3\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <Calendar className=\"w-4 h-4 text-gray-400\" />\r\n            <select\r\n              value={showCustomDate ? 'custom' : dateRange}\r\n              onChange={(e) => handleDateRangeChange(e.target.value)}\r\n              className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n            >\r\n              <option value=\"7\">7 Hari Terakhir</option>\r\n              <option value=\"14\">14 Hari Terakhir</option>\r\n              <option value=\"30\">30 Hari Terakhir</option>\r\n              <option value=\"90\">3 Bulan Terakhir</option>\r\n              <option value=\"custom\">Custom</option>\r\n            </select>\r\n          </div>\r\n\r\n          {showCustomDate && (\r\n            <>\r\n              <input\r\n                type=\"date\"\r\n                value={startDate}\r\n                onChange={(e) => setStartDate(e.target.value)}\r\n                className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n              />\r\n              <span className=\"text-gray-400\">-</span>\r\n              <input\r\n                type=\"date\"\r\n                value={endDate}\r\n                onChange={(e) => setEndDate(e.target.value)}\r\n                className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n              />\r\n            </>\r\n          )}\r\n\r\n          <select\r\n            value={selectedCabang}\r\n            onChange={(e) => setSelectedCabang(e.target.value)}\r\n            className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n          >\r\n            <option value=\"\">Semua Cabang</option>\r\n            {cabangs.map(c => (\r\n              <option key={c.id} value={c.id}>{c.name}</option>\r\n            ))}\r\n          </select>\r\n\r\n          <select\r\n            value={selectedChannel}\r\n            onChange={(e) => setSelectedChannel(e.target.value)}\r\n            className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n          >\r\n            <option value=\"\">Semua Channel</option>\r\n            {channels.map(c => (\r\n              <option key={c.id} value={c.id}>{c.name}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div className=\"space-y-6\">\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n            <SkeletonStatCard />\r\n            <SkeletonStatCard />\r\n            <SkeletonStatCard />\r\n            <SkeletonStatCard />\r\n          </div>\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            <SkeletonChart height={250} />\r\n            <SkeletonChart height={250} />\r\n          </div>\r\n          <SkeletonTable rows={5} columns={5} />\r\n        </div>\r\n      ) : (\r\n        <>\r\n          {/* Summary Cards */}\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <div className=\"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg\">\r\n                  <DollarSign className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\r\n                </div>\r\n                {stats && stats.trendPercentage !== 0 && (\r\n                  <span className={`flex items-center text-xs font-medium ${stats.trendPercentage >= 0 ? 'text-green-600' : 'text-red-600'}`}>\r\n                    {stats.trendPercentage >= 0 ? <TrendingUp className=\"w-3 h-3 mr-1\" /> : <TrendingDown className=\"w-3 h-3 mr-1\" />}\r\n                    {Math.abs(stats.trendPercentage).toFixed(1)}%\r\n                  </span>\r\n                )}\r\n              </div>\r\n              <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                {formatCurrency(summary?.totalRevenue || 0)}\r\n              </p>\r\n              <p className=\"text-sm text-gray-500 mt-1\">Total Revenue</p>\r\n            </div>\r\n\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <div className=\"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg\">\r\n                  <ShoppingCart className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\r\n                </div>\r\n              </div>\r\n              <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                {(summary?.totalTransactions || 0).toLocaleString()}\r\n              </p>\r\n              <p className=\"text-sm text-gray-500 mt-1\">Total Transaksi</p>\r\n            </div>\r\n\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <div className=\"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg\">\r\n                  <ArrowUpRight className=\"w-5 h-5 text-purple-600 dark:text-purple-400\" />\r\n                </div>\r\n              </div>\r\n              <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                {formatCurrency(stats?.avgTransaction || 0)}\r\n              </p>\r\n              <p className=\"text-sm text-gray-500 mt-1\">Rata-rata/Transaksi</p>\r\n            </div>\r\n\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <div className=\"p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg\">\r\n                  <Package className=\"w-5 h-5 text-orange-600 dark:text-orange-400\" />\r\n                </div>\r\n              </div>\r\n              <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                {(stats?.totalItems || 0).toLocaleString()}\r\n              </p>\r\n              <p className=\"text-sm text-gray-500 mt-1\">Items Terjual</p>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Charts Row */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6\">\r\n            {/* Sales Trend Chart */}\r\n            <div className=\"lg:col-span-2 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n              <h3 className=\"font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n                <TrendingUp className=\"w-5 h-5 text-blue-600\" />\r\n                Trend Penjualan\r\n              </h3>\r\n              <div className=\"h-64\">\r\n                {trend.length > 0 ? (\r\n                  <div className=\"flex items-end justify-between h-full gap-1 px-2\">\r\n                    {trend.map((item, index) => (\r\n                      <div key={index} className=\"flex-1 flex flex-col items-center gap-1\">\r\n                        <div \r\n                          className=\"w-full bg-blue-500 dark:bg-blue-600 rounded-t-sm hover:bg-blue-600 dark:hover:bg-blue-500 transition cursor-pointer group relative\"\r\n                          style={{ height: `${Math.max((item.total / maxTrendValue) * 100, 2)}%` }}\r\n                        >\r\n                          <div className=\"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-gray-900 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap z-10\">\r\n                            {formatCurrency(item.total)}\r\n                            <br />\r\n                            <span className=\"text-gray-300\">{item.count} transaksi</span>\r\n                          </div>\r\n                        </div>\r\n                        <span className=\"text-[10px] text-gray-500 dark:text-gray-400 truncate w-full text-center\">\r\n                          {formatDate(item.date)}\r\n                        </span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"flex items-center justify-center h-full text-gray-400\">\r\n                    Tidak ada data\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Payment Methods */}\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n              <h3 className=\"font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n                <PieChart className=\"w-5 h-5 text-purple-600\" />\r\n                Metode Pembayaran\r\n              </h3>\r\n              <div className=\"space-y-3\">\r\n                {summary?.paymentMethodBreakdown.map((item) => {\r\n                  const Icon = PAYMENT_ICONS[item.paymentMethod] || Wallet;\r\n                  const percentage = ((item._count.id / totalPayments) * 100).toFixed(1);\r\n                  return (\r\n                    <div key={item.paymentMethod} className=\"flex items-center gap-3\">\r\n                      <div className={`p-2 rounded-lg ${PAYMENT_COLORS[item.paymentMethod] || 'bg-gray-500'} bg-opacity-20`}>\r\n                        <Icon className=\"w-4 h-4 text-gray-700 dark:text-gray-300\" />\r\n                      </div>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-center justify-between mb-1\">\r\n                          <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\r\n                            {item.paymentMethod}\r\n                          </span>\r\n                          <span className=\"text-sm text-gray-500\">{percentage}%</span>\r\n                        </div>\r\n                        <div className=\"h-2 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden\">\r\n                          <div \r\n                            className={`h-full ${PAYMENT_COLORS[item.paymentMethod] || 'bg-gray-500'} rounded-full transition-all`}\r\n                            style={{ width: `${percentage}%` }}\r\n                          />\r\n                        </div>\r\n                        <p className=\"text-xs text-gray-400 mt-1\">\r\n                          {item._count.id} transaksi ΓÇó {formatCurrency(item._sum.total || 0)}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n                {(!summary?.paymentMethodBreakdown || summary.paymentMethodBreakdown.length === 0) && (\r\n                  <p className=\"text-center text-gray-400 py-4\">Tidak ada data</p>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Bottom Row */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            {/* Top Products */}\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n              <h3 className=\"font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n                <ShoppingBag className=\"w-5 h-5 text-orange-600\" />\r\n                Produk Terlaris\r\n              </h3>\r\n              <div className=\"overflow-x-auto\">\r\n                <table className=\"w-full text-sm\">\r\n                  <thead>\r\n                    <tr className=\"text-gray-500 dark:text-gray-400 border-b border-gray-100 dark:border-gray-700\">\r\n                      <th className=\"text-left py-2 font-medium\">#</th>\r\n                      <th className=\"text-left py-2 font-medium\">Produk</th>\r\n                      <th className=\"text-right py-2 font-medium\">Qty</th>\r\n                      <th className=\"text-right py-2 font-medium\">Revenue</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody className=\"divide-y divide-gray-100 dark:divide-gray-700\">\r\n                    {topProducts.slice(0, 5).map((product, index) => (\r\n                      <tr key={product.productVariantId} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50\">\r\n                        <td className=\"py-2.5\">\r\n                          <span className={`inline-flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold\r\n                            ${index === 0 ? 'bg-yellow-100 text-yellow-700' : \r\n                              index === 1 ? 'bg-gray-100 text-gray-600' : \r\n                              index === 2 ? 'bg-orange-100 text-orange-700' : \r\n                              'bg-gray-50 text-gray-500'}`}\r\n                          >\r\n                            {index + 1}\r\n                          </span>\r\n                        </td>\r\n                        <td className=\"py-2.5\">\r\n                          <div>\r\n                            <p className=\"font-medium text-gray-900 dark:text-white truncate max-w-[200px]\">\r\n                              {product.productName}\r\n                            </p>\r\n                            {product.variantValue !== '-' && (\r\n                              <p className=\"text-xs text-gray-500\">{product.variantValue}</p>\r\n                            )}\r\n                          </div>\r\n                        </td>\r\n                        <td className=\"py-2.5 text-right font-medium text-gray-900 dark:text-white\">\r\n                          {product.totalQuantity.toLocaleString()}\r\n                        </td>\r\n                        <td className=\"py-2.5 text-right text-gray-600 dark:text-gray-300\">\r\n                          {formatCurrency(product.totalRevenue)}\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                    {topProducts.length === 0 && (\r\n                      <tr>\r\n                        <td colSpan={4} className=\"py-8 text-center text-gray-400\">\r\n                          Tidak ada data\r\n                        </td>\r\n                      </tr>\r\n                    )}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Branch Performance */}\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n              <h3 className=\"font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n                <Store className=\"w-5 h-5 text-green-600\" />\r\n                Performa Cabang\r\n              </h3>\r\n              <div className=\"space-y-3\">\r\n                {branchPerformance.map((branch, index) => {\r\n                  const maxRevenue = Math.max(...branchPerformance.map(b => b.totalRevenue), 1);\r\n                  const percentage = (branch.totalRevenue / maxRevenue) * 100;\r\n                  return (\r\n                    <div key={branch.cabangId} className=\"p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg\">\r\n                      <div className=\"flex items-center justify-between mb-2\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <span className={`inline-flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold\r\n                            ${index === 0 ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600'}`}\r\n                          >\r\n                            {index + 1}\r\n                          </span>\r\n                          <span className=\"font-medium text-gray-900 dark:text-white\">{branch.cabangName}</span>\r\n                        </div>\r\n                        <span className=\"text-sm font-semibold text-gray-900 dark:text-white\">\r\n                          {formatCurrency(branch.totalRevenue)}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <div className=\"flex-1 h-2 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden\">\r\n                          <div \r\n                            className=\"h-full bg-green-500 rounded-full transition-all\"\r\n                            style={{ width: `${percentage}%` }}\r\n                          />\r\n                        </div>\r\n                        <span className=\"text-xs text-gray-500 w-20 text-right\">\r\n                          {branch.totalTransactions} trx\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n                {branchPerformance.length === 0 && (\r\n                  <p className=\"text-center text-gray-400 py-4\">Tidak ada data</p>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\reports\\stock\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\reports\\stock\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonFilterBar' is defined but never used.","line":10,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":60},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[505,508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[505,508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect } from 'react';\r\nimport { \r\n  Package, AlertTriangle, TrendingDown, TrendingUp, RefreshCw, \r\n  Calendar, ArrowDownCircle, ArrowUpCircle, BarChart3,\r\n  XCircle, CheckCircle, Clock, Filter, Boxes\r\n} from 'lucide-react';\r\nimport { useStockReportStore, type ActiveTab } from './useStockReportStore';\r\nimport { SkeletonStatCard, SkeletonTable, SkeletonFilterBar } from '@/components/ui/Skeleton';\r\n\r\nconst REASON_CONFIG: Record<string, { label: string; color: string; icon: any }> = {\r\n  SALE: { label: 'Penjualan', color: 'text-blue-600 bg-blue-100 dark:bg-blue-900/30', icon: TrendingDown },\r\n  PURCHASE: { label: 'Pembelian', color: 'text-green-600 bg-green-100 dark:bg-green-900/30', icon: TrendingUp },\r\n  RETURN: { label: 'Retur', color: 'text-orange-600 bg-orange-100 dark:bg-orange-900/30', icon: ArrowUpCircle },\r\n  DAMAGED: { label: 'Rusak', color: 'text-red-600 bg-red-100 dark:bg-red-900/30', icon: XCircle },\r\n  ADJUSTMENT: { label: 'Penyesuaian', color: 'text-purple-600 bg-purple-100 dark:bg-purple-900/30', icon: RefreshCw },\r\n  TRANSFER_IN: { label: 'Transfer Masuk', color: 'text-cyan-600 bg-cyan-100 dark:bg-cyan-900/30', icon: ArrowDownCircle },\r\n  TRANSFER_OUT: { label: 'Transfer Keluar', color: 'text-pink-600 bg-pink-100 dark:bg-pink-900/30', icon: ArrowUpCircle },\r\n  INITIAL: { label: 'Stok Awal', color: 'text-gray-600 bg-gray-100 dark:bg-gray-700', icon: Package },\r\n  OPNAME: { label: 'Stock Opname', color: 'text-indigo-600 bg-indigo-100 dark:bg-indigo-900/30', icon: CheckCircle },\r\n};\r\n\r\nconst formatCurrency = (value: number) => {\r\n  return new Intl.NumberFormat('id-ID', {\r\n    style: 'currency',\r\n    currency: 'IDR',\r\n    minimumFractionDigits: 0,\r\n    maximumFractionDigits: 0,\r\n  }).format(value);\r\n};\r\n\r\nconst formatDate = (dateStr: string) => {\r\n  return new Date(dateStr).toLocaleDateString('id-ID', { \r\n    day: 'numeric', \r\n    month: 'short',\r\n    hour: '2-digit',\r\n    minute: '2-digit'\r\n  });\r\n};\r\n\r\nexport default function StockReportPage() {\r\n  const {\r\n    loading,\r\n    cabangs,\r\n    lowStockItems,\r\n    adjustments,\r\n    selectedCabang,\r\n    dateRange,\r\n    startDate,\r\n    endDate,\r\n    showCustomDate,\r\n    reasonFilter,\r\n    activeTab,\r\n    summary,\r\n    adjustmentsByReason,\r\n    setSelectedCabang,\r\n    setStartDate,\r\n    setEndDate,\r\n    setReasonFilter,\r\n    setActiveTab,\r\n    handleDateRangeChange,\r\n    fetchInitialData,\r\n    fetchReportData,\r\n  } = useStockReportStore();\r\n\r\n  useEffect(() => {\r\n    fetchInitialData();\r\n  }, [fetchInitialData]);\r\n\r\n  useEffect(() => {\r\n    fetchReportData();\r\n  }, [selectedCabang, dateRange, startDate, endDate, reasonFilter, fetchReportData]);\r\n\r\n  return (\r\n    <div className=\"px-4 md:px-6 pb-6 space-y-6\">\r\n      {/* Breadcrumb + Action */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\r\n        <nav className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n          <a href=\"/dashboard\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Dashboard</a>\r\n          <span>ΓÇ║</span>\r\n          <span className=\"text-gray-900 dark:text-white font-medium\">Stock Report</span>\r\n        </nav>\r\n        \r\n        <button\r\n          onClick={fetchReportData}\r\n          disabled={loading}\r\n          className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50\"\r\n        >\r\n          <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\r\n          Refresh\r\n        </button>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 mb-6\">\r\n        <div className=\"flex flex-wrap items-center gap-3\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <Calendar className=\"w-4 h-4 text-gray-400\" />\r\n            <select\r\n              value={showCustomDate ? 'custom' : dateRange}\r\n              onChange={(e) => handleDateRangeChange(e.target.value)}\r\n              className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n            >\r\n              <option value=\"7\">7 Hari Terakhir</option>\r\n              <option value=\"14\">14 Hari Terakhir</option>\r\n              <option value=\"30\">30 Hari Terakhir</option>\r\n              <option value=\"90\">3 Bulan Terakhir</option>\r\n              <option value=\"custom\">Custom</option>\r\n            </select>\r\n          </div>\r\n\r\n          {showCustomDate && (\r\n            <>\r\n              <input\r\n                type=\"date\"\r\n                value={startDate}\r\n                onChange={(e) => setStartDate(e.target.value)}\r\n                className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n              />\r\n              <span className=\"text-gray-400\">-</span>\r\n              <input\r\n                type=\"date\"\r\n                value={endDate}\r\n                onChange={(e) => setEndDate(e.target.value)}\r\n                className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n              />\r\n            </>\r\n          )}\r\n\r\n          <select\r\n            value={selectedCabang}\r\n            onChange={(e) => setSelectedCabang(e.target.value)}\r\n            className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n          >\r\n            <option value=\"\">Semua Cabang</option>\r\n            {cabangs.map(c => (\r\n              <option key={c.id} value={c.id}>{c.name}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Tabs */}\r\n      <div className=\"flex gap-2 mb-6 border-b border-gray-200 dark:border-gray-700\">\r\n        {[\r\n          { id: 'overview', label: 'Overview', icon: BarChart3 },\r\n          { id: 'lowstock', label: 'Low Stock Alert', icon: AlertTriangle },\r\n          { id: 'movement', label: 'Stock Movement', icon: RefreshCw },\r\n        ].map(tab => (\r\n          <button\r\n            key={tab.id}\r\n            onClick={() => setActiveTab(tab.id as ActiveTab)}\r\n            className={`flex items-center gap-2 px-4 py-2.5 text-sm font-medium border-b-2 transition\r\n              ${activeTab === tab.id \r\n                ? 'border-indigo-600 text-indigo-600 dark:text-indigo-400' \r\n                : 'border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300'}`}\r\n          >\r\n            <tab.icon className=\"w-4 h-4\" />\r\n            {tab.label}\r\n            {tab.id === 'lowstock' && lowStockItems.length > 0 && (\r\n              <span className=\"ml-1 px-1.5 py-0.5 text-xs bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400 rounded-full\">\r\n                {lowStockItems.length}\r\n              </span>\r\n            )}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div className=\"space-y-6\">\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n            <SkeletonStatCard />\r\n            <SkeletonStatCard />\r\n            <SkeletonStatCard />\r\n            <SkeletonStatCard />\r\n          </div>\r\n          <SkeletonTable rows={10} columns={6} />\r\n        </div>\r\n      ) : (\r\n        <>\r\n          {/* Overview Tab */}\r\n          {activeTab === 'overview' && (\r\n            <>\r\n              {/* Summary Cards */}\r\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n                  <div className=\"flex items-center justify-between mb-3\">\r\n                    <div className=\"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg\">\r\n                      <Package className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\r\n                    </div>\r\n                  </div>\r\n                  <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                    {summary.totalStock.toLocaleString()}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-500 mt-1\">Total Unit Stock</p>\r\n                </div>\r\n\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n                  <div className=\"flex items-center justify-between mb-3\">\r\n                    <div className=\"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg\">\r\n                      <Boxes className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\r\n                    </div>\r\n                  </div>\r\n                  <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                    {formatCurrency(summary.totalValue)}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-500 mt-1\">Nilai Inventori</p>\r\n                </div>\r\n\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n                  <div className=\"flex items-center justify-between mb-3\">\r\n                    <div className=\"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg\">\r\n                      <AlertTriangle className=\"w-5 h-5 text-yellow-600 dark:text-yellow-400\" />\r\n                    </div>\r\n                  </div>\r\n                  <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                    {summary.lowStockCount}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-500 mt-1\">Low Stock Items</p>\r\n                </div>\r\n\r\n                <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n                  <div className=\"flex items-center justify-between mb-3\">\r\n                    <div className=\"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg\">\r\n                      <XCircle className=\"w-5 h-5 text-red-600 dark:text-red-400\" />\r\n                    </div>\r\n                  </div>\r\n                  <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                    {summary.outOfStockCount}\r\n                  </p>\r\n                  <p className=\"text-sm text-gray-500 mt-1\">Out of Stock</p>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Movement Summary by Reason */}\r\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 mb-6\">\r\n                <h3 className=\"font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n                  <RefreshCw className=\"w-5 h-5 text-indigo-600\" />\r\n                  Ringkasan Pergerakan Stock\r\n                </h3>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3\">\r\n                  {Object.entries(adjustmentsByReason).map(([reason, data]) => {\r\n                    const config = REASON_CONFIG[reason] || REASON_CONFIG.ADJUSTMENT;\r\n                    const Icon = config.icon;\r\n                    return (\r\n                      <div key={reason} className={`p-3 rounded-lg ${config.color}`}>\r\n                        <div className=\"flex items-center gap-2 mb-2\">\r\n                          <Icon className=\"w-4 h-4\" />\r\n                          <span className=\"font-medium text-sm\">{config.label}</span>\r\n                        </div>\r\n                        <div className=\"flex items-center justify-between text-xs\">\r\n                          <span>{data.count} transaksi</span>\r\n                          <div className=\"flex gap-2\">\r\n                            {data.qtyIn > 0 && <span className=\"text-green-700\">+{data.qtyIn}</span>}\r\n                            {data.qtyOut > 0 && <span className=\"text-red-700\">-{data.qtyOut}</span>}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                  {Object.keys(adjustmentsByReason).length === 0 && (\r\n                    <div className=\"col-span-full text-center text-gray-400 py-4\">\r\n                      Tidak ada pergerakan stock dalam periode ini\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Product/Variant Stats */}\r\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n                <h3 className=\"font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n                  <Package className=\"w-5 h-5 text-blue-600\" />\r\n                  Statistik Produk\r\n                </h3>\r\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n                  <div className=\"text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg\">\r\n                    <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{summary.totalProducts}</p>\r\n                    <p className=\"text-xs text-gray-500\">Total Produk</p>\r\n                  </div>\r\n                  <div className=\"text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg\">\r\n                    <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{summary.totalVariants}</p>\r\n                    <p className=\"text-xs text-gray-500\">Total Varian</p>\r\n                  </div>\r\n                  <div className=\"text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg\">\r\n                    <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{cabangs.length}</p>\r\n                    <p className=\"text-xs text-gray-500\">Cabang Aktif</p>\r\n                  </div>\r\n                  <div className=\"text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg\">\r\n                    <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{adjustments.length}</p>\r\n                    <p className=\"text-xs text-gray-500\">Pergerakan Stock</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </>\r\n          )}\r\n\r\n          {/* Low Stock Tab */}\r\n          {activeTab === 'lowstock' && (\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden\">\r\n              {lowStockItems.length === 0 ? (\r\n                <div className=\"text-center py-12\">\r\n                  <CheckCircle className=\"w-12 h-12 mx-auto text-green-500 mb-3\" />\r\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-1\">Semua Stock Aman!</h3>\r\n                  <p className=\"text-gray-500\">Tidak ada produk dengan stock rendah saat ini.</p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"overflow-x-auto\">\r\n                  <table className=\"w-full text-sm\">\r\n                    <thead className=\"bg-gray-50 dark:bg-gray-700/50\">\r\n                      <tr>\r\n                        <th className=\"px-4 py-3 text-left font-medium text-gray-500 dark:text-gray-400\">Produk</th>\r\n                        <th className=\"px-4 py-3 text-left font-medium text-gray-500 dark:text-gray-400\">SKU</th>\r\n                        <th className=\"px-4 py-3 text-left font-medium text-gray-500 dark:text-gray-400\">Cabang</th>\r\n                        <th className=\"px-4 py-3 text-center font-medium text-gray-500 dark:text-gray-400\">Stock Saat Ini</th>\r\n                        <th className=\"px-4 py-3 text-center font-medium text-gray-500 dark:text-gray-400\">Min. Stock</th>\r\n                        <th className=\"px-4 py-3 text-center font-medium text-gray-500 dark:text-gray-400\">Kekurangan</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-gray-100 dark:divide-gray-700\">\r\n                      {lowStockItems.map((item) => {\r\n                        const currentStock = item.productVariant.stocks.find(s => s.cabangId === item.cabang.id)?.quantity || 0;\r\n                        const shortage = item.minStock - currentStock;\r\n                        return (\r\n                          <tr key={item.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50\">\r\n                            <td className=\"px-4 py-3\">\r\n                              <div>\r\n                                <p className=\"font-medium text-gray-900 dark:text-white\">{item.productVariant.product.name}</p>\r\n                                <p className=\"text-xs text-gray-500\">{item.productVariant.variantValue}</p>\r\n                              </div>\r\n                            </td>\r\n                            <td className=\"px-4 py-3\">\r\n                              <code className=\"text-xs bg-gray-100 dark:bg-gray-700 px-1.5 py-0.5 rounded\">\r\n                                {item.productVariant.sku}\r\n                              </code>\r\n                            </td>\r\n                            <td className=\"px-4 py-3 text-gray-600 dark:text-gray-300\">{item.cabang.name}</td>\r\n                            <td className=\"px-4 py-3 text-center\">\r\n                              <span className={`font-semibold ${currentStock === 0 ? 'text-red-600' : 'text-yellow-600'}`}>\r\n                                {currentStock}\r\n                              </span>\r\n                            </td>\r\n                            <td className=\"px-4 py-3 text-center text-gray-600 dark:text-gray-300\">{item.minStock}</td>\r\n                            <td className=\"px-4 py-3 text-center\">\r\n                              <span className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 text-xs font-medium\">\r\n                                <ArrowDownCircle className=\"w-3 h-3\" />\r\n                                {shortage}\r\n                              </span>\r\n                            </td>\r\n                          </tr>\r\n                        );\r\n                      })}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Stock Movement Tab */}\r\n          {activeTab === 'movement' && (\r\n            <>\r\n              {/* Reason Filter */}\r\n              <div className=\"flex items-center gap-2 mb-4\">\r\n                <Filter className=\"w-4 h-4 text-gray-400\" />\r\n                <select\r\n                  value={reasonFilter}\r\n                  onChange={(e) => setReasonFilter(e.target.value)}\r\n                  className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                >\r\n                  <option value=\"\">Semua Alasan</option>\r\n                  {Object.entries(REASON_CONFIG).map(([key, config]) => (\r\n                    <option key={key} value={key}>{config.label}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden\">\r\n                {adjustments.length === 0 ? (\r\n                  <div className=\"text-center py-12\">\r\n                    <Clock className=\"w-12 h-12 mx-auto text-gray-400 mb-3\" />\r\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-1\">Tidak Ada Pergerakan</h3>\r\n                    <p className=\"text-gray-500\">Tidak ada pergerakan stock dalam periode yang dipilih.</p>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-sm\">\r\n                      <thead className=\"bg-gray-50 dark:bg-gray-700/50\">\r\n                        <tr>\r\n                          <th className=\"px-4 py-3 text-left font-medium text-gray-500 dark:text-gray-400\">Waktu</th>\r\n                          <th className=\"px-4 py-3 text-left font-medium text-gray-500 dark:text-gray-400\">Produk</th>\r\n                          <th className=\"px-4 py-3 text-left font-medium text-gray-500 dark:text-gray-400\">Cabang</th>\r\n                          <th className=\"px-4 py-3 text-left font-medium text-gray-500 dark:text-gray-400\">Alasan</th>\r\n                          <th className=\"px-4 py-3 text-center font-medium text-gray-500 dark:text-gray-400\">Perubahan</th>\r\n                          <th className=\"px-4 py-3 text-center font-medium text-gray-500 dark:text-gray-400\">Stock</th>\r\n                          <th className=\"px-4 py-3 text-left font-medium text-gray-500 dark:text-gray-400\">Oleh</th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody className=\"divide-y divide-gray-100 dark:divide-gray-700\">\r\n                        {adjustments.map((adj) => {\r\n                          const config = REASON_CONFIG[adj.reason] || REASON_CONFIG.ADJUSTMENT;\r\n                          const Icon = config.icon;\r\n                          return (\r\n                            <tr key={adj.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50\">\r\n                              <td className=\"px-4 py-3 text-gray-500 dark:text-gray-400 whitespace-nowrap\">\r\n                                {formatDate(adj.createdAt)}\r\n                              </td>\r\n                              <td className=\"px-4 py-3\">\r\n                                <div>\r\n                                  <p className=\"font-medium text-gray-900 dark:text-white\">{adj.productVariant.product.name}</p>\r\n                                  <p className=\"text-xs text-gray-500\">{adj.productVariant.sku}</p>\r\n                                </div>\r\n                              </td>\r\n                              <td className=\"px-4 py-3 text-gray-600 dark:text-gray-300\">{adj.cabang.name}</td>\r\n                              <td className=\"px-4 py-3\">\r\n                                <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${config.color}`}>\r\n                                  <Icon className=\"w-3 h-3\" />\r\n                                  {config.label}\r\n                                </span>\r\n                              </td>\r\n                              <td className=\"px-4 py-3 text-center\">\r\n                                <span className={`font-semibold ${adj.type === 'add' ? 'text-green-600' : 'text-red-600'}`}>\r\n                                  {adj.type === 'add' ? '+' : '-'}{adj.quantity}\r\n                                </span>\r\n                              </td>\r\n                              <td className=\"px-4 py-3 text-center\">\r\n                                <span className=\"text-gray-400\">{adj.previousStock}</span>\r\n                                <span className=\"mx-1\">ΓåÆ</span>\r\n                                <span className=\"font-medium text-gray-900 dark:text-white\">{adj.newStock}</span>\r\n                              </td>\r\n                              <td className=\"px-4 py-3 text-gray-600 dark:text-gray-300\">{adj.adjustedBy.name}</td>\r\n                            </tr>\r\n                          );\r\n                        })}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </>\r\n          )}\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\reports\\stock\\useStockReportStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\reports\\stock\\useStockReportStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1363,1366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1363,1366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1383,1386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1383,1386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2343,2346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2343,2346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2672,2675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2672,2675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2750,2753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2750,2753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":236,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5909,5912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5909,5912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { create } from 'zustand';\r\nimport { productsAPI, cabangAPI, stockAPI } from '@/lib/api';\r\n\r\n// ============ Types ============\r\nexport interface LowStockItem {\r\n  id: string;\r\n  productVariant: {\r\n    id: string;\r\n    sku: string;\r\n    variantValue: string;\r\n    product: {\r\n      id: string;\r\n      name: string;\r\n    };\r\n    stocks: Array<{\r\n      quantity: number;\r\n      cabangId: string;\r\n    }>;\r\n  };\r\n  cabang: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n  minStock: number;\r\n}\r\n\r\nexport interface StockAdjustment {\r\n  id: string;\r\n  type: string;\r\n  quantity: number;\r\n  previousStock: number;\r\n  newStock: number;\r\n  reason: string;\r\n  notes: string | null;\r\n  createdAt: string;\r\n  productVariant: {\r\n    id: string;\r\n    sku: string;\r\n    variantValue: string;\r\n    product: {\r\n      id: string;\r\n      name: string;\r\n    };\r\n  };\r\n  cabang: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n  adjustedBy: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n}\r\n\r\nexport interface StockSummary {\r\n  totalProducts: number;\r\n  totalVariants: number;\r\n  totalStock: number;\r\n  lowStockCount: number;\r\n  outOfStockCount: number;\r\n  totalValue: number;\r\n}\r\n\r\nexport type ActiveTab = 'overview' | 'lowstock' | 'movement';\r\n\r\n// ============ State Interface ============\r\ninterface StockReportState {\r\n  // Data\r\n  loading: boolean;\r\n  cabangs: any[];\r\n  products: any[];\r\n  lowStockItems: LowStockItem[];\r\n  adjustments: StockAdjustment[];\r\n  \r\n  // Filters\r\n  selectedCabang: string;\r\n  dateRange: string;\r\n  startDate: string;\r\n  endDate: string;\r\n  showCustomDate: boolean;\r\n  reasonFilter: string;\r\n  \r\n  // UI\r\n  activeTab: ActiveTab;\r\n  \r\n  // Computed\r\n  summary: StockSummary;\r\n  adjustmentsByReason: Record<string, { count: number; qtyIn: number; qtyOut: number }>;\r\n  \r\n  // Actions\r\n  setSelectedCabang: (cabang: string) => void;\r\n  setDateRange: (range: string) => void;\r\n  setStartDate: (date: string) => void;\r\n  setEndDate: (date: string) => void;\r\n  setShowCustomDate: (show: boolean) => void;\r\n  setReasonFilter: (reason: string) => void;\r\n  setActiveTab: (tab: ActiveTab) => void;\r\n  handleDateRangeChange: (value: string) => void;\r\n  fetchInitialData: () => Promise<void>;\r\n  fetchReportData: () => Promise<void>;\r\n}\r\n\r\n// ============ Helper Functions ============\r\nconst computeSummary = (\r\n  products: any[],\r\n  selectedCabang: string,\r\n  lowStockItems: LowStockItem[]\r\n): StockSummary => {\r\n  let totalStock = 0;\r\n  let totalValue = 0;\r\n  let outOfStockCount = 0;\r\n  const totalVariants = products.reduce((sum, p) => sum + (p.variants?.length || 0), 0);\r\n\r\n  products.forEach(product => {\r\n    product.variants?.forEach((variant: any) => {\r\n      let variantStock = 0;\r\n      variant.stocks?.forEach((stock: any) => {\r\n        if (!selectedCabang || stock.cabangId === selectedCabang) {\r\n          variantStock += stock.quantity;\r\n        }\r\n      });\r\n      totalStock += variantStock;\r\n      totalValue += variantStock * (variant.price || 0);\r\n      \r\n      if (variantStock === 0) outOfStockCount++;\r\n    });\r\n  });\r\n\r\n  return {\r\n    totalProducts: products.length,\r\n    totalVariants,\r\n    totalStock,\r\n    lowStockCount: lowStockItems.length,\r\n    outOfStockCount,\r\n    totalValue\r\n  };\r\n};\r\n\r\nconst computeAdjustmentsByReason = (\r\n  adjustments: StockAdjustment[]\r\n): Record<string, { count: number; qtyIn: number; qtyOut: number }> => {\r\n  const grouped: Record<string, { count: number; qtyIn: number; qtyOut: number }> = {};\r\n  \r\n  adjustments.forEach(adj => {\r\n    if (!grouped[adj.reason]) {\r\n      grouped[adj.reason] = { count: 0, qtyIn: 0, qtyOut: 0 };\r\n    }\r\n    grouped[adj.reason].count++;\r\n    if (adj.type === 'add') {\r\n      grouped[adj.reason].qtyIn += adj.quantity;\r\n    } else {\r\n      grouped[adj.reason].qtyOut += adj.quantity;\r\n    }\r\n  });\r\n  \r\n  return grouped;\r\n};\r\n\r\n// ============ Store ============\r\nexport const useStockReportStore = create<StockReportState>((set, get) => ({\r\n  // Data\r\n  loading: true,\r\n  cabangs: [],\r\n  products: [],\r\n  lowStockItems: [],\r\n  adjustments: [],\r\n  \r\n  // Filters\r\n  selectedCabang: '',\r\n  dateRange: '7',\r\n  startDate: '',\r\n  endDate: '',\r\n  showCustomDate: false,\r\n  reasonFilter: '',\r\n  \r\n  // UI\r\n  activeTab: 'overview',\r\n  \r\n  // Computed (initial values)\r\n  summary: {\r\n    totalProducts: 0,\r\n    totalVariants: 0,\r\n    totalStock: 0,\r\n    lowStockCount: 0,\r\n    outOfStockCount: 0,\r\n    totalValue: 0\r\n  },\r\n  adjustmentsByReason: {},\r\n  \r\n  // Actions\r\n  setSelectedCabang: (cabang) => set({ selectedCabang: cabang }),\r\n  setDateRange: (range) => set({ dateRange: range }),\r\n  setStartDate: (date) => set({ startDate: date }),\r\n  setEndDate: (date) => set({ endDate: date }),\r\n  setShowCustomDate: (show) => set({ showCustomDate: show }),\r\n  setReasonFilter: (reason) => set({ reasonFilter: reason }),\r\n  setActiveTab: (tab) => set({ activeTab: tab }),\r\n  \r\n  handleDateRangeChange: (value) => {\r\n    if (value === 'custom') {\r\n      set({ showCustomDate: true });\r\n    } else {\r\n      set({ showCustomDate: false, dateRange: value });\r\n    }\r\n  },\r\n  \r\n  fetchInitialData: async () => {\r\n    try {\r\n      const [cabangRes, productsRes] = await Promise.all([\r\n        cabangAPI.getCabangs(),\r\n        productsAPI.getProducts({ isActive: true })\r\n      ]);\r\n      \r\n      const products = productsRes.data;\r\n      const cabangs = cabangRes.data;\r\n      const { selectedCabang, lowStockItems } = get();\r\n      \r\n      set({ \r\n        cabangs,\r\n        products,\r\n        summary: computeSummary(products, selectedCabang, lowStockItems)\r\n      });\r\n    } catch (error) {\r\n      console.error('Error fetching initial data:', error);\r\n    }\r\n  },\r\n  \r\n  fetchReportData: async () => {\r\n    const { selectedCabang, reasonFilter, showCustomDate, startDate, endDate, dateRange, products } = get();\r\n    \r\n    set({ loading: true });\r\n    try {\r\n      // Calculate date params\r\n      const params: any = {};\r\n      if (selectedCabang) params.cabangId = selectedCabang;\r\n      if (reasonFilter) params.reason = reasonFilter;\r\n      \r\n      if (showCustomDate && startDate && endDate) {\r\n        params.startDate = startDate;\r\n        params.endDate = endDate;\r\n      } else {\r\n        const end = new Date();\r\n        const start = new Date();\r\n        start.setDate(start.getDate() - parseInt(dateRange));\r\n        params.startDate = start.toISOString().split('T')[0];\r\n        params.endDate = end.toISOString().split('T')[0];\r\n      }\r\n\r\n      const [lowStockRes, adjustmentsRes] = await Promise.all([\r\n        stockAPI.getLowStockItems(selectedCabang || undefined),\r\n        stockAPI.getAdjustments({ ...params, limit: 100 })\r\n      ]);\r\n\r\n      const lowStockItems = lowStockRes.data.data || [];\r\n      const adjustments = adjustmentsRes.data.data || [];\r\n      \r\n      set({ \r\n        lowStockItems,\r\n        adjustments,\r\n        summary: computeSummary(products, selectedCabang, lowStockItems),\r\n        adjustmentsByReason: computeAdjustmentsByReason(adjustments)\r\n      });\r\n    } catch (error) {\r\n      console.error('Error fetching report data:', error);\r\n    } finally {\r\n      set({ loading: false });\r\n    }\r\n  }\r\n}));\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\returns\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\returns\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RotateCcw' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonStatCard' is defined but never used.","line":8,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":452,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":452,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22591,22594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22591,22594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":472,"column":109,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":472,"endColumn":112,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24142,24145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24142,24145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useEffect, useCallback } from 'react'\r\nimport ProtectedRoute from '@/components/ProtectedRoute'\r\nimport { useFilterStore } from '@/stores/useFilterStore'\r\nimport { useReturnsStore } from '@/stores/useReturnsStore'\r\nimport { RotateCcw, RefreshCw } from 'lucide-react'\r\nimport { SkeletonTable, SkeletonStatCard } from '@/components/ui/Skeleton'\r\n\r\nexport default function ReturnsPage() {\r\n  // Use returns store for data and modals\r\n  const {\r\n    returns,\r\n    stats,\r\n    loading,\r\n    modal,\r\n    processing,\r\n    fetchReturns,\r\n    fetchStats,\r\n    handleApprove,\r\n    handleReject,\r\n    openModal,\r\n    closeModal,\r\n    setModalNotes,\r\n  } = useReturnsStore()\r\n  \r\n  // Use filter store for shared filter state\r\n  const {\r\n    search: searchQuery,\r\n    startDate,\r\n    endDate,\r\n    selectedStatus: statusFilter,\r\n    setSearch: setSearchQuery,\r\n    setStartDate,\r\n    setEndDate,\r\n    setSelectedStatus: setStatusFilter,\r\n  } = useFilterStore()\r\n\r\n  const doFetchReturns = useCallback(async () => {\r\n    await fetchReturns({\r\n      status: statusFilter,\r\n      search: searchQuery,\r\n      startDate,\r\n      endDate\r\n    })\r\n  }, [statusFilter, searchQuery, startDate, endDate, fetchReturns])\r\n\r\n  useEffect(() => {\r\n    doFetchReturns()\r\n    fetchStats()\r\n  }, [doFetchReturns, fetchStats])\r\n\r\n  const onApprove = async () => {\r\n    const result = await handleApprove()\r\n    alert(result.message)\r\n    if (result.success) {\r\n      doFetchReturns()\r\n      fetchStats()\r\n    }\r\n  }\r\n\r\n  const onReject = async () => {\r\n    const result = await handleReject()\r\n    alert(result.message)\r\n    if (result.success) {\r\n      doFetchReturns()\r\n      fetchStats()\r\n    }\r\n  }\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const styles = {\r\n      PENDING: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',\r\n      REJECTED: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',\r\n      COMPLETED: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'\r\n    }\r\n    \r\n    const labels = {\r\n      PENDING: 'Menunggu',\r\n      REJECTED: 'Ditolak',\r\n      COMPLETED: 'Selesai'\r\n    }\r\n    \r\n    return (\r\n      <span className={`px-2 py-1 rounded-full text-xs font-medium ${styles[status as keyof typeof styles]}`}>\r\n        {labels[status as keyof typeof labels]}\r\n      </span>\r\n    )\r\n  }\r\n\r\n  const formatReason = (reason: string) => {\r\n    const reasonLabels: { [key: string]: string } = {\r\n      CUSTOMER_REQUEST: 'Permintaan Customer',\r\n      OTHER: 'Lainnya',\r\n      WRONG_SIZE: 'Salah Ukuran',\r\n      WRONG_ITEM: 'Salah Barang',\r\n      DEFECTIVE: 'Barang Rusak/Cacat',\r\n      EXPIRED: 'Kadaluarsa',\r\n      // Legacy reasons\r\n      DAMAGED: 'Barang Rusak',\r\n    }\r\n    return reasonLabels[reason] || reason\r\n  }\r\n\r\n  const formatCurrency = (amount: number) => {\r\n    return new Intl.NumberFormat('id-ID', {\r\n      style: 'currency',\r\n      currency: 'IDR',\r\n      minimumFractionDigits: 0\r\n    }).format(amount)\r\n  }\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('id-ID', {\r\n      day: '2-digit',\r\n      month: 'short',\r\n      year: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    })\r\n  }\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={['OWNER', 'MANAGER']}>\r\n      <div className=\"px-4 md:px-6 pb-6 space-y-6\">\r\n        {/* Breadcrumb + Action */}\r\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\r\n          <nav className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n            <a href=\"/dashboard\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Dashboard</a>\r\n            <span>ΓÇ║</span>\r\n            <span className=\"text-gray-900 dark:text-white font-medium\">Retur</span>\r\n          </nav>\r\n          \r\n          <button\r\n            onClick={() => { doFetchReturns(); fetchStats(); }}\r\n            className=\"flex items-center gap-2 px-4 py-2 bg-rose-600 text-white rounded-lg hover:bg-rose-700 transition\"\r\n          >\r\n            <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\r\n            Refresh\r\n          </button>\r\n        </div>\r\n\r\n        {/* Statistics Cards */}\r\n        {stats && (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\r\n            <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">Pending</p>\r\n              <p className=\"text-2xl font-bold text-yellow-600\">{stats.pending}</p>\r\n            </div>\r\n            <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">Selesai</p>\r\n              <p className=\"text-2xl font-bold text-green-600\">{stats.completed}</p>\r\n            </div>\r\n            <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">Ditolak</p>\r\n              <p className=\"text-2xl font-bold text-red-600\">{stats.rejected}</p>\r\n            </div>\r\n            <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700\">\r\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">Total Refund</p>\r\n              <p className=\"text-lg font-bold text-purple-600\">{formatCurrency(stats.totalRefundAmount)}</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Filters */}\r\n        <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 mb-6\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                Status\r\n              </label>\r\n              <select\r\n                value={statusFilter}\r\n                onChange={(e) => setStatusFilter(e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n              >\r\n                <option value=\"ALL\">Semua Status</option>\r\n                <option value=\"PENDING\">Pending</option>\r\n                <option value=\"COMPLETED\">Selesai</option>\r\n                <option value=\"REJECTED\">Ditolak</option>\r\n              </select>\r\n            </div>\r\n            \r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                Cari\r\n              </label>\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"No Return / No Transaksi\"\r\n                value={searchQuery}\r\n                onChange={(e) => setSearchQuery(e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n              />\r\n            </div>\r\n            \r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                Dari Tanggal\r\n              </label>\r\n              <input\r\n                type=\"date\"\r\n                value={startDate}\r\n                onChange={(e) => setStartDate(e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n              />\r\n            </div>\r\n            \r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                Sampai Tanggal\r\n              </label>\r\n              <input\r\n                type=\"date\"\r\n                value={endDate}\r\n                onChange={(e) => setEndDate(e.target.value)}\r\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Returns Table */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden\">\r\n          {loading ? (\r\n            <SkeletonTable rows={8} columns={8} />\r\n          ) : returns.length === 0 ? (\r\n            <div className=\"p-8 text-center\">\r\n              <p className=\"text-gray-600 dark:text-gray-400\">Tidak ada data return</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"w-full\">\r\n                <thead className=\"bg-gray-50 dark:bg-gray-700\">\r\n                  <tr>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                      No Return\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                      Tipe\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                      Transaksi\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                      Tanggal\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                      Kasir\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                      Cabang\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                      Nilai\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                      Status\r\n                    </th>\r\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\r\n                      Aksi\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\r\n                  {returns.map((returnItem) => (\r\n                    <tr key={returnItem.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700\">\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white\">\r\n                        {returnItem.returnNo}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\r\n                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${\r\n                          returnItem.returnType === 'EXCHANGE' \r\n                            ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'\r\n                            : 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200'\r\n                        }`}>\r\n                          {returnItem.returnType === 'EXCHANGE' ? 'Tukar' : 'Refund'}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400\">\r\n                        {returnItem.transaction.transactionNo}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400\">\r\n                        {formatDate(returnItem.createdAt)}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400\">\r\n                        {returnItem.processedBy.name}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400\">\r\n                        {returnItem.cabang.name}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white\">\r\n                        {returnItem.returnType === 'EXCHANGE' && returnItem.priceDifference != null ? (\r\n                          <span className={(returnItem.priceDifference ?? 0) > 0 ? 'text-green-600' : (returnItem.priceDifference ?? 0) < 0 ? 'text-red-600' : ''}>\r\n                            {(returnItem.priceDifference ?? 0) > 0 ? '+' : ''}{formatCurrency(returnItem.priceDifference ?? 0)}\r\n                          </span>\r\n                        ) : (\r\n                          formatCurrency(returnItem.refundAmount)\r\n                        )}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                        {getStatusBadge(returnItem.status)}\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\r\n                        <button\r\n                          onClick={() => openModal('detail', returnItem)}\r\n                          className=\"text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300 font-medium\"\r\n                        >\r\n                          Detail\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Detail Modal */}\r\n        {modal.type === 'detail' && modal.selectedReturn && (\r\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\r\n              <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\r\n                <div className=\"flex justify-between items-start\">\r\n                  <div>\r\n                    <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">\r\n                      Detail Return\r\n                    </h2>\r\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\r\n                      {modal.selectedReturn.returnNo}\r\n                    </p>\r\n                  </div>\r\n                  <button\r\n                    onClick={closeModal}\r\n                    className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\r\n                  >\r\n                    <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"p-6 space-y-6\">\r\n                {/* Transaction Info */}\r\n                <div>\r\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-3\">\r\n                    Informasi Transaksi\r\n                  </h3>\r\n                  <div className=\"grid grid-cols-2 gap-4 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">No Transaksi</p>\r\n                      <p className=\"font-medium text-gray-900 dark:text-white\">{modal.selectedReturn.transaction.transactionNo}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">Tanggal Transaksi</p>\r\n                      <p className=\"font-medium text-gray-900 dark:text-white\">{formatDate(modal.selectedReturn.transaction.createdAt)}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">Kasir</p>\r\n                      <p className=\"font-medium text-gray-900 dark:text-white\">{modal.selectedReturn.processedBy.name}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">Cabang</p>\r\n                      <p className=\"font-medium text-gray-900 dark:text-white\">{modal.selectedReturn.cabang.name}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">Metode Pembayaran</p>\r\n                      <p className=\"font-medium text-gray-900 dark:text-white\">{modal.selectedReturn.transaction.paymentMethod}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">Tipe</p>\r\n                      <span className={`inline-block mt-1 px-2 py-1 rounded-full text-xs font-medium ${\r\n                        modal.selectedReturn.returnType === 'EXCHANGE' \r\n                          ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'\r\n                          : 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200'\r\n                      }`}>\r\n                        {modal.selectedReturn.returnType === 'EXCHANGE' ? 'Tukar Barang' : 'Refund'}\r\n                      </span>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">Status</p>\r\n                      <div className=\"mt-1\">{getStatusBadge(modal.selectedReturn.status)}</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Return Items */}\r\n                <div>\r\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-3\">\r\n                    Item yang Dikembalikan\r\n                  </h3>\r\n                  <div className=\"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\">\r\n                    <table className=\"w-full\">\r\n                      <thead className=\"bg-gray-50 dark:bg-gray-700\">\r\n                        <tr>\r\n                          <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300\">Produk</th>\r\n                          <th className=\"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300\">SKU</th>\r\n                          <th className=\"px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300\">Qty</th>\r\n                          <th className=\"px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300\">Harga</th>\r\n                          <th className=\"px-4 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-300\">Subtotal</th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\r\n                        {modal.selectedReturn.items.map((item) => (\r\n                          <tr key={item.id}>\r\n                            <td className=\"px-4 py-3 text-sm text-gray-900 dark:text-white\">\r\n                              {item.productName}\r\n                              <br />\r\n                              <span className=\"text-xs text-gray-500\">{item.variantInfo}</span>\r\n                            </td>\r\n                            <td className=\"px-4 py-3 text-sm text-gray-600 dark:text-gray-400\">{item.sku}</td>\r\n                            <td className=\"px-4 py-3 text-sm text-right text-gray-900 dark:text-white\">{item.quantity}</td>\r\n                            <td className=\"px-4 py-3 text-sm text-right text-gray-900 dark:text-white\">{formatCurrency(item.price)}</td>\r\n                            <td className=\"px-4 py-3 text-sm text-right font-medium text-gray-900 dark:text-white\">{formatCurrency(item.subtotal)}</td>\r\n                          </tr>\r\n                        ))}\r\n                      </tbody>\r\n                      <tfoot className=\"bg-gray-50 dark:bg-gray-700\">\r\n                        <tr>\r\n                          <td colSpan={4} className=\"px-4 py-3 text-right font-semibold text-gray-900 dark:text-white\">\r\n                            Subtotal Item Dikembalikan:\r\n                          </td>\r\n                          <td className=\"px-4 py-3 text-right font-bold text-lg text-gray-900 dark:text-white\">\r\n                            {formatCurrency(modal.selectedReturn.subtotal)}\r\n                          </td>\r\n                        </tr>\r\n                      </tfoot>\r\n                    </table>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Exchange Items (if EXCHANGE type) */}\r\n                {modal.selectedReturn.returnType === 'EXCHANGE' && modal.selectedReturn.exchangeItems && modal.selectedReturn.exchangeItems.length > 0 && (\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold text-blue-600 dark:text-blue-400 mb-3\">\r\n                      ≡ƒöä Item Pengganti (Tukar)\r\n                    </h3>\r\n                    <div className=\"border border-blue-200 dark:border-blue-700 rounded-lg overflow-hidden\">\r\n                      <table className=\"w-full\">\r\n                        <thead className=\"bg-blue-50 dark:bg-blue-900/30\">\r\n                          <tr>\r\n                            <th className=\"px-4 py-2 text-left text-xs font-medium text-blue-700 dark:text-blue-300\">Produk</th>\r\n                            <th className=\"px-4 py-2 text-left text-xs font-medium text-blue-700 dark:text-blue-300\">SKU</th>\r\n                            <th className=\"px-4 py-2 text-right text-xs font-medium text-blue-700 dark:text-blue-300\">Qty</th>\r\n                            <th className=\"px-4 py-2 text-right text-xs font-medium text-blue-700 dark:text-blue-300\">Harga</th>\r\n                            <th className=\"px-4 py-2 text-right text-xs font-medium text-blue-700 dark:text-blue-300\">Subtotal</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-blue-100 dark:divide-blue-800\">\r\n                          {modal.selectedReturn.exchangeItems.map((item: any) => (\r\n                            <tr key={item.id}>\r\n                              <td className=\"px-4 py-3 text-sm text-gray-900 dark:text-white\">\r\n                                {item.productName}\r\n                                <br />\r\n                                <span className=\"text-xs text-gray-500\">{item.variantInfo}</span>\r\n                              </td>\r\n                              <td className=\"px-4 py-3 text-sm text-gray-600 dark:text-gray-400\">{item.sku}</td>\r\n                              <td className=\"px-4 py-3 text-sm text-right text-gray-900 dark:text-white\">{item.quantity}</td>\r\n                              <td className=\"px-4 py-3 text-sm text-right text-gray-900 dark:text-white\">{formatCurrency(item.price)}</td>\r\n                              <td className=\"px-4 py-3 text-sm text-right font-medium text-gray-900 dark:text-white\">{formatCurrency(item.subtotal)}</td>\r\n                            </tr>\r\n                          ))}\r\n                        </tbody>\r\n                        <tfoot className=\"bg-blue-50 dark:bg-blue-900/30\">\r\n                          <tr>\r\n                            <td colSpan={4} className=\"px-4 py-3 text-right font-semibold text-blue-700 dark:text-blue-300\">\r\n                              Subtotal Item Pengganti:\r\n                            </td>\r\n                            <td className=\"px-4 py-3 text-right font-bold text-lg text-blue-600\">\r\n                              {formatCurrency(modal.selectedReturn.exchangeItems.reduce((sum: number, item: any) => sum + item.subtotal, 0))}\r\n                            </td>\r\n                          </tr>\r\n                        </tfoot>\r\n                      </table>\r\n                    </div>\r\n\r\n                    {/* Price Difference Summary */}\r\n                    <div className={`mt-4 p-4 rounded-lg ${\r\n                      (modal.selectedReturn.priceDifference || 0) > 0 \r\n                        ? 'bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700'\r\n                        : (modal.selectedReturn.priceDifference || 0) < 0 \r\n                          ? 'bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700'\r\n                          : 'bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600'\r\n                    }`}>\r\n                      <div className=\"flex justify-between items-center\">\r\n                        <span className=\"font-medium text-gray-900 dark:text-white\">Selisih Harga:</span>\r\n                        <span className={`text-xl font-bold ${\r\n                          (modal.selectedReturn.priceDifference || 0) > 0 \r\n                            ? 'text-green-600' \r\n                            : (modal.selectedReturn.priceDifference || 0) < 0 \r\n                              ? 'text-red-600' \r\n                              : 'text-gray-600'\r\n                        }`}>\r\n                          {(modal.selectedReturn.priceDifference || 0) > 0 ? '+' : ''}{formatCurrency(modal.selectedReturn.priceDifference || 0)}\r\n                        </span>\r\n                      </div>\r\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\r\n                        {(modal.selectedReturn.priceDifference || 0) > 0 \r\n                          ? 'Customer membayar selisih' \r\n                          : (modal.selectedReturn.priceDifference || 0) < 0 \r\n                            ? 'Customer menerima refund selisih' \r\n                            : 'Tidak ada selisih harga'}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Regular Refund Amount (for non-exchange) */}\r\n                {modal.selectedReturn.returnType !== 'EXCHANGE' && (\r\n                  <div className=\"bg-purple-50 dark:bg-purple-900/30 p-4 rounded-lg border border-purple-200 dark:border-purple-700\">\r\n                    <div className=\"flex justify-between items-center\">\r\n                      <span className=\"font-medium text-gray-900 dark:text-white\">Total Refund:</span>\r\n                      <span className=\"text-xl font-bold text-purple-600\">\r\n                        {formatCurrency(modal.selectedReturn.refundAmount)}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Return Reason & Notes */}\r\n                <div>\r\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-3\">\r\n                    Alasan\r\n                  </h3>\r\n                  <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\r\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\">Alasan:</p>\r\n                    <p className=\"font-medium text-gray-900 dark:text-white mb-3\">\r\n                      {formatReason(modal.selectedReturn.reason)}\r\n                      {(modal.selectedReturn.reason === 'DEFECTIVE' || modal.selectedReturn.reason === 'EXPIRED') && (\r\n                        <span className=\"ml-2 text-xs text-orange-600 dark:text-orange-400\">\r\n                          (Barang tidak masuk stok - write off)\r\n                        </span>\r\n                      )}\r\n                    </p>\r\n                    {modal.selectedReturn.notes && (\r\n                      <>\r\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\">Catatan:</p>\r\n                        <p className=\"text-gray-900 dark:text-white\">{modal.selectedReturn.notes}</p>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Actions */}\r\n                {modal.selectedReturn.status === 'PENDING' && (\r\n                  <div className=\"flex gap-3\">\r\n                    <button\r\n                      onClick={() => openModal('approve', modal.selectedReturn!)}\r\n                      className=\"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg\"\r\n                    >\r\n                      Setujui Return\r\n                    </button>\r\n                    <button\r\n                      onClick={() => openModal('reject', modal.selectedReturn!)}\r\n                      className=\"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg\"\r\n                    >\r\n                      Tolak Return\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Approve Modal */}\r\n        {modal.type === 'approve' && modal.selectedReturn && (\r\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full\">\r\n              <div className=\"p-6\">\r\n                <h3 className=\"text-lg font-bold text-gray-900 dark:text-white mb-4\">\r\n                  Konfirmasi Persetujuan {modal.selectedReturn.returnType === 'EXCHANGE' ? 'Tukar Barang' : 'Return'}\r\n                </h3>\r\n                <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\r\n                  Anda akan menyetujui <strong>{modal.selectedReturn.returnNo}</strong>.\r\n                  {modal.selectedReturn.returnType === 'EXCHANGE' ? (\r\n                    <>\r\n                      <br /><br />\r\n                      <span className=\"text-blue-600 dark:text-blue-400\">\r\n                        ΓÇó Stok barang lama akan dikembalikan<br />\r\n                        ΓÇó Stok barang pengganti akan dikurangi\r\n                      </span>\r\n                      {(modal.selectedReturn.priceDifference || 0) !== 0 && (\r\n                        <>\r\n                          <br /><br />\r\n                          <span className={(modal.selectedReturn.priceDifference ?? 0) > 0 ? 'text-green-600' : 'text-red-600'}>\r\n                            Selisih harga: <strong>{(modal.selectedReturn.priceDifference ?? 0) > 0 ? '+' : ''}{formatCurrency(modal.selectedReturn.priceDifference ?? 0)}</strong>\r\n                          </span>\r\n                        </>\r\n                      )}\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      {' '}dengan total refund <strong>{formatCurrency(modal.selectedReturn.refundAmount)}</strong>. \r\n                      Stok akan dikembalikan ke cabang {modal.selectedReturn.cabang.name}.\r\n                    </>\r\n                  )}\r\n                </p>\r\n                <div className=\"mb-4\">\r\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                    Catatan (Opsional)\r\n                  </label>\r\n                  <textarea\r\n                    value={modal.notes}\r\n                    onChange={(e) => setModalNotes(e.target.value)}\r\n                    placeholder=\"Tambahkan catatan...\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                    rows={3}\r\n                  />\r\n                </div>\r\n                <div className=\"flex gap-3\">\r\n                  <button\r\n                    onClick={closeModal}\r\n                    className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\r\n                    disabled={processing}\r\n                  >\r\n                    Batal\r\n                  </button>\r\n                  <button\r\n                    onClick={onApprove}\r\n                    className=\"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg disabled:opacity-50\"\r\n                    disabled={processing}\r\n                  >\r\n                    {processing ? 'Memproses...' : 'Ya, Setujui'}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Reject Modal */}\r\n        {modal.type === 'reject' && modal.selectedReturn && (\r\n          <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full\">\r\n              <div className=\"p-6\">\r\n                <h3 className=\"text-lg font-bold text-gray-900 dark:text-white mb-4\">\r\n                  Konfirmasi Penolakan Return\r\n                </h3>\r\n                <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\r\n                  Anda akan menolak return <strong>{modal.selectedReturn.returnNo}</strong>. Mohon berikan alasan penolakan.\r\n                </p>\r\n                <div className=\"mb-4\">\r\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                    Alasan Penolakan <span className=\"text-red-500\">*</span>\r\n                  </label>\r\n                  <textarea\r\n                    value={modal.notes}\r\n                    onChange={(e) => setModalNotes(e.target.value)}\r\n                    placeholder=\"Berikan alasan penolakan...\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                    rows={3}\r\n                    required\r\n                  />\r\n                </div>\r\n                <div className=\"flex gap-3\">\r\n                  <button\r\n                    onClick={closeModal}\r\n                    className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700\"\r\n                    disabled={processing}\r\n                  >\r\n                    Batal\r\n                  </button>\r\n                  <button\r\n                    onClick={onReject}\r\n                    className=\"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg disabled:opacity-50\"\r\n                    disabled={processing || !modal.notes.trim()}\r\n                  >\r\n                    {processing ? 'Memproses...' : 'Ya, Tolak'}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </ProtectedRoute>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\backup\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\backup\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\backup\\useBackupStore.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3888,3891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3888,3891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { useBackupStore } from './useBackupStore';\r\n\r\n// Mock API\r\nvi.mock('@/lib/api', () => ({\r\n  backupAPI: {\r\n    getAutoBackupStatus: vi.fn().mockResolvedValue({ data: { enabled: true } }),\r\n    getLastBackup: vi.fn().mockResolvedValue({ \r\n      data: { \r\n        lastBackup: { \r\n          timestamp: '2024-01-01T00:00:00Z', \r\n          size: 1024,\r\n          filename: 'backup_20240101.zip' \r\n        } \r\n      } \r\n    }),\r\n    createBackup: vi.fn().mockResolvedValue({ data: { filename: 'backup_new.zip' } }),\r\n    toggleAutoBackup: vi.fn().mockResolvedValue({}),\r\n    resetSettings: vi.fn().mockResolvedValue({}),\r\n  },\r\n}));\r\n\r\n// Mock window.confirm\r\nglobal.confirm = vi.fn();\r\n\r\ndescribe('useBackupStore', () => {\r\n  beforeEach(() => {\r\n    useBackupStore.setState({\r\n      autoBackupEnabled: false,\r\n      lastBackup: null,\r\n      loading: false,\r\n      message: '',\r\n    });\r\n    vi.mocked(confirm).mockReset();\r\n  });\r\n\r\n  it('should initialize with default state', () => {\r\n    const state = useBackupStore.getState();\r\n    expect(state.autoBackupEnabled).toBe(false);\r\n    expect(state.lastBackup).toBeNull();\r\n    expect(state.loading).toBe(false);\r\n    expect(state.message).toBe('');\r\n  });\r\n\r\n  it('should clear message', () => {\r\n    useBackupStore.setState({ message: 'Test message' });\r\n    useBackupStore.getState().clearMessage();\r\n    expect(useBackupStore.getState().message).toBe('');\r\n  });\r\n\r\n  it('should load backup status', async () => {\r\n    await useBackupStore.getState().loadBackupStatus();\r\n    expect(useBackupStore.getState().autoBackupEnabled).toBe(true);\r\n  });\r\n\r\n  it('should load last backup', async () => {\r\n    await useBackupStore.getState().loadLastBackup();\r\n    const state = useBackupStore.getState();\r\n    expect(state.lastBackup).not.toBeNull();\r\n    expect(state.lastBackup?.filename).toBe('backup_20240101.zip');\r\n    expect(state.lastBackup?.size).toBe(1024);\r\n  });\r\n\r\n  it('should handle manual backup', async () => {\r\n    await useBackupStore.getState().handleManualBackup();\r\n    const state = useBackupStore.getState();\r\n    expect(state.message).toContain('[OK] Backup berhasil');\r\n    expect(state.loading).toBe(false);\r\n  });\r\n\r\n  it('should toggle auto backup on', async () => {\r\n    useBackupStore.setState({ autoBackupEnabled: false });\r\n    await useBackupStore.getState().handleToggleAutoBackup();\r\n    const state = useBackupStore.getState();\r\n    expect(state.autoBackupEnabled).toBe(true);\r\n    expect(state.message).toContain('diaktifkan');\r\n  });\r\n\r\n  it('should toggle auto backup off', async () => {\r\n    useBackupStore.setState({ autoBackupEnabled: true });\r\n    await useBackupStore.getState().handleToggleAutoBackup();\r\n    const state = useBackupStore.getState();\r\n    expect(state.autoBackupEnabled).toBe(false);\r\n    expect(state.message).toContain('dinonaktifkan');\r\n  });\r\n\r\n  it('should handle reset settings when confirmed', async () => {\r\n    vi.mocked(confirm).mockReturnValue(true);\r\n    await useBackupStore.getState().handleResetSettings();\r\n    const state = useBackupStore.getState();\r\n    expect(state.message).toContain('[OK] Settings berhasil direset');\r\n    expect(state.loading).toBe(false);\r\n  });\r\n\r\n  it('should not reset settings when cancelled', async () => {\r\n    vi.mocked(confirm).mockReturnValue(false);\r\n    await useBackupStore.getState().handleResetSettings();\r\n    const state = useBackupStore.getState();\r\n    expect(state.message).toBe('');\r\n  });\r\n\r\n  it('should set loading true during manual backup', async () => {\r\n    // Use a delayed promise to check loading state\r\n    const { backupAPI } = await import('@/lib/api');\r\n    vi.mocked(backupAPI.createBackup).mockImplementation(async () => {\r\n      expect(useBackupStore.getState().loading).toBe(true);\r\n      return { data: { filename: 'test.zip' } } as any;\r\n    });\r\n    \r\n    await useBackupStore.getState().handleManualBackup();\r\n    expect(useBackupStore.getState().loading).toBe(false);\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\backup\\useBackupStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1887,1890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1887,1890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":84,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2399,2402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2399,2402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2845,2848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2845,2848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3234,3237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3234,3237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3626,3629],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3626,3629],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":134,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4015,4018],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4015,4018],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { create } from 'zustand';\r\nimport { backupAPI } from '@/lib/api';\r\n\r\n// ============ Types ============\r\ninterface LastBackup {\r\n  timestamp: string;\r\n  size: number;\r\n  filename?: string;\r\n}\r\n\r\n// ============ State Interface ============\r\ninterface BackupState {\r\n  // Data\r\n  autoBackupEnabled: boolean;\r\n  lastBackup: LastBackup | null;\r\n  loading: boolean;\r\n  message: string;\r\n  \r\n  // Actions\r\n  loadBackupStatus: () => Promise<void>;\r\n  loadLastBackup: () => Promise<void>;\r\n  handleManualBackup: () => Promise<void>;\r\n  handleToggleAutoBackup: () => Promise<void>;\r\n  handleResetSettings: () => Promise<void>;\r\n  handleExportTransactions: () => Promise<void>;\r\n  handleExportProducts: () => Promise<void>;\r\n  handleExportReport: () => Promise<void>;\r\n  clearMessage: () => void;\r\n}\r\n\r\n// ============ Store ============\r\nexport const useBackupStore = create<BackupState>((set, get) => ({\r\n  // Data\r\n  autoBackupEnabled: false,\r\n  lastBackup: null,\r\n  loading: false,\r\n  message: '',\r\n  \r\n  // Actions\r\n  clearMessage: () => set({ message: '' }),\r\n  \r\n  loadBackupStatus: async () => {\r\n    try {\r\n      const response = await backupAPI.getAutoBackupStatus();\r\n      set({ autoBackupEnabled: response.data.enabled });\r\n    } catch (error) {\r\n      console.error('Error loading backup status:', error);\r\n    }\r\n  },\r\n  \r\n  loadLastBackup: async () => {\r\n    try {\r\n      const response = await backupAPI.getLastBackup();\r\n      set({ lastBackup: response.data.lastBackup });\r\n    } catch (error) {\r\n      console.error('Error loading last backup:', error);\r\n    }\r\n  },\r\n  \r\n  handleManualBackup: async () => {\r\n    set({ loading: true, message: '' });\r\n    try {\r\n      const response = await backupAPI.createBackup();\r\n      set({ message: `[OK] Backup berhasil: ${response.data.filename}` });\r\n      await get().loadLastBackup();\r\n    } catch (error: any) {\r\n      set({ message: `[ERROR] ${error.response?.data?.error || error.message}` });\r\n    } finally {\r\n      set({ loading: false });\r\n    }\r\n  },\r\n  \r\n  handleToggleAutoBackup: async () => {\r\n    const { autoBackupEnabled } = get();\r\n    try {\r\n      const newValue = !autoBackupEnabled;\r\n      await backupAPI.toggleAutoBackup(newValue);\r\n      set({ \r\n        autoBackupEnabled: newValue,\r\n        message: `[OK] Auto backup ${newValue ? 'diaktifkan' : 'dinonaktifkan'}`\r\n      });\r\n    } catch (error: any) {\r\n      set({ message: `[ERROR] ${error.response?.data?.error || error.message}` });\r\n    }\r\n  },\r\n  \r\n  handleResetSettings: async () => {\r\n    if (!confirm('Yakin ingin reset semua settings ke default? Aksi ini tidak bisa dibatalkan!')) {\r\n      return;\r\n    }\r\n    \r\n    set({ loading: true });\r\n    try {\r\n      await backupAPI.resetSettings();\r\n      set({ message: '[OK] Settings berhasil direset ke default' });\r\n    } catch (error: any) {\r\n      set({ message: `[ERROR] ${error.response?.data?.error || error.message}` });\r\n    } finally {\r\n      set({ loading: false });\r\n    }\r\n  },\r\n  \r\n  handleExportTransactions: async () => {\r\n    set({ loading: true, message: '' });\r\n    try {\r\n      await backupAPI.exportTransactions();\r\n      set({ message: '[OK] Export transaksi berhasil didownload' });\r\n    } catch (error: any) {\r\n      set({ message: `[ERROR] Export gagal: ${error.response?.data?.error || error.message}` });\r\n    } finally {\r\n      set({ loading: false });\r\n    }\r\n  },\r\n  \r\n  handleExportProducts: async () => {\r\n    set({ loading: true, message: '' });\r\n    try {\r\n      await backupAPI.exportProducts();\r\n      set({ message: '[OK] Export produk berhasil didownload' });\r\n    } catch (error: any) {\r\n      set({ message: `[ERROR] Export gagal: ${error.response?.data?.error || error.message}` });\r\n    } finally {\r\n      set({ loading: false });\r\n    }\r\n  },\r\n  \r\n  handleExportReport: async () => {\r\n    set({ loading: true, message: '' });\r\n    try {\r\n      await backupAPI.exportReport();\r\n      set({ message: '[OK] Export laporan berhasil didownload' });\r\n    } catch (error: any) {\r\n      set({ message: `[ERROR] Export gagal: ${error.response?.data?.error || error.message}` });\r\n    } finally {\r\n      set({ loading: false });\r\n    }\r\n  },\r\n}));\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\general\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\general\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadAllSettings'. Either include it or remove the dependency array.","line":56,"column":6,"nodeType":"ArrayExpression","endLine":56,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadAllSettings]","fix":{"range":[1935,1937],"text":"[loadAllSettings]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useMemo } from 'react';\r\nimport { api } from '@/lib/api';\r\nimport { getAuth } from '@/lib/auth';\r\nimport ProtectedRoute from '@/components/ProtectedRoute';\r\nimport { useTheme } from '@/contexts/ThemeContext';\r\n\r\ninterface AppSettings {\r\n  returnEnabled: boolean;\r\n  returnDeadlineDays: number;\r\n  returnRequiresApproval: boolean;\r\n  exchangeEnabled: boolean;\r\n}\r\n\r\ntype ThemeMode = 'light' | 'dark' | 'system';\r\n\r\nexport default function GeneralSettingsPage() {\r\n  const auth = getAuth();\r\n  const isOwner = auth?.user?.role === 'OWNER';\r\n  const { themeMode, setThemeMode } = useTheme();\r\n  \r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  \r\n  // Original values untuk tracking perubahan\r\n  const [originalTheme, setOriginalTheme] = useState<ThemeMode>('system');\r\n  const [originalAppSettings, setOriginalAppSettings] = useState<AppSettings>({\r\n    returnEnabled: false,\r\n    returnDeadlineDays: 7,\r\n    returnRequiresApproval: true,\r\n    exchangeEnabled: false,\r\n  });\r\n  \r\n  const [appSettings, setAppSettings] = useState<AppSettings>({\r\n    returnEnabled: false,\r\n    returnDeadlineDays: 7,\r\n    returnRequiresApproval: true,\r\n    exchangeEnabled: false,\r\n  });\r\n\r\n  // Check if ada perubahan\r\n  const hasChanges = useMemo(() => {\r\n    const generalChanged = themeMode !== originalTheme;\r\n    const appChanged = isOwner && (\r\n      appSettings.returnEnabled !== originalAppSettings.returnEnabled ||\r\n      appSettings.returnDeadlineDays !== originalAppSettings.returnDeadlineDays ||\r\n      appSettings.returnRequiresApproval !== originalAppSettings.returnRequiresApproval ||\r\n      appSettings.exchangeEnabled !== originalAppSettings.exchangeEnabled\r\n    );\r\n    return generalChanged || appChanged;\r\n  }, [themeMode, originalTheme, appSettings, originalAppSettings, isOwner]);\r\n\r\n  useEffect(() => {\r\n    loadAllSettings();\r\n  }, []);\r\n\r\n  const loadAllSettings = async () => {\r\n    try {\r\n      const savedTheme = localStorage.getItem('theme') as ThemeMode;\r\n      \r\n      if (savedTheme) {\r\n        setOriginalTheme(savedTheme);\r\n      }\r\n\r\n      // Load app settings from backend (owner only)\r\n      if (isOwner) {\r\n        const response = await api.get('/settings/app');\r\n        setAppSettings(response.data);\r\n        setOriginalAppSettings(response.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading settings:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle theme change - langsung apply\r\n  const handleThemeChange = (newTheme: ThemeMode) => {\r\n    setThemeMode(newTheme);\r\n  };\r\n\r\n  // Save ALL settings\r\n  const handleSaveAll = async () => {\r\n    setSaving(true);\r\n    try {\r\n      // Save to backend (optional sync)\r\n      try {\r\n        await api.put('/settings', { theme: themeMode });\r\n      } catch {\r\n        // Backend sync failed, continue with local save\r\n      }\r\n\r\n      // Save app settings (owner only)\r\n      if (isOwner) {\r\n        await api.put('/settings/app', appSettings);\r\n        setOriginalAppSettings({ ...appSettings });\r\n      }\r\n\r\n      setOriginalTheme(themeMode);\r\n      alert('Semua pengaturan berhasil disimpan!');\r\n    } catch (error) {\r\n      console.error('Error saving settings:', error);\r\n      alert('Gagal menyimpan pengaturan');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={['OWNER', 'MANAGER', 'ADMIN']}>\r\n      <div className=\"px-4 md:px-6 space-y-6\">\r\n        {/* Breadcrumb */}\r\n        <nav className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n          <a href=\"/dashboard\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Dashboard</a>\r\n          <span>ΓÇ║</span>\r\n          <a href=\"/dashboard/settings\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Settings</a>\r\n          <span>ΓÇ║</span>\r\n          <span className=\"text-gray-900 dark:text-white font-medium\">General</span>\r\n        </nav>\r\n\r\n        <div className=\"space-y-6\">\r\n          {/* General Settings Card */}\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700\">\r\n            <div className=\"p-4 md:p-6 lg:p-8 space-y-6 md:space-y-8\">\r\n              <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\" />\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                </svg>\r\n                Pengaturan Umum\r\n              </h2>\r\n              \r\n              {/* Theme Settings */}\r\n              <div>\r\n                <label className=\"flex items-center space-x-2 text-sm font-semibold text-gray-900 dark:text-white mb-3\">\r\n                  <svg className=\"w-5 h-5 text-gray-700 dark:text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z\" />\r\n                  </svg>\r\n                  <span>Theme Mode</span>\r\n                </label>\r\n                <select \r\n                  value={themeMode}\r\n                  onChange={(e) => handleThemeChange(e.target.value as ThemeMode)}\r\n                  className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-shadow\"\r\n                >\r\n                  <option value=\"light\">Terang</option>\r\n                  <option value=\"dark\">Gelap</option>\r\n                  <option value=\"system\">Otomatis (Ikuti Sistem)</option>\r\n                </select>\r\n              </div>\r\n\r\n              {/* Currency Format */}\r\n              <div>\r\n                <label className=\"flex items-center space-x-2 text-sm font-semibold text-gray-900 dark:text-white mb-3\">\r\n                  <svg className=\"w-5 h-5 text-gray-700 dark:text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                  </svg>\r\n                  <span>Format Mata Uang</span>\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value=\"IDR (Rupiah)\"\r\n                  disabled\r\n                  className=\"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400\"\r\n                />\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n                  Format mata uang: Indonesian Rupiah (Rp)\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Return & Exchange Settings Card - Owner Only */}\r\n          {isOwner && (\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700\">\r\n              <div className=\"p-4 md:p-6 lg:p-8 space-y-6\">\r\n                <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\r\n                  <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 15v-1a4 4 0 00-4-4H8m0 0l3 3m-3-3l3-3m9 14V5a2 2 0 00-2-2H6a2 2 0 00-2 2v16l4-2 4 2 4-2 4 2z\" />\r\n                  </svg>\r\n                  Pengaturan Retur & Tukar\r\n                </h2>\r\n                \r\n                {loading ? (\r\n                  <div className=\"flex items-center justify-center py-8\">\r\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600\"></div>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-6\">\r\n                    {/* Return Enabled Toggle */}\r\n                    <div className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl\">\r\n                      <div>\r\n                        <h3 className=\"font-medium text-gray-900 dark:text-white\">Fitur Retur</h3>\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                          Aktifkan fitur retur untuk mengembalikan barang dan uang\r\n                        </p>\r\n                      </div>\r\n                      <button\r\n                        onClick={() => setAppSettings(prev => ({ ...prev, returnEnabled: !prev.returnEnabled }))}\r\n                        className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\r\n                          appSettings.returnEnabled ? 'bg-purple-600' : 'bg-gray-300 dark:bg-gray-600'\r\n                        }`}\r\n                      >\r\n                        <span\r\n                          className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\r\n                            appSettings.returnEnabled ? 'translate-x-6' : 'translate-x-1'\r\n                          }`}\r\n                        />\r\n                      </button>\r\n                    </div>\r\n\r\n                    {/* Settings shown when return is enabled */}\r\n                    {appSettings.returnEnabled && (\r\n                      <div className=\"space-y-4 pl-4 border-l-2 border-purple-200 dark:border-purple-800\">\r\n                        {/* Return Deadline */}\r\n                        <div className=\"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl\">\r\n                          <label className=\"block font-medium text-gray-900 dark:text-white mb-2\">\r\n                            Batas Waktu Retur\r\n                          </label>\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <input\r\n                              type=\"number\"\r\n                              min=\"1\"\r\n                              max=\"365\"\r\n                              value={appSettings.returnDeadlineDays}\r\n                              onChange={(e) => setAppSettings(prev => ({ \r\n                                ...prev, \r\n                                returnDeadlineDays: parseInt(e.target.value) || 7 \r\n                              }))}\r\n                              className=\"w-24 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                            />\r\n                            <span className=\"text-gray-600 dark:text-gray-400\">hari setelah pembelian</span>\r\n                          </div>\r\n                          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n                            Customer hanya bisa retur dalam jangka waktu ini\r\n                          </p>\r\n                        </div>\r\n\r\n                        {/* Approval Required */}\r\n                        <div className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl\">\r\n                          <div>\r\n                            <h3 className=\"font-medium text-gray-900 dark:text-white\">Perlu Approval Manager</h3>\r\n                            <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                              Retur harus disetujui manager sebelum diproses\r\n                            </p>\r\n                          </div>\r\n                          <button\r\n                            onClick={() => setAppSettings(prev => ({ ...prev, returnRequiresApproval: !prev.returnRequiresApproval }))}\r\n                            className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\r\n                              appSettings.returnRequiresApproval ? 'bg-purple-600' : 'bg-gray-300 dark:bg-gray-600'\r\n                            }`}\r\n                          >\r\n                            <span\r\n                              className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\r\n                                appSettings.returnRequiresApproval ? 'translate-x-6' : 'translate-x-1'\r\n                              }`}\r\n                            />\r\n                          </button>\r\n                        </div>\r\n\r\n                        {/* Exchange Enabled Toggle */}\r\n                        <div className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl\">\r\n                          <div>\r\n                            <h3 className=\"font-medium text-gray-900 dark:text-white\">Fitur Tukar Barang</h3>\r\n                            <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                              Aktifkan fitur tukar ukuran/barang (tanpa refund uang)\r\n                            </p>\r\n                          </div>\r\n                          <button\r\n                            onClick={() => setAppSettings(prev => ({ ...prev, exchangeEnabled: !prev.exchangeEnabled }))}\r\n                            className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\r\n                              appSettings.exchangeEnabled ? 'bg-purple-600' : 'bg-gray-300 dark:bg-gray-600'\r\n                            }`}\r\n                          >\r\n                            <span\r\n                              className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\r\n                                appSettings.exchangeEnabled ? 'translate-x-6' : 'translate-x-1'\r\n                              }`}\r\n                            />\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Info Box */}\r\n          <div className=\"bg-gradient-to-r from-slate-50 to-gray-50 dark:from-slate-900/20 dark:to-gray-900/20 border-2 border-slate-200 dark:border-slate-800 rounded-xl p-5\">\r\n            <div className=\"flex items-start\">\r\n              <div className=\"flex-shrink-0\">\r\n                <svg className=\"w-6 h-6 text-slate-600 dark:text-slate-400\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                  <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\r\n                </svg>\r\n              </div>\r\n              <div className=\"ml-4 flex-1\">\r\n                <h3 className=\"text-sm font-semibold text-slate-900 dark:text-slate-300 mb-1\">\r\n                  Pengaturan Global Aplikasi\r\n                </h3>\r\n                <p className=\"text-sm text-slate-800 dark:text-slate-400 leading-relaxed\">\r\n                  Perubahan pada pengaturan general akan mempengaruhi tampilan dan perilaku seluruh aplikasi, \r\n                  termasuk web dashboard dan desktop POS.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Save Button */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            {hasChanges && (\r\n              <p className=\"text-sm text-amber-600 dark:text-amber-400 flex items-center gap-2\">\r\n                <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n                  <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\r\n                </svg>\r\n                Ada perubahan yang belum disimpan\r\n              </p>\r\n            )}\r\n            {!hasChanges && <div />}\r\n            <button\r\n              onClick={handleSaveAll}\r\n              disabled={saving || !hasChanges}\r\n              className=\"px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\"\r\n            >\r\n              <span className=\"flex items-center space-x-2\">\r\n                {saving ? (\r\n                  <>\r\n                    <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"></div>\r\n                    <span>Menyimpan...</span>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n                    </svg>\r\n                    <span>Simpan Pengaturan</span>\r\n                  </>\r\n                )}\r\n              </span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ProtectedRoute>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\printer\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\printer\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\printer\\usePrinterSettingsStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\printer\\usePrinterSettingsStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[812,815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[812,815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { create } from 'zustand';\r\nimport { cabangAPI } from '@/lib/api';\r\n\r\n// ============ Types ============\r\nexport interface PrinterSettings {\r\n  autoPrintEnabled: boolean;\r\n  printerName: string;\r\n  paperWidth: number;\r\n  storeName: string;\r\n  branchName: string;\r\n  address: string;\r\n  phone: string;\r\n  footerText1: string;\r\n  footerText2: string;\r\n}\r\n\r\nconst DEFAULT_SETTINGS: PrinterSettings = {\r\n  autoPrintEnabled: true,\r\n  printerName: '',\r\n  paperWidth: 58,\r\n  storeName: '', // Will be populated from tenant.name via API\r\n  branchName: '',\r\n  address: '',\r\n  phone: '',\r\n  footerText1: 'Terima kasih atas kunjungan Anda',\r\n  footerText2: '',\r\n};\r\n\r\n// ============ State Interface ============\r\ninterface PrinterSettingsState {\r\n  // Data\r\n  selectedCabangId: string;\r\n  cabangs: any[];\r\n  settings: PrinterSettings;\r\n  loading: boolean;\r\n  loadingData: boolean;\r\n  message: string;\r\n  \r\n  // Actions\r\n  setSelectedCabangId: (id: string) => void;\r\n  updateSettings: (updates: Partial<PrinterSettings>) => void;\r\n  toggleAutoPrint: () => void;\r\n  loadCabangs: () => Promise<void>;\r\n  loadSettings: () => Promise<void>;\r\n  handleSave: () => Promise<void>;\r\n  clearMessage: () => void;\r\n}\r\n\r\n// ============ Store ============\r\nexport const usePrinterSettingsStore = create<PrinterSettingsState>((set, get) => ({\r\n  // Data\r\n  selectedCabangId: '',\r\n  cabangs: [],\r\n  settings: { ...DEFAULT_SETTINGS },\r\n  loading: false,\r\n  loadingData: true,\r\n  message: '',\r\n  \r\n  // Actions\r\n  setSelectedCabangId: (id) => set({ selectedCabangId: id }),\r\n  \r\n  updateSettings: (updates) => set((state) => ({\r\n    settings: { ...state.settings, ...updates }\r\n  })),\r\n  \r\n  toggleAutoPrint: () => set((state) => ({\r\n    settings: { ...state.settings, autoPrintEnabled: !state.settings.autoPrintEnabled }\r\n  })),\r\n  \r\n  clearMessage: () => set({ message: '' }),\r\n  \r\n  loadCabangs: async () => {\r\n    try {\r\n      const response = await cabangAPI.getCabangs();\r\n      const cabangList = response.data || [];\r\n      set({ cabangs: cabangList });\r\n      if (cabangList.length > 0) {\r\n        set({ selectedCabangId: cabangList[0].id });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load cabangs:', error);\r\n    }\r\n  },\r\n  \r\n  loadSettings: async () => {\r\n    const { selectedCabangId, cabangs } = get();\r\n    if (!selectedCabangId) return;\r\n    \r\n    set({ loadingData: true });\r\n    const API_URL = process.env.NEXT_PUBLIC_API_URL || 'https://api-pelaris.ziqrishahab.com/api';\r\n    \r\n    try {\r\n      const token = sessionStorage.getItem('token');\r\n      if (!token) {\r\n        set({ loadingData: false });\r\n        return;\r\n      }\r\n\r\n      const response = await fetch(`${API_URL}/settings/printer?cabangId=${selectedCabangId}`, {\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        \r\n        // Auto-fill branchName from selected cabang if empty\r\n        const selectedCabang = cabangs.find(c => c.id === selectedCabangId);\r\n        const defaultBranchName = data.branchName || (selectedCabang ? `Cabang ${selectedCabang.name}` : '');\r\n        \r\n        set({\r\n          settings: {\r\n            autoPrintEnabled: data.autoPrintEnabled ?? true,\r\n            printerName: data.printerName || '',\r\n            paperWidth: 58,\r\n            storeName: data.storeName || '', // From tenant.name via API\r\n            branchName: defaultBranchName,\r\n            address: data.address || '',\r\n            phone: data.phone || '',\r\n            footerText1: data.footerText1 || 'Terima kasih atas kunjungan Anda',\r\n            footerText2: data.footerText2 || '',\r\n          }\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load printer settings:', error);\r\n    } finally {\r\n      set({ loadingData: false });\r\n    }\r\n  },\r\n  \r\n  handleSave: async () => {\r\n    const { selectedCabangId, settings } = get();\r\n    \r\n    if (!selectedCabangId) {\r\n      set({ message: 'Pilih cabang terlebih dahulu' });\r\n      setTimeout(() => set({ message: '' }), 3000);\r\n      return;\r\n    }\r\n\r\n    set({ loading: true, message: '' });\r\n    const API_URL = process.env.NEXT_PUBLIC_API_URL || 'https://api-pelaris.ziqrishahab.com/api';\r\n    \r\n    try {\r\n      const response = await fetch(`${API_URL}/settings/printer`, {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${sessionStorage.getItem('token')}`,\r\n        },\r\n        body: JSON.stringify({\r\n          cabangId: selectedCabangId,\r\n          ...settings,\r\n        }),\r\n      });\r\n\r\n      if (response.ok) {\r\n        set({ message: 'Pengaturan printer berhasil disimpan' });\r\n      } else {\r\n        const error = await response.json();\r\n        set({ message: error.error || 'Gagal menyimpan pengaturan' });\r\n      }\r\n      setTimeout(() => set({ message: '' }), 3000);\r\n    } catch (error) {\r\n      console.error('Save error:', error);\r\n      set({ message: 'Gagal menyimpan pengaturan' });\r\n      setTimeout(() => set({ message: '' }), 3000);\r\n    } finally {\r\n      set({ loading: false });\r\n    }\r\n  }\r\n}));\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\users\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\settings\\users\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[884,887],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[884,887],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1624,1627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1624,1627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1875,1878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1875,1878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1982,1985],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1982,1985],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":371,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16695,16698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16695,16698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect } from 'react';\r\nimport { Plus } from 'lucide-react';\r\nimport { useUserStore } from '@/stores/useUserStore';\r\nimport { useCabangStore } from '@/stores/useCabangStore';\r\n\r\nexport default function UsersPage() {\r\n  const {\r\n    users,\r\n    loading,\r\n    formData,\r\n    editingUserId,\r\n    showModal,\r\n    fetchUsers,\r\n    setFormData,\r\n    setEditingUser,\r\n    resetForm,\r\n    createUser,\r\n    updateUser,\r\n    deleteUser,\r\n    setShowModal,\r\n  } = useUserStore();\r\n\r\n  const { cabangs, fetchCabangs } = useCabangStore();\r\n\r\n  useEffect(() => {\r\n    fetchUsers();\r\n    fetchCabangs();\r\n  }, [fetchUsers, fetchCabangs]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    let success = false;\r\n    \r\n    if (editingUserId) {\r\n      // Update existing user - only include password if filled\r\n      const updateData: any = {\r\n        name: formData.name,\r\n        role: formData.role,\r\n        cabangId: formData.cabangId || null,\r\n        hasMultiCabangAccess: formData.role !== 'KASIR' ? formData.hasMultiCabangAccess : false,\r\n      };\r\n      \r\n      if (formData.password && formData.password.trim() !== '') {\r\n        updateData.password = formData.password;\r\n      }\r\n\r\n      success = await updateUser(editingUserId, updateData);\r\n      if (success) alert('User berhasil diupdate!');\r\n    } else {\r\n      const createData = {\r\n        ...formData,\r\n        cabangId: formData.cabangId || null,\r\n        hasMultiCabangAccess: formData.role !== 'KASIR' ? formData.hasMultiCabangAccess : false,\r\n      };\r\n      success = await createUser(createData as any);\r\n      if (success) alert('User berhasil ditambahkan!');\r\n    }\r\n    \r\n    if (success) {\r\n      setShowModal(false);\r\n    } else {\r\n      alert(`Gagal ${editingUserId ? 'update' : 'menambah'} user`);\r\n    }\r\n  };\r\n\r\n  const handleEdit = (user: any) => {\r\n    setEditingUser(user);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleDelete = async (user: any) => {\r\n    if (!confirm(`Yakin ingin menghapus user ${user.name}?`)) return;\r\n    \r\n    const success = await deleteUser(user.id);\r\n    if (success) {\r\n      alert('User berhasil dihapus!');\r\n    } else {\r\n      alert('Gagal menghapus user');\r\n    }\r\n  };\r\n\r\n  const handleCloseModal = () => {\r\n    setShowModal(false);\r\n    resetForm();\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"px-4 md:px-6 space-y-6\">\r\n      {/* Breadcrumb + Action */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\r\n        <nav className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n          <a href=\"/dashboard\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Dashboard</a>\r\n          <span>ΓÇ║</span>\r\n          <a href=\"/dashboard/settings\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Settings</a>\r\n          <span>ΓÇ║</span>\r\n          <span className=\"text-gray-900 dark:text-white font-medium\">Users</span>\r\n        </nav>\r\n        \r\n        <button\r\n          onClick={() => setShowModal(true)}\r\n          className=\"flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-slate-600 to-slate-700 text-white rounded-lg hover:from-slate-700 hover:to-slate-800 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all\"\r\n        >\r\n          <Plus className=\"w-4 h-4\" />\r\n          Tambah User\r\n        </button>\r\n      </div>\r\n\r\n      {/* Users Table/Cards */}\r\n      <div className=\"hidden md:block bg-white dark:bg-gray-800 rounded-xl md:rounded-2xl shadow-lg border border-gray-100 dark:border-gray-700 overflow-hidden\">\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\r\n            <thead className=\"bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-800\">\r\n              <tr>\r\n                <th className=\"px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider\">\r\n                  Nama\r\n                </th>\r\n                <th className=\"px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider\">\r\n                  Email\r\n                </th>\r\n                <th className=\"px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider\">\r\n                  Role\r\n                </th>\r\n                <th className=\"px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider\">\r\n                  Cabang\r\n                </th>\r\n                <th className=\"px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider\">\r\n                  Status\r\n                </th>\r\n                <th className=\"px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider\">\r\n                  Dibuat\r\n                </th>\r\n                <th className=\"px-6 py-4 text-left text-xs font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider\">\r\n                  Aksi\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\r\n              {users.map((user) => (\r\n                <tr key={user.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700\">\r\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                    <div className=\"text-sm font-medium text-gray-900 dark:text-white\">{user.name}</div>\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">{user.email}</div>\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                    <span\r\n                      className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n                        user.role === 'OWNER'\r\n                          ? 'bg-slate-100 text-slate-800 dark:bg-slate-900 dark:text-slate-300'\r\n                          : user.role === 'ADMIN'\r\n                          ? 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300'\r\n                          : user.role === 'MANAGER'\r\n                          ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300'\r\n                          : 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300'\r\n                      }`}\r\n                    >\r\n                      {user.role}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\r\n                    {user.hasMultiCabangAccess ? (\r\n                      <span className=\"px-2 py-1 text-xs font-semibold rounded-full bg-slate-100 text-slate-800 dark:bg-slate-900 dark:text-slate-300\">\r\n                        Semua Cabang\r\n                      </span>\r\n                    ) : user.cabang?.name ? (\r\n                      <span className=\"px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300\">\r\n                        {user.cabang.name}\r\n                      </span>\r\n                    ) : (\r\n                      <span className=\"text-gray-400 dark:text-gray-500\">-</span>\r\n                    )}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                    <span\r\n                      className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n                        user.isActive\r\n                          ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300'\r\n                          : 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300'\r\n                      }`}\r\n                    >\r\n                      {user.isActive ? 'Aktif' : 'Nonaktif'}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400\">\r\n                    {new Date(user.createdAt).toLocaleDateString('id-ID')}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <button\r\n                        onClick={() => handleEdit(user)}\r\n                        className=\"text-slate-600 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-200\"\r\n                      >\r\n                        Edit\r\n                      </button>\r\n                      <button\r\n                        onClick={() => handleDelete(user)}\r\n                        className=\"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200\"\r\n                      >\r\n                        Hapus\r\n                      </button>\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Mobile Card View */}\r\n      <div className=\"md:hidden space-y-3\">\r\n        {users.map((user) => (\r\n          <div\r\n            key={user.id}\r\n            className=\"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 p-4\"\r\n          >\r\n            <div className=\"flex items-start justify-between mb-3\">\r\n              <div className=\"flex-1\">\r\n                <h3 className=\"text-base font-bold text-gray-900 dark:text-white mb-1\">\r\n                  {user.name}\r\n                </h3>\r\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">{user.email}</p>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <button\r\n                  onClick={() => handleEdit(user)}\r\n                  className=\"px-3 py-1.5 text-xs font-semibold bg-slate-600 text-white rounded-lg hover:bg-slate-700\"\r\n                >\r\n                  Edit\r\n                </button>\r\n                <button\r\n                  onClick={() => handleDelete(user)}\r\n                  className=\"px-3 py-1.5 text-xs font-semibold bg-red-600 text-white rounded-lg hover:bg-red-700\"\r\n                >\r\n                  Hapus\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-2 gap-3 mb-3\">\r\n              <div>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Role</p>\r\n                <span\r\n                  className={`px-2 py-1 text-xs font-semibold rounded-full inline-block ${\r\n                    user.role === 'OWNER'\r\n                      ? 'bg-slate-100 text-slate-800 dark:bg-slate-900 dark:text-slate-300'\r\n                      : user.role === 'ADMIN'\r\n                      ? 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300'\r\n                      : user.role === 'MANAGER'\r\n                      ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300'\r\n                      : 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300'\r\n                  }`}\r\n                >\r\n                  {user.role}\r\n                </span>\r\n              </div>\r\n              <div>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Status</p>\r\n                <span\r\n                  className={`px-2 py-1 text-xs font-semibold rounded-full inline-block ${\r\n                    user.isActive\r\n                      ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300'\r\n                      : 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300'\r\n                  }`}\r\n                >\r\n                  {user.isActive ? 'Aktif' : 'Nonaktif'}\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"pt-3 border-t border-gray-100 dark:border-gray-700 grid grid-cols-2 gap-3 text-sm\">\r\n              <div>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-0.5\">Cabang</p>\r\n                {user.hasMultiCabangAccess ? (\r\n                  <span className=\"px-2 py-0.5 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300\">\r\n                    Semua\r\n                  </span>\r\n                ) : (\r\n                  <p className=\"font-medium text-gray-900 dark:text-white truncate\">\r\n                    {user.cabang?.name || '-'}\r\n                  </p>\r\n                )}\r\n              </div>\r\n              <div>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-0.5\">Dibuat</p>\r\n                <p className=\"font-medium text-gray-900 dark:text-white\">\r\n                  {new Date(user.createdAt).toLocaleDateString('id-ID', {\r\n                    day: '2-digit',\r\n                    month: 'short',\r\n                    year: 'numeric',\r\n                  })}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Add/Edit User Modal */}\r\n      {showModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full p-4 md:p-6\">\r\n            <h2 className=\"text-xl md:text-2xl font-bold text-gray-900 dark:text-white mb-4 md:mb-6\">\r\n              {editingUserId ? 'Edit User' : 'Tambah User Baru'}\r\n            </h2>\r\n            \r\n            <form onSubmit={handleSubmit} className=\"space-y-3 md:space-y-4\">\r\n              <div>\r\n                <label className=\"block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Nama\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  required\r\n                  value={formData.name}\r\n                  onChange={(e) => setFormData({ name: e.target.value })}\r\n                  className=\"w-full px-3 md:px-4 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Email\r\n                </label>\r\n                <input\r\n                  type=\"email\"\r\n                  required\r\n                  disabled={!!editingUserId}\r\n                  value={formData.email}\r\n                  onChange={(e) => setFormData({ email: e.target.value })}\r\n                  className=\"w-full px-3 md:px-4 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white disabled:bg-gray-100 dark:disabled:bg-gray-600 disabled:cursor-not-allowed\"\r\n                />\r\n                {editingUserId && (\r\n                  <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">Email tidak bisa diubah</p>\r\n                )}\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Password {editingUserId && '(kosongkan jika tidak diubah)'}\r\n                </label>\r\n                <input\r\n                  type=\"password\"\r\n                  required={!editingUserId}\r\n                  value={formData.password}\r\n                  onChange={(e) => setFormData({ password: e.target.value })}\r\n                  autoComplete=\"new-password\"\r\n                  className=\"w-full px-3 md:px-4 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                  placeholder={editingUserId ? 'ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó' : ''}\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Role\r\n                </label>\r\n                <select\r\n                  required\r\n                  value={formData.role}\r\n                  onChange={(e) => setFormData({ role: e.target.value as any })}\r\n                  className=\"w-full px-3 md:px-4 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                >\r\n                  <option value=\"KASIR\">KASIR</option>\r\n                  <option value=\"MANAGER\">MANAGER</option>\r\n                  <option value=\"ADMIN\">ADMIN</option>\r\n                  <option value=\"OWNER\">OWNER</option>\r\n                </select>\r\n              </div>\r\n\r\n              {/* Akses Cabang - untuk non-KASIR */}\r\n              {formData.role !== 'KASIR' && (\r\n                <div className=\"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg space-y-3\">\r\n                  <label className=\"block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                    Akses Cabang\r\n                  </label>\r\n                  \r\n                  {/* Toggle Akses Semua Cabang */}\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <p className=\"text-sm font-medium text-gray-900 dark:text-white\">Akses Semua Cabang</p>\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                        User dapat mengakses semua cabang yang ada\r\n                      </p>\r\n                    </div>\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => {\r\n                        const newValue = !formData.hasMultiCabangAccess;\r\n                        setFormData({ \r\n                          hasMultiCabangAccess: newValue,\r\n                          cabangId: newValue ? '' : formData.cabangId \r\n                        });\r\n                      }}\r\n                      className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\r\n                        formData.hasMultiCabangAccess ? 'bg-green-600' : 'bg-gray-300 dark:bg-gray-600'\r\n                      }`}\r\n                    >\r\n                      <span\r\n                        className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\r\n                          formData.hasMultiCabangAccess ? 'translate-x-6' : 'translate-x-1'\r\n                        }`}\r\n                      />\r\n                    </button>\r\n                  </div>\r\n\r\n                  {/* Pilih Cabang Tertentu - hanya jika tidak akses semua */}\r\n                  {!formData.hasMultiCabangAccess && (\r\n                    <div>\r\n                      <label className=\"block text-xs text-gray-600 dark:text-gray-400 mb-1\">\r\n                        Atau pilih cabang tertentu:\r\n                      </label>\r\n                      <select\r\n                        value={formData.cabangId}\r\n                        onChange={(e) => setFormData({ cabangId: e.target.value })}\r\n                        className=\"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                      >\r\n                        <option value=\"\">-- Tidak ada (default) --</option>\r\n                        {cabangs.map((cabang) => (\r\n                          <option key={cabang.id} value={cabang.id}>\r\n                            {cabang.name}\r\n                          </option>\r\n                        ))}\r\n                      </select>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Cabang untuk KASIR - wajib pilih 1 */}\r\n              {formData.role === 'KASIR' && (\r\n                <div>\r\n                  <label className=\"block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                    Cabang <span className=\"text-red-500\">*</span>\r\n                  </label>\r\n                  <select\r\n                    required\r\n                    value={formData.cabangId}\r\n                    onChange={(e) => setFormData({ cabangId: e.target.value })}\r\n                    className=\"w-full px-3 md:px-4 py-2 text-sm md:text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                  >\r\n                    <option value=\"\">-- Pilih Cabang --</option>\r\n                    {cabangs.map((cabang) => (\r\n                      <option key={cabang.id} value={cabang.id}>\r\n                        {cabang.name}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                  <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\r\n                    KASIR hanya bisa mengakses 1 cabang\r\n                  </p>\r\n                </div>\r\n              )}\r\n\r\n              <div className=\"flex gap-2 md:gap-3 pt-3 md:pt-4\">\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"flex-1 py-2 md:py-2.5 text-sm md:text-base bg-slate-600 text-white rounded-lg font-semibold hover:bg-slate-700\"\r\n                >\r\n                  Simpan\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handleCloseModal}\r\n                  className=\"px-4 md:px-6 py-2 md:py-2.5 text-sm md:text-base bg-gray-100 text-gray-700 rounded-lg font-semibold hover:bg-gray-200\"\r\n                >\r\n                  Batal\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\stock-opname\\loading.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonFilterBar' is defined but never used.","line":1,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { SkeletonStatCard, SkeletonTable, SkeletonFilterBar, SkeletonPageHeader, Skeleton } from '@/components/ui/Skeleton';\r\n\r\nexport default function Loading() {\r\n  return (\r\n    <div className=\"px-4 md:px-6 space-y-6\">\r\n      {/* Header */}\r\n      <SkeletonPageHeader />\r\n      \r\n      {/* Stats */}\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n        <SkeletonStatCard />\r\n        <SkeletonStatCard />\r\n        <SkeletonStatCard />\r\n        <SkeletonStatCard />\r\n      </div>\r\n      \r\n      {/* Filters */}\r\n      <div className=\"flex flex-wrap gap-4\">\r\n        <Skeleton className=\"h-10 w-48 rounded-lg\" />\r\n        <Skeleton className=\"h-10 w-64 rounded-lg\" />\r\n        <Skeleton className=\"h-10 w-32 rounded-lg\" />\r\n      </div>\r\n      \r\n      {/* Product List */}\r\n      <div className=\"space-y-4\">\r\n        {Array.from({ length: 5 }).map((_, i) => (\r\n          <div key={i} className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <Skeleton className=\"h-5 w-5 rounded\" />\r\n                <Skeleton className=\"h-5 w-48\" />\r\n              </div>\r\n              <Skeleton className=\"h-8 w-20 rounded-lg\" />\r\n            </div>\r\n            <SkeletonTable rows={3} columns={5} />\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\stock-opname\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":3,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ClipboardList' is defined but never used.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertTriangle' is defined but never used.","line":6,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used.","line":6,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":65},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Filter' is defined but never used.","line":6,"column":78,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":84},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Cabang' is defined but never used.","line":8,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Product' is defined but never used.","line":24,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'products' is assigned a value but never used.","line":47,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setCabangs' is assigned a value but never used.","line":59,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'resetAll' is assigned a value but never used.","line":73,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":275,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10052,10055],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10052,10055],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useCallback } from 'react';\r\nimport { getAuth } from '@/lib/auth';\r\nimport { useStockOpnameStore } from '@/stores/useStockOpnameStore';\r\nimport { ClipboardList, Search, Package, AlertTriangle, Check, X, RefreshCw, Filter, ChevronDown, ChevronUp, Save, Minus, Plus, RotateCcw } from 'lucide-react';\r\n\r\ninterface Cabang {\r\n  id: string;\r\n  name: string;\r\n}\r\n\r\ninterface ProductVariant {\r\n  id: string;\r\n  name: string;\r\n  sku: string;\r\n  stocks: {\r\n    id: string;\r\n    quantity: number;\r\n    cabangId: string;\r\n  }[];\r\n}\r\n\r\ninterface Product {\r\n  id: string;\r\n  name: string;\r\n  category?: { id: string; name: string };\r\n  variants: ProductVariant[];\r\n}\r\n\r\ninterface OpnameItem {\r\n  variantId: string;\r\n  productName: string;\r\n  variantName: string;\r\n  sku: string;\r\n  systemQty: number;\r\n  physicalQty: number | null;\r\n  difference: number;\r\n  status: 'pending' | 'counted' | 'adjusted';\r\n}\r\n\r\nexport default function StockOpnamePage() {\r\n  // Use store for all state\r\n  const {\r\n    cabangs,\r\n    selectedCabang,\r\n    products,\r\n    opnameItems,\r\n    loading,\r\n    loadingProducts,\r\n    search,\r\n    filterStatus,\r\n    expandedProducts,\r\n    submitting,\r\n    successMessage,\r\n    showOnlyDiscrepancy,\r\n    getStats,\r\n    // Actions\r\n    setCabangs,\r\n    setSelectedCabang,\r\n    setSearch,\r\n    setFilterStatus,\r\n    setShowOnlyDiscrepancy,\r\n    toggleExpandedProduct,\r\n    handlePhysicalQtyChange,\r\n    handleQuickAdjust,\r\n    handleResetItem,\r\n    handleSetToSystem,\r\n    loadCabangs,\r\n    loadProducts,\r\n    submitAdjustment,\r\n    submitAllAdjustments,\r\n    resetAll,\r\n  } = useStockOpnameStore();\r\n  \r\n  const { user } = getAuth();\r\n  const stats = getStats();\r\n\r\n  useEffect(() => {\r\n    // Set default cabang for non-owner\r\n    if (user?.role !== 'OWNER' && user?.cabangId) {\r\n      setSelectedCabang(user.cabangId);\r\n    }\r\n    loadCabangs();\r\n  }, [user, setSelectedCabang, loadCabangs]);\r\n\r\n  useEffect(() => {\r\n    if (selectedCabang) {\r\n      loadProducts();\r\n    }\r\n  }, [selectedCabang, loadProducts]);\r\n\r\n  const handleSubmitAdjustment = async (item: OpnameItem) => {\r\n    const success = await submitAdjustment(item);\r\n    if (!success && item.physicalQty !== null && item.difference !== 0) {\r\n      alert('Gagal menyesuaikan stok');\r\n    }\r\n  };\r\n\r\n  const handleSubmitAllDiscrepancies = async () => {\r\n    const discrepancyItems = opnameItems.filter(\r\n      i => i.physicalQty !== null && i.difference !== 0 && i.status !== 'adjusted'\r\n    );\r\n    \r\n    if (discrepancyItems.length === 0) {\r\n      alert('Tidak ada selisih yang perlu disesuaikan');\r\n      return;\r\n    }\r\n    \r\n    if (!confirm(`Apakah Anda yakin ingin menyesuaikan ${discrepancyItems.length} item dengan selisih?`)) {\r\n      return;\r\n    }\r\n    \r\n    const success = await submitAllAdjustments();\r\n    if (!success) {\r\n      alert('Gagal menyesuaikan beberapa stok');\r\n    }\r\n  };\r\n\r\n  const toggleProductExpand = (productName: string) => {\r\n    toggleExpandedProduct(productName);\r\n  };\r\n\r\n  // Filter items\r\n  const filteredItems = opnameItems.filter(item => {\r\n    // Search filter\r\n    if (search) {\r\n      const searchLower = search.toLowerCase();\r\n      if (\r\n        !item.productName.toLowerCase().includes(searchLower) &&\r\n        !item.variantName.toLowerCase().includes(searchLower) &&\r\n        !item.sku.toLowerCase().includes(searchLower)\r\n      ) {\r\n        return false;\r\n      }\r\n    }\r\n    \r\n    // Status filter\r\n    if (filterStatus === 'pending' && item.status !== 'pending') return false;\r\n    if (filterStatus === 'counted' && item.status === 'pending') return false;\r\n    if (filterStatus === 'discrepancy' && (item.physicalQty === null || item.difference === 0)) return false;\r\n    \r\n    // Discrepancy only toggle\r\n    if (showOnlyDiscrepancy && (item.physicalQty === null || item.difference === 0)) return false;\r\n    \r\n    return true;\r\n  });\r\n\r\n  // Group by product\r\n  const groupedItems = filteredItems.reduce((acc, item) => {\r\n    if (!acc[item.productName]) {\r\n      acc[item.productName] = [];\r\n    }\r\n    acc[item.productName].push(item);\r\n    return acc;\r\n  }, {} as Record<string, OpnameItem[]>);\r\n\r\n  const expandAll = () => {\r\n    Object.keys(groupedItems).forEach(name => {\r\n      if (!expandedProducts.has(name)) {\r\n        toggleExpandedProduct(name);\r\n      }\r\n    });\r\n  };\r\n\r\n  const collapseAll = () => {\r\n    expandedProducts.forEach(name => {\r\n      toggleExpandedProduct(name);\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"px-4 md:px-6 pb-6\">\r\n      {/* Success Toast */}\r\n      {successMessage && (\r\n        <div className=\"fixed top-4 right-4 z-50 bg-green-500 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 animate-fade-in\">\r\n          <Check className=\"w-5 h-5\" />\r\n          {successMessage}\r\n        </div>\r\n      )}\r\n\r\n      {/* Breadcrumb */}\r\n      <nav className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-6\">\r\n        <a href=\"/dashboard\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Dashboard</a>\r\n        <span>ΓÇ║</span>\r\n        <a href=\"/dashboard/stock\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Stock</a>\r\n        <span>ΓÇ║</span>\r\n        <span className=\"text-gray-900 dark:text-white font-medium\">Stock Opname</span>\r\n      </nav>\r\n\r\n      {/* Cabang Selector */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <select\r\n            value={selectedCabang}\r\n            onChange={(e) => setSelectedCabang(e.target.value)}\r\n            disabled={user?.role !== 'OWNER'}\r\n            className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 disabled:opacity-60\"\r\n          >\r\n            <option value=\"\">Pilih Cabang</option>\r\n            {cabangs.map((cabang) => (\r\n              <option key={cabang.id} value={cabang.id}>\r\n                {cabang.name}\r\n              </option>\r\n            ))}\r\n          </select>\r\n          \r\n          {selectedCabang && (\r\n            <button\r\n              onClick={loadProducts}\r\n              disabled={loadingProducts}\r\n              className=\"p-2 text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition\"\r\n              title=\"Refresh Data\"\r\n            >\r\n              <RefreshCw className={`w-5 h-5 ${loadingProducts ? 'animate-spin' : ''}`} />\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {!selectedCabang ? (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-12 text-center\">\r\n          <Package className=\"w-16 h-16 mx-auto text-gray-400 dark:text-gray-500 mb-4\" />\r\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">\r\n            Pilih Cabang untuk Memulai\r\n          </h3>\r\n          <p className=\"text-gray-500 dark:text-gray-400\">\r\n            Silakan pilih cabang untuk melakukan stock opname\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <>\r\n          {/* Stats Cards */}\r\n          <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6\">\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700\">\r\n              <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">{stats.total}</div>\r\n              <div className=\"text-sm text-gray-500 dark:text-gray-400\">Total Item</div>\r\n            </div>\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700\">\r\n              <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">{stats.counted}</div>\r\n              <div className=\"text-sm text-gray-500 dark:text-gray-400\">Sudah Dihitung</div>\r\n            </div>\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700\">\r\n              <div className=\"text-2xl font-bold text-gray-600 dark:text-gray-400\">{stats.pending}</div>\r\n              <div className=\"text-sm text-gray-500 dark:text-gray-400\">Belum Dihitung</div>\r\n            </div>\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700\">\r\n              <div className=\"text-2xl font-bold text-amber-600 dark:text-amber-400\">{stats.discrepancy}</div>\r\n              <div className=\"text-sm text-gray-500 dark:text-gray-400\">Ada Selisih</div>\r\n            </div>\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700\">\r\n              <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">{stats.adjusted}</div>\r\n              <div className=\"text-sm text-gray-500 dark:text-gray-400\">Disesuaikan</div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Filters */}\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 mb-6\">\r\n            <div className=\"flex flex-col md:flex-row gap-4\">\r\n              {/* Search */}\r\n              <div className=\"flex-1 relative\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Cari produk, varian, atau SKU...\"\r\n                  value={search}\r\n                  onChange={(e) => setSearch(e.target.value)}\r\n                  className=\"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500\"\r\n                />\r\n              </div>\r\n\r\n              {/* Status Filter */}\r\n              <select\r\n                value={filterStatus}\r\n                onChange={(e) => setFilterStatus(e.target.value as any)}\r\n                className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500\"\r\n              >\r\n                <option value=\"all\">Semua Status</option>\r\n                <option value=\"pending\">Belum Dihitung</option>\r\n                <option value=\"counted\">Sudah Dihitung</option>\r\n                <option value=\"discrepancy\">Ada Selisih</option>\r\n              </select>\r\n\r\n              {/* Discrepancy Toggle */}\r\n              <label className=\"flex items-center gap-2 px-4 py-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg cursor-pointer\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={showOnlyDiscrepancy}\r\n                  onChange={(e) => setShowOnlyDiscrepancy(e.target.checked)}\r\n                  className=\"rounded text-amber-600 focus:ring-amber-500\"\r\n                />\r\n                <span className=\"text-sm text-amber-700 dark:text-amber-400 whitespace-nowrap\">\r\n                  Selisih Saja\r\n                </span>\r\n              </label>\r\n\r\n              {/* Expand/Collapse */}\r\n              <div className=\"flex gap-2\">\r\n                <button\r\n                  onClick={expandAll}\r\n                  className=\"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition\"\r\n                >\r\n                  <ChevronDown className=\"w-4 h-4\" />\r\n                </button>\r\n                <button\r\n                  onClick={collapseAll}\r\n                  className=\"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition\"\r\n                >\r\n                  <ChevronUp className=\"w-4 h-4\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Submit All Discrepancies Button */}\r\n          {stats.discrepancy > 0 && (\r\n            <div className=\"mb-6\">\r\n              <button\r\n                onClick={handleSubmitAllDiscrepancies}\r\n                disabled={loading}\r\n                className=\"w-full md:w-auto px-6 py-3 bg-amber-600 hover:bg-amber-700 text-white font-medium rounded-lg transition flex items-center justify-center gap-2 disabled:opacity-50\"\r\n              >\r\n                {loading ? (\r\n                  <RefreshCw className=\"w-5 h-5 animate-spin\" />\r\n                ) : (\r\n                  <Save className=\"w-5 h-5\" />\r\n                )}\r\n                Sesuaikan Semua Selisih ({stats.discrepancy - stats.adjusted} item)\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {/* Products List */}\r\n          {loadingProducts ? (\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-12 text-center\">\r\n              <RefreshCw className=\"w-8 h-8 mx-auto text-indigo-600 animate-spin mb-4\" />\r\n              <p className=\"text-gray-500 dark:text-gray-400\">Memuat data produk...</p>\r\n            </div>\r\n          ) : Object.keys(groupedItems).length === 0 ? (\r\n            <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-12 text-center\">\r\n              <Package className=\"w-16 h-16 mx-auto text-gray-400 dark:text-gray-500 mb-4\" />\r\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">\r\n                Tidak Ada Data\r\n              </h3>\r\n              <p className=\"text-gray-500 dark:text-gray-400\">\r\n                {search || filterStatus !== 'all' || showOnlyDiscrepancy\r\n                  ? 'Tidak ada item yang sesuai dengan filter'\r\n                  : 'Belum ada produk di cabang ini'}\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              {Object.entries(groupedItems).map(([productName, items]) => {\r\n                const isExpanded = expandedProducts.has(productName);\r\n                const hasDiscrepancy = items.some(i => i.physicalQty !== null && i.difference !== 0);\r\n                const allCounted = items.every(i => i.status !== 'pending');\r\n                \r\n                return (\r\n                  <div\r\n                    key={productName}\r\n                    className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden\"\r\n                  >\r\n                    {/* Product Header */}\r\n                    <button\r\n                      onClick={() => toggleProductExpand(productName)}\r\n                      className=\"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700/50 transition\"\r\n                    >\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <div className={`w-2 h-2 rounded-full ${\r\n                          hasDiscrepancy ? 'bg-amber-500' :\r\n                          allCounted ? 'bg-green-500' : 'bg-gray-300'\r\n                        }`} />\r\n                        <span className=\"font-medium text-gray-900 dark:text-white\">\r\n                          {productName}\r\n                        </span>\r\n                        <span className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                          ({items.length} varian)\r\n                        </span>\r\n                      </div>\r\n                      {isExpanded ? (\r\n                        <ChevronUp className=\"w-5 h-5 text-gray-400\" />\r\n                      ) : (\r\n                        <ChevronDown className=\"w-5 h-5 text-gray-400\" />\r\n                      )}\r\n                    </button>\r\n\r\n                    {/* Variants */}\r\n                    {isExpanded && (\r\n                      <div className=\"border-t border-gray-200 dark:border-gray-700\">\r\n                        {items.map((item) => (\r\n                          <div\r\n                            key={item.variantId}\r\n                            className={`px-4 py-3 border-b border-gray-100 dark:border-gray-700/50 last:border-b-0 ${\r\n                              item.status === 'adjusted' ? 'bg-green-50 dark:bg-green-900/10' :\r\n                              item.difference !== 0 && item.physicalQty !== null ? 'bg-amber-50 dark:bg-amber-900/10' : ''\r\n                            }`}\r\n                          >\r\n                            <div className=\"flex flex-col md:flex-row md:items-center gap-4\">\r\n                              {/* Variant Info */}\r\n                              <div className=\"flex-1 min-w-0\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                  <span className=\"font-medium text-gray-900 dark:text-white truncate\">\r\n                                    {item.variantName}\r\n                                  </span>\r\n                                  {item.status === 'adjusted' && (\r\n                                    <span className=\"px-2 py-0.5 text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full\">\r\n                                      Disesuaikan\r\n                                    </span>\r\n                                  )}\r\n                                </div>\r\n                                <div className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                                  SKU: {item.sku}\r\n                                </div>\r\n                              </div>\r\n\r\n                              {/* System Qty */}\r\n                              <div className=\"text-center px-4\">\r\n                                <div className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Sistem</div>\r\n                                <div className=\"text-lg font-semibold text-gray-900 dark:text-white\">\r\n                                  {item.systemQty}\r\n                                </div>\r\n                              </div>\r\n\r\n                              {/* Physical Qty Input */}\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <button\r\n                                  onClick={() => handleQuickAdjust(item.variantId, -1)}\r\n                                  disabled={item.status === 'adjusted'}\r\n                                  className=\"p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition disabled:opacity-50\"\r\n                                >\r\n                                  <Minus className=\"w-4 h-4\" />\r\n                                </button>\r\n                                <div className=\"text-center\">\r\n                                  <div className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Fisik</div>\r\n                                  <input\r\n                                    type=\"number\"\r\n                                    min=\"0\"\r\n                                    value={item.physicalQty ?? ''}\r\n                                    onChange={(e) => handlePhysicalQtyChange(item.variantId, e.target.value)}\r\n                                    disabled={item.status === 'adjusted'}\r\n                                    placeholder=\"ΓÇö\"\r\n                                    className=\"w-20 text-center text-lg font-semibold border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 disabled:opacity-50\"\r\n                                  />\r\n                                </div>\r\n                                <button\r\n                                  onClick={() => handleQuickAdjust(item.variantId, 1)}\r\n                                  disabled={item.status === 'adjusted'}\r\n                                  className=\"p-2 text-gray-500 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition disabled:opacity-50\"\r\n                                >\r\n                                  <Plus className=\"w-4 h-4\" />\r\n                                </button>\r\n                              </div>\r\n\r\n                              {/* Difference */}\r\n                              <div className=\"text-center px-4 min-w-[80px]\">\r\n                                <div className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Selisih</div>\r\n                                <div className={`text-lg font-semibold ${\r\n                                  item.difference > 0 ? 'text-green-600 dark:text-green-400' :\r\n                                  item.difference < 0 ? 'text-red-600 dark:text-red-400' :\r\n                                  'text-gray-400'\r\n                                }`}>\r\n                                  {item.physicalQty !== null ? (\r\n                                    item.difference > 0 ? `+${item.difference}` : item.difference\r\n                                  ) : 'ΓÇö'}\r\n                                </div>\r\n                              </div>\r\n\r\n                              {/* Actions */}\r\n                              <div className=\"flex items-center gap-2\">\r\n                                {item.status !== 'adjusted' && (\r\n                                  <>\r\n                                    <button\r\n                                      onClick={() => handleSetToSystem(item.variantId)}\r\n                                      className=\"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition\"\r\n                                      title=\"Set sama dengan sistem\"\r\n                                    >\r\n                                      <Check className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                    <button\r\n                                      onClick={() => handleResetItem(item.variantId)}\r\n                                      className=\"p-2 text-gray-500 hover:text-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition\"\r\n                                      title=\"Reset\"\r\n                                    >\r\n                                      <RotateCcw className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                    {item.physicalQty !== null && item.difference !== 0 && (\r\n                                      <button\r\n                                        onClick={() => handleSubmitAdjustment(item)}\r\n                                        disabled={submitting === item.variantId}\r\n                                        className=\"px-3 py-1.5 bg-amber-600 hover:bg-amber-700 text-white text-sm font-medium rounded-lg transition disabled:opacity-50 flex items-center gap-1\"\r\n                                      >\r\n                                        {submitting === item.variantId ? (\r\n                                          <RefreshCw className=\"w-4 h-4 animate-spin\" />\r\n                                        ) : (\r\n                                          <Save className=\"w-4 h-4\" />\r\n                                        )}\r\n                                        Adjust\r\n                                      </button>\r\n                                    )}\r\n                                  </>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\stock-transfers\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\stock-transfers\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Transfer' is defined but never used.","line":21,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Cabang' is defined but never used.","line":55,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Product' is defined but never used.","line":61,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":18}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect } from 'react';\r\nimport { getAuth } from '@/lib/auth';\r\nimport { useTransferStore } from '@/stores/useTransferStore';\r\nimport { SkeletonDashboardStats, SkeletonTable, SkeletonPageHeader } from '@/components/ui/Skeleton';\r\nimport { \r\n  ArrowLeftRight, \r\n  Plus, \r\n  Check, \r\n  X, \r\n  Clock, \r\n  CheckCircle2, \r\n  XCircle,\r\n  Package,\r\n  Search,\r\n  Filter,\r\n  AlertCircle\r\n} from 'lucide-react';\r\n\r\ninterface Transfer {\r\n  id: string;\r\n  transferNo: string;\r\n  quantity: number;\r\n  status: 'PENDING' | 'COMPLETED' | 'CANCELLED';\r\n  notes: string | null;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  productVariant: {\r\n    id: string;\r\n    variantName: string;\r\n    variantValue: string;\r\n    sku: string;\r\n    product: {\r\n      id: string;\r\n      name: string;\r\n    };\r\n  };\r\n  fromCabang: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n  toCabang: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n  transferredBy: {\r\n    id: string;\r\n    name: string;\r\n    email: string;\r\n    role: string;\r\n  };\r\n}\r\n\r\ninterface Cabang {\r\n  id: string;\r\n  name: string;\r\n  isActive: boolean;\r\n}\r\n\r\ninterface Product {\r\n  id: string;\r\n  name: string;\r\n  variants: Array<{\r\n    id: string;\r\n    variantName: string;\r\n    variantValue: string;\r\n    sku: string;\r\n    stocks: Array<{\r\n      cabangId: string;\r\n      quantity: number;\r\n    }>;\r\n  }>;\r\n}\r\n\r\nexport default function StockTransfersPage() {\r\n  // Use store for all state\r\n  const {\r\n    transfers,\r\n    stats,\r\n    loading,\r\n    cabangs: branches,\r\n    products,\r\n    statusFilter,\r\n    cabangFilter,\r\n    showCreateModal,\r\n    createLoading,\r\n    searchProduct,\r\n    selectedProduct,\r\n    selectedVariant,\r\n    fromCabang,\r\n    toCabang,\r\n    quantity,\r\n    notes,\r\n    actionLoading,\r\n    // Actions\r\n    setStatusFilter,\r\n    setCabangFilter,\r\n    setShowCreateModal,\r\n    setSearchProduct,\r\n    setSelectedProduct,\r\n    setSelectedVariant,\r\n    setFromCabang,\r\n    setToCabang,\r\n    setQuantity,\r\n    setNotes,\r\n    setProducts,\r\n    resetCreateForm,\r\n    fetchData,\r\n    fetchProducts,\r\n    createTransfer,\r\n    approveTransfer,\r\n    rejectTransfer,\r\n  } = useTransferStore();\r\n  \r\n  const { user } = getAuth();\r\n  const canApprove = user?.role === 'MANAGER' || user?.role === 'OWNER';\r\n  const canCreate = user?.role === 'ADMIN' || user?.role === 'MANAGER' || user?.role === 'OWNER';\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, [statusFilter, cabangFilter, fetchData]);\r\n\r\n  const handleCreateTransfer = async () => {\r\n    if (!selectedVariant || !fromCabang || !toCabang || quantity <= 0) {\r\n      alert('Please fill all required fields');\r\n      return;\r\n    }\r\n    \r\n    const success = await createTransfer({\r\n      variantId: selectedVariant,\r\n      fromCabangId: fromCabang,\r\n      toCabangId: toCabang,\r\n      quantity,\r\n      notes: notes || undefined,\r\n    });\r\n    \r\n    if (success) {\r\n      if (canApprove) {\r\n        alert('Transfer berhasil dibuat dan langsung diproses!');\r\n      } else {\r\n        alert('Request transfer berhasil dikirim!\\nMenunggu approval dari Manager/Owner.');\r\n      }\r\n    } else {\r\n      alert('Gagal membuat transfer');\r\n    }\r\n  };\r\n\r\n  const handleApprove = async (id: string) => {\r\n    if (!confirm('Approve transfer ini? Stock akan langsung dipindahkan.')) return;\r\n    \r\n    const success = await approveTransfer(id);\r\n    if (success) {\r\n      alert('Transfer approved!');\r\n    } else {\r\n      alert('Gagal approve transfer');\r\n    }\r\n  };\r\n\r\n  const handleReject = async (id: string) => {\r\n    const reason = prompt('Alasan reject (opsional):');\r\n    if (reason === null) return;\r\n    \r\n    const success = await rejectTransfer(id);\r\n    if (success) {\r\n      alert('Transfer dibatalkan');\r\n    } else {\r\n      alert('Gagal reject transfer');\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case 'PENDING':\r\n        return (\r\n          <span className=\"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300\">\r\n            <Clock className=\"w-3 h-3\" />\r\n            Pending\r\n          </span>\r\n        );\r\n      case 'COMPLETED':\r\n        return (\r\n          <span className=\"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300\">\r\n            <CheckCircle2 className=\"w-3 h-3\" />\r\n            Completed\r\n          </span>\r\n        );\r\n      case 'CANCELLED':\r\n        return (\r\n          <span className=\"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300\">\r\n            <XCircle className=\"w-3 h-3\" />\r\n            Cancelled\r\n          </span>\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  const getAvailableStock = () => {\r\n    if (!selectedProduct || !selectedVariant || !fromCabang) return 0;\r\n    const variant = selectedProduct.variants.find(v => v.id === selectedVariant);\r\n    if (!variant) return 0;\r\n    const stock = variant.stocks.find(s => s.cabangId === fromCabang);\r\n    return stock?.quantity || 0;\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"px-4 md:px-6 space-y-6\">\r\n        <SkeletonPageHeader />\r\n        <SkeletonDashboardStats count={4} />\r\n        <SkeletonTable rows={8} columns={7} />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"px-4 md:px-6 space-y-6\">\r\n      {/* Breadcrumb */}\r\n      <nav className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n        <a href=\"/dashboard\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Dashboard</a>\r\n        <span>ΓÇ║</span>\r\n        <a href=\"/dashboard/stock\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Stock</a>\r\n        <span>ΓÇ║</span>\r\n        <span className=\"text-gray-900 dark:text-white font-medium\">Transfer</span>\r\n      </nav>\r\n\r\n      {/* Stats Cards */}\r\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">Total Transfer</p>\r\n              <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{stats?.total || 0}</p>\r\n            </div>\r\n            <div className=\"p-2 bg-cyan-100 dark:bg-cyan-900/30 rounded-lg\">\r\n              <ArrowLeftRight className=\"w-5 h-5 text-cyan-600 dark:text-cyan-400\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">Pending</p>\r\n              <p className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">{stats?.pending || 0}</p>\r\n            </div>\r\n            <div className=\"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg\">\r\n              <Clock className=\"w-5 h-5 text-yellow-600 dark:text-yellow-400\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">Completed</p>\r\n              <p className=\"text-2xl font-bold text-green-600 dark:text-green-400\">{stats?.completed || 0}</p>\r\n            </div>\r\n            <div className=\"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg\">\r\n              <CheckCircle2 className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">Total Items</p>\r\n              <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{stats?.totalQuantity || 0}</p>\r\n            </div>\r\n            <div className=\"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg\">\r\n              <Package className=\"w-5 h-5 text-purple-600 dark:text-purple-400\" />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700\">\r\n        {/* Header */}\r\n        <div className=\"p-4 md:p-6 border-b border-gray-200 dark:border-gray-700\">\r\n          <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\r\n            <h2 className=\"text-lg font-bold text-gray-900 dark:text-white\">Daftar Transfer</h2>\r\n            \r\n            {canCreate && (\r\n              <button\r\n                onClick={() => setShowCreateModal(true)}\r\n                className=\"flex items-center gap-2 px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors\"\r\n              >\r\n                <Plus className=\"w-4 h-4\" />\r\n                <span>Buat Transfer</span>\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Filters */}\r\n        <div className=\"p-4 border-b border-gray-200 dark:border-gray-700 flex flex-wrap gap-3\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <Filter className=\"w-4 h-4 text-gray-400\" />\r\n            <select\r\n              value={statusFilter}\r\n              onChange={(e) => setStatusFilter(e.target.value)}\r\n              className=\"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n            >\r\n              <option value=\"ALL\">Semua Status</option>\r\n              <option value=\"PENDING\">Pending</option>\r\n              <option value=\"COMPLETED\">Completed</option>\r\n              <option value=\"CANCELLED\">Cancelled</option>\r\n            </select>\r\n          </div>\r\n          \r\n          <select\r\n            value={cabangFilter}\r\n            onChange={(e) => setCabangFilter(e.target.value)}\r\n            className=\"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n          >\r\n            <option value=\"\">Semua Cabang</option>\r\n            {branches.map(branch => (\r\n              <option key={branch.id} value={branch.id}>{branch.name}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n\r\n        {/* Table */}\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"w-full\">\r\n            <thead className=\"bg-gray-50 dark:bg-gray-700/50\">\r\n              <tr>\r\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Transfer No</th>\r\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Product</th>\r\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">From ΓåÆ To</th>\r\n                <th className=\"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Qty</th>\r\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Requested By</th>\r\n                <th className=\"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Status</th>\r\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Date</th>\r\n                {canApprove && <th className=\"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Actions</th>}\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\r\n              {transfers.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={canApprove ? 8 : 7} className=\"px-4 py-12 text-center text-gray-500 dark:text-gray-400\">\r\n                    <ArrowLeftRight className=\"w-12 h-12 mx-auto mb-3 text-gray-300 dark:text-gray-600\" />\r\n                    <p>Belum ada transfer</p>\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                transfers.map((transfer) => (\r\n                  <tr key={transfer.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50\">\r\n                    <td className=\"px-4 py-3\">\r\n                      <span className=\"font-mono text-sm text-gray-900 dark:text-white\">{transfer.transferNo}</span>\r\n                    </td>\r\n                    <td className=\"px-4 py-3\">\r\n                      <div>\r\n                        <p className=\"font-medium text-gray-900 dark:text-white text-sm\">\r\n                          {transfer.productVariant.product.name}\r\n                        </p>\r\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                          {transfer.productVariant.variantValue} ΓÇó {transfer.productVariant.sku}\r\n                        </p>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-4 py-3\">\r\n                      <div className=\"flex items-center gap-2 text-sm\">\r\n                        <span className=\"text-gray-900 dark:text-white\">{transfer.fromCabang.name}</span>\r\n                        <ArrowLeftRight className=\"w-4 h-4 text-gray-400\" />\r\n                        <span className=\"text-gray-900 dark:text-white\">{transfer.toCabang.name}</span>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-4 py-3 text-center\">\r\n                      <span className=\"font-semibold text-gray-900 dark:text-white\">{transfer.quantity}</span>\r\n                    </td>\r\n                    <td className=\"px-4 py-3\">\r\n                      <div>\r\n                        <p className=\"text-sm text-gray-900 dark:text-white\">{transfer.transferredBy.name}</p>\r\n                        <p className=\"text-xs text-gray-500 dark:text-gray-400\">{transfer.transferredBy.role}</p>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-4 py-3 text-center\">\r\n                      {getStatusBadge(transfer.status)}\r\n                    </td>\r\n                    <td className=\"px-4 py-3\">\r\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                        {new Date(transfer.createdAt).toLocaleDateString('id-ID', {\r\n                          day: 'numeric',\r\n                          month: 'short',\r\n                          year: 'numeric',\r\n                          hour: '2-digit',\r\n                          minute: '2-digit'\r\n                        })}\r\n                      </p>\r\n                    </td>\r\n                    {canApprove && (\r\n                      <td className=\"px-4 py-3\">\r\n                        {transfer.status === 'PENDING' && (\r\n                          <div className=\"flex items-center justify-center gap-2\">\r\n                            <button\r\n                              onClick={() => handleApprove(transfer.id)}\r\n                              disabled={actionLoading === transfer.id}\r\n                              className=\"p-1.5 text-green-600 hover:bg-green-100 dark:hover:bg-green-900/30 rounded-lg transition-colors disabled:opacity-50\"\r\n                              title=\"Approve\"\r\n                            >\r\n                              <Check className=\"w-4 h-4\" />\r\n                            </button>\r\n                            <button\r\n                              onClick={() => handleReject(transfer.id)}\r\n                              disabled={actionLoading === transfer.id}\r\n                              className=\"p-1.5 text-red-600 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg transition-colors disabled:opacity-50\"\r\n                              title=\"Reject\"\r\n                            >\r\n                              <X className=\"w-4 h-4\" />\r\n                            </button>\r\n                          </div>\r\n                        )}\r\n                      </td>\r\n                    )}\r\n                  </tr>\r\n                ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Create Modal */}\r\n      {showCreateModal && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto\">\r\n            <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\r\n              <h3 className=\"text-xl font-bold text-gray-900 dark:text-white\">Buat Transfer Stock</h3>\r\n              <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                {canApprove \r\n                  ? 'Transfer akan langsung diproses' \r\n                  : 'Transfer akan menunggu approval dari Manager/Owner'}\r\n              </p>\r\n            </div>\r\n            \r\n            <div className=\"p-6 space-y-4\">\r\n              {/* Product Search */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Cari Produk *\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n                  <input\r\n                    type=\"text\"\r\n                    value={searchProduct}\r\n                    onChange={(e) => {\r\n                      setSearchProduct(e.target.value);\r\n                      fetchProducts(e.target.value);\r\n                    }}\r\n                    placeholder=\"Ketik nama produk atau SKU...\"\r\n                    className=\"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                  />\r\n                </div>\r\n                \r\n                {/* Product Results */}\r\n                {products.length > 0 && !selectedProduct && (\r\n                  <div className=\"mt-2 border border-gray-200 dark:border-gray-600 rounded-lg max-h-48 overflow-y-auto\">\r\n                    {products.map(product => (\r\n                      <button\r\n                        key={product.id}\r\n                        onClick={() => {\r\n                          setSelectedProduct(product);\r\n                          setSearchProduct(product.name);\r\n                          setProducts([]);\r\n                        }}\r\n                        className=\"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                      >\r\n                        <Package className=\"w-4 h-4 text-gray-400\" />\r\n                        <span className=\"text-sm text-gray-900 dark:text-white\">{product.name}</span>\r\n                        <span className=\"text-xs text-gray-500\">({product.variants.length} variant)</span>\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Variant Selection */}\r\n              {selectedProduct && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                    Pilih Variant *\r\n                  </label>\r\n                  <select\r\n                    value={selectedVariant}\r\n                    onChange={(e) => setSelectedVariant(e.target.value)}\r\n                    className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                  >\r\n                    <option value=\"\">-- Pilih Variant --</option>\r\n                    {selectedProduct.variants.map(variant => (\r\n                      <option key={variant.id} value={variant.id}>\r\n                        {variant.variantValue} ({variant.sku})\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n              )}\r\n\r\n              {/* From Cabang */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Dari Cabang *\r\n                </label>\r\n                <select\r\n                  value={fromCabang}\r\n                  onChange={(e) => setFromCabang(e.target.value)}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                >\r\n                  <option value=\"\">-- Pilih Cabang Asal --</option>\r\n                  {branches.map(branch => (\r\n                    <option key={branch.id} value={branch.id}>{branch.name}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              {/* To Cabang */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Ke Cabang *\r\n                </label>\r\n                <select\r\n                  value={toCabang}\r\n                  onChange={(e) => setToCabang(e.target.value)}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                >\r\n                  <option value=\"\">-- Pilih Cabang Tujuan --</option>\r\n                  {branches.filter(b => b.id !== fromCabang).map(branch => (\r\n                    <option key={branch.id} value={branch.id}>{branch.name}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              {/* Stock Info & Quantity */}\r\n              {selectedVariant && fromCabang && (\r\n                <div className=\"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4\">\r\n                  <div className=\"flex items-center justify-between mb-3\">\r\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Stok Tersedia:</span>\r\n                    <span className=\"font-semibold text-gray-900 dark:text-white\">{getAvailableStock()}</span>\r\n                  </div>\r\n                  \r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                      Jumlah Transfer *\r\n                    </label>\r\n                    <input\r\n                      type=\"number\"\r\n                      min={1}\r\n                      max={getAvailableStock()}\r\n                      value={quantity}\r\n                      onChange={(e) => setQuantity(parseInt(e.target.value) || 0)}\r\n                      className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                    />\r\n                  </div>\r\n                  \r\n                  {quantity > getAvailableStock() && (\r\n                    <div className=\"mt-2 flex items-center gap-2 text-red-600 dark:text-red-400 text-sm\">\r\n                      <AlertCircle className=\"w-4 h-4\" />\r\n                      <span>Jumlah melebihi stok tersedia!</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Notes */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\r\n                  Catatan (opsional)\r\n                </label>\r\n                <textarea\r\n                  value={notes}\r\n                  onChange={(e) => setNotes(e.target.value)}\r\n                  rows={2}\r\n                  placeholder=\"Tambahkan catatan...\"\r\n                  className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none\"\r\n                />\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"p-6 border-t border-gray-200 dark:border-gray-700 flex gap-3 justify-end\">\r\n              <button\r\n                onClick={() => {\r\n                  setShowCreateModal(false);\r\n                  resetCreateForm();\r\n                }}\r\n                className=\"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\r\n              >\r\n                Batal\r\n              </button>\r\n              <button\r\n                onClick={handleCreateTransfer}\r\n                disabled={createLoading || !selectedVariant || !fromCabang || !toCabang || quantity <= 0 || quantity > getAvailableStock()}\r\n                className=\"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n              >\r\n                {createLoading ? (\r\n                  <>\r\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\r\n                    <span>Processing...</span>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <ArrowLeftRight className=\"w-4 h-4\" />\r\n                    <span>{canApprove ? 'Transfer' : 'Request Transfer'}</span>\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\stock\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\stock\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setStockInItems' is assigned a value but never used.","line":96,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'setActiveActionMenu' and 'setShowCabangDropdown'. Either include them or remove the dependency array.","line":150,"column":6,"nodeType":"ArrayExpression","endLine":150,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [setActiveActionMenu, setShowCabangDropdown]","fix":{"range":[3617,3619],"text":"[setActiveActionMenu, setShowCabangDropdown]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":281,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9128,9131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9128,9131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":310,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":310,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10084,10087],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10084,10087],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":637,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":637,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'vIndex' is defined but never used.","line":794,"column":82,"nodeType":null,"messageId":"unusedVar","endLine":794,"endColumn":88},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":983,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":983,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[51320,51323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[51320,51323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1283,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1283,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[68231,68234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[68231,68234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useEffect, useRef, useMemo, useCallback } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { initSocket, subscribe } from '@/lib/socket';\r\nimport { useStockStore } from '@/stores/useStockStore';\r\nimport type { Variant, Product } from '@/stores/useStockStore';\r\nimport { \r\n  Search, \r\n  Package,\r\n  AlertTriangle,\r\n  TrendingUp,\r\n  TrendingDown,\r\n  ChevronDown,\r\n  ChevronRight,\r\n  RefreshCw,\r\n  Download,\r\n  Building2,\r\n  Check,\r\n  X,\r\n  Eye,\r\n  Edit3,\r\n  ArrowRightLeft,\r\n  ArrowDownUp,\r\n  Bell,\r\n  History,\r\n  CheckCircle,\r\n  Clock,\r\n  Truck,\r\n  XCircle,\r\n  Plus,\r\n  Minus\r\n} from 'lucide-react';\r\n\r\nexport default function StockOverviewPage() {\r\n  const router = useRouter();\r\n  \r\n  // Store state & actions\r\n  const {\r\n    // State\r\n    products,\r\n    cabangs,\r\n    loading,\r\n    searchTerm,\r\n    selectedCabangs,\r\n    showLowStockOnly,\r\n    viewMode,\r\n    activeTab,\r\n    expandedProducts,\r\n    adjustmentHistory,\r\n    loadingHistory,\r\n    stockAlerts,\r\n    damagedCounts,\r\n    submitting,\r\n    adjustmentModal,\r\n    quickHistoryModal,\r\n    alertModal,\r\n    alertMinStock,\r\n    adjustmentForm,\r\n    showStockInModal,\r\n    stockInItems,\r\n    stockInLoading,\r\n    showCabangDropdown,\r\n    activeActionMenu,\r\n    adjustmentItems,\r\n    // Basic actions\r\n    setSearchTerm,\r\n    setShowLowStockOnly,\r\n    setViewMode,\r\n    setActiveTab,\r\n    toggleCabang,\r\n    selectAllCabangs,\r\n    clearAllCabangs,\r\n    toggleExpandProduct,\r\n    fetchData,\r\n    fetchHistory,\r\n    fetchStockAlerts: storeFetchStockAlerts,\r\n    // Modal actions\r\n    setAlertMinStock,\r\n    setAdjustmentForm,\r\n    setShowCabangDropdown,\r\n    setActiveActionMenu,\r\n    closeAdjustmentModal,\r\n    closeQuickHistoryModal,\r\n    closeAlertModal,\r\n    removeAdjustmentItem,\r\n    clearAdjustmentItems,\r\n    // Stock-In actions\r\n    openStockInModal,\r\n    addStockInItem,\r\n    removeStockInItem,\r\n    updateStockInItem,\r\n    searchSkuForStockIn,\r\n    submitStockIn,\r\n    setShowStockInModal,\r\n    setStockInItems,\r\n    // Adjustment actions\r\n    addCurrentItemToAdjustment,\r\n    submitAllAdjustments,\r\n    openQuickHistory,\r\n    openAdjustmentModal,\r\n    changeCabangInAdjustmentModal,\r\n    openHistoryForAllCabangs,\r\n    // Alert actions\r\n    openAlertModal,\r\n    changeAlertCabang,\r\n    submitAlert,\r\n    deleteAlert,\r\n  } = useStockStore();\r\n  \r\n  const cabangDropdownRef = useRef<HTMLDivElement>(null);\r\n  const actionMenuRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n    storeFetchStockAlerts();\r\n    \r\n    // Initialize socket connection\r\n    initSocket();\r\n    \r\n    // Subscribe to stock updates\r\n    const unsubscribe = subscribe('stock:updated', () => {\r\n      fetchData(); // Refresh data when stock changes\r\n    });\r\n    \r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, [fetchData, storeFetchStockAlerts]);\r\n\r\n  // Fetch history when switching to history tab\r\n  useEffect(() => {\r\n    if (activeTab === 'history') {\r\n      fetchHistory({});\r\n    }\r\n  }, [activeTab, fetchHistory]);\r\n\r\n  // Close dropdowns when clicking outside\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (cabangDropdownRef.current && !cabangDropdownRef.current.contains(event.target as Node)) {\r\n        setShowCabangDropdown(false);\r\n      }\r\n      if (actionMenuRef.current && !actionMenuRef.current.contains(event.target as Node)) {\r\n        setActiveActionMenu(null);\r\n      }\r\n    };\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, []);\r\n\r\n  const visibleCabangs = useMemo(() => cabangs.filter(c => selectedCabangs.has(c.id)), [cabangs, selectedCabangs]);\r\n\r\n  // Helper: check if variant has alert and is below threshold for specific cabang\r\n  const getAlertStatus = useCallback((variantId: string, cabangId: string, currentQty: number) => {\r\n    const key = `${variantId}-${cabangId}`;\r\n    const alert = stockAlerts.get(key);\r\n    if (!alert || !alert.isActive) return null;\r\n    \r\n    if (currentQty < alert.minStock) {\r\n      return { hasAlert: true, isLow: true, minStock: alert.minStock };\r\n    }\r\n    return { hasAlert: true, isLow: false, minStock: alert.minStock };\r\n  }, [stockAlerts]);\r\n\r\n  // Helper: check if variant has any low stock alert (across any cabang)\r\n  const isVariantLowStock = useCallback((variant: Variant) => {\r\n    return variant.stocks.some(stock => {\r\n      const key = `${variant.id}-${stock.cabang.id}`;\r\n      const alert = stockAlerts.get(key);\r\n      return alert?.isActive && stock.quantity < alert.minStock;\r\n    });\r\n  }, [stockAlerts]);\r\n\r\n  // Helper: check if product has any variant with low stock alert\r\n  const isProductLowStock = useCallback((product: Product) => {\r\n    return product.variants.some(variant => isVariantLowStock(variant));\r\n  }, [isVariantLowStock]);\r\n\r\n  // Helper: get stock summary for a product per cabang\r\n  const getProductStockByCabang = useCallback((product: Product, cabangId: string) => {\r\n    let totalQty = 0;\r\n    product.variants.forEach(variant => {\r\n      const stock = variant.stocks.find(s => s.cabang.id === cabangId);\r\n      totalQty += stock?.quantity || 0;\r\n    });\r\n    return totalQty;\r\n  }, []);\r\n\r\n  // Helper: get total stock for a product\r\n  const getProductTotalStock = useCallback((product: Product) => {\r\n    let total = 0;\r\n    product.variants.forEach(variant => {\r\n      variant.stocks.forEach(stock => {\r\n        total += stock.quantity;\r\n      });\r\n    });\r\n    return total;\r\n  }, []);\r\n\r\n  // Helper: get variant stock per cabang\r\n  const getVariantStockByCabang = useCallback((variant: Variant, cabangId: string) => {\r\n    const stock = variant.stocks.find(s => s.cabang.id === cabangId);\r\n    return stock?.quantity || 0;\r\n  }, []);\r\n\r\n  // Helper: get variant damaged count per cabang\r\n  const getVariantDamagedByCabang = useCallback((variantId: string, cabangId: string) => {\r\n    const key = `${variantId}-${cabangId}`;\r\n    return damagedCounts.get(key) || 0;\r\n  }, [damagedCounts]);\r\n\r\n  // Helper: get variant total damaged\r\n  const getVariantTotalDamaged = useCallback((variant: Variant) => {\r\n    return variant.stocks.reduce((sum, s) => {\r\n      const damaged = getVariantDamagedByCabang(variant.id, s.cabang.id);\r\n      return sum + damaged;\r\n    }, 0);\r\n  }, [getVariantDamagedByCabang]);\r\n\r\n  // Helper: get product total damaged (sum of all variants)\r\n  const getProductTotalDamaged = useCallback((product: Product) => {\r\n    return product.variants.reduce((sum, variant) => {\r\n      return sum + getVariantTotalDamaged(variant);\r\n    }, 0);\r\n  }, [getVariantTotalDamaged]);\r\n\r\n  // Helper: get variant total stock\r\n  const getVariantTotalStock = useCallback((variant: Variant) => {\r\n    return variant.stocks.reduce((sum, s) => sum + s.quantity, 0);\r\n  }, []);\r\n\r\n  // Filter products based on search - memoized\r\n  const filteredProducts = useMemo(() => products.filter(product => {\r\n    if (searchTerm) {\r\n      const search = searchTerm.toLowerCase();\r\n      const matchesSearch = \r\n        product.name.toLowerCase().includes(search) ||\r\n        product.category?.name?.toLowerCase().includes(search) ||\r\n        product.variants.some(v => \r\n          v.sku.toLowerCase().includes(search) ||\r\n          v.variantValue.toLowerCase().includes(search)\r\n        );\r\n      if (!matchesSearch) return false;\r\n    }\r\n\r\n    if (showLowStockOnly) {\r\n      // Only show products that have variants with active low stock alerts\r\n      if (!isProductLowStock(product)) return false;\r\n    }\r\n\r\n    return true;\r\n  }), [products, searchTerm, showLowStockOnly, isProductLowStock]);\r\n\r\n  // Summary calculations - memoized\r\n  const { totalProducts, totalVariants, totalStockUnits, lowStockCount, outOfStockCount } = useMemo(() => {\r\n    const totalProducts = filteredProducts.length;\r\n    const totalVariants = filteredProducts.reduce((sum, p) => sum + p.variants.length, 0);\r\n    const totalStockUnits = filteredProducts.reduce((sum, p) => sum + getProductTotalStock(p), 0);\r\n    // Count variants that have active alerts and are below threshold\r\n    const lowStockCount = filteredProducts.reduce((count, p) => {\r\n      return count + p.variants.filter(v => isVariantLowStock(v)).length;\r\n    }, 0);\r\n    const outOfStockCount = filteredProducts.reduce((count, p) => {\r\n      return count + p.variants.filter(v => getVariantTotalStock(v) === 0).length;\r\n    }, 0);\r\n    return { totalProducts, totalVariants, totalStockUnits, lowStockCount, outOfStockCount };\r\n  }, [filteredProducts, getProductTotalStock, getVariantTotalStock, isVariantLowStock]);\r\n\r\n  // Action handlers - thin wrappers for UI feedback\r\n  const handleViewDetail = (productId: string) => {\r\n    router.push(`/dashboard/products/${productId}`);\r\n    setActiveActionMenu(null);\r\n  };\r\n\r\n  const handleAdjustStock = (variant: Variant, productName: string) => {\r\n    const defaultCabangId = visibleCabangs[0]?.id || '';\r\n    openAdjustmentModal(variant, productName, defaultCabangId);\r\n  };\r\n\r\n  const handleStockInItemChange = async (index: number, field: string, value: any) => {\r\n    if (field === 'sku') {\r\n      await searchSkuForStockIn(index, value);\r\n    } else {\r\n      updateStockInItem(index, field, value);\r\n    }\r\n  };\r\n\r\n  const handleSubmitStockIn = async () => {\r\n    const result = await submitStockIn();\r\n    if (result === false) {\r\n      alert('Pastikan semua item sudah diisi: SKU valid, cabang terpilih, dan quantity > 0');\r\n    } else if (typeof result === 'object') {\r\n      if (result.failed > 0) {\r\n        alert(`Berhasil: ${result.success} item, Gagal: ${result.failed} item`);\r\n      } else {\r\n        alert(`Berhasil menambahkan stok untuk ${result.success} item`);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleSubmitAdjustment = async () => {\r\n    try {\r\n      const count = await submitAllAdjustments();\r\n      if (count === false) {\r\n        alert('Mohon tambahkan minimal satu item adjustment');\r\n      } else {\r\n        alert(`${count} adjustment berhasil disimpan!`);\r\n      }\r\n    } catch (error: any) {\r\n      alert(error.response?.data?.error || 'Gagal menyimpan adjustment');\r\n    }\r\n  };\r\n\r\n  const handleAddItem = () => {\r\n    if (!addCurrentItemToAdjustment()) {\r\n      alert('Lengkapi data item terlebih dahulu');\r\n    }\r\n  };\r\n\r\n  const handleTransferStock = (sku: string) => {\r\n    router.push(`/dashboard/stock/transfers?sku=${sku}`);\r\n    setActiveActionMenu(null);\r\n  };\r\n\r\n  const handleSetAlert = async (variant: Variant, productName: string) => {\r\n    await openAlertModal(variant, productName, visibleCabangs[0]?.id || '');\r\n  };\r\n  \r\n  const handleSubmitAlert = async () => {\r\n    alert((await submitAlert()).message);\r\n  };\r\n  \r\n  const handleDeleteAlert = async () => {\r\n    if (!confirm('Nonaktifkan alert untuk item ini?')) return;\r\n    alert((await deleteAlert()).message);\r\n  };\r\n\r\n  const handleViewHistory = async (variant: Variant, productName: string) => {\r\n    await openHistoryForAllCabangs(variant.id, variant.variantValue, productName);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-64\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6 px-4 md:px-6\">\r\n      {/* Breadcrumb + Action */}\r\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\r\n        <nav className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n          <a href=\"/dashboard\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Dashboard</a>\r\n          <span>ΓÇ║</span>\r\n          <span className=\"text-gray-900 dark:text-white font-medium\">Stock Overview</span>\r\n        </nav>\r\n        \r\n        <div className=\"flex items-center gap-2\">\r\n          <button\r\n            onClick={openStockInModal}\r\n            className=\"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 transition-all shadow-lg hover:shadow-xl font-medium\"\r\n          >\r\n            <ArrowDownUp className=\"w-4 h-4\" />\r\n            Stock In\r\n          </button>\r\n          <button\r\n            onClick={fetchData}\r\n            disabled={loading}\r\n            className=\"flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition disabled:opacity-50\"\r\n          >\r\n            <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\r\n            Refresh\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Summary Cards */}\r\n      <div className=\"grid grid-cols-2 md:grid-cols-5 gap-4\">\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg\">\r\n              <Package className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{totalProducts}</p>\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">Produk</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg\">\r\n              <TrendingUp className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{totalVariants}</p>\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">SKU</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg\">\r\n              <Package className=\"w-5 h-5 text-purple-600 dark:text-purple-400\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{totalStockUnits.toLocaleString()}</p>\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">Total Unit</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg\">\r\n              <AlertTriangle className=\"w-5 h-5 text-yellow-600 dark:text-yellow-400\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">{lowStockCount}</p>\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">Low Stock</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg\">\r\n              <TrendingDown className=\"w-5 h-5 text-red-600 dark:text-red-400\" />\r\n            </div>\r\n            <div>\r\n              <p className=\"text-2xl font-bold text-red-600 dark:text-red-400\">{outOfStockCount}</p>\r\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">Out of Stock</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Tab Navigation */}\r\n      <div className=\"flex gap-2 border-b border-gray-200 dark:border-gray-700\">\r\n        <button\r\n          onClick={() => setActiveTab('overview')}\r\n          className={`px-4 py-2 text-sm font-medium transition-colors relative ${\r\n            activeTab === 'overview'\r\n              ? 'text-blue-600 dark:text-blue-400'\r\n              : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'\r\n          }`}\r\n        >\r\n          Overview\r\n          {activeTab === 'overview' && (\r\n            <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600 dark:bg-blue-400\"></div>\r\n          )}\r\n        </button>\r\n        <button\r\n          onClick={() => setActiveTab('history')}\r\n          className={`px-4 py-2 text-sm font-medium transition-colors relative ${\r\n            activeTab === 'history'\r\n              ? 'text-blue-600 dark:text-blue-400'\r\n              : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'\r\n          }`}\r\n        >\r\n          Riwayat Adjustment\r\n          {activeTab === 'history' && (\r\n            <div className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600 dark:bg-blue-400\"></div>\r\n          )}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Filters & Actions */}\r\n      <div className=\"flex flex-col md:flex-row gap-4 items-start md:items-center justify-between\">\r\n        <div className=\"flex flex-wrap gap-3\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Cari produk, SKU...\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n              className=\"pl-10 pr-4 py-2 w-64 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"relative\" ref={cabangDropdownRef}>\r\n            <button\r\n              onClick={() => setShowCabangDropdown(!showCabangDropdown)}\r\n              className=\"px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-sm flex items-center gap-2 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors min-w-[180px]\"\r\n            >\r\n              <Building2 className=\"w-4 h-4 text-gray-400\" />\r\n              <span className=\"flex-1 text-left\">\r\n                {selectedCabangs.size === 0 \r\n                  ? 'Pilih Cabang' \r\n                  : selectedCabangs.size === cabangs.length \r\n                    ? 'Semua Cabang' \r\n                    : `${selectedCabangs.size} Cabang`}\r\n              </span>\r\n              <ChevronDown className={`w-4 h-4 text-gray-400 transition-transform ${showCabangDropdown ? 'rotate-180' : ''}`} />\r\n            </button>\r\n\r\n            {showCabangDropdown && (\r\n              <div className=\"absolute top-full left-0 mt-1 w-64 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50 overflow-hidden\">\r\n                <div className=\"px-3 py-2 bg-gray-50 dark:bg-gray-900/50 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between\">\r\n                  <span className=\"text-xs font-medium text-gray-500 dark:text-gray-400\">Pilih cabang untuk ditampilkan</span>\r\n                  <div className=\"flex gap-1\">\r\n                    <button onClick={selectAllCabangs} className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-xs text-blue-600 dark:text-blue-400\" title=\"Pilih Semua\">\r\n                      <Check className=\"w-3.5 h-3.5\" />\r\n                    </button>\r\n                    <button onClick={clearAllCabangs} className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-xs text-red-600 dark:text-red-400\" title=\"Hapus Semua\">\r\n                      <X className=\"w-3.5 h-3.5\" />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n                <div className=\"max-h-64 overflow-y-auto\">\r\n                  {cabangs.map(cabang => (\r\n                    <label key={cabang.id} className=\"flex items-center gap-3 px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer transition-colors\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={selectedCabangs.has(cabang.id)}\r\n                        onChange={() => toggleCabang(cabang.id)}\r\n                        className=\"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500 dark:bg-gray-700\"\r\n                      />\r\n                      <span className=\"text-sm text-gray-700 dark:text-gray-300\">{cabang.name}</span>\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n                <div className=\"px-3 py-2 bg-gray-50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700\">\r\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">{selectedCabangs.size} dari {cabangs.length} cabang dipilih</p>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <button\r\n            onClick={() => setShowLowStockOnly(!showLowStockOnly)}\r\n            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${\r\n              showLowStockOnly \r\n                ? 'bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400' \r\n                : 'bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300'\r\n            }`}\r\n          >\r\n            <AlertTriangle className=\"w-4 h-4\" />\r\n            Low Stock Only\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"flex gap-3\">\r\n          <div className=\"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-1\">\r\n            <button\r\n              onClick={() => setViewMode('simple')}\r\n              className={`px-3 py-1 rounded text-sm font-medium transition-colors ${\r\n                viewMode === 'simple' ? 'bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm' : 'text-gray-500 dark:text-gray-400'\r\n              }`}\r\n            >\r\n              Simple\r\n            </button>\r\n            <button\r\n              onClick={() => setViewMode('advanced')}\r\n              className={`px-3 py-1 rounded text-sm font-medium transition-colors ${\r\n                viewMode === 'advanced' ? 'bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm' : 'text-gray-500 dark:text-gray-400'\r\n              }`}\r\n            >\r\n              Advanced\r\n            </button>\r\n          </div>\r\n\r\n          <button onClick={fetchData} className=\"p-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\">\r\n            <RefreshCw className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />\r\n          </button>\r\n\r\n          <button className=\"px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2\">\r\n            <Download className=\"w-4 h-4\" />\r\n            Export\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content based on active tab */}\r\n      {activeTab === 'overview' ? (\r\n        <>\r\n      {/* Stock Table */}\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden\">\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"w-full text-sm\">\r\n            <thead>\r\n              <tr className=\"bg-gray-50 dark:bg-gray-900/50 border-b border-gray-200 dark:border-gray-700\">\r\n                <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider w-80\">Produk</th>\r\n                <th className=\"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Total</th>\r\n                {visibleCabangs.map(cabang => (\r\n                  <th key={cabang.id} className=\"px-3 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider border-l border-gray-200 dark:border-gray-700 whitespace-nowrap\">\r\n                    {cabang.name}\r\n                  </th>\r\n                ))}\r\n                {viewMode === 'advanced' && (\r\n                  <>\r\n                    <th className=\"px-3 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider border-l border-gray-200 dark:border-gray-700\">\r\n                      <div className=\"flex items-center justify-center gap-1\">\r\n                        <CheckCircle className=\"w-3.5 h-3.5 text-green-500\" />\r\n                        <span>Available</span>\r\n                      </div>\r\n                    </th>\r\n                    <th className=\"px-3 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                      <div className=\"flex items-center justify-center gap-1\">\r\n                        <Clock className=\"w-3.5 h-3.5 text-yellow-500\" />\r\n                        <span>Reserved</span>\r\n                      </div>\r\n                    </th>\r\n                    <th className=\"px-3 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                      <div className=\"flex items-center justify-center gap-1\">\r\n                        <Truck className=\"w-3.5 h-3.5 text-blue-500\" />\r\n                        <span>Transit</span>\r\n                      </div>\r\n                    </th>\r\n                    <th className=\"px-3 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                      <div className=\"flex items-center justify-center gap-1\">\r\n                        <XCircle className=\"w-3.5 h-3.5 text-red-500\" />\r\n                        <span>Damaged</span>\r\n                      </div>\r\n                    </th>\r\n                  </>\r\n                )}\r\n                <th className=\"px-3 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider border-l border-gray-200 dark:border-gray-700 w-12\"></th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"divide-y divide-gray-100 dark:divide-gray-700\">\r\n              {filteredProducts.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={viewMode === 'advanced' ? 6 + visibleCabangs.length : 3 + visibleCabangs.length} className=\"px-4 py-12 text-center text-gray-500 dark:text-gray-400\">\r\n                    <Package className=\"w-10 h-10 mx-auto mb-2 text-gray-300 dark:text-gray-600\" />\r\n                    <p className=\"text-sm\">Tidak ada data stock</p>\r\n                    {selectedCabangs.size === 0 && <p className=\"text-xs mt-1 text-gray-400\">Pilih minimal satu cabang</p>}\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                filteredProducts.map((product, index) => {\r\n                  const totalStock = getProductTotalStock(product);\r\n                  const isLowStock = isProductLowStock(product);\r\n                  const isOutOfStock = totalStock === 0;\r\n                  const variantCount = product.variants.length;\r\n                  const isExpanded = expandedProducts.has(product.id);\r\n                  const isSingle = product.productType === 'SINGLE';\r\n                  const firstVariant = product.variants[0];\r\n\r\n                  return (\r\n                    <React.Fragment key={product.id}>\r\n                      {/* Product Row */}\r\n                      <tr \r\n                        className={`hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors\r\n                          ${isOutOfStock ? 'bg-red-50/30 dark:bg-red-900/5' : ''}\r\n                          ${isLowStock ? 'bg-yellow-50/30 dark:bg-yellow-900/5' : ''}`}\r\n                      >\r\n                        <td className=\"px-4 py-2.5\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <div className=\"flex-shrink-0 w-8 h-8 bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-800 rounded flex items-center justify-center\">\r\n                              <span className=\"text-slate-600 dark:text-slate-300 font-bold text-sm\">\r\n                                {product.name.charAt(0).toUpperCase()}\r\n                              </span>\r\n                            </div>\r\n                            <div className=\"min-w-0 flex-1\">\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <button\r\n                                  onClick={() => router.push(`/dashboard/products/${product.id}`)}\r\n                                  className=\"text-sm font-medium text-gray-900 dark:text-white hover:text-slate-600 dark:hover:text-slate-400 transition-colors line-clamp-1 text-left\"\r\n                                >\r\n                                  {product.name}\r\n                                </button>\r\n                                {isSingle ? (\r\n                                  <span className=\"inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300\">\r\n                                    Tunggal\r\n                                  </span>\r\n                                ) : (\r\n                                  <button\r\n                                    onClick={() => toggleExpandProduct(product.id)}\r\n                                    className={`inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium transition-colors hover:ring-2 hover:ring-purple-300 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300`}\r\n                                  >\r\n                                    <ChevronRight className={`w-3 h-3 transition-transform ${isExpanded ? 'rotate-90' : ''}`} />\r\n                                    {variantCount} Varian\r\n                                  </button>\r\n                                )}\r\n                              </div>\r\n                              <div className=\"flex items-center gap-2 mt-0.5\">\r\n                                <span className=\"text-xs text-gray-400\">{product.category?.name || '-'}</span>\r\n                                {isSingle && firstVariant && (\r\n                                  <code className=\"text-[10px] font-mono bg-gray-100 dark:bg-gray-700 px-1 py-0.5 rounded text-gray-500 dark:text-gray-400\">{firstVariant.sku}</code>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </td>\r\n                        <td className=\"px-4 py-2.5 text-center\">\r\n                          <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold\r\n                            ${isOutOfStock ? 'bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400' : ''}\r\n                            ${isLowStock ? 'bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400' : ''}\r\n                            ${!isOutOfStock && !isLowStock ? 'text-gray-700 dark:text-gray-300' : ''}`}\r\n                          >\r\n                            {isLowStock && <AlertTriangle className=\"w-3 h-3\" />}\r\n                            {totalStock.toLocaleString()}\r\n                          </span>\r\n                        </td>\r\n                        {visibleCabangs.map(cabang => {\r\n                          const qty = getProductStockByCabang(product, cabang.id);\r\n                          // Check if any variant in this product has alert for this cabang\r\n                          const hasCabangAlert = product.variants.some(v => {\r\n                            const alertStatus = getAlertStatus(v.id, cabang.id, getVariantStockByCabang(v, cabang.id));\r\n                            return alertStatus?.isLow;\r\n                          });\r\n                          const cabangOut = qty === 0;\r\n                          return (\r\n                            <td key={cabang.id} className=\"px-3 py-2.5 text-center border-l border-gray-100 dark:border-gray-700\">\r\n                              <span className={`text-sm font-medium ${cabangOut ? 'text-red-500' : hasCabangAlert ? 'text-yellow-600' : 'text-gray-600 dark:text-gray-300'}`}>\r\n                                {qty.toLocaleString()}\r\n                              </span>\r\n                            </td>\r\n                          );\r\n                        })}\r\n                        {viewMode === 'advanced' && (\r\n                          <>\r\n                            <td className=\"px-3 py-2.5 text-center border-l border-gray-100 dark:border-gray-700\">\r\n                              <span className=\"text-sm text-green-600 dark:text-green-400\">{totalStock.toLocaleString()}</span>\r\n                            </td>\r\n                            <td className=\"px-3 py-2.5 text-center\">\r\n                              <span className=\"text-sm text-yellow-600 dark:text-yellow-400\">0</span>\r\n                            </td>\r\n                            <td className=\"px-3 py-2.5 text-center\">\r\n                              <span className=\"text-sm text-blue-600 dark:text-blue-400\">0</span>\r\n                            </td>\r\n                            <td className=\"px-3 py-2.5 text-center\">\r\n                              <span className=\"text-sm text-red-600 dark:text-red-400\">\r\n                                {getProductTotalDamaged(product).toLocaleString()}\r\n                              </span>\r\n                            </td>\r\n                          </>\r\n                        )}\r\n                        <td className=\"px-3 py-2.5 text-center border-l border-gray-100 dark:border-gray-700\">\r\n                          <div className=\"relative inline-block\" ref={activeActionMenu === product.id ? actionMenuRef : null}>\r\n                            <button \r\n                              onClick={() => setActiveActionMenu(activeActionMenu === product.id ? null : product.id)}\r\n                              className=\"p-1.5 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors\"\r\n                            >\r\n                              <ChevronDown className={`w-4 h-4 text-gray-500 transition-transform ${activeActionMenu === product.id ? 'rotate-180' : ''}`} />\r\n                            </button>\r\n                            \r\n                            {activeActionMenu === product.id && (\r\n                              <div className=\"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50 py-1\">\r\n                                <button\r\n                                  onClick={() => handleViewDetail(product.id)}\r\n                                  className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                                >\r\n                                  <Eye className=\"w-4 h-4\" />\r\n                                  Lihat Detail\r\n                                </button>\r\n                                {isSingle && firstVariant && (\r\n                                  <>\r\n                                    <button\r\n                                      onClick={() => handleAdjustStock(firstVariant, product.name)}\r\n                                      className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                                    >\r\n                                      <Edit3 className=\"w-4 h-4\" />\r\n                                      Adjustment\r\n                                    </button>\r\n                                    <button\r\n                                      onClick={() => handleTransferStock(firstVariant.sku)}\r\n                                      className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                                    >\r\n                                      <ArrowRightLeft className=\"w-4 h-4\" />\r\n                                      Transfer\r\n                                    </button>\r\n                                    <hr className=\"my-1 border-gray-200 dark:border-gray-700\" />\r\n                                    <button\r\n                                      onClick={() => handleSetAlert(firstVariant, product.name)}\r\n                                      className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                                    >\r\n                                      <Bell className=\"w-4 h-4\" />\r\n                                      Set Alert\r\n                                    </button>\r\n                                    <button\r\n                                      onClick={() => handleViewHistory(firstVariant, product.name)}\r\n                                      className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                                    >\r\n                                      <History className=\"w-4 h-4\" />\r\n                                      Riwayat Stock\r\n                                    </button>\r\n                                  </>\r\n                                )}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </td>\r\n                      </tr>\r\n\r\n                      {/* Variant Sub-rows */}\r\n                      {!isSingle && isExpanded && product.variants.map((variant, vIndex) => {\r\n                        const variantTotal = getVariantTotalStock(variant);\r\n                        const variantLow = isVariantLowStock(variant);\r\n                        const variantOut = variantTotal === 0;\r\n\r\n                        return (\r\n                          <tr \r\n                            key={`${product.id}-${variant.id}`}\r\n                            className=\"bg-purple-50/30 dark:bg-purple-900/10 border-l-4 border-purple-300 dark:border-purple-700\"\r\n                          >\r\n                            <td className=\"px-4 py-2 pl-14\">\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <ChevronRight className=\"w-3 h-3 text-purple-500 flex-shrink-0\" />\r\n                                <div className=\"min-w-0 flex-1\">\r\n                                  <div className=\"flex items-center gap-2\">\r\n                                    <span className=\"text-sm font-medium text-purple-700 dark:text-purple-400\">\r\n                                      {variant.variantValue}\r\n                                    </span>\r\n                                    <code className=\"text-[10px] font-mono bg-gray-100 dark:bg-gray-700 px-1 py-0.5 rounded text-gray-500 dark:text-gray-400\">{variant.sku}</code>\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            </td>\r\n                            <td className=\"px-4 py-2 text-center\">\r\n                              <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-semibold\r\n                                ${variantOut ? 'bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400' : ''}\r\n                                ${variantLow ? 'bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400' : ''}\r\n                                ${!variantOut && !variantLow ? 'text-gray-700 dark:text-gray-300' : ''}`}\r\n                              >\r\n                                {variantLow && <AlertTriangle className=\"w-3 h-3\" />}\r\n                                {variantTotal.toLocaleString()}\r\n                              </span>\r\n                            </td>\r\n                            {visibleCabangs.map(cabang => {\r\n                              const qty = getVariantStockByCabang(variant, cabang.id);\r\n                              const alertStatus = getAlertStatus(variant.id, cabang.id, qty);\r\n                              const cabangOut = qty === 0;\r\n                              const isAlertLow = alertStatus?.isLow;\r\n                              \r\n                              return (\r\n                                <td key={cabang.id} className=\"px-3 py-2 text-center border-l border-gray-100 dark:border-gray-700\">\r\n                                  <div className=\"flex flex-col items-center gap-0.5\">\r\n                                    <span className={`text-sm ${cabangOut ? 'text-red-500' : isAlertLow ? 'text-orange-600 dark:text-orange-400 font-semibold' : 'text-gray-600 dark:text-gray-300'}`}>\r\n                                      {qty.toLocaleString()}\r\n                                    </span>\r\n                                    {alertStatus?.hasAlert && (\r\n                                      <span className={`inline-flex items-center gap-0.5 px-1 py-0.5 rounded text-[9px] font-medium ${\r\n                                        isAlertLow \r\n                                          ? 'bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400'\r\n                                          : 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\r\n                                      }`}>\r\n                                        <Bell className=\"w-2.5 h-2.5\" />\r\n                                        {isAlertLow ? 'LOW' : `ΓëÑ${alertStatus.minStock}`}\r\n                                      </span>\r\n                                    )}\r\n                                  </div>\r\n                                </td>\r\n                              );\r\n                            })}\r\n                            {viewMode === 'advanced' && (\r\n                              <>\r\n                                <td className=\"px-3 py-2 text-center border-l border-gray-100 dark:border-gray-700\">\r\n                                  <span className=\"text-sm text-green-600 dark:text-green-400\">{variantTotal.toLocaleString()}</span>\r\n                                </td>\r\n                                <td className=\"px-3 py-2 text-center\">\r\n                                  <span className=\"text-sm text-yellow-600 dark:text-yellow-400\">0</span>\r\n                                </td>\r\n                                <td className=\"px-3 py-2 text-center\">\r\n                                  <span className=\"text-sm text-blue-600 dark:text-blue-400\">0</span>\r\n                                </td>\r\n                                <td className=\"px-3 py-2 text-center\">\r\n                                  <span className=\"text-sm text-red-600 dark:text-red-400\">{getVariantTotalDamaged(variant).toLocaleString()}</span>\r\n                                </td>\r\n                              </>\r\n                            )}\r\n                            <td className=\"px-3 py-2 text-center border-l border-gray-100 dark:border-gray-700\">\r\n                              <div className=\"relative inline-block\" ref={activeActionMenu === variant.id ? actionMenuRef : null}>\r\n                                <button \r\n                                  onClick={() => setActiveActionMenu(activeActionMenu === variant.id ? null : variant.id)}\r\n                                  className=\"p-1 hover:bg-purple-200 dark:hover:bg-purple-800/30 rounded transition-colors\"\r\n                                >\r\n                                  <ChevronDown className={`w-3.5 h-3.5 text-purple-500 transition-transform ${activeActionMenu === variant.id ? 'rotate-180' : ''}`} />\r\n                                </button>\r\n                                \r\n                                {activeActionMenu === variant.id && (\r\n                                  <div className=\"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50 py-1\">\r\n                                    <button\r\n                                      onClick={() => handleAdjustStock(variant, product.name)}\r\n                                      className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                                    >\r\n                                      <Edit3 className=\"w-4 h-4\" />\r\n                                      Adjustment\r\n                                    </button>\r\n                                    <button\r\n                                      onClick={() => handleTransferStock(variant.sku)}\r\n                                      className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                                    >\r\n                                      <ArrowRightLeft className=\"w-4 h-4\" />\r\n                                      Transfer\r\n                                    </button>\r\n                                    <button\r\n                                      onClick={() => openQuickHistory(variant.id, visibleCabangs[0]?.id || '', variant.variantValue, product.name)}\r\n                                      className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                                    >\r\n                                      <History className=\"w-4 h-4\" />\r\n                                      Riwayat\r\n                                    </button>\r\n                                    <hr className=\"my-1 border-gray-200 dark:border-gray-700\" />\r\n                                    <button\r\n                                      onClick={() => handleSetAlert(variant, product.name)}\r\n                                      className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\r\n                                    >\r\n                                      <Bell className=\"w-4 h-4\" />\r\n                                      Set Alert\r\n                                    </button>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            </td>\r\n                          </tr>\r\n                        );\r\n                      })}\r\n                    </React.Fragment>\r\n                  );\r\n                })\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n\r\n        <div className=\"px-4 py-3 bg-gray-50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between\">\r\n          <p className=\"text-sm text-gray-500 dark:text-gray-400\">Menampilkan {filteredProducts.length} produk ({totalVariants} SKU)</p>\r\n          <p className=\"text-sm text-gray-500 dark:text-gray-400\">Total Stock: <span className=\"font-semibold text-gray-900 dark:text-white\">{totalStockUnits.toLocaleString()}</span> unit</p>\r\n        </div>\r\n      </div>\r\n\r\n      {viewMode === 'advanced' && (\r\n        <div className=\"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4 border border-gray-200 dark:border-gray-700\">\r\n          <h4 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3\">Keterangan Status:</h4>\r\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <CheckCircle className=\"w-4 h-4 text-green-500\" />\r\n              <span className=\"text-gray-600 dark:text-gray-400\">Available - Siap dijual</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Clock className=\"w-4 h-4 text-yellow-500\" />\r\n              <span className=\"text-gray-600 dark:text-gray-400\">Reserved - Di-booking</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Truck className=\"w-4 h-4 text-blue-500\" />\r\n              <span className=\"text-gray-600 dark:text-gray-400\">Transit - Dalam perjalanan</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <XCircle className=\"w-4 h-4 text-red-500\" />\r\n              <span className=\"text-gray-600 dark:text-gray-400\">Damaged - Rusak/cacat (dari StockAdjustment)</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n        </>\r\n      ) : (\r\n        <>\r\n        {/* History Tab */}\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden\">\r\n          <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\r\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Riwayat Adjustment</h3>\r\n            <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">History semua adjustment stock</p>\r\n          </div>\r\n          \r\n          <div className=\"overflow-x-auto\">\r\n            {loadingHistory ? (\r\n              <div className=\"p-8 text-center text-gray-500 dark:text-gray-400\">Loading...</div>\r\n            ) : adjustmentHistory.length === 0 ? (\r\n              <div className=\"p-8 text-center text-gray-500 dark:text-gray-400\">Belum ada riwayat adjustment</div>\r\n            ) : (\r\n              <table className=\"w-full text-sm\">\r\n                <thead>\r\n                  <tr className=\"bg-gray-50 dark:bg-gray-900/50 border-b border-gray-200 dark:border-gray-700\">\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Tanggal</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Produk / SKU</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Cabang</th>\r\n                    <th className=\"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Sebelum</th>\r\n                    <th className=\"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Perubahan</th>\r\n                    <th className=\"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Sesudah</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Alasan</th>\r\n                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase\">Oleh</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\r\n                  {adjustmentHistory.map((adj: any) => (\r\n                    <tr key={adj.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50\">\r\n                      <td className=\"px-4 py-3 text-gray-900 dark:text-white whitespace-nowrap\">\r\n                        {new Date(adj.createdAt).toLocaleDateString('id-ID', { \r\n                          day: '2-digit', \r\n                          month: 'short', \r\n                          year: 'numeric',\r\n                          hour: '2-digit',\r\n                          minute: '2-digit'\r\n                        })}\r\n                      </td>\r\n                      <td className=\"px-4 py-3\">\r\n                        <div className=\"text-gray-900 dark:text-white font-medium\">{adj.productVariant?.product?.name}</div>\r\n                        <div className=\"text-xs text-gray-500 dark:text-gray-400\">{adj.productVariant?.name} ΓÇó {adj.productVariant?.sku}</div>\r\n                      </td>\r\n                      <td className=\"px-4 py-3 text-gray-700 dark:text-gray-300\">{adj.cabang?.name}</td>\r\n                      <td className=\"px-4 py-3 text-center text-gray-700 dark:text-gray-300\">{adj.previousQty}</td>\r\n                      <td className=\"px-4 py-3 text-center\">\r\n                        <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${\r\n                          adj.difference > 0 \r\n                            ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\r\n                            : 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400'\r\n                        }`}>\r\n                          {adj.difference > 0 ? '+' : ''}{adj.difference}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"px-4 py-3 text-center text-gray-900 dark:text-white font-medium\">{adj.newQty}</td>\r\n                      <td className=\"px-4 py-3\">\r\n                        <div className=\"text-gray-700 dark:text-gray-300\">{adj.reason}</div>\r\n                        {adj.notes && <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">{adj.notes}</div>}\r\n                      </td>\r\n                      <td className=\"px-4 py-3 text-gray-700 dark:text-gray-300\">{adj.adjustedBy?.name || '-'}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            )}\r\n          </div>\r\n          \r\n          <div className=\"px-4 py-3 bg-gray-50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700\">\r\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">Total: {adjustmentHistory.length} adjustment</p>\r\n          </div>\r\n        </div>\r\n        </>\r\n      )}\r\n\r\n      {/* Adjustment Modal */}\r\n      {adjustmentModal.isOpen && adjustmentModal.variant && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md overflow-hidden\">\r\n            {/* Header */}\r\n            <div className=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Stock Adjustment</h3>\r\n                <button\r\n                  onClick={closeAdjustmentModal}\r\n                  className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors\"\r\n                >\r\n                  <X className=\"w-5 h-5 text-gray-500\" />\r\n                </button>\r\n              </div>\r\n              <div className=\"mt-2\">\r\n                <p className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">{adjustmentModal.productName}</p>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                  {adjustmentModal.variant.variantValue !== 'Standard' && (\r\n                    <span className=\"text-purple-600 dark:text-purple-400\">{adjustmentModal.variant.variantValue} ΓÇó </span>\r\n                  )}\r\n                  SKU: {adjustmentModal.variant.sku}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Body */}\r\n            <div className=\"px-6 py-4 space-y-4\">\r\n              {/* Cabang Selection */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Cabang</label>\r\n                <select\r\n                  value={adjustmentModal.cabangId}\r\n                  onChange={(e) => changeCabangInAdjustmentModal(e.target.value)}\r\n                  className=\"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                >\r\n                  {visibleCabangs.map(cabang => (\r\n                    <option key={cabang.id} value={cabang.id}>{cabang.name}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              {/* Current Stock Display */}\r\n              <div className=\"bg-gray-100 dark:bg-gray-700/50 rounded-lg p-3\">\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Stock Saat Ini</p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{adjustmentModal.currentStock}</p>\r\n              </div>\r\n\r\n              {/* Adjustment Type */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Tipe Adjustment</label>\r\n                <div className=\"flex gap-2\">\r\n                  <button\r\n                    onClick={() => setAdjustmentForm(prev => ({ ...prev, type: 'add' }))}\r\n                    className={`flex-1 py-2 px-4 rounded-lg text-sm font-medium flex items-center justify-center gap-2 transition-colors ${\r\n                      adjustmentForm.type === 'add'\r\n                        ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 ring-2 ring-green-500'\r\n                        : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                    }`}\r\n                  >\r\n                    <Plus className=\"w-4 h-4\" />\r\n                    Tambah\r\n                  </button>\r\n                  <button\r\n                    onClick={() => setAdjustmentForm(prev => ({ ...prev, type: 'subtract' }))}\r\n                    className={`flex-1 py-2 px-4 rounded-lg text-sm font-medium flex items-center justify-center gap-2 transition-colors ${\r\n                      adjustmentForm.type === 'subtract'\r\n                        ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 ring-2 ring-red-500'\r\n                        : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600'\r\n                    }`}\r\n                  >\r\n                    <Minus className=\"w-4 h-4\" />\r\n                    Kurangi\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Quantity Input */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Jumlah</label>\r\n                <input\r\n                  type=\"text\"\r\n                  inputMode=\"numeric\"\r\n                  pattern=\"[0-9]*\"\r\n                  value={adjustmentForm.quantity > 0 ? String(adjustmentForm.quantity) : ''}\r\n                  onChange={(e) => {\r\n                    const value = e.target.value.replace(/[^0-9]/g, '');\r\n                    const num = value === '' ? 0 : parseInt(value, 10);\r\n                    setAdjustmentForm({ ...adjustmentForm, quantity: num });\r\n                  }}\r\n                  className=\"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  placeholder=\"Masukkan jumlah\"\r\n                />\r\n                {adjustmentForm.quantity > 0 && (\r\n                  <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\r\n                    Stock baru: <span className={`font-semibold ${adjustmentForm.type === 'add' ? 'text-green-600' : 'text-red-600'}`}>\r\n                      {adjustmentForm.type === 'add' \r\n                        ? adjustmentModal.currentStock + adjustmentForm.quantity \r\n                        : Math.max(0, adjustmentModal.currentStock - adjustmentForm.quantity)}\r\n                    </span>\r\n                  </p>\r\n                )}\r\n              </div>\r\n\r\n              {/* Reason Select */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Alasan <span className=\"text-red-500\">*</span></label>\r\n                <select\r\n                  value={adjustmentForm.reason}\r\n                  onChange={(e) => setAdjustmentForm(prev => ({ ...prev, reason: e.target.value }))}\r\n                  className=\"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                >\r\n                  <option value=\"\">Pilih alasan...</option>\r\n                  {adjustmentForm.type === 'add' ? (\r\n                    <>\r\n                      <option value=\"restock\">Restock / Barang Masuk</option>\r\n                      <option value=\"return\">Return dari Customer</option>\r\n                      <option value=\"found\">Barang Ditemukan</option>\r\n                      <option value=\"correction\">Koreksi Stock Opname</option>\r\n                      <option value=\"other_add\">Lainnya</option>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <option value=\"damaged\">Barang Rusak</option>\r\n                      <option value=\"expired\">Barang Kadaluarsa</option>\r\n                      <option value=\"lost\">Barang Hilang</option>\r\n                      <option value=\"sample\">Sample / Tester</option>\r\n                      <option value=\"correction\">Koreksi Stock Opname</option>\r\n                      <option value=\"other_subtract\">Lainnya</option>\r\n                    </>\r\n                  )}\r\n                </select>\r\n              </div>\r\n\r\n              {/* Notes */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Catatan</label>\r\n                <textarea\r\n                  value={adjustmentForm.notes}\r\n                  onChange={(e) => setAdjustmentForm(prev => ({ ...prev, notes: e.target.value }))}\r\n                  className=\"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\r\n                  rows={2}\r\n                  placeholder=\"Catatan tambahan (opsional)\"\r\n                />\r\n              </div>\r\n\r\n              {/* Add Item Button */}\r\n              <button\r\n                onClick={handleAddItem}\r\n                className=\"w-full py-2 px-4 bg-blue-50 dark:bg-blue-900/20 hover:bg-blue-100 dark:hover:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg text-sm font-medium flex items-center justify-center gap-2 transition-colors border border-blue-200 dark:border-blue-800\"\r\n              >\r\n                <Plus className=\"w-4 h-4\" />\r\n                Tambah ke List\r\n              </button>\r\n\r\n              {/* Items List */}\r\n              {adjustmentItems.length > 0 && (\r\n                <div className=\"mt-4\">\r\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                    Item yang akan di-adjust ({adjustmentItems.length})\r\n                  </label>\r\n                  <div className=\"space-y-2 max-h-48 overflow-y-auto\">\r\n                    {adjustmentItems.map((item) => (\r\n                      <div key={item.id} className=\"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600\">\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <p className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">{item.productName}</p>\r\n                          <p className=\"text-xs text-gray-500 dark:text-gray-400\">{item.variant.variantValue} ΓÇó {item.variant.sku}</p>\r\n                          <div className=\"flex items-center gap-2 mt-1\">\r\n                            <span className={`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium ${\r\n                              item.type === 'add' \r\n                                ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\r\n                                : 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400'\r\n                            }`}>\r\n                              {item.type === 'add' ? '+' : '-'}{item.quantity}\r\n                            </span>\r\n                            <span className=\"text-xs text-gray-500 dark:text-gray-400\">ΓÇó {item.reason}</span>\r\n                          </div>\r\n                        </div>\r\n                        <button\r\n                          onClick={() => removeAdjustmentItem(item.id)}\r\n                          className=\"p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded transition-colors\"\r\n                        >\r\n                          <X className=\"w-4 h-4 text-red-500\" />\r\n                        </button>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Footer */}\r\n            <div className=\"px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 flex justify-end gap-3\">\r\n              <button\r\n                onClick={() => {\r\n                  closeAdjustmentModal();\r\n                  clearAdjustmentItems();\r\n                }}\r\n                className=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors\"\r\n              >\r\n                Batal\r\n              </button>\r\n              <button\r\n                onClick={handleSubmitAdjustment}\r\n                disabled={submitting}\r\n                className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed rounded-lg transition-colors flex items-center gap-2\"\r\n              >\r\n                {submitting ? (\r\n                  <>\r\n                    <RefreshCw className=\"w-4 h-4 animate-spin\" />\r\n                    Menyimpan...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Check className=\"w-4 h-4\" />\r\n                    {adjustmentItems.length > 0 ? `Simpan ${adjustmentItems.length} Adjustment` : 'Simpan Adjustment'}\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Quick History Modal */}\r\n      {quickHistoryModal.isOpen && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden flex flex-col\">\r\n            {/* Header */}\r\n            <div className=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Riwayat Adjustment</h3>\r\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\r\n                    {quickHistoryModal.productName} ΓÇó {quickHistoryModal.variantName}\r\n                  </p>\r\n                </div>\r\n                <button\r\n                  onClick={closeQuickHistoryModal}\r\n                  className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors\"\r\n                >\r\n                  <X className=\"w-5 h-5 text-gray-500\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Body */}\r\n            <div className=\"flex-1 overflow-y-auto p-6\">\r\n              {loadingHistory ? (\r\n                <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">Loading...</div>\r\n              ) : adjustmentHistory.length === 0 ? (\r\n                <div className=\"text-center py-8 text-gray-500 dark:text-gray-400\">Belum ada riwayat adjustment untuk item ini</div>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {adjustmentHistory.map((adj: any) => (\r\n                    <div key={adj.id} className=\"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 border border-gray-200 dark:border-gray-600\">\r\n                      <div className=\"flex items-start justify-between\">\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm font-medium ${\r\n                              adj.difference > 0 \r\n                                ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\r\n                                : 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400'\r\n                            }`}>\r\n                              {adj.difference > 0 ? '+' : ''}{adj.difference}\r\n                            </span>\r\n                            <span className=\"text-sm text-gray-700 dark:text-gray-300\">\r\n                              {adj.previousQty} ΓåÆ {adj.newQty}\r\n                            </span>\r\n                          </div>\r\n                          <p className=\"text-sm font-medium text-gray-900 dark:text-white mt-2\">{adj.reason}</p>\r\n                          {adj.notes && <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">{adj.notes}</p>}\r\n                          <div className=\"flex items-center gap-3 mt-2 text-xs text-gray-500 dark:text-gray-400\">\r\n                            {adj.cabang && (\r\n                              <>\r\n                                <span className=\"inline-flex items-center gap-1 px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded-full font-medium\">\r\n                                  <Building2 className=\"w-3 h-3\" />\r\n                                  {adj.cabang.name}\r\n                                </span>\r\n                                <span>ΓÇó</span>\r\n                              </>\r\n                            )}\r\n                            <span>{adj.adjustedBy?.name || '-'}</span>\r\n                            <span>ΓÇó</span>\r\n                            <span>{new Date(adj.createdAt).toLocaleString('id-ID', { \r\n                              day: '2-digit', \r\n                              month: 'short', \r\n                              year: 'numeric',\r\n                              hour: '2-digit',\r\n                              minute: '2-digit'\r\n                            })}</span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Alert Modal */}\r\n      {alertModal.isOpen && alertModal.variant && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md overflow-hidden\">\r\n            {/* Header */}\r\n            <div className=\"px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Set Stock Alert</h3>\r\n                  {alertModal.existingAlert?.isActive && (\r\n                    <span className=\"inline-flex items-center gap-1 mt-1 px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs rounded-full\">\r\n                      <Bell className=\"w-3 h-3\" />\r\n                      Alert Aktif\r\n                    </span>\r\n                  )}\r\n                </div>\r\n                <button\r\n                  onClick={closeAlertModal}\r\n                  className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors\"\r\n                >\r\n                  <X className=\"w-5 h-5 text-gray-500\" />\r\n                </button>\r\n              </div>\r\n              <div className=\"mt-2\">\r\n                <p className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">{alertModal.productName}</p>\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                  {alertModal.variant.variantValue !== 'Standard' && (\r\n                    <span className=\"text-purple-600 dark:text-purple-400\">{alertModal.variant.variantValue} ΓÇó </span>\r\n                  )}\r\n                  SKU: {alertModal.variant.sku}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Body */}\r\n            <div className=\"px-6 py-4 space-y-4\">\r\n              {/* Cabang Selection */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Cabang</label>\r\n                <select\r\n                  value={alertModal.cabangId}\r\n                  onChange={(e) => changeAlertCabang(e.target.value)}\r\n                  className=\"w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                >\r\n                  {visibleCabangs.map(cabang => (\r\n                    <option key={cabang.id} value={cabang.id}>{cabang.name}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              {/* Current Stock Display */}\r\n              <div className=\"bg-gray-100 dark:bg-gray-700/50 rounded-lg p-3\">\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mb-1\">Stock Saat Ini</p>\r\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{alertModal.currentStock}</p>\r\n              </div>\r\n\r\n              {/* Minimum Stock Input */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Minimum Stock Alert\r\n                  <span className=\"text-xs text-gray-500 dark:text-gray-400 ml-2\">\r\n                    (Notifikasi muncul jika stock &lt; nilai ini)\r\n                  </span>\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type=\"number\"\r\n                    value={alertMinStock}\r\n                    onChange={(e) => setAlertMinStock(e.target.value)}\r\n                    min=\"0\"\r\n                    className=\"w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-lg font-semibold text-center focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    placeholder=\"0\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Info */}\r\n              <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3\">\r\n                <div className=\"flex gap-2\">\r\n                  <AlertTriangle className=\"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5\" />\r\n                  <div className=\"text-xs text-blue-700 dark:text-blue-300\">\r\n                    Alert akan muncul di dashboard jika stock mencapai atau di bawah <strong>{alertMinStock || 0}</strong> unit\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Existing Alert Info */}\r\n              {alertModal.existingAlert && (\r\n                <div className=\"text-xs text-gray-500 dark:text-gray-400 text-center\">\r\n                  Alert sebelumnya: {alertModal.existingAlert.minStock} unit\r\n                  {!alertModal.existingAlert.isActive && ' (Nonaktif)'}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Footer */}\r\n            <div className=\"px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 flex justify-between gap-3\">\r\n              {alertModal.existingAlert?.isActive && (\r\n                <button\r\n                  onClick={handleDeleteAlert}\r\n                  className=\"px-4 py-2 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors\"\r\n                >\r\n                  Nonaktifkan\r\n                </button>\r\n              )}\r\n              <div className=\"flex-1\"></div>\r\n              <button\r\n                onClick={closeAlertModal}\r\n                className=\"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors\"\r\n              >\r\n                Batal\r\n              </button>\r\n              <button\r\n                onClick={handleSubmitAlert}\r\n                className=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors flex items-center gap-2\"\r\n              >\r\n                <Check className=\"w-4 h-4\" />\r\n                Simpan Alert\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Stock In Modal */}\r\n      {showStockInModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\r\n            <div className=\"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-4 md:p-6 z-10\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center space-x-3\">\r\n                  <div className=\"flex items-center justify-center w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg\">\r\n                    <ArrowDownUp className=\"w-6 h-6 text-green-600 dark:text-green-400\" />\r\n                  </div>\r\n                  <div>\r\n                    <h2 className=\"text-xl md:text-2xl font-bold text-gray-900 dark:text-white\">Stock In - Barang Masuk</h2>\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">Tambah stok produk ke gudang</p>\r\n                  </div>\r\n                </div>\r\n                <button\r\n                  onClick={() => setShowStockInModal(false)}\r\n                  className=\"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\"\r\n                >\r\n                  <X className=\"w-6 h-6\" />\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"p-4 md:p-6\">\r\n              {/* Items List */}\r\n              <div className=\"space-y-4 mb-4\">\r\n                {stockInItems.map((item, index) => (\r\n                  <div key={index} className=\"bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4 border border-gray-200 dark:border-gray-600\">\r\n                    <div className=\"flex items-start justify-between mb-3\">\r\n                      <span className=\"inline-flex items-center justify-center w-6 h-6 bg-green-600 text-white text-xs font-bold rounded-full\">\r\n                        {index + 1}\r\n                      </span>\r\n                      {stockInItems.length > 1 && (\r\n                        <button\r\n                          onClick={() => removeStockInItem(index)}\r\n                          className=\"text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300\"\r\n                        >\r\n                          <X className=\"w-5 h-5\" />\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/* SKU Input - Primary Field */}\r\n                    <div className=\"mb-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg p-4 border-2 border-green-200 dark:border-green-800\">\r\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                        <span className=\"inline-flex items-center gap-2\">\r\n                          <Search className=\"w-4 h-4 text-green-600 dark:text-green-400\" />\r\n                          <span className=\"text-green-700 dark:text-green-300 font-semibold\">Input SKU / Scan Barcode</span>\r\n                          <span className=\"text-red-500\">*</span>\r\n                        </span>\r\n                      </label>\r\n                      <input\r\n                        type=\"text\"\r\n                        value={item.sku}\r\n                        onChange={(e) => handleStockInItemChange(index, 'sku', e.target.value)}\r\n                        placeholder=\"Ketik atau scan SKU barcode disini...\"\r\n                        className={`w-full px-4 py-3 border-2 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 text-sm font-mono tracking-wider placeholder:font-sans placeholder:tracking-normal ${\r\n                          item.skuError\r\n                            ? 'border-red-300 dark:border-red-700 focus:ring-red-500 focus:border-red-500'\r\n                            : 'border-green-300 dark:border-green-700 focus:ring-green-500 focus:border-green-500'\r\n                        }`}\r\n                        autoFocus={index === stockInItems.length - 1}\r\n                      />\r\n                      {item.skuError ? (\r\n                        <p className=\"mt-2 text-xs text-red-600 dark:text-red-400 flex items-center gap-1\">\r\n                          <AlertTriangle className=\"w-3.5 h-3.5\" />\r\n                          {item.skuError}\r\n                        </p>\r\n                      ) : (\r\n                        <p className=\"mt-2 text-xs text-gray-500 dark:text-gray-400\">\r\n                          Produk dan varian akan otomatis terdeteksi setelah input SKU\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/* Auto-filled Product Info Display */}\r\n                    {item.productName && (\r\n                      <div className=\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\r\n                        <div className=\"flex items-start gap-2\">\r\n                          <CheckCircle className=\"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5\" />\r\n                          <div className=\"flex-1\">\r\n                            <p className=\"text-sm font-semibold text-blue-900 dark:text-blue-100\">{item.productName}</p>\r\n                            <p className=\"text-xs text-blue-700 dark:text-blue-300 mt-0.5\">{item.variantName}</p>\r\n                            <p className=\"text-xs text-blue-600 dark:text-blue-400 mt-1 font-mono\">SKU: {item.sku}</p>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                      {/* Quantity */}\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                          Jumlah <span className=\"text-red-500\">*</span>\r\n                        </label>\r\n                        <input\r\n                          type=\"text\"\r\n                          inputMode=\"numeric\"\r\n                          value={item.quantity ? item.quantity.toLocaleString('id-ID') : ''}\r\n                          onChange={(e) => {\r\n                            const value = e.target.value.replace(/\\D/g, '');\r\n                            handleStockInItemChange(index, 'quantity', parseInt(value) || 0);\r\n                          }}\r\n                          placeholder=\"0\"\r\n                          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm\"\r\n                        />\r\n                      </div>\r\n\r\n                      {/* Cabang Selection */}\r\n                      <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                          Cabang Tujuan <span className=\"text-red-500\">*</span>\r\n                        </label>\r\n                        <select\r\n                          value={item.cabangId}\r\n                          onChange={(e) => handleStockInItemChange(index, 'cabangId', e.target.value)}\r\n                          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm\"\r\n                        >\r\n                          <option value=\"\">-- Pilih Cabang --</option>\r\n                          {cabangs.map(cabang => (\r\n                            <option key={cabang.id} value={cabang.id}>\r\n                              {cabang.name}\r\n                            </option>\r\n                          ))}\r\n                        </select>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              {/* Add Item Button */}\r\n              <button\r\n                onClick={addStockInItem}\r\n                className=\"w-full py-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-gray-600 dark:text-gray-400 hover:border-green-500 hover:text-green-600 dark:hover:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/10 transition-all font-medium text-sm\"\r\n              >\r\n                <span className=\"inline-flex items-center\">\r\n                  <Plus className=\"w-5 h-5 mr-2\" />\r\n                  Tambah Item\r\n                </span>\r\n              </button>\r\n\r\n              {/* Action Buttons */}\r\n              <div className=\"flex gap-3 mt-6 pt-6 border-t border-gray-200 dark:border-gray-700\">\r\n                <button\r\n                  onClick={() => setShowStockInModal(false)}\r\n                  disabled={stockInLoading}\r\n                  className=\"flex-1 px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-semibold hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50\"\r\n                >\r\n                  Batal\r\n                </button>\r\n                <button\r\n                  onClick={handleSubmitStockIn}\r\n                  disabled={stockInLoading || stockInItems.length === 0}\r\n                  className=\"flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all disabled:opacity-50 disabled:transform-none\"\r\n                >\r\n                  {stockInLoading ? (\r\n                    <span className=\"flex items-center justify-center\">\r\n                      <RefreshCw className=\"animate-spin h-5 w-5 mr-2\" />\r\n                      Menyimpan...\r\n                    </span>\r\n                  ) : (\r\n                    <span className=\"flex items-center justify-center\">\r\n                      <Check className=\"w-5 h-5 mr-2\" />\r\n                      Simpan Stock In\r\n                    </span>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\transactions\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\transactions\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RefreshCw' is defined but never used.","line":5,"column":62,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":71},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonFilterBar' is defined but never used.","line":7,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":42},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1036,1039],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1036,1039],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10941,10944],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10941,10944],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect } from 'react';\r\nimport { useFilterStore } from '@/stores/useFilterStore';\r\nimport { Search, Store, ShoppingBag, Globe, Package, X, Eye, RefreshCw } from 'lucide-react';\r\nimport { useTransactionsStore, type Channel } from './useTransactionsStore';\r\nimport { SkeletonTable, SkeletonFilterBar } from '@/components/ui/Skeleton';\r\n\r\nconst STATUS_CONFIG: Record<string, { label: string; bg: string }> = {\r\n  PENDING: { label: 'Menunggu', bg: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400' },\r\n  ONPROCESS: { label: 'Diproses', bg: 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400' },\r\n  SHIPPED: { label: 'Dikirim', bg: 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400' },\r\n  COMPLETED: { label: 'Selesai', bg: 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400' },\r\n  CANCELLED: { label: 'Dibatalkan', bg: 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400' },\r\n};\r\n\r\nconst CHANNEL_ICONS: Record<string, any> = {\r\n  POS: Store, MARKETPLACE: ShoppingBag, WEBSITE: Globe, SOCIAL: Package, OTHER: Package,\r\n};\r\n\r\nexport default function TransactionsPage() {\r\n  const {\r\n    transactions,\r\n    channels,\r\n    loading,\r\n    selectedTx,\r\n    setSelectedTx,\r\n    fetchChannels,\r\n    fetchTransactions,\r\n  } = useTransactionsStore();\r\n  \r\n  // Use filter store for shared filter state\r\n  const {\r\n    search,\r\n    startDate,\r\n    endDate,\r\n    selectedChannel,\r\n    selectedStatus,\r\n    setSearch,\r\n    setStartDate,\r\n    setEndDate,\r\n    setSelectedChannel,\r\n    setSelectedStatus,\r\n  } = useFilterStore();\r\n\r\n  useEffect(() => {\r\n    fetchChannels();\r\n  }, [fetchChannels]);\r\n\r\n  useEffect(() => {\r\n    fetchTransactions();\r\n  }, [startDate, endDate, selectedChannel, selectedStatus, search, fetchTransactions]);\r\n\r\n  const getIcon = (ch?: Channel) => CHANNEL_ICONS[ch?.type || 'POS'] || Store;\r\n  const getColor = (ch?: Channel) => ch?.color || '#3B82F6';\r\n\r\n  return (\r\n    <div className=\"px-4 md:px-6 pb-6 space-y-6\">\r\n      {/* Breadcrumb */}\r\n      <nav className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\r\n        <a href=\"/dashboard\" className=\"hover:text-gray-900 dark:hover:text-white transition\">Dashboard</a>\r\n        <span>ΓÇ║</span>\r\n        <span className=\"text-gray-900 dark:text-white font-medium\">Transaksi</span>\r\n      </nav>\r\n\r\n      {/* Channel Quick Filters */}\r\n      <div className=\"flex flex-wrap gap-2 mb-4\">\r\n        <button\r\n          onClick={() => setSelectedChannel('')}\r\n          className={`px-3 py-1.5 text-sm font-medium rounded-lg ${!selectedChannel ? 'bg-blue-600 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'}`}\r\n        >\r\n          Semua\r\n        </button>\r\n        {channels.map((ch) => {\r\n          const Icon = getIcon(ch);\r\n          return (\r\n            <button\r\n              key={ch.id}\r\n              onClick={() => setSelectedChannel(selectedChannel === ch.id ? '' : ch.id)}\r\n              className={`flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium rounded-lg ${selectedChannel === ch.id ? 'text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300'}`}\r\n              style={{ backgroundColor: selectedChannel === ch.id ? getColor(ch) : undefined }}\r\n            >\r\n              <Icon className=\"w-4 h-4\" /> {ch.name}\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 mb-6\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-5 gap-3\">\r\n          <div className=\"md:col-span-2 relative\">\r\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Cari invoice atau pelanggan...\"\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n              className=\"w-full pl-9 pr-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n            />\r\n          </div>\r\n          <input type=\"date\" value={startDate} onChange={(e) => setStartDate(e.target.value)} className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\" />\r\n          <input type=\"date\" value={endDate} onChange={(e) => setEndDate(e.target.value)} className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\" />\r\n          <select value={selectedStatus} onChange={(e) => setSelectedStatus(e.target.value)} className=\"px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\">\r\n            <option value=\"\">Semua Status</option>\r\n            {Object.entries(STATUS_CONFIG).map(([k, v]) => <option key={k} value={k}>{v.label}</option>)}\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Table */}\r\n      {loading ? (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden\">\r\n          <SkeletonTable rows={8} columns={7} />\r\n        </div>\r\n      ) : transactions.length === 0 ? (\r\n        <div className=\"text-center py-12 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700\">\r\n          <Package className=\"w-12 h-12 mx-auto text-gray-400 mb-2\" />\r\n          <p className=\"text-gray-500\">Tidak ada transaksi</p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden\">\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full text-sm\">\r\n              <thead className=\"bg-gray-50 dark:bg-gray-700/50 text-gray-500 dark:text-gray-400\">\r\n                <tr>\r\n                  <th className=\"px-4 py-3 text-left font-medium\">Channel</th>\r\n                  <th className=\"px-4 py-3 text-left font-medium\">Invoice</th>\r\n                  <th className=\"px-4 py-3 text-left font-medium\">Tanggal</th>\r\n                  <th className=\"px-4 py-3 text-left font-medium\">Pelanggan</th>\r\n                  <th className=\"px-4 py-3 text-left font-medium\">Total</th>\r\n                  <th className=\"px-4 py-3 text-left font-medium\">Status</th>\r\n                  <th className=\"px-4 py-3 text-left font-medium\"></th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\r\n                {transactions.map((tx) => {\r\n                  const Icon = getIcon(tx.channel);\r\n                  const st = STATUS_CONFIG[tx.status] || STATUS_CONFIG.PENDING;\r\n                  return (\r\n                    <tr key={tx.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50\">\r\n                      <td className=\"px-4 py-3\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <div className=\"p-1.5 rounded\" style={{ backgroundColor: `${getColor(tx.channel)}20` }}>\r\n                            <Icon className=\"w-4 h-4\" style={{ color: getColor(tx.channel) }} />\r\n                          </div>\r\n                          <span className=\"font-medium text-gray-900 dark:text-white\">{tx.channel?.name || 'POS'}</span>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"px-4 py-3 font-mono text-gray-900 dark:text-white\">{tx.transactionNo}</td>\r\n                      <td className=\"px-4 py-3 text-gray-600 dark:text-gray-400\">\r\n                        {new Date(tx.createdAt).toLocaleDateString('id-ID')}\r\n                      </td>\r\n                      <td className=\"px-4 py-3 text-gray-900 dark:text-white\">{tx.customerName || tx.buyerUsername || '-'}</td>\r\n                      <td className=\"px-4 py-3 font-semibold text-gray-900 dark:text-white\">Rp {tx.total.toLocaleString('id-ID')}</td>\r\n                      <td className=\"px-4 py-3\">\r\n                        <span className={`px-2 py-1 text-xs font-medium rounded-full ${st.bg}`}>{st.label}</span>\r\n                      </td>\r\n                      <td className=\"px-4 py-3\">\r\n                        <button onClick={() => setSelectedTx(tx)} className=\"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded\">\r\n                          <Eye className=\"w-4 h-4\" />\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Detail Modal */}\r\n      {selectedTx && (\r\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl max-w-lg w-full max-h-[80vh] overflow-y-auto\">\r\n            <div className=\"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center\">\r\n              <h2 className=\"text-lg font-bold text-gray-900 dark:text-white\">Detail Transaksi</h2>\r\n              <button onClick={() => setSelectedTx(null)} className=\"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"><X className=\"w-5 h-5\" /></button>\r\n            </div>\r\n            <div className=\"p-4 space-y-4\">\r\n              <div className=\"grid grid-cols-2 gap-3 text-sm\">\r\n                <div><span className=\"text-gray-500\">Invoice:</span><p className=\"font-mono font-semibold text-gray-900 dark:text-white\">{selectedTx.transactionNo}</p></div>\r\n                <div><span className=\"text-gray-500\">Channel:</span><p className=\"font-semibold text-gray-900 dark:text-white\">{selectedTx.channel?.name || 'POS'}</p></div>\r\n                <div><span className=\"text-gray-500\">Tanggal:</span><p className=\"font-semibold text-gray-900 dark:text-white\">{new Date(selectedTx.createdAt).toLocaleString('id-ID')}</p></div>\r\n                <div><span className=\"text-gray-500\">Status:</span><span className={`px-2 py-0.5 text-xs rounded-full ${STATUS_CONFIG[selectedTx.status]?.bg}`}>{STATUS_CONFIG[selectedTx.status]?.label}</span></div>\r\n                <div><span className=\"text-gray-500\">Pelanggan:</span><p className=\"font-semibold text-gray-900 dark:text-white\">{selectedTx.customerName || selectedTx.buyerUsername || '-'}</p></div>\r\n                <div><span className=\"text-gray-500\">Cabang:</span><p className=\"font-semibold text-gray-900 dark:text-white\">{selectedTx.cabang?.name}</p></div>\r\n              </div>\r\n              <div>\r\n                <h3 className=\"text-sm font-semibold text-gray-900 dark:text-white mb-2\">Items</h3>\r\n                <div className=\"space-y-2\">\r\n                  {selectedTx.items?.map((item: any) => (\r\n                    <div key={item.id} className=\"flex justify-between p-2 bg-gray-50 dark:bg-gray-700/50 rounded text-sm\">\r\n                      <div><p className=\"font-medium text-gray-900 dark:text-white\">{item.productName}</p><p className=\"text-xs text-gray-500\">{item.variantInfo}</p></div>\r\n                      <div className=\"text-right\"><p className=\"text-gray-500\">{item.quantity} x Rp {item.price.toLocaleString()}</p><p className=\"font-semibold text-gray-900 dark:text-white\">Rp {item.subtotal.toLocaleString()}</p></div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n              <div className=\"border-t pt-3 text-sm\">\r\n                <div className=\"flex justify-between font-bold text-base\"><span>Total</span><span className=\"text-blue-600\">Rp {selectedTx.total.toLocaleString('id-ID')}</span></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\transactions\\useTransactionsStore.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2149,2152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2149,2152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { useTransactionsStore } from './useTransactionsStore';\r\n\r\n// Mock API\r\nvi.mock('@/lib/api', () => ({\r\n  transactionsAPI: {\r\n    getTransactions: vi.fn().mockResolvedValue({ \r\n      data: [\r\n        {\r\n          id: 'tx1',\r\n          transactionNo: 'TRX-001',\r\n          status: 'COMPLETED',\r\n          cabang: { id: 'c1', name: 'Cabang 1' },\r\n          kasir: { id: 'u1', name: 'Kasir 1' },\r\n          total: 100000,\r\n          shippingCost: 0,\r\n          items: [],\r\n          createdAt: '2024-01-01T00:00:00Z'\r\n        }\r\n      ]\r\n    }),\r\n  },\r\n  channelsAPI: {\r\n    getChannels: vi.fn().mockResolvedValue({ \r\n      data: [\r\n        { id: 'ch1', code: 'POS', name: 'Point of Sale', type: 'OFFLINE', color: null }\r\n      ]\r\n    }),\r\n  },\r\n}));\r\n\r\n// Mock filter store\r\nvi.mock('@/stores/useFilterStore', () => ({\r\n  useFilterStore: {\r\n    getState: vi.fn().mockReturnValue({\r\n      search: '',\r\n      startDate: null,\r\n      endDate: null,\r\n      selectedChannel: '',\r\n      selectedStatus: '',\r\n    }),\r\n  },\r\n}));\r\n\r\ndescribe('useTransactionsStore', () => {\r\n  beforeEach(() => {\r\n    useTransactionsStore.setState({\r\n      transactions: [],\r\n      channels: [],\r\n      loading: true,\r\n      selectedTx: null,\r\n    });\r\n  });\r\n\r\n  it('should initialize with default state', () => {\r\n    const state = useTransactionsStore.getState();\r\n    expect(state.transactions).toEqual([]);\r\n    expect(state.channels).toEqual([]);\r\n    expect(state.loading).toBe(true);\r\n    expect(state.selectedTx).toBeNull();\r\n  });\r\n\r\n  it('should set selected transaction', () => {\r\n    const tx = {\r\n      id: 'tx1',\r\n      transactionNo: 'TRX-001',\r\n      status: 'COMPLETED',\r\n      cabang: { id: 'c1', name: 'Cabang 1' },\r\n      total: 100000,\r\n      shippingCost: 0,\r\n      items: [],\r\n      createdAt: '2024-01-01T00:00:00Z'\r\n    };\r\n    \r\n    useTransactionsStore.getState().setSelectedTx(tx);\r\n    expect(useTransactionsStore.getState().selectedTx).toEqual(tx);\r\n  });\r\n\r\n  it('should clear selected transaction', () => {\r\n    useTransactionsStore.setState({ selectedTx: { id: 'tx1' } as any });\r\n    useTransactionsStore.getState().setSelectedTx(null);\r\n    expect(useTransactionsStore.getState().selectedTx).toBeNull();\r\n  });\r\n\r\n  it('should fetch channels', async () => {\r\n    await useTransactionsStore.getState().fetchChannels();\r\n    const state = useTransactionsStore.getState();\r\n    expect(state.channels).toHaveLength(1);\r\n    expect(state.channels[0].code).toBe('POS');\r\n  });\r\n\r\n  it('should fetch transactions', async () => {\r\n    await useTransactionsStore.getState().fetchTransactions();\r\n    const state = useTransactionsStore.getState();\r\n    expect(state.transactions).toHaveLength(1);\r\n    expect(state.transactions[0].transactionNo).toBe('TRX-001');\r\n    expect(state.loading).toBe(false);\r\n  });\r\n\r\n  it('should set loading false after fetch completes', async () => {\r\n    useTransactionsStore.setState({ loading: true });\r\n    await useTransactionsStore.getState().fetchTransactions();\r\n    expect(useTransactionsStore.getState().loading).toBe(false);\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\transactions\\useTransactionsStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[689,692],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[689,692],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { create } from 'zustand';\r\nimport { transactionsAPI, channelsAPI } from '@/lib/api';\r\nimport { useFilterStore } from '@/stores/useFilterStore';\r\n\r\n// ============ Types ============\r\nexport interface Channel {\r\n  id: string;\r\n  code: string;\r\n  name: string;\r\n  type: string;\r\n  color: string | null;\r\n}\r\n\r\nexport interface Transaction {\r\n  id: string;\r\n  transactionNo: string;\r\n  status: string;\r\n  cabang: { id: string; name: string };\r\n  kasir?: { id: string; name: string };\r\n  channel?: Channel;\r\n  customerName?: string;\r\n  buyerUsername?: string;\r\n  total: number;\r\n  shippingCost: number;\r\n  externalOrderId?: string;\r\n  paymentMethod?: string;\r\n  items: any[];\r\n  createdAt: string;\r\n}\r\n\r\n// ============ State Interface ============\r\ninterface TransactionsState {\r\n  // Data\r\n  transactions: Transaction[];\r\n  channels: Channel[];\r\n  loading: boolean;\r\n  selectedTx: Transaction | null;\r\n  \r\n  // Actions\r\n  setSelectedTx: (tx: Transaction | null) => void;\r\n  fetchChannels: () => Promise<void>;\r\n  fetchTransactions: () => Promise<void>;\r\n}\r\n\r\n// ============ Store ============\r\nexport const useTransactionsStore = create<TransactionsState>((set) => ({\r\n  // Data\r\n  transactions: [],\r\n  channels: [],\r\n  loading: true,\r\n  selectedTx: null,\r\n  \r\n  // Actions\r\n  setSelectedTx: (tx) => set({ selectedTx: tx }),\r\n  \r\n  fetchChannels: async () => {\r\n    try {\r\n      const res = await channelsAPI.getChannels();\r\n      // Handle both direct array and paginated response\r\n      const channelsData = Array.isArray(res.data) ? res.data : (res.data?.data || []);\r\n      set({ channels: channelsData });\r\n    } catch (error) {\r\n      console.error('Error fetching channels:', error);\r\n      set({ channels: [] });\r\n    }\r\n  },\r\n  \r\n  fetchTransactions: async () => {\r\n    const { search, startDate, endDate, selectedChannel, selectedStatus } = useFilterStore.getState();\r\n    \r\n    set({ loading: true });\r\n    try {\r\n      const res = await transactionsAPI.getTransactions({\r\n        startDate: startDate || undefined,\r\n        endDate: endDate || undefined,\r\n        channelId: selectedChannel || undefined,\r\n        status: selectedStatus || undefined,\r\n        search: search || undefined,\r\n      });\r\n      // Handle paginated response format from backend\r\n      const transactionsData = res.data?.data || res.data || [];\r\n      set({ transactions: Array.isArray(transactionsData) ? transactionsData : [] });\r\n    } catch (error) {\r\n      console.error('Error fetching transactions:', error);\r\n      set({ transactions: [] });\r\n    } finally {\r\n      set({ loading: false });\r\n    }\r\n  },\r\n}));\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\users\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\dashboard\\users\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\faq\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\forgot-password\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1448,1451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1448,1451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport { Mail, ArrowLeft, CheckCircle } from 'lucide-react';\r\nimport { api } from '@/lib/api';\r\nimport emailjs from '@emailjs/browser';\r\nimport { EMAILJS_CONFIG } from '@/lib/emailjs.config';\r\n\r\nexport default function ForgotPasswordPage() {\r\n  const [email, setEmail] = useState('');\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isSubmitted, setIsSubmitted] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n    setError('');\r\n\r\n    try {\r\n      // Request reset token from backend\r\n      const response = await api.post('/auth/forgot-password', { email });\r\n      const data = response.data;\r\n\r\n      if (data.success && data.resetData) {\r\n        // Generate reset link\r\n        const resetLink = `${window.location.origin}/reset-password?token=${data.resetData.token}`;\r\n\r\n        // Send email via EmailJS\r\n        await emailjs.send(\r\n          EMAILJS_CONFIG.SERVICE_ID,\r\n          EMAILJS_CONFIG.FORGOT_PASSWORD_TEMPLATE_ID,\r\n          {\r\n            to_email: data.resetData.email,\r\n            name: data.resetData.name,\r\n            link: resetLink,\r\n          },\r\n          EMAILJS_CONFIG.PUBLIC_KEY\r\n        );\r\n      }\r\n\r\n      setIsSubmitted(true);\r\n    } catch (err: any) {\r\n      // Still show success to prevent email enumeration\r\n      if (err.response?.status === 400 || err.response?.status === 404) {\r\n        setIsSubmitted(true);\r\n      } else {\r\n        setError('Terjadi kesalahan. Silakan coba lagi.');\r\n      }\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950 flex flex-col\">\r\n      {/* Logo Header */}\r\n      <div className=\"pt-8 pb-4 flex justify-center\">\r\n        <Link href=\"/\" className=\"flex items-center\">\r\n          <Image\r\n            src=\"/images/logo.png\"\r\n            alt=\"Pelaris\"\r\n            width={150}\r\n            height={40}            \r\n            style={{ width: 'auto', height: 'auto' }}\r\n            priority\r\n          />\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Form Card */}\r\n      <div className=\"flex-1 flex items-start justify-center px-4 py-8\">\r\n        <div className=\"w-full max-w-md\">\r\n          <div className=\"bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-800 p-8\">\r\n            {isSubmitted ? (\r\n              /* Success State */\r\n              <div className=\"text-center py-6\">\r\n                <div className=\"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                  <CheckCircle className=\"w-8 h-8 text-green-600 dark:text-green-400\" />\r\n                </div>\r\n                <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-2\">\r\n                  Email Terkirim!\r\n                </h1>\r\n                <p className=\"text-slate-500 dark:text-slate-400 mb-6\">\r\n                  Kami telah mengirimkan link reset password ke <strong className=\"text-slate-700 dark:text-slate-300\">{email}</strong>. \r\n                  Silakan cek inbox atau folder spam Anda.\r\n                </p>\r\n                <p className=\"text-sm text-slate-500 dark:text-slate-400 mb-6\">\r\n                  Link akan kadaluarsa dalam 1 jam.\r\n                </p>\r\n                <Link\r\n                  href=\"/login\"\r\n                  className=\"inline-flex items-center gap-2 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors\"\r\n                >\r\n                  <ArrowLeft className=\"w-4 h-4\" />\r\n                  Kembali ke halaman login\r\n                </Link>\r\n              </div>\r\n            ) : (\r\n              /* Form State */\r\n              <>\r\n                <div className=\"text-center mb-8\">\r\n                  <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-2\">\r\n                    Lupa Kata Sandi?\r\n                  </h1>\r\n                  <p className=\"text-slate-500 dark:text-slate-400\">\r\n                    Masukkan email Anda dan kami akan mengirimkan link untuk reset password.\r\n                  </p>\r\n                </div>\r\n\r\n                {error && (\r\n                  <div className=\"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\r\n                    <p className=\"text-red-600 dark:text-red-400 text-sm\">{error}</p>\r\n                  </div>\r\n                )}\r\n\r\n                <form onSubmit={handleSubmit} className=\"space-y-5\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\r\n                      Alamat Email\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                      <input\r\n                        type=\"email\"\r\n                        value={email}\r\n                        onChange={(e) => setEmail(e.target.value)}\r\n                        placeholder=\"nama@email.com\"\r\n                        required\r\n                        className=\"w-full px-4 py-3 pr-12 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all\"\r\n                      />\r\n                      <Mail className=\"absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400\" />\r\n                    </div>\r\n                  </div>\r\n\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={isSubmitting}\r\n                    className=\"w-full py-3.5 bg-slate-600 hover:bg-slate-700 disabled:bg-slate-600/50 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2\"\r\n                  >\r\n                    {isSubmitting ? (\r\n                      <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                    ) : (\r\n                      'Kirim Link Reset'\r\n                    )}\r\n                  </button>\r\n                </form>\r\n\r\n                <div className=\"mt-6 text-center\">\r\n                  <Link\r\n                    href=\"/login\"\r\n                    className=\"inline-flex items-center gap-2 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors\"\r\n                  >\r\n                    <ArrowLeft className=\"w-4 h-4\" />\r\n                    Kembali ke halaman login\r\n                  </Link>\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setError' is assigned a value but never used.","line":39,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getFieldError' is assigned a value but never used.","line":40,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2105,2108],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2105,2108],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":73,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":73,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useRef, useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport { Mail, Eye, EyeOff, ArrowRight } from 'lucide-react';\r\nimport { authAPI } from '@/lib/api';\r\nimport { setAuth, clearAuth, getAuth } from '@/lib/auth';\r\nimport { useZodForm } from '@/hooks/useZodForm';\r\nimport { loginSchema, type LoginInput } from '@/lib/validations';\r\n\r\nexport default function LoginPage() {\r\n  const router = useRouter();\r\n  const isSubmitting = useRef(false);\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [isCheckingAuth, setIsCheckingAuth] = useState(true);\r\n\r\n  // Check if already logged in - redirect to appropriate page\r\n  useEffect(() => {\r\n    const { token, user } = getAuth();\r\n    if (token && user) {\r\n      // Already logged in, redirect based on role\r\n      if (user.role === 'KASIR') {\r\n        router.replace('/pos');\r\n      } else {\r\n        router.replace('/dashboard');\r\n      }\r\n    } else {\r\n      setIsCheckingAuth(false);\r\n    }\r\n  }, [router]);\r\n\r\n  const {\r\n    register,\r\n    onSubmit,\r\n    isSubmitting: loading,\r\n    submitError: error,\r\n    setSubmitError: setError,\r\n    getFieldError,\r\n    formState: { errors },\r\n  } = useZodForm<LoginInput>({\r\n    schema: loginSchema,\r\n    defaultValues: { email: '', password: '' },\r\n    onSubmit: async (data) => {\r\n      // Prevent double submit\r\n      if (isSubmitting.current) return;\r\n      isSubmitting.current = true;\r\n\r\n      try {\r\n        const response = await authAPI.login(data.email, data.password);\r\n        const { token, user, csrfToken } = response.data;\r\n        \r\n        // Clear old auth first\r\n        clearAuth();\r\n        \r\n        // Save to sessionStorage (CSRF token will be stored in memory via setAuth)\r\n        setAuth(token, user, csrfToken);\r\n        \r\n        // KASIR hanya bisa akses POS, role lain ke dashboard\r\n        if (user.role === 'KASIR') {\r\n          router.push('/pos');\r\n        } else {\r\n          router.push('/dashboard');\r\n        }\r\n      } catch (err: any) {\r\n        const errorMsg = err.response?.data?.error || 'Email atau password salah. Silakan coba lagi.';\r\n        throw new Error(errorMsg);\r\n      } finally {\r\n        isSubmitting.current = false;\r\n      }\r\n    },\r\n    onError: (err) => {\r\n      isSubmitting.current = false;\r\n    },\r\n  });\r\n\r\n  // Show loading while checking auth\r\n  if (isCheckingAuth) {\r\n    return (\r\n      <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950 flex items-center justify-center\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-slate-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950 flex flex-col\">\r\n      {/* Logo Header */}\r\n      <div className=\"pt-8 pb-4 flex justify-center\">\r\n        <Link href=\"/\" className=\"flex items-center\">\r\n          <Image\r\n            src=\"/images/logo.png\"\r\n            alt=\"Pelaris\"\r\n            width={250}\r\n            height={68}\r\n            className=\"h-14\"\r\n            style={{ width: 'auto' }}\r\n            priority\r\n          />\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Form Card */}\r\n      <div className=\"flex-1 flex items-start justify-center px-4 py-8\">\r\n        <div className=\"w-full max-w-md\">\r\n          <div className=\"bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-800 p-8\">\r\n            {/* Header */}\r\n            <div className=\"text-center mb-8\">\r\n              <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-2\">\r\n                Selamat Datang\r\n              </h1>\r\n              <p className=\"text-slate-500 dark:text-slate-400\">\r\n                Masuk untuk mengelola bisnis Anda\r\n              </p>\r\n            </div>\r\n\r\n            {/* Error Message */}\r\n            {error && (\r\n              <div className=\"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\r\n                <p className=\"text-red-600 dark:text-red-400 text-sm\">{error}</p>\r\n              </div>\r\n            )}\r\n\r\n            {/* Login Form */}\r\n            <form onSubmit={onSubmit} className=\"space-y-5\">\r\n              {/* Email */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\r\n                  Alamat Email\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type=\"email\"\r\n                    {...register('email')}\r\n                    autoComplete=\"email\"\r\n                    placeholder=\"nama@email.com\"\r\n                    disabled={loading}\r\n                    className=\"w-full px-4 py-3 pr-12 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all disabled:opacity-50\"\r\n                  />\r\n                  <Mail className=\"absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400\" />\r\n                </div>\r\n                {errors.email && (\r\n                  <p className=\"mt-1.5 text-sm text-red-600 dark:text-red-400\">{errors.email.message}</p>\r\n                )}\r\n              </div>\r\n\r\n              {/* Password */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\r\n                  Kata Sandi\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type={showPassword ? 'text' : 'password'}\r\n                    {...register('password')}\r\n                    autoComplete=\"current-password\"\r\n                    placeholder=\"Masukkan kata sandi\"\r\n                    disabled={loading}\r\n                    className=\"w-full px-4 py-3 pr-12 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all disabled:opacity-50\"\r\n                  />\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowPassword(!showPassword)}\r\n                    className=\"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300\"\r\n                  >\r\n                    {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\r\n                  </button>\r\n                </div>\r\n                {errors.password && (\r\n                  <p className=\"mt-1.5 text-sm text-red-600 dark:text-red-400\">{errors.password.message}</p>\r\n                )}\r\n              </div>\r\n\r\n              {/* Forgot Password Link */}\r\n              <div className=\"text-right\">\r\n                <Link \r\n                  href=\"/forgot-password\" \r\n                  className=\"text-sm text-slate-600 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300\"\r\n                >\r\n                  Lupa Kata Sandi?\r\n                </Link>\r\n              </div>\r\n\r\n              {/* Submit Button */}\r\n              <button\r\n                type=\"submit\"\r\n                disabled={loading}\r\n                className=\"w-full py-3.5 bg-slate-600 hover:bg-slate-700 disabled:bg-slate-600/50 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2\"\r\n              >\r\n                {loading ? (\r\n                  <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                ) : (\r\n                  <>\r\n                    Masuk Sekarang\r\n                    <ArrowRight className=\"w-5 h-5\" />\r\n                  </>\r\n                )}\r\n              </button>\r\n            </form>\r\n\r\n            {/* Divider */}\r\n            <div className=\"relative my-6\">\r\n              <div className=\"absolute inset-0 flex items-center\">\r\n                <div className=\"w-full border-t border-slate-200 dark:border-slate-700\"></div>\r\n              </div>\r\n              <div className=\"relative flex justify-center text-sm\">\r\n                <span className=\"px-4 bg-white dark:bg-slate-900 text-slate-500\">\r\n                  Atau masuk dengan\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Google Button */}\r\n            <button\r\n              type=\"button\"\r\n              disabled\r\n              className=\"w-full py-3 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-700 dark:text-slate-300 font-medium hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors flex items-center justify-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\r\n                <path\r\n                  fill=\"#4285F4\"\r\n                  d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\r\n                />\r\n                <path\r\n                  fill=\"#34A853\"\r\n                  d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\r\n                />\r\n                <path\r\n                  fill=\"#FBBC05\"\r\n                  d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\r\n                />\r\n                <path\r\n                  fill=\"#EA4335\"\r\n                  d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\r\n                />\r\n              </svg>\r\n              Google\r\n            </button>\r\n          </div>\r\n\r\n          {/* Register Link */}\r\n          <p className=\"mt-8 text-center text-slate-600 dark:text-slate-400\">\r\n            Belum punya akun Pelaris?{' '}\r\n            <Link href=\"/register\" className=\"text-slate-600 font-medium hover:underline dark:text-slate-300\">\r\n              Daftar di sini\r\n            </Link>\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\not-found.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Search' is defined but never used.","line":5,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport { Home, ArrowLeft, Search } from 'lucide-react';\r\n\r\nexport default function NotFound() {\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950 flex flex-col\">\r\n      {/* Logo Header */}\r\n      <div className=\"pt-8 pb-4 flex justify-center\">\r\n        <Link href=\"/\" className=\"flex items-center\">\r\n          <Image\r\n            src=\"/images/logo.png\"\r\n            alt=\"Pelaris\"\r\n            width={150}\r\n            height={40}            \r\n            style={{ width: 'auto', height: 'auto' }}\r\n          />\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"flex-1 flex items-center justify-center px-4 py-8\">\r\n        <div className=\"text-center max-w-md\">\r\n          {/* 404 Number */}\r\n          <div className=\"mb-8\">\r\n            <span className=\"text-8xl md:text-9xl font-bold text-slate-200 dark:text-slate-800\">\r\n              404\r\n            </span>\r\n          </div>\r\n\r\n          {/* Message */}\r\n          <h1 className=\"text-2xl md:text-3xl font-bold text-slate-900 dark:text-white mb-4\">\r\n            Halaman Tidak Ditemukan\r\n          </h1>\r\n          <p className=\"text-slate-600 dark:text-slate-400 mb-8\">\r\n            Maaf, halaman yang Anda cari tidak ada atau mungkin telah dipindahkan. \r\n            Pastikan URL yang Anda masukkan sudah benar.\r\n          </p>\r\n\r\n          {/* Actions */}\r\n          <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\r\n            <Link\r\n              href=\"/\"\r\n              className=\"inline-flex items-center justify-center gap-2 px-6 py-3 bg-slate-600 hover:bg-slate-700 text-white rounded-lg font-medium transition-colors\"\r\n            >\r\n              <Home className=\"w-5 h-5\" />\r\n              Ke Beranda\r\n            </Link>\r\n            <button\r\n              onClick={() => window.history.back()}\r\n              className=\"inline-flex items-center justify-center gap-2 px-6 py-3 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg font-medium transition-colors\"\r\n            >\r\n              <ArrowLeft className=\"w-5 h-5\" />\r\n              Kembali\r\n            </button>\r\n          </div>\r\n\r\n          {/* Helpful Links */}\r\n          <div className=\"mt-12 pt-8 border-t border-slate-200 dark:border-slate-800\">\r\n            <p className=\"text-sm text-slate-500 dark:text-slate-400 mb-4\">\r\n              Mungkin Anda mencari:\r\n            </p>\r\n            <div className=\"flex flex-wrap justify-center gap-4 text-sm\">\r\n              <Link href=\"/login\" className=\"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:underline\">\r\n                Login\r\n              </Link>\r\n              <Link href=\"/register\" className=\"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:underline\">\r\n                Daftar\r\n              </Link>\r\n              <Link href=\"/faq\" className=\"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:underline\">\r\n                FAQ\r\n              </Link>\r\n              <Link href=\"/contact\" className=\"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:underline\">\r\n                Kontak\r\n              </Link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\pos\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1525,1528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1525,1528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'theme' is assigned a value but never used.","line":56,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'toggleTheme' is assigned a value but never used.","line":56,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":29},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'isMobile'. Either include it or remove the dependency array.","line":292,"column":6,"nodeType":"ArrayExpression","endLine":292,"endColumn":68,"suggestions":[{"desc":"Update the dependencies array to be: [showSuccess, cart.length, closeSuccessModal, setCashReceived, isMobile]","fix":{"range":[9391,9453],"text":"[showSuccess, cart.length, closeSuccessModal, setCashReceived, isMobile]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":302,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9791,9794],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9791,9794],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":390,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":390,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12896,12899],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12896,12899],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":393,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":393,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13051,13054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13051,13054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":394,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":394,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13109,13112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13109,13112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":403,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":403,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13504,13507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13504,13507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":417,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":417,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14183,14186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14183,14186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":417,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":417,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14197,14200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14197,14200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":419,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":419,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14306,14309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14306,14309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":477,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":477,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15857,15860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15857,15860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":522,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":522,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17224,17227],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17224,17227],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":544,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":544,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18275,18278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18275,18278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":568,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":568,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18865,18868],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18865,18868],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":614,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":614,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20718,20721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20718,20721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":678,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":678,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23017,23020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23017,23020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":724,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":724,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24635,24638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24635,24638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":744,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":744,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25431,25434],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25431,25434],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":17,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState, useRef, useCallback } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { API_BASE_URL } from '@/lib/api';\r\nimport { getAuth, clearAuth } from '@/lib/auth';\r\nimport { useTheme } from '@/contexts/ThemeContext';\r\nimport { useToast } from '@/components/ui/Toast';\r\nimport { useCartStore, useCheckoutStore, useProductStore } from '@/stores';\r\nimport { useProductSocket } from '@/hooks/useProductSocket';\r\nimport { logger } from '@/lib/logger';\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogContent,\r\n  AlertDialogHeader,\r\n  AlertDialogFooter,\r\n  AlertDialogTitle,\r\n  AlertDialogDescription,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n} from '@/components/ui/AlertDialog';\r\nimport { connectQZ, printReceipt, isQZAvailable, PrintReceiptOptions } from '@/lib/qz-print';\r\nimport TransactionHistory from '@/components/TransactionHistory';\r\nimport { useOfflineQueueStore } from '@/stores/useOfflineQueueStore';\r\nimport { getOfflineCacheService } from '@/lib/offlineCache';\r\nimport { transactionsAPI } from '@/lib/api';\r\n\r\n// Import POS components\r\nimport {\r\n  POSHeader,\r\n  POSProductGrid,\r\n  POSCart,\r\n  POSSuccessModal,\r\n  POSHoldModal,\r\n  POSRequestProductModal,\r\n  POSMobileBlock,\r\n  ConfirmState,\r\n  PrinterSettings,\r\n} from '@/components/pos';\r\n\r\n// Detect if device is phone (not tablet or desktop)\r\nfunction isPhoneDevice(): boolean {\r\n  if (typeof window === 'undefined') return false;\r\n  \r\n  const userAgent = navigator.userAgent || navigator.vendor || (window as any).opera;\r\n  const isPhone = /iPhone|iPod|Android.*Mobile|webOS|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);\r\n  const isTablet = /iPad|Android(?!.*Mobile)|Tablet/i.test(userAgent);\r\n  const isSmallScreen = window.innerWidth < 768;\r\n  \r\n  return (isPhone || isSmallScreen) && !isTablet;\r\n}\r\n\r\nexport default function POSPage() {\r\n  const router = useRouter();\r\n  const toast = useToast();\r\n  const { theme, toggleTheme } = useTheme();\r\n  const { user } = getAuth();\r\n  \r\n  // Zustand stores\r\n  const {\r\n    cart,\r\n    heldTransactions,\r\n    addToCart,\r\n    updateQuantity,\r\n    removeFromCart,\r\n    clearCart,\r\n    holdTransaction,\r\n    retrieveHeld,\r\n    deleteHeld,\r\n    updateItemStock,\r\n    getSubtotal,\r\n    getTotal,\r\n    getDiscountAmount,\r\n  } = useCartStore();\r\n  \r\n  const {\r\n    customerName,\r\n    customerPhone,\r\n    paymentMethod,\r\n    cashReceived,\r\n    bankName,\r\n    referenceNo,\r\n    discount,\r\n    discountType,\r\n    showCustomerInfo,\r\n    showDiscount,\r\n    processing,\r\n    lastTransaction,\r\n    lastCashReceived,\r\n    showSuccess,\r\n    setCustomerName,\r\n    setCustomerPhone,\r\n    setPaymentMethod,\r\n    setCashReceived,\r\n    setBankName,\r\n    setReferenceNo,\r\n    setDiscount,\r\n    setDiscountType,\r\n    setShowCustomerInfo,\r\n    setShowDiscount,\r\n    setProcessing,\r\n    setTransactionSuccess,\r\n    closeSuccessModal,\r\n    resetCheckout,\r\n  } = useCheckoutStore();\r\n\r\n  const {\r\n    products,\r\n    branches,\r\n    categories,\r\n    selectedCabangId,\r\n    search,\r\n    loading,\r\n    adminWhatsApp,\r\n    setSelectedCabangId,\r\n    setSearch,\r\n    setLoading,\r\n    fetchProducts: fetchProductsStore,\r\n    fetchBranches,\r\n    fetchCategories,\r\n    fetchSettings,\r\n    updateProduct,\r\n    deleteProduct: deleteProductStore,\r\n    updateStock,\r\n    getFilteredProducts,\r\n  } = useProductStore();\r\n\r\n  // Calculated values from stores\r\n  const filteredProducts = getFilteredProducts();\r\n  const subtotal = getSubtotal();\r\n  const discountAmount = getDiscountAmount(discount, discountType);\r\n  const total = getTotal(discount, discountType);\r\n\r\n  // Local UI states\r\n  const [isMobile, setIsMobile] = useState(false);\r\n  const [showHoldModal, setShowHoldModal] = useState(false);\r\n  const [showCloseConfirm, setShowCloseConfirm] = useState(false);\r\n  const [userMenuOpen, setUserMenuOpen] = useState(false);\r\n  const [showBranchDropdown, setShowBranchDropdown] = useState(false);\r\n  const [showHistory, setShowHistory] = useState(false);\r\n  const [showRequestProductModal, setShowRequestProductModal] = useState(false);\r\n  const [newProduct, setNewProduct] = useState({\r\n    name: '',\r\n    categoryId: '',\r\n    productType: 'SINGLE' as 'SINGLE' | 'VARIANT',\r\n  });\r\n  const [requestProductLoading, setRequestProductLoading] = useState(false);\r\n  \r\n  // Printer settings\r\n  const [printerSettings, setPrinterSettings] = useState<PrinterSettings | null>(null);\r\n  const [qzConnected, setQzConnected] = useState(false);\r\n  const [printing, setPrinting] = useState(false);\r\n  \r\n  // Generic confirm dialog state\r\n  const [confirmDialog, setConfirmDialog] = useState<ConfirmState>({\r\n    open: false,\r\n    title: '',\r\n    description: '',\r\n    onConfirm: () => {},\r\n  });\r\n\r\n  const searchInputRef = useRef<HTMLInputElement>(null);\r\n  const posContainerRef = useRef<HTMLDivElement>(null);\r\n  const cashInputRef = useRef<HTMLInputElement>(null);\r\n  \r\n  // Offline queue store\r\n  const {\r\n    isOnline,\r\n    initialize: initializeOfflineQueue,\r\n    queueTransaction,\r\n    isInitialized: isOfflineInitialized,\r\n  } = useOfflineQueueStore();\r\n\r\n  // Redirect to login if not authenticated\r\n  useEffect(() => {\r\n    const { token } = getAuth();\r\n    if (!token) {\r\n      router.push('/login');\r\n    }\r\n  }, [router]);\r\n\r\n  // Check if phone device\r\n  useEffect(() => {\r\n    const checkPhone = isPhoneDevice();\r\n    setIsMobile(checkPhone);\r\n    if (checkPhone) {\r\n      setLoading(false);\r\n    }\r\n  }, [setLoading]);\r\n\r\n  // Initialize offline queue service\r\n  useEffect(() => {\r\n    if (!isOfflineInitialized) {\r\n      initializeOfflineQueue();\r\n    }\r\n  }, [isOfflineInitialized, initializeOfflineQueue]);\r\n\r\n  // Helper functions\r\n  const showConfirm = useCallback((options: Omit<ConfirmState, 'open'>) => {\r\n    setConfirmDialog({ ...options, open: true });\r\n  }, []);\r\n\r\n  const closeConfirm = useCallback(() => {\r\n    setConfirmDialog(prev => ({ ...prev, open: false }));\r\n  }, []);\r\n\r\n  const getEffectiveCabangId = useCallback(() => {\r\n    if (user?.role === 'KASIR') {\r\n      return user?.cabangId;\r\n    }\r\n    return selectedCabangId || localStorage.getItem('activeCabangId') || user?.cabangId;\r\n  }, [user?.role, user?.cabangId, selectedCabangId]);\r\n\r\n  // Focus trap\r\n  useEffect(() => {\r\n    if (isMobile) return;\r\n    \r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (showSuccess || showHoldModal || showCloseConfirm || confirmDialog.open) return;\r\n      \r\n      if (e.key === 'Tab' && posContainerRef.current) {\r\n        const focusableElements = posContainerRef.current.querySelectorAll<HTMLElement>(\r\n          'input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]):not([tabindex=\"-1\"]), [tabindex]:not([tabindex=\"-1\"]):not([disabled])'\r\n        );\r\n        \r\n        if (focusableElements.length === 0) return;\r\n        \r\n        const firstElement = focusableElements[0];\r\n        const lastElement = focusableElements[focusableElements.length - 1];\r\n        \r\n        if (e.shiftKey && document.activeElement === firstElement) {\r\n          e.preventDefault();\r\n          lastElement.focus();\r\n        } else if (!e.shiftKey && document.activeElement === lastElement) {\r\n          e.preventDefault();\r\n          firstElement.focus();\r\n        } else if (!posContainerRef.current.contains(document.activeElement)) {\r\n          e.preventDefault();\r\n          firstElement.focus();\r\n        }\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [isMobile, showSuccess, showHoldModal, showCloseConfirm, confirmDialog.open]);\r\n\r\n  // Auto-focus search on mount\r\n  useEffect(() => {\r\n    if (isMobile) return;\r\n    searchInputRef.current?.focus();\r\n  }, [isMobile]);\r\n\r\n  // Keyboard shortcuts\r\n  useEffect(() => {\r\n    if (isMobile) return;\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      const isSearchFocused = document.activeElement === searchInputRef.current;\r\n      const isCashInputFocused = document.activeElement === cashInputRef.current;\r\n      \r\n      if (e.key === 'Escape') {\r\n        e.preventDefault();\r\n        if (showSuccess) closeSuccessModal();\r\n        searchInputRef.current?.focus();\r\n        return;\r\n      }\r\n\r\n      const searchValue = searchInputRef.current?.value || '';\r\n      const shouldTriggerNumpad = cart.length > 0 && \r\n                                   (!isSearchFocused || searchValue === '') && \r\n                                   !isCashInputFocused;\r\n      \r\n      if (shouldTriggerNumpad) {\r\n        const numpadKeys = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '.', ','];\r\n        if (numpadKeys.includes(e.key)) {\r\n          e.preventDefault();\r\n          cashInputRef.current?.focus();\r\n          const currentVal = cashInputRef.current?.value || '';\r\n          const newVal = currentVal + (e.key === ',' ? '.' : e.key);\r\n          setCashReceived(parseFloat(newVal.replace(/\\./g, '')) || 0);\r\n        }\r\n      }\r\n\r\n      if ((e.key === 'Enter' || e.key === 'NumpadEnter') && isCashInputFocused && cart.length > 0) {\r\n        e.preventDefault();\r\n        const processBtn = document.querySelector('[data-process-payment]') as HTMLButtonElement;\r\n        processBtn?.click();\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [showSuccess, cart.length, closeSuccessModal, setCashReceived]);\r\n\r\n  // Fetch branches for Owner/Manager\r\n  useEffect(() => {\r\n    const initBranches = async () => {\r\n      if (user?.role === 'KASIR') return;\r\n      \r\n      const activeBranches = await fetchBranches();\r\n      \r\n      const savedCabangId = localStorage.getItem('activeCabangId');\r\n      if (savedCabangId && activeBranches.some((b: any) => b.id === savedCabangId)) {\r\n        setSelectedCabangId(savedCabangId);\r\n      } else if (user?.cabangId) {\r\n        setSelectedCabangId(user.cabangId);\r\n      } else if (activeBranches.length > 0) {\r\n        setSelectedCabangId(activeBranches[0].id);\r\n      }\r\n    };\r\n    \r\n    initBranches();\r\n  }, [user?.role, user?.cabangId, fetchBranches, setSelectedCabangId]);\r\n\r\n  // Fetch products when cabang changes\r\n  useEffect(() => {\r\n    const effectiveCabangId = getEffectiveCabangId();\r\n    if (effectiveCabangId || user?.role === 'KASIR') {\r\n      fetchProductsStore(effectiveCabangId || '');\r\n      fetchSettings();\r\n      fetchCategories();\r\n    }\r\n  }, [selectedCabangId, user?.role, user?.cabangId, fetchProductsStore, fetchSettings, fetchCategories, getEffectiveCabangId]);\r\n\r\n  // beforeunload warning\r\n  useEffect(() => {\r\n    const handleBeforeUnload = (e: BeforeUnloadEvent) => {\r\n      if (cart.length > 0) {\r\n        e.preventDefault();\r\n        e.returnValue = '';\r\n      }\r\n    };\r\n    window.addEventListener('beforeunload', handleBeforeUnload);\r\n    return () => window.removeEventListener('beforeunload', handleBeforeUnload);\r\n  }, [cart]);\r\n\r\n  // Load printer settings and connect QZ Tray\r\n  useEffect(() => {\r\n    const effectiveCabangId = getEffectiveCabangId();\r\n    if (!effectiveCabangId) return;\r\n    \r\n    const loadPrinterSettings = async () => {\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        const response = await fetch(`${API_BASE_URL}/settings/printer?cabangId=${effectiveCabangId}`, {\r\n          headers: { 'Authorization': `Bearer ${token}` },\r\n        });\r\n        \r\n        if (response.ok) {\r\n          const data = await response.json();\r\n          setPrinterSettings({\r\n            autoPrintEnabled: data.autoPrintEnabled ?? true,\r\n            printerName: data.printerName || '',\r\n            paperWidth: data.paperWidth || 58,\r\n            storeName: data.storeName || '',\r\n            branchName: data.branchName || '',\r\n            address: data.address || '',\r\n            phone: data.phone || '',\r\n            footerText1: data.footerText1 || 'Terima kasih atas kunjungan Anda',\r\n            footerText2: data.footerText2 || '',\r\n          });\r\n        }\r\n      } catch (e) {\r\n        logger.error('Failed to load printer settings:', e);\r\n      }\r\n    };\r\n    \r\n    const initQZ = async () => {\r\n      try {\r\n        const available = await isQZAvailable();\r\n        setQzConnected(available);\r\n        if (available) {\r\n          await connectQZ();\r\n        }\r\n      } catch (e) {\r\n        logger.debug('QZ Tray not available:', e);\r\n        setQzConnected(false);\r\n      }\r\n    };\r\n    \r\n    loadPrinterSettings();\r\n    initQZ();\r\n  }, [selectedCabangId, user?.cabangId, getEffectiveCabangId]);\r\n\r\n  // Real-time product sync via WebSocket\r\n  useProductSocket({\r\n    onProductCreated: useCallback(() => {\r\n      const effectiveCabangId = getEffectiveCabangId();\r\n      fetchProductsStore(effectiveCabangId || '');\r\n    }, [fetchProductsStore, getEffectiveCabangId]),\r\n    onProductUpdated: useCallback((updatedProduct: any) => {\r\n      updateProduct(updatedProduct);\r\n      const effectiveCabangId = getEffectiveCabangId();\r\n      updatedProduct.variants?.forEach((variant: any) => {\r\n        const stock = variant.stocks?.find((s: any) => s.cabangId === effectiveCabangId);\r\n        if (stock) {\r\n          updateItemStock(variant.id, stock.quantity, stock.price);\r\n        }\r\n      });\r\n    }, [updateProduct, updateItemStock, getEffectiveCabangId]),\r\n    onProductDeleted: useCallback((productId: string) => {\r\n      deleteProductStore(productId);\r\n    }, [deleteProductStore]),\r\n    onStockUpdated: useCallback((stockData: any) => {\r\n      const effectiveCabangId = getEffectiveCabangId();\r\n      if (stockData.cabangId !== effectiveCabangId) return;\r\n      updateStock(stockData.cabangId, stockData.productVariantId, stockData.quantity, stockData.price);\r\n      updateItemStock(stockData.productVariantId, stockData.quantity, stockData.price);\r\n    }, [updateStock, updateItemStock, getEffectiveCabangId]),\r\n    onRefreshNeeded: useCallback(() => {\r\n      const effectiveCabangId = getEffectiveCabangId();\r\n      fetchProductsStore(effectiveCabangId || '');\r\n    }, [fetchProductsStore, getEffectiveCabangId]),\r\n    enabled: !loading,\r\n  });\r\n\r\n  // Cart handlers\r\n  const handleAddToCart = (product: any, variant: any) => {\r\n    const effectiveCabangId = getEffectiveCabangId();\r\n    const stock = variant.stocks?.find((s: any) => s.cabangId === effectiveCabangId);\r\n    if (!stock || stock.quantity <= 0) {\r\n      toast.warning('Stok tidak tersedia!');\r\n      return;\r\n    }\r\n\r\n    let variantInfo = variant.variantValue;\r\n    const defaultVariants = ['default', 'standar', 'standard', 'default:', '-'];\r\n    if (product.productType === 'SINGLE' || defaultVariants.some((v: string) => variantInfo.toLowerCase().includes(v))) {\r\n      variantInfo = '';\r\n    }\r\n\r\n    const success = addToCart({\r\n      productVariantId: variant.id,\r\n      productName: product.name,\r\n      variantInfo,\r\n      sku: variant.sku,\r\n      price: stock.price || 0,\r\n      availableStock: stock.quantity,\r\n    });\r\n\r\n    if (!success) {\r\n      toast.warning('Stok tidak mencukupi!');\r\n    }\r\n  };\r\n\r\n  const handleUpdateQuantity = (variantId: string, newQty: number) => {\r\n    if (newQty <= 0) {\r\n      removeFromCart(variantId);\r\n      return;\r\n    }\r\n    const success = updateQuantity(variantId, newQty);\r\n    if (!success) {\r\n      toast.warning('Stok tidak mencukupi!');\r\n    }\r\n  };\r\n\r\n  const resetTransaction = () => {\r\n    clearCart();\r\n    resetCheckout();\r\n  };\r\n\r\n  const handleHoldTransaction = () => {\r\n    if (cart.length === 0) { toast.warning('Keranjang masih kosong!'); return; }\r\n    \r\n    holdTransaction({\r\n      customerName,\r\n      customerPhone,\r\n      paymentMethod,\r\n      discount,\r\n      discountType,\r\n      bankName,\r\n      referenceNo,\r\n    });\r\n    resetTransaction();\r\n    toast.success('Transaksi berhasil di-hold!');\r\n  };\r\n\r\n  const handleRetrieveHeld = (held: any) => {\r\n    const doRetrieve = () => {\r\n      retrieveHeld(held.id);\r\n      setCustomerName(held.customerName);\r\n      setCustomerPhone(held.customerPhone);\r\n      setPaymentMethod(held.paymentMethod);\r\n      setDiscount(held.discount);\r\n      setDiscountType(held.discountType);\r\n      setBankName(held.bankName);\r\n      setReferenceNo(held.referenceNo);\r\n      setShowHoldModal(false);\r\n    };\r\n\r\n    if (cart.length > 0) {\r\n      showConfirm({\r\n        title: 'Ganti Keranjang?',\r\n        description: 'Keranjang saat ini akan diganti dengan transaksi yang di-hold. Lanjutkan?',\r\n        confirmText: 'Ya, Ganti',\r\n        confirmVariant: 'warning',\r\n        onConfirm: doRetrieve,\r\n      });\r\n    } else {\r\n      doRetrieve();\r\n    }\r\n  };\r\n\r\n  const handleDeleteHeld = (id: string) => {\r\n    showConfirm({\r\n      title: 'Hapus Transaksi?',\r\n      description: 'Transaksi yang di-hold ini akan dihapus secara permanen.',\r\n      confirmText: 'Hapus',\r\n      confirmVariant: 'danger',\r\n      onConfirm: () => deleteHeld(id),\r\n    });\r\n  };\r\n\r\n  // Request Product via WhatsApp\r\n  const handleRequestProduct = async () => {\r\n    if (!newProduct.name || !newProduct.categoryId) {\r\n      toast.warning('Mohon isi minimal Nama Produk dan Kategori');\r\n      return;\r\n    }\r\n\r\n    setRequestProductLoading(true);\r\n    try {\r\n      const category = categories.find((c: any) => c.id === newProduct.categoryId);\r\n      const categoryName = category?.name || 'N/A';\r\n      const productTypeLabel = newProduct.productType === 'SINGLE' ? 'Produk Single' : 'Produk Variant';\r\n\r\n      const message = `REQUEST PRODUK BARU\\n\\n` +\r\n        `Nama Produk: ${newProduct.name}\\n` +\r\n        `Tipe Produk: ${productTypeLabel}\\n` +\r\n        `Kategori: ${categoryName}\\n\\n` +\r\n        `Diminta oleh: ${user?.name || 'Kasir'}\\n` +\r\n        `Cabang: ${user?.cabang?.name || 'N/A'}\\n` +\r\n        `Waktu: ${new Date().toLocaleString('id-ID', { dateStyle: 'full', timeStyle: 'short' })}`;\r\n\r\n      const encodedMessage = encodeURIComponent(message);\r\n      const whatsappURL = `https://wa.me/${adminWhatsApp}?text=${encodedMessage}`;\r\n\r\n      if (typeof window !== 'undefined') {\r\n        window.open(whatsappURL, '_blank');\r\n      }\r\n\r\n      setNewProduct({ name: '', categoryId: '', productType: 'SINGLE' });\r\n      setShowRequestProductModal(false);\r\n      toast.success('Request produk dikirim ke WhatsApp admin!');\r\n    } catch (error: any) {\r\n      toast.error('Gagal mengirim request: ' + error.message);\r\n    } finally {\r\n      setRequestProductLoading(false);\r\n    }\r\n  };\r\n\r\n  // Handle close POS\r\n  const handleClosePOS = () => setShowCloseConfirm(true);\r\n\r\n  const confirmClosePOS = () => {\r\n    if (heldTransactions.length > 0) {\r\n      localStorage.removeItem('heldTransactions');\r\n    }\r\n    setShowCloseConfirm(false);\r\n    if (user?.role === 'KASIR') {\r\n      clearAuth();\r\n      router.push('/login');\r\n    } else {\r\n      router.back();\r\n    }\r\n  };\r\n\r\n  // Network error check\r\n  const isNetworkError = (error: any): boolean => {\r\n    if (!error) return false;\r\n    if (error.name === 'AxiosError' && error.code === 'ERR_NETWORK') return true;\r\n    if (error.code === 'ERR_NETWORK' || error.code === 'ECONNREFUSED') return true;\r\n    const msg = (error.message || '').toLowerCase();\r\n    if (msg.includes('network error') || msg.includes('failed to fetch') || msg.includes('connection refused')) return true;\r\n    if (error.request && !error.response) return true;\r\n    return false;\r\n  };\r\n\r\n  // Handle offline transaction queueing\r\n  const handleOfflineCheckout = async (transactionData: Record<string, unknown>) => {\r\n    try {\r\n      const localId = await queueTransaction(transactionData);\r\n      \r\n      const offlineTransaction = {\r\n        id: localId,\r\n        transactionNo: `OFFLINE-${Date.now()}`,\r\n        createdAt: new Date().toISOString(),\r\n        total: total,\r\n        discount: discountAmount,\r\n        paymentMethod,\r\n        cabangId: getEffectiveCabangId() || '',\r\n        items: cart.map((item) => ({\r\n          id: item.productVariantId,\r\n          productName: item.productName,\r\n          variantInfo: item.variantInfo,\r\n          quantity: item.quantity,\r\n          price: item.price,\r\n          subtotal: item.quantity * item.price,\r\n          productVariantId: item.productVariantId,\r\n        })),\r\n        isOffline: true,\r\n        syncStatus: 'pending' as const,\r\n        customerName: customerName || undefined,\r\n        customerPhone: customerPhone || undefined,\r\n      };\r\n      \r\n      try {\r\n        const cacheService = getOfflineCacheService();\r\n        await cacheService.initialize();\r\n        await cacheService.addOfflineTransaction(offlineTransaction);\r\n      } catch (cacheError) {\r\n        console.error('[POS] Error adding to cache:', cacheError);\r\n      }\r\n      \r\n      setTransactionSuccess(offlineTransaction as any, paymentMethod === 'CASH' ? cashReceived : 0);\r\n      resetTransaction();\r\n      toast.success('Transaksi disimpan offline. Akan disync saat online.');\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('Failed to queue offline transaction:', error);\r\n      toast.error('Gagal menyimpan transaksi offline!');\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const handleCheckout = async () => {\r\n    if (cart.length === 0) { toast.warning('Keranjang masih kosong!'); return; }\r\n    \r\n    if (paymentMethod === 'CASH') {\r\n      if (cashReceived === 0) { toast.warning('Masukkan uang yang diterima!'); return; }\r\n      if (cashReceived < total) { toast.error(`Uang kurang Rp ${(total - cashReceived).toLocaleString('id-ID')}!`); return; }\r\n    }\r\n    \r\n    if ((paymentMethod === 'DEBIT' || paymentMethod === 'TRANSFER') && !bankName) {\r\n      toast.error('Pilih bank terlebih dahulu!'); return;\r\n    }\r\n    \r\n    if (paymentMethod !== 'CASH' && !referenceNo) {\r\n      toast.error('Nomor referensi wajib diisi!'); return;\r\n    }\r\n\r\n    setProcessing(true);\r\n    \r\n    const transactionData = {\r\n      cabangId: getEffectiveCabangId()!,\r\n      customerName: customerName || undefined,\r\n      customerPhone: customerPhone || undefined,\r\n      items: cart.map((item) => ({\r\n        productVariantId: item.productVariantId,\r\n        quantity: item.quantity,\r\n        price: item.price,\r\n      })),\r\n      discount: discountAmount,\r\n      tax: 0,\r\n      paymentMethod,\r\n      bankName: bankName || undefined,\r\n      referenceNo: referenceNo || undefined,\r\n      deviceSource: 'WEB',\r\n    };\r\n    \r\n    if (!isOnline) {\r\n      await handleOfflineCheckout(transactionData);\r\n      setProcessing(false);\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const res = await transactionsAPI.createTransaction(transactionData);\r\n\r\n      setTransactionSuccess(res.data.transaction, paymentMethod === 'CASH' ? cashReceived : 0);\r\n      resetTransaction();\r\n      \r\n      const effectiveCabangId = getEffectiveCabangId();\r\n      fetchProductsStore(effectiveCabangId || '');\r\n      \r\n      if (printerSettings?.autoPrintEnabled && qzConnected && res.data.transaction) {\r\n        setTimeout(() => handlePrintReceipt(res.data.transaction, paymentMethod === 'CASH' ? cashReceived : 0), 500);\r\n      }\r\n    } catch (e: any) {\r\n      logger.error('Transaction failed:', e);\r\n      \r\n      if (isNetworkError(e)) {\r\n        toast.warning('Koneksi terputus. Menyimpan transaksi offline...');\r\n        const success = await handleOfflineCheckout(transactionData);\r\n        if (!success) {\r\n          toast.error('Gagal menyimpan offline. Coba lagi.');\r\n        }\r\n      } else {\r\n        toast.error(e.response?.data?.error || 'Transaksi gagal!');\r\n      }\r\n    } finally {\r\n      setProcessing(false);\r\n    }\r\n  };\r\n\r\n  // Print receipt function\r\n  const handlePrintReceipt = async (transaction: typeof lastTransaction, cashAmount?: number) => {\r\n    if (!transaction || !printerSettings) {\r\n      toast.error('Data transaksi atau pengaturan printer tidak tersedia');\r\n      return;\r\n    }\r\n\r\n    if (!qzConnected) {\r\n      toast.error('QZ Tray tidak terhubung. Pastikan QZ Tray sudah terinstall dan berjalan.');\r\n      return;\r\n    }\r\n\r\n    setPrinting(true);\r\n    try {\r\n      const printOptions: PrintReceiptOptions = {\r\n        printerName: printerSettings.printerName,\r\n        paperWidth: printerSettings.paperWidth as 58 | 80,\r\n        storeName: printerSettings.storeName,\r\n        branchName: printerSettings.branchName,\r\n        address: printerSettings.address,\r\n        phone: printerSettings.phone,\r\n        transactionNo: transaction.transactionNo,\r\n        date: new Date(transaction.createdAt).toLocaleDateString('id-ID', {\r\n          day: '2-digit',\r\n          month: '2-digit',\r\n          year: 'numeric',\r\n          hour: '2-digit',\r\n          minute: '2-digit',\r\n        }),\r\n        items: transaction.items.map((item: any) => ({\r\n          name: item.productName,\r\n          variant: item.variantInfo || undefined,\r\n          qty: item.quantity,\r\n          price: item.price,\r\n          subtotal: item.quantity * item.price,\r\n        })),\r\n        subtotal: transaction.total + (transaction.discount || 0),\r\n        discount: transaction.discount || 0,\r\n        total: transaction.total,\r\n        paymentMethod: transaction.paymentMethod,\r\n        cashReceived: cashAmount,\r\n        change: cashAmount ? cashAmount - transaction.total : undefined,\r\n        footerText1: printerSettings.footerText1,\r\n        footerText2: printerSettings.footerText2,\r\n        cashierName: user?.name || 'Kasir',\r\n      };\r\n\r\n      await printReceipt(printOptions);\r\n      toast.success('Struk berhasil dicetak!');\r\n    } catch (e: any) {\r\n      logger.error('Print error:', e);\r\n      toast.error(`Gagal mencetak: ${e.message || 'Unknown error'}`);\r\n    } finally {\r\n      setPrinting(false);\r\n    }\r\n  };\r\n\r\n  // Block phone users (tablet allowed)\r\n  if (isMobile) {\r\n    return <POSMobileBlock user={user} router={router} />;\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen bg-gray-50 dark:bg-gray-900\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div ref={posContainerRef} className=\"h-screen bg-gray-50 dark:bg-gray-900 px-6 py-4 flex flex-col overflow-hidden\">\r\n      {/* Generic Confirm Dialog */}\r\n      <AlertDialog open={confirmDialog.open} onOpenChange={(open: boolean) => !open && closeConfirm()}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{confirmDialog.title}</AlertDialogTitle>\r\n            <AlertDialogDescription>{confirmDialog.description}</AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>Batal</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={() => {\r\n                confirmDialog.onConfirm();\r\n                closeConfirm();\r\n              }}\r\n              className={\r\n                confirmDialog.confirmVariant === 'danger'\r\n                  ? 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500'\r\n                  : confirmDialog.confirmVariant === 'warning'\r\n                  ? 'bg-amber-600 text-white hover:bg-amber-700 focus:ring-amber-500'\r\n                  : 'bg-slate-600 text-white hover:bg-slate-700 focus:ring-slate-500'\r\n              }\r\n            >\r\n              {confirmDialog.confirmText || 'Konfirmasi'}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Header */}\r\n      <POSHeader\r\n        user={user}\r\n        branches={branches}\r\n        selectedCabangId={selectedCabangId}\r\n        setSelectedCabangId={setSelectedCabangId}\r\n        showBranchDropdown={showBranchDropdown}\r\n        setShowBranchDropdown={setShowBranchDropdown}\r\n        heldTransactions={heldTransactions}\r\n        setShowHoldModal={setShowHoldModal}\r\n        userMenuOpen={userMenuOpen}\r\n        setUserMenuOpen={setUserMenuOpen}\r\n        handleClosePOS={handleClosePOS}\r\n        clearAuth={clearAuth}\r\n        router={router}\r\n      />\r\n\r\n      <div className=\"flex-1 grid grid-cols-1 xl:grid-cols-3 gap-6 min-h-0\">\r\n        {/* Products */}\r\n        <POSProductGrid\r\n          searchInputRef={searchInputRef}\r\n          search={search}\r\n          setSearch={setSearch}\r\n          filteredProducts={filteredProducts}\r\n          products={products}\r\n          loading={loading}\r\n          cart={cart}\r\n          getEffectiveCabangId={getEffectiveCabangId}\r\n          onAddToCart={handleAddToCart}\r\n          onRequestProduct={() => setShowRequestProductModal(true)}\r\n          onShowHistory={() => setShowHistory(true)}\r\n        />\r\n\r\n        {/* Cart */}\r\n        <POSCart\r\n          cart={cart}\r\n          customerName={customerName}\r\n          setCustomerName={setCustomerName}\r\n          customerPhone={customerPhone}\r\n          setCustomerPhone={setCustomerPhone}\r\n          showCustomerInfo={showCustomerInfo}\r\n          setShowCustomerInfo={setShowCustomerInfo}\r\n          discount={discount}\r\n          setDiscount={setDiscount}\r\n          discountType={discountType}\r\n          setDiscountType={setDiscountType}\r\n          showDiscount={showDiscount}\r\n          setShowDiscount={setShowDiscount}\r\n          paymentMethod={paymentMethod}\r\n          setPaymentMethod={setPaymentMethod}\r\n          bankName={bankName}\r\n          setBankName={setBankName}\r\n          referenceNo={referenceNo}\r\n          setReferenceNo={setReferenceNo}\r\n          cashReceived={cashReceived}\r\n          setCashReceived={setCashReceived}\r\n          cashInputRef={cashInputRef}\r\n          subtotal={subtotal}\r\n          discountAmount={discountAmount}\r\n          total={total}\r\n          processing={processing}\r\n          onUpdateQuantity={handleUpdateQuantity}\r\n          onRemoveFromCart={removeFromCart}\r\n          onHold={handleHoldTransaction}\r\n          onCheckout={handleCheckout}\r\n        />\r\n      </div>\r\n\r\n      {/* Success Modal */}\r\n      {showSuccess && lastTransaction && (\r\n        <POSSuccessModal\r\n          transaction={lastTransaction}\r\n          cashReceived={lastCashReceived}\r\n          qzConnected={qzConnected}\r\n          printing={printing}\r\n          onPrint={handlePrintReceipt}\r\n          onClose={closeSuccessModal}\r\n        />\r\n      )}\r\n\r\n      {/* Hold Modal */}\r\n      {showHoldModal && (\r\n        <POSHoldModal\r\n          heldTransactions={heldTransactions}\r\n          onRetrieve={handleRetrieveHeld}\r\n          onDelete={handleDeleteHeld}\r\n          onClose={() => setShowHoldModal(false)}\r\n        />\r\n      )}\r\n\r\n      {/* Close POS Confirmation Dialog */}\r\n      <AlertDialog open={showCloseConfirm} onOpenChange={setShowCloseConfirm}>\r\n        <AlertDialogContent className=\"max-w-xs rounded-2xl p-8\">\r\n          <AlertDialogHeader className=\"space-y-3\">\r\n            <AlertDialogTitle className=\"text-base font-medium text-gray-900 dark:text-white text-center\">\r\n              {user?.role === 'KASIR' ? 'Akhiri Sesi Kasir?' : 'Kembali ke Dashboard?'}\r\n            </AlertDialogTitle>\r\n            <AlertDialogDescription className=\"text-sm text-gray-500 dark:text-gray-400 text-center leading-relaxed\">\r\n              {cart.length > 0 || heldTransactions.length > 0 ? (\r\n                <>\r\n                  Ada {cart.length > 0 && `${cart.length} item`}\r\n                  {cart.length > 0 && heldTransactions.length > 0 && ' & '}\r\n                  {heldTransactions.length > 0 && `${heldTransactions.length} hold`} yang belum selesai\r\n                </>\r\n              ) : (\r\n                user?.role === 'KASIR' \r\n                  ? 'Anda akan logout dari sistem'\r\n                  : 'Halaman kasir akan ditutup'\r\n              )}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n\r\n          <AlertDialogFooter className=\"flex-row gap-8 sm:justify-center mt-6\">\r\n            <AlertDialogCancel className=\"flex-1 m-0 h-11 rounded-xl border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800\">\r\n              Batal\r\n            </AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={confirmClosePOS}\r\n              className=\"flex-1 m-0 h-11 rounded-xl bg-slate-800 text-white hover:bg-slate-900 dark:bg-slate-700 dark:hover:bg-slate-600\"\r\n            >\r\n              {user?.role === 'KASIR' ? 'Logout' : 'Ya, Kembali'}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Request Product Modal */}\r\n      {showRequestProductModal && (\r\n        <POSRequestProductModal\r\n          newProduct={newProduct}\r\n          setNewProduct={setNewProduct}\r\n          categories={categories}\r\n          loading={requestProductLoading}\r\n          onSubmit={handleRequestProduct}\r\n          onClose={() => setShowRequestProductModal(false)}\r\n        />\r\n      )}\r\n\r\n      {/* Transaction History Modal */}\r\n      {showHistory && (\r\n        <TransactionHistory \r\n          user={user} \r\n          onClose={() => setShowHistory(false)} \r\n          cabangId={getEffectiveCabangId()}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\privacy\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":166,"column":27,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8726,9068],"text":"\r\n                  Kami dapat memperbarui Kebijakan Privasi ini dari waktu ke waktu. Perubahan \r\n                  signifikan akan diberitahukan melalui email atau notifikasi di aplikasi. \r\n                  Tanggal &quot;Terakhir diperbarui\" di bagian atas menunjukkan kapan terakhir \r\n                  kebijakan ini direvisi.\r\n                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8726,9068],"text":"\r\n                  Kami dapat memperbarui Kebijakan Privasi ini dari waktu ke waktu. Perubahan \r\n                  signifikan akan diberitahukan melalui email atau notifikasi di aplikasi. \r\n                  Tanggal &ldquo;Terakhir diperbarui\" di bagian atas menunjukkan kapan terakhir \r\n                  kebijakan ini direvisi.\r\n                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8726,9068],"text":"\r\n                  Kami dapat memperbarui Kebijakan Privasi ini dari waktu ke waktu. Perubahan \r\n                  signifikan akan diberitahukan melalui email atau notifikasi di aplikasi. \r\n                  Tanggal &#34;Terakhir diperbarui\" di bagian atas menunjukkan kapan terakhir \r\n                  kebijakan ini direvisi.\r\n                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8726,9068],"text":"\r\n                  Kami dapat memperbarui Kebijakan Privasi ini dari waktu ke waktu. Perubahan \r\n                  signifikan akan diberitahukan melalui email atau notifikasi di aplikasi. \r\n                  Tanggal &rdquo;Terakhir diperbarui\" di bagian atas menunjukkan kapan terakhir \r\n                  kebijakan ini direvisi.\r\n                "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":166,"column":47,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[8726,9068],"text":"\r\n                  Kami dapat memperbarui Kebijakan Privasi ini dari waktu ke waktu. Perubahan \r\n                  signifikan akan diberitahukan melalui email atau notifikasi di aplikasi. \r\n                  Tanggal \"Terakhir diperbarui&quot; di bagian atas menunjukkan kapan terakhir \r\n                  kebijakan ini direvisi.\r\n                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[8726,9068],"text":"\r\n                  Kami dapat memperbarui Kebijakan Privasi ini dari waktu ke waktu. Perubahan \r\n                  signifikan akan diberitahukan melalui email atau notifikasi di aplikasi. \r\n                  Tanggal \"Terakhir diperbarui&ldquo; di bagian atas menunjukkan kapan terakhir \r\n                  kebijakan ini direvisi.\r\n                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[8726,9068],"text":"\r\n                  Kami dapat memperbarui Kebijakan Privasi ini dari waktu ke waktu. Perubahan \r\n                  signifikan akan diberitahukan melalui email atau notifikasi di aplikasi. \r\n                  Tanggal \"Terakhir diperbarui&#34; di bagian atas menunjukkan kapan terakhir \r\n                  kebijakan ini direvisi.\r\n                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[8726,9068],"text":"\r\n                  Kami dapat memperbarui Kebijakan Privasi ini dari waktu ke waktu. Perubahan \r\n                  signifikan akan diberitahukan melalui email atau notifikasi di aplikasi. \r\n                  Tanggal \"Terakhir diperbarui&rdquo; di bagian atas menunjukkan kapan terakhir \r\n                  kebijakan ini direvisi.\r\n                "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport { Sun, Moon, ArrowLeft } from 'lucide-react';\r\nimport { useTheme } from '@/contexts/ThemeContext';\r\n\r\nexport default function PrivacyPage() {\r\n  const { resolvedTheme, toggleTheme } = useTheme();\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950\">\r\n      {/* Navbar */}\r\n      <nav className=\"fixed top-0 left-0 right-0 z-50 bg-white/95 dark:bg-slate-900/95 backdrop-blur-md border-b border-slate-200 dark:border-slate-800\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"flex items-center justify-between h-16\">\r\n            <Link href=\"/\" className=\"flex items-center\">\r\n              <Image\r\n                src=\"/images/logo.png\"\r\n                alt=\"Pelaris\"\r\n                width={120}\r\n                height={32}                \r\n                style={{ width: 'auto', height: 'auto' }}\r\n              />\r\n            </Link>\r\n\r\n            <div className=\"flex items-center gap-3\">\r\n              <button\r\n                onClick={toggleTheme}\r\n                className=\"p-2 text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors\"\r\n                aria-label=\"Toggle theme\"\r\n              >\r\n                {resolvedTheme === 'dark' ? <Sun className=\"w-5 h-5\" /> : <Moon className=\"w-5 h-5\" />}\r\n              </button>\r\n              <Link\r\n                href=\"/\"\r\n                className=\"flex items-center gap-2 px-4 py-2 text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white transition-colors\"\r\n              >\r\n                <ArrowLeft className=\"w-4 h-4\" />\r\n                Kembali\r\n              </Link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </nav>\r\n\r\n      {/* Content */}\r\n      <main className=\"pt-24 pb-16 px-4\">\r\n        <div className=\"max-w-3xl mx-auto\">\r\n          <div className=\"bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 p-8 md:p-12\">\r\n            <h1 className=\"text-3xl font-bold text-slate-900 dark:text-white mb-2\">\r\n              Kebijakan Privasi\r\n            </h1>\r\n            <p className=\"text-slate-500 dark:text-slate-400 mb-8\">\r\n              Terakhir diperbarui: 1 Februari 2026\r\n            </p>\r\n\r\n            <div className=\"prose prose-slate dark:prose-invert max-w-none\">\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  1. Informasi yang Kami Kumpulkan\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed mb-4\">\r\n                  Kami mengumpulkan informasi yang Anda berikan secara langsung, termasuk:\r\n                </p>\r\n                <ul className=\"list-disc list-inside text-slate-600 dark:text-slate-300 space-y-2\">\r\n                  <li><strong>Data Akun:</strong> Nama, email, nama bisnis, dan password terenkripsi</li>\r\n                  <li><strong>Data Transaksi:</strong> Riwayat penjualan, produk, dan pembayaran</li>\r\n                  <li><strong>Data Inventori:</strong> Informasi produk, stok, dan kategori</li>\r\n                  <li><strong>Data Penggunaan:</strong> Log aktivitas dan preferensi penggunaan</li>\r\n                </ul>\r\n              </section>\r\n\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  2. Bagaimana Kami Menggunakan Informasi\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed mb-4\">\r\n                  Informasi yang kami kumpulkan digunakan untuk:\r\n                </p>\r\n                <ul className=\"list-disc list-inside text-slate-600 dark:text-slate-300 space-y-2\">\r\n                  <li>Menyediakan, mengoperasikan, dan memelihara layanan Pelaris</li>\r\n                  <li>Memproses transaksi dan mengirim notifikasi terkait</li>\r\n                  <li>Meningkatkan dan mengembangkan fitur baru</li>\r\n                  <li>Memberikan dukungan pelanggan</li>\r\n                  <li>Mengirim komunikasi penting tentang layanan</li>\r\n                  <li>Mendeteksi dan mencegah aktivitas penipuan</li>\r\n                </ul>\r\n              </section>\r\n\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  3. Keamanan Data\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed\">\r\n                  Kami menerapkan langkah-langkah keamanan teknis dan organisasi yang sesuai untuk \r\n                  melindungi data Anda, termasuk enkripsi data dalam transit dan saat disimpan, \r\n                  kontrol akses yang ketat, dan audit keamanan berkala. Namun, tidak ada metode \r\n                  transmisi internet yang 100% aman, dan kami tidak dapat menjamin keamanan mutlak.\r\n                </p>\r\n              </section>\r\n\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  4. Berbagi Informasi\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed mb-4\">\r\n                  Kami <strong>tidak menjual</strong> data pribadi Anda. Kami hanya membagikan informasi dalam \r\n                  situasi berikut:\r\n                </p>\r\n                <ul className=\"list-disc list-inside text-slate-600 dark:text-slate-300 space-y-2\">\r\n                  <li>Dengan persetujuan eksplisit Anda</li>\r\n                  <li>Untuk mematuhi kewajiban hukum</li>\r\n                  <li>Dengan penyedia layanan yang membantu operasional kami (dengan perjanjian kerahasiaan)</li>\r\n                  <li>Dalam situasi darurat untuk melindungi hak dan keselamatan</li>\r\n                </ul>\r\n              </section>\r\n\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  5. Penyimpanan Data\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed\">\r\n                  Data Anda disimpan di server yang aman di Indonesia. Kami menyimpan data selama \r\n                  akun Anda aktif atau selama diperlukan untuk menyediakan layanan. Setelah akun \r\n                  dihapus, kami akan menghapus data Anda dalam waktu 30 hari, kecuali ada kewajiban \r\n                  hukum untuk menyimpan lebih lama.\r\n                </p>\r\n              </section>\r\n\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  6. Hak Anda\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed mb-4\">\r\n                  Anda memiliki hak untuk:\r\n                </p>\r\n                <ul className=\"list-disc list-inside text-slate-600 dark:text-slate-300 space-y-2\">\r\n                  <li><strong>Mengakses:</strong> Meminta salinan data pribadi Anda</li>\r\n                  <li><strong>Memperbaiki:</strong> Memperbarui informasi yang tidak akurat</li>\r\n                  <li><strong>Menghapus:</strong> Meminta penghapusan data Anda</li>\r\n                  <li><strong>Mengekspor:</strong> Mengunduh data Anda dalam format yang dapat dibaca</li>\r\n                  <li><strong>Menolak:</strong> Menolak penggunaan data untuk tujuan tertentu</li>\r\n                </ul>\r\n              </section>\r\n\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  7. Cookie dan Teknologi Pelacakan\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed\">\r\n                  Kami menggunakan cookie dan teknologi serupa untuk menjaga sesi login Anda, \r\n                  mengingat preferensi, dan meningkatkan pengalaman pengguna. Anda dapat mengontrol \r\n                  cookie melalui pengaturan browser Anda, namun beberapa fitur mungkin tidak berfungsi \r\n                  dengan baik tanpa cookie.\r\n                </p>\r\n              </section>\r\n\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  8. Perubahan Kebijakan\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed\">\r\n                  Kami dapat memperbarui Kebijakan Privasi ini dari waktu ke waktu. Perubahan \r\n                  signifikan akan diberitahukan melalui email atau notifikasi di aplikasi. \r\n                  Tanggal \"Terakhir diperbarui\" di bagian atas menunjukkan kapan terakhir \r\n                  kebijakan ini direvisi.\r\n                </p>\r\n              </section>\r\n\r\n              <section>\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  9. Hubungi Kami\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed\">\r\n                  Jika Anda memiliki pertanyaan tentang Kebijakan Privasi ini atau ingin menggunakan \r\n                  hak Anda terkait data pribadi, silakan hubungi kami di{' '}\r\n                  <a href=\"mailto:privacy@pelaris.id\" className=\"text-slate-700 dark:text-slate-300 underline hover:no-underline\">\r\n                    privacy@pelaris.id\r\n                  </a>\r\n                </p>\r\n              </section>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\register\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Lock' is defined but never used.","line":7,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":7,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Building2' is defined but never used.","line":7,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2399,2402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2399,2402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Mail, Lock, User, Building2, Eye, EyeOff, Check, X, ArrowRight } from 'lucide-react';\r\nimport { api } from '@/lib/api';\r\nimport { getAuth } from '@/lib/auth';\r\n\r\nexport default function RegisterPage() {\r\n  const router = useRouter();\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [isCheckingAuth, setIsCheckingAuth] = useState(true);\r\n\r\n  // Check if already logged in - redirect to appropriate page\r\n  useEffect(() => {\r\n    const { token, user } = getAuth();\r\n    if (token && user) {\r\n      // Already logged in, redirect based on role\r\n      if (user.role === 'KASIR') {\r\n        router.replace('/pos');\r\n      } else {\r\n        router.replace('/dashboard');\r\n      }\r\n    } else {\r\n      setIsCheckingAuth(false);\r\n    }\r\n  }, [router]);\r\n\r\n  const [formData, setFormData] = useState({\r\n    name: '',\r\n    storeName: '',\r\n    email: '',\r\n    password: '',\r\n  });\r\n\r\n  // Password validation\r\n  const hasMinLength = formData.password.length >= 8;\r\n  const hasLowercase = /[a-z]/.test(formData.password);\r\n  const hasUppercase = /[A-Z]/.test(formData.password);\r\n  const hasNumber = /\\d/.test(formData.password);\r\n  const isPasswordValid = hasMinLength && hasLowercase && hasUppercase && hasNumber;\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData((prev) => ({ ...prev, [name]: value }));\r\n    setError('');\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!isPasswordValid) {\r\n      setError('Password harus minimal 8 karakter, huruf besar, huruf kecil, dan angka');\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError('');\r\n\r\n    try {\r\n      const response = await api.post('/auth/register', {\r\n        ...formData,\r\n        branchName: 'Cabang Utama',\r\n      });\r\n\r\n      const data = response.data;\r\n      if (data.token) {\r\n        localStorage.setItem('token', data.token);\r\n        if (data.csrfToken) {\r\n          localStorage.setItem('csrfToken', data.csrfToken);\r\n        }\r\n        router.push('/dashboard');\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.message || 'Terjadi kesalahan saat mendaftar');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Show loading while checking auth\r\n  if (isCheckingAuth) {\r\n    return (\r\n      <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950 flex items-center justify-center\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-slate-600\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950 flex flex-col\">\r\n      {/* Logo Header */}\r\n      <div className=\"pt-8 pb-4 flex justify-center\">\r\n        <Link href=\"/\" className=\"flex items-center\">\r\n          <Image\r\n            src=\"/images/logo.png\"\r\n            alt=\"Pelaris\"\r\n            width={250}\r\n            height={68}\r\n            className=\"h-14\"\r\n            style={{ width: 'auto' }}\r\n            priority\r\n          />\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Form Card */}\r\n      <div className=\"flex-1 flex items-start justify-center px-4 py-8\">\r\n        <div className=\"w-full max-w-md\">\r\n          <div className=\"bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-800 p-8\">\r\n            {/* Header */}\r\n            <div className=\"text-center mb-8\">\r\n              <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-2\">\r\n                Mulai Bisnis Anda Gratis\r\n              </h1>\r\n              <p className=\"text-slate-500 dark:text-slate-400\">\r\n                Bergabung dengan ribuan UMKM lainnya di Indonesia\r\n              </p>\r\n            </div>\r\n\r\n            {/* Error Message */}\r\n            {error && (\r\n              <div className=\"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\r\n                <p className=\"text-red-600 dark:text-red-400 text-sm\">{error}</p>\r\n              </div>\r\n            )}\r\n\r\n            {/* Form */}\r\n            <form onSubmit={handleSubmit} className=\"space-y-5\">\r\n              {/* Nama Lengkap */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\r\n                  Nama Lengkap\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type=\"text\"\r\n                    name=\"name\"\r\n                    value={formData.name}\r\n                    onChange={handleChange}\r\n                    placeholder=\"Cth. Budi Santoso\"\r\n                    required\r\n                    className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Nama Bisnis */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\r\n                  Nama Bisnis\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type=\"text\"\r\n                    name=\"storeName\"\r\n                    value={formData.storeName}\r\n                    onChange={handleChange}\r\n                    placeholder=\"Cth. Kopi Kenangan Budi\"\r\n                    required\r\n                    className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Email */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\r\n                  Alamat Email\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type=\"email\"\r\n                    name=\"email\"\r\n                    value={formData.email}\r\n                    onChange={handleChange}\r\n                    placeholder=\"nama@email.com\"\r\n                    required\r\n                    autoComplete=\"email\"\r\n                    className=\"w-full px-4 py-3 pr-12 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all\"\r\n                  />\r\n                  <Mail className=\"absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400\" />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Password */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\r\n                  Kata Sandi\r\n                </label>\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type={showPassword ? 'text' : 'password'}\r\n                    name=\"password\"\r\n                    value={formData.password}\r\n                    onChange={handleChange}\r\n                    placeholder=\"Minimal 8 karakter\"\r\n                    required\r\n                    autoComplete=\"new-password\"\r\n                    className=\"w-full px-4 py-3 pr-12 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all\"\r\n                  />\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowPassword(!showPassword)}\r\n                    className=\"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300\"\r\n                  >\r\n                    {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\r\n                  </button>\r\n                </div>\r\n\r\n                {/* Password Requirements */}\r\n                <div className=\"flex flex-wrap gap-x-4 gap-y-1 mt-2\">\r\n                  <div className={`flex items-center gap-1.5 text-xs ${hasMinLength ? 'text-green-600 dark:text-green-400' : 'text-slate-400'}`}>\r\n                    {hasMinLength ? <Check className=\"w-3.5 h-3.5\" /> : <X className=\"w-3.5 h-3.5\" />}\r\n                    <span>8+ Karakter</span>\r\n                  </div>\r\n                  <div className={`flex items-center gap-1.5 text-xs ${hasLowercase ? 'text-green-600 dark:text-green-400' : 'text-slate-400'}`}>\r\n                    {hasLowercase ? <Check className=\"w-3.5 h-3.5\" /> : <X className=\"w-3.5 h-3.5\" />}\r\n                    <span>Huruf Kecil</span>\r\n                  </div>\r\n                  <div className={`flex items-center gap-1.5 text-xs ${hasUppercase ? 'text-green-600 dark:text-green-400' : 'text-slate-400'}`}>\r\n                    {hasUppercase ? <Check className=\"w-3.5 h-3.5\" /> : <X className=\"w-3.5 h-3.5\" />}\r\n                    <span>Huruf Besar</span>\r\n                  </div>\r\n                  <div className={`flex items-center gap-1.5 text-xs ${hasNumber ? 'text-green-600 dark:text-green-400' : 'text-slate-400'}`}>\r\n                    {hasNumber ? <Check className=\"w-3.5 h-3.5\" /> : <X className=\"w-3.5 h-3.5\" />}\r\n                    <span>Angka</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Submit Button */}\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isLoading || !isPasswordValid}\r\n                className=\"w-full py-3.5 bg-slate-600 hover:bg-slate-700 disabled:bg-slate-600/50 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2\"\r\n              >\r\n                {isLoading ? (\r\n                  <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                ) : (\r\n                  <>\r\n                    Daftar Gratis\r\n                    <ArrowRight className=\"w-5 h-5\" />\r\n                  </>\r\n                )}\r\n              </button>\r\n            </form>\r\n\r\n            {/* Divider */}\r\n            <div className=\"relative my-6\">\r\n              <div className=\"absolute inset-0 flex items-center\">\r\n                <div className=\"w-full border-t border-slate-200 dark:border-slate-700\"></div>\r\n              </div>\r\n              <div className=\"relative flex justify-center text-sm\">\r\n                <span className=\"px-4 bg-white dark:bg-slate-900 text-slate-500\">\r\n                  Atau daftar dengan\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Google Button */}\r\n            <button\r\n              type=\"button\"\r\n              disabled\r\n              className=\"w-full py-3 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-700 dark:text-slate-300 font-medium hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors flex items-center justify-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\r\n                <path\r\n                  fill=\"#4285F4\"\r\n                  d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\r\n                />\r\n                <path\r\n                  fill=\"#34A853\"\r\n                  d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\r\n                />\r\n                <path\r\n                  fill=\"#FBBC05\"\r\n                  d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\r\n                />\r\n                <path\r\n                  fill=\"#EA4335\"\r\n                  d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\r\n                />\r\n              </svg>\r\n              Google\r\n            </button>\r\n\r\n            {/* Terms */}\r\n            <p className=\"mt-6 text-center text-xs text-slate-500 dark:text-slate-400\">\r\n              Dengan mendaftar, Anda menyetujui{' '}\r\n              <Link href=\"/terms\" className=\"text-slate-600 dark:text-slate-300 hover:underline\">\r\n                Syarat & Ketentuan\r\n              </Link>{' '}\r\n              dan{' '}\r\n              <Link href=\"/privacy\" className=\"text-slate-600 dark:text-slate-300 hover:underline\">\r\n                Kebijakan Privasi\r\n              </Link>{' '}\r\n              kami.\r\n            </p>\r\n          </div>\r\n\r\n          {/* Login Link */}\r\n          <p className=\"mt-8 text-center text-slate-600 dark:text-slate-400\">\r\n            Sudah punya akun Pelaris?{' '}\r\n            <Link href=\"/login\" className=\"text-slate-600 dark:text-slate-300 font-medium hover:underline\">\r\n              Masuk di sini\r\n            </Link>\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\reset-password\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Lock' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1937,1940],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1937,1940],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, Suspense } from 'react';\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport { Lock, Eye, EyeOff, CheckCircle, XCircle, Check, X } from 'lucide-react';\r\nimport { api } from '@/lib/api';\r\n\r\nfunction ResetPasswordForm() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n  const token = searchParams.get('token');\r\n\r\n  const [password, setPassword] = useState('');\r\n  const [confirmPassword, setConfirmPassword] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isSuccess, setIsSuccess] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  // Password validation\r\n  const hasMinLength = password.length >= 8;\r\n  const hasLowercase = /[a-z]/.test(password);\r\n  const hasUppercase = /[A-Z]/.test(password);\r\n  const hasNumber = /\\d/.test(password);\r\n  const passwordsMatch = password === confirmPassword && confirmPassword.length > 0;\r\n  const isPasswordValid = hasMinLength && hasLowercase && hasUppercase && hasNumber && passwordsMatch;\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!token) {\r\n      setError('Token tidak valid');\r\n      return;\r\n    }\r\n\r\n    if (!isPasswordValid) {\r\n      setError('Password belum memenuhi semua syarat');\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n    setError('');\r\n\r\n    try {\r\n      const response = await api.post('/auth/reset-password', {\r\n        token,\r\n        password,\r\n      });\r\n\r\n      if (response.data.success) {\r\n        setIsSuccess(true);\r\n        // Redirect to login after 3 seconds\r\n        setTimeout(() => {\r\n          router.push('/login');\r\n        }, 3000);\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.response?.data?.error || 'Terjadi kesalahan. Silakan coba lagi.');\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (!token) {\r\n    return (\r\n      <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950 flex flex-col\">\r\n        <div className=\"pt-8 pb-4 flex justify-center\">\r\n          <Link href=\"/\" className=\"flex items-center\">\r\n            <Image\r\n              src=\"/images/logo.png\"\r\n              alt=\"Pelaris\"\r\n              width={150}\r\n              height={40}              \r\n              style={{ width: 'auto', height: 'auto' }}\r\n              priority\r\n            />\r\n          </Link>\r\n        </div>\r\n        <div className=\"flex-1 flex items-start justify-center px-4 py-8\">\r\n          <div className=\"w-full max-w-md\">\r\n            <div className=\"bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-800 p-8 text-center\">\r\n              <div className=\"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                <XCircle className=\"w-8 h-8 text-red-600 dark:text-red-400\" />\r\n              </div>\r\n              <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-2\">\r\n                Link Tidak Valid\r\n              </h1>\r\n              <p className=\"text-slate-500 dark:text-slate-400 mb-6\">\r\n                Link reset password tidak valid atau sudah kadaluarsa. Silakan request link baru.\r\n              </p>\r\n              <Link\r\n                href=\"/forgot-password\"\r\n                className=\"inline-flex px-6 py-3 bg-slate-600 hover:bg-slate-700 text-white rounded-lg font-medium transition-colors\"\r\n              >\r\n                Request Link Baru\r\n              </Link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950 flex flex-col\">\r\n      {/* Logo Header */}\r\n      <div className=\"pt-8 pb-4 flex justify-center\">\r\n        <Link href=\"/\" className=\"flex items-center\">\r\n          <Image\r\n            src=\"/images/logo.png\"\r\n            alt=\"Pelaris\"\r\n            width={150}\r\n            height={40}            \r\n            style={{ width: 'auto', height: 'auto' }}\r\n            priority\r\n          />\r\n        </Link>\r\n      </div>\r\n\r\n      {/* Form Card */}\r\n      <div className=\"flex-1 flex items-start justify-center px-4 py-8\">\r\n        <div className=\"w-full max-w-md\">\r\n          <div className=\"bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-800 p-8\">\r\n            {isSuccess ? (\r\n              /* Success State */\r\n              <div className=\"text-center py-6\">\r\n                <div className=\"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                  <CheckCircle className=\"w-8 h-8 text-green-600 dark:text-green-400\" />\r\n                </div>\r\n                <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-2\">\r\n                  Password Berhasil Direset!\r\n                </h1>\r\n                <p className=\"text-slate-500 dark:text-slate-400 mb-6\">\r\n                  Password Anda telah berhasil diubah. Anda akan diarahkan ke halaman login...\r\n                </p>\r\n                <Link\r\n                  href=\"/login\"\r\n                  className=\"inline-flex px-6 py-3 bg-slate-600 hover:bg-slate-700 text-white rounded-lg font-medium transition-colors\"\r\n                >\r\n                  Login Sekarang\r\n                </Link>\r\n              </div>\r\n            ) : (\r\n              /* Form State */\r\n              <>\r\n                <div className=\"text-center mb-8\">\r\n                  <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-2\">\r\n                    Reset Password\r\n                  </h1>\r\n                  <p className=\"text-slate-500 dark:text-slate-400\">\r\n                    Masukkan password baru Anda\r\n                  </p>\r\n                </div>\r\n\r\n                {error && (\r\n                  <div className=\"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\r\n                    <p className=\"text-red-600 dark:text-red-400 text-sm\">{error}</p>\r\n                  </div>\r\n                )}\r\n\r\n                <form onSubmit={handleSubmit} className=\"space-y-5\">\r\n                  {/* New Password */}\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\r\n                      Password Baru\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                      <input\r\n                        type={showPassword ? 'text' : 'password'}\r\n                        value={password}\r\n                        onChange={(e) => setPassword(e.target.value)}\r\n                        placeholder=\"Minimal 8 karakter\"\r\n                        required\r\n                        autoComplete=\"new-password\"\r\n                        className=\"w-full px-4 py-3 pr-12 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all\"\r\n                      />\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowPassword(!showPassword)}\r\n                        className=\"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300\"\r\n                      >\r\n                        {showPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\r\n                      </button>\r\n                    </div>\r\n\r\n                    {/* Password Requirements */}\r\n                    <div className=\"flex flex-wrap gap-x-4 gap-y-1 mt-2\">\r\n                      <div className={`flex items-center gap-1.5 text-xs ${hasMinLength ? 'text-green-600 dark:text-green-400' : 'text-slate-400'}`}>\r\n                        {hasMinLength ? <Check className=\"w-3.5 h-3.5\" /> : <X className=\"w-3.5 h-3.5\" />}\r\n                        <span>8+ Karakter</span>\r\n                      </div>\r\n                      <div className={`flex items-center gap-1.5 text-xs ${hasLowercase ? 'text-green-600 dark:text-green-400' : 'text-slate-400'}`}>\r\n                        {hasLowercase ? <Check className=\"w-3.5 h-3.5\" /> : <X className=\"w-3.5 h-3.5\" />}\r\n                        <span>Huruf Kecil</span>\r\n                      </div>\r\n                      <div className={`flex items-center gap-1.5 text-xs ${hasUppercase ? 'text-green-600 dark:text-green-400' : 'text-slate-400'}`}>\r\n                        {hasUppercase ? <Check className=\"w-3.5 h-3.5\" /> : <X className=\"w-3.5 h-3.5\" />}\r\n                        <span>Huruf Besar</span>\r\n                      </div>\r\n                      <div className={`flex items-center gap-1.5 text-xs ${hasNumber ? 'text-green-600 dark:text-green-400' : 'text-slate-400'}`}>\r\n                        {hasNumber ? <Check className=\"w-3.5 h-3.5\" /> : <X className=\"w-3.5 h-3.5\" />}\r\n                        <span>Angka</span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Confirm Password */}\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2\">\r\n                      Konfirmasi Password\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                      <input\r\n                        type={showConfirmPassword ? 'text' : 'password'}\r\n                        value={confirmPassword}\r\n                        onChange={(e) => setConfirmPassword(e.target.value)}\r\n                        placeholder=\"Ulangi password baru\"\r\n                        required\r\n                        autoComplete=\"new-password\"\r\n                        className=\"w-full px-4 py-3 pr-12 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:border-transparent transition-all\"\r\n                      />\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => setShowConfirmPassword(!showConfirmPassword)}\r\n                        className=\"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300\"\r\n                      >\r\n                        {showConfirmPassword ? <EyeOff className=\"w-5 h-5\" /> : <Eye className=\"w-5 h-5\" />}\r\n                      </button>\r\n                    </div>\r\n                    {confirmPassword && (\r\n                      <div className={`flex items-center gap-1.5 text-xs mt-2 ${passwordsMatch ? 'text-green-600 dark:text-green-400' : 'text-red-500'}`}>\r\n                        {passwordsMatch ? <Check className=\"w-3.5 h-3.5\" /> : <X className=\"w-3.5 h-3.5\" />}\r\n                        <span>{passwordsMatch ? 'Password cocok' : 'Password tidak cocok'}</span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Submit Button */}\r\n                  <button\r\n                    type=\"submit\"\r\n                    disabled={isSubmitting || !isPasswordValid}\r\n                    className=\"w-full py-3.5 bg-slate-600 hover:bg-slate-700 disabled:bg-slate-600/50 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2\"\r\n                  >\r\n                    {isSubmitting ? (\r\n                      <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                    ) : (\r\n                      'Reset Password'\r\n                    )}\r\n                  </button>\r\n                </form>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function ResetPasswordPage() {\r\n  return (\r\n    <Suspense fallback={\r\n      <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950 flex items-center justify-center\">\r\n        <div className=\"w-8 h-8 border-2 border-slate-300 border-t-slate-600 rounded-full animate-spin\" />\r\n      </div>\r\n    }>\r\n      <ResetPasswordForm />\r\n    </Suspense>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\app\\terms\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":132,"column":38,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[6579,6860],"text":"\r\n                  Pelaris disediakan &quot;sebagaimana adanya\" tanpa jaminan apapun. Kami tidak bertanggung \r\n                  jawab atas kerugian langsung, tidak langsung, insidental, atau konsekuensial yang \r\n                  timbul dari penggunaan layanan kami.\r\n                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[6579,6860],"text":"\r\n                  Pelaris disediakan &ldquo;sebagaimana adanya\" tanpa jaminan apapun. Kami tidak bertanggung \r\n                  jawab atas kerugian langsung, tidak langsung, insidental, atau konsekuensial yang \r\n                  timbul dari penggunaan layanan kami.\r\n                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[6579,6860],"text":"\r\n                  Pelaris disediakan &#34;sebagaimana adanya\" tanpa jaminan apapun. Kami tidak bertanggung \r\n                  jawab atas kerugian langsung, tidak langsung, insidental, atau konsekuensial yang \r\n                  timbul dari penggunaan layanan kami.\r\n                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[6579,6860],"text":"\r\n                  Pelaris disediakan &rdquo;sebagaimana adanya\" tanpa jaminan apapun. Kami tidak bertanggung \r\n                  jawab atas kerugian langsung, tidak langsung, insidental, atau konsekuensial yang \r\n                  timbul dari penggunaan layanan kami.\r\n                "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":132,"column":57,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[6579,6860],"text":"\r\n                  Pelaris disediakan \"sebagaimana adanya&quot; tanpa jaminan apapun. Kami tidak bertanggung \r\n                  jawab atas kerugian langsung, tidak langsung, insidental, atau konsekuensial yang \r\n                  timbul dari penggunaan layanan kami.\r\n                "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[6579,6860],"text":"\r\n                  Pelaris disediakan \"sebagaimana adanya&ldquo; tanpa jaminan apapun. Kami tidak bertanggung \r\n                  jawab atas kerugian langsung, tidak langsung, insidental, atau konsekuensial yang \r\n                  timbul dari penggunaan layanan kami.\r\n                "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[6579,6860],"text":"\r\n                  Pelaris disediakan \"sebagaimana adanya&#34; tanpa jaminan apapun. Kami tidak bertanggung \r\n                  jawab atas kerugian langsung, tidak langsung, insidental, atau konsekuensial yang \r\n                  timbul dari penggunaan layanan kami.\r\n                "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[6579,6860],"text":"\r\n                  Pelaris disediakan \"sebagaimana adanya&rdquo; tanpa jaminan apapun. Kami tidak bertanggung \r\n                  jawab atas kerugian langsung, tidak langsung, insidental, atau konsekuensial yang \r\n                  timbul dari penggunaan layanan kami.\r\n                "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport { Sun, Moon, ArrowLeft } from 'lucide-react';\r\nimport { useTheme } from '@/contexts/ThemeContext';\r\n\r\nexport default function TermsPage() {\r\n  const { resolvedTheme, toggleTheme } = useTheme();\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 dark:bg-slate-950\">\r\n      {/* Navbar */}\r\n      <nav className=\"fixed top-0 left-0 right-0 z-50 bg-white/95 dark:bg-slate-900/95 backdrop-blur-md border-b border-slate-200 dark:border-slate-800\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"flex items-center justify-between h-16\">\r\n            <Link href=\"/\" className=\"flex items-center\">\r\n              <Image\r\n                src=\"/images/logo.png\"\r\n                alt=\"Pelaris\"\r\n                width={120}\r\n                height={32}                \r\n                style={{ width: 'auto', height: 'auto' }}\r\n              />\r\n            </Link>\r\n\r\n            <div className=\"flex items-center gap-3\">\r\n              <button\r\n                onClick={toggleTheme}\r\n                className=\"p-2 text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors\"\r\n                aria-label=\"Toggle theme\"\r\n              >\r\n                {resolvedTheme === 'dark' ? <Sun className=\"w-5 h-5\" /> : <Moon className=\"w-5 h-5\" />}\r\n              </button>\r\n              <Link\r\n                href=\"/\"\r\n                className=\"flex items-center gap-2 px-4 py-2 text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white transition-colors\"\r\n              >\r\n                <ArrowLeft className=\"w-4 h-4\" />\r\n                Kembali\r\n              </Link>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </nav>\r\n\r\n      {/* Content */}\r\n      <main className=\"pt-24 pb-16 px-4\">\r\n        <div className=\"max-w-3xl mx-auto\">\r\n          <div className=\"bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 p-8 md:p-12\">\r\n            <h1 className=\"text-3xl font-bold text-slate-900 dark:text-white mb-2\">\r\n              Syarat & Ketentuan\r\n            </h1>\r\n            <p className=\"text-slate-500 dark:text-slate-400 mb-8\">\r\n              Terakhir diperbarui: 1 Februari 2026\r\n            </p>\r\n\r\n            <div className=\"prose prose-slate dark:prose-invert max-w-none\">\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  1. Penerimaan Ketentuan\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed\">\r\n                  Dengan mengakses atau menggunakan layanan Pelaris, Anda menyetujui untuk terikat oleh \r\n                  Syarat & Ketentuan ini. Jika Anda tidak setuju dengan bagian manapun dari ketentuan ini, \r\n                  Anda tidak diperkenankan menggunakan layanan kami.\r\n                </p>\r\n              </section>\r\n\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  2. Deskripsi Layanan\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed mb-4\">\r\n                  Pelaris adalah platform Point of Sale (POS) yang menyediakan:\r\n                </p>\r\n                <ul className=\"list-disc list-inside text-slate-600 dark:text-slate-300 space-y-2\">\r\n                  <li>Sistem kasir dan pencatatan transaksi</li>\r\n                  <li>Manajemen inventori dan stok barang</li>\r\n                  <li>Laporan penjualan dan analisis bisnis</li>\r\n                  <li>Manajemen multi-cabang dan pegawai</li>\r\n                  <li>Fitur mode offline dengan sinkronisasi otomatis</li>\r\n                </ul>\r\n              </section>\r\n\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  3. Akun Pengguna\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed mb-4\">\r\n                  Untuk menggunakan layanan Pelaris, Anda harus:\r\n                </p>\r\n                <ul className=\"list-disc list-inside text-slate-600 dark:text-slate-300 space-y-2\">\r\n                  <li>Berusia minimal 17 tahun atau memiliki izin dari orang tua/wali</li>\r\n                  <li>Memberikan informasi yang akurat dan lengkap saat pendaftaran</li>\r\n                  <li>Menjaga kerahasiaan password akun Anda</li>\r\n                  <li>Bertanggung jawab atas semua aktivitas yang terjadi di akun Anda</li>\r\n                </ul>\r\n              </section>\r\n\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  4. Penggunaan yang Dilarang\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed mb-4\">\r\n                  Anda dilarang menggunakan Pelaris untuk:\r\n                </p>\r\n                <ul className=\"list-disc list-inside text-slate-600 dark:text-slate-300 space-y-2\">\r\n                  <li>Aktivitas ilegal atau melanggar hukum yang berlaku</li>\r\n                  <li>Menyebarkan malware, virus, atau kode berbahaya</li>\r\n                  <li>Mencoba mengakses sistem atau data pengguna lain tanpa izin</li>\r\n                  <li>Melakukan tindakan yang dapat membahayakan sistem kami</li>\r\n                </ul>\r\n              </section>\r\n\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  5. Hak Kekayaan Intelektual\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed\">\r\n                  Semua konten, fitur, dan fungsionalitas Pelaris termasuk namun tidak terbatas pada \r\n                  desain, logo, teks, grafik, dan kode sumber adalah milik Pelaris dan dilindungi oleh \r\n                  undang-undang hak cipta dan merek dagang.\r\n                </p>\r\n              </section>\r\n\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  6. Batasan Tanggung Jawab\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed\">\r\n                  Pelaris disediakan \"sebagaimana adanya\" tanpa jaminan apapun. Kami tidak bertanggung \r\n                  jawab atas kerugian langsung, tidak langsung, insidental, atau konsekuensial yang \r\n                  timbul dari penggunaan layanan kami.\r\n                </p>\r\n              </section>\r\n\r\n              <section className=\"mb-8\">\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  7. Perubahan Ketentuan\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed\">\r\n                  Kami berhak mengubah Syarat & Ketentuan ini kapan saja. Perubahan akan berlaku segera \r\n                  setelah dipublikasikan di halaman ini. Penggunaan berkelanjutan atas layanan kami \r\n                  setelah perubahan berarti Anda menerima ketentuan yang diperbarui.\r\n                </p>\r\n              </section>\r\n\r\n              <section>\r\n                <h2 className=\"text-xl font-semibold text-slate-900 dark:text-white mb-4\">\r\n                  8. Kontak\r\n                </h2>\r\n                <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed\">\r\n                  Jika Anda memiliki pertanyaan tentang Syarat & Ketentuan ini, silakan hubungi kami di{' '}\r\n                  <a href=\"mailto:legal@pelaris.id\" className=\"text-slate-700 dark:text-slate-300 underline hover:no-underline\">\r\n                    legal@pelaris.id\r\n                  </a>\r\n                </p>\r\n              </section>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\ErrorBoundary.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'rerender' is assigned a value but never used.","line":75,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeAll, afterAll } from 'vitest';\r\nimport { render, screen, fireEvent } from '@testing-library/react';\r\nimport ErrorBoundary from './ErrorBoundary';\r\n\r\n// Component that throws an error\r\nconst ThrowError = ({ shouldThrow }: { shouldThrow: boolean }) => {\r\n  if (shouldThrow) {\r\n    throw new Error('Test error');\r\n  }\r\n  return <div>No error</div>;\r\n};\r\n\r\n// Suppress console.error for cleaner test output\r\nconst originalError = console.error;\r\nbeforeAll(() => {\r\n  console.error = vi.fn();\r\n});\r\nafterAll(() => {\r\n  console.error = originalError;\r\n});\r\n\r\ndescribe('ErrorBoundary', () => {\r\n  it('should render children when no error', () => {\r\n    render(\r\n      <ErrorBoundary>\r\n        <div>Child content</div>\r\n      </ErrorBoundary>\r\n    );\r\n\r\n    expect(screen.getByText('Child content')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should catch and display error UI', () => {\r\n    render(\r\n      <ErrorBoundary>\r\n        <ThrowError shouldThrow={true} />\r\n      </ErrorBoundary>\r\n    );\r\n\r\n    expect(screen.getByText('Terjadi Kesalahan')).toBeInTheDocument();\r\n    expect(screen.getByText(/Maaf, terjadi kesalahan/)).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render custom fallback when provided', () => {\r\n    render(\r\n      <ErrorBoundary fallback={<div>Custom error UI</div>}>\r\n        <ThrowError shouldThrow={true} />\r\n      </ErrorBoundary>\r\n    );\r\n\r\n    expect(screen.getByText('Custom error UI')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should have Coba Lagi button', () => {\r\n    render(\r\n      <ErrorBoundary>\r\n        <ThrowError shouldThrow={true} />\r\n      </ErrorBoundary>\r\n    );\r\n\r\n    expect(screen.getByText('Coba Lagi')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should have Muat Ulang button', () => {\r\n    render(\r\n      <ErrorBoundary>\r\n        <ThrowError shouldThrow={true} />\r\n      </ErrorBoundary>\r\n    );\r\n\r\n    expect(screen.getByText('Muat Ulang')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should reset error state when Coba Lagi is clicked', () => {\r\n    const { rerender } = render(\r\n      <ErrorBoundary>\r\n        <ThrowError shouldThrow={true} />\r\n      </ErrorBoundary>\r\n    );\r\n\r\n    expect(screen.getByText('Terjadi Kesalahan')).toBeInTheDocument();\r\n\r\n    // Click reset button - this resets internal state but component still throws\r\n    fireEvent.click(screen.getByText('Coba Lagi'));\r\n\r\n    // After reset, the error boundary tries to re-render children\r\n    // Since ThrowError still throws, it will show error UI again\r\n    // This is expected behavior - the test confirms reset mechanism works\r\n    expect(screen.getByText('Coba Lagi')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should call window.location.reload on Muat Ulang click', () => {\r\n    const reloadMock = vi.fn();\r\n    Object.defineProperty(window, 'location', {\r\n      value: { reload: reloadMock },\r\n      writable: true,\r\n    });\r\n\r\n    render(\r\n      <ErrorBoundary>\r\n        <ThrowError shouldThrow={true} />\r\n      </ErrorBoundary>\r\n    );\r\n\r\n    fireEvent.click(screen.getByText('Muat Ulang'));\r\n    expect(reloadMock).toHaveBeenCalled();\r\n  });\r\n\r\n  it('should log error to console', () => {\r\n    render(\r\n      <ErrorBoundary>\r\n        <ThrowError shouldThrow={true} />\r\n      </ErrorBoundary>\r\n    );\r\n\r\n    expect(console.error).toHaveBeenCalled();\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\ProtectedRoute.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\ProtectedRoute.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\ProtectedRoute.tsx:41:7\n  39 |   useEffect(() => {\n  40 |     if (checkAuth()) {\n> 41 |       setIsLoading(false);\n     |       ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  42 |     }\n  43 |   }, [checkAuth]);\n  44 |","line":41,"column":7,"nodeType":null,"endLine":41,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState, useCallback } from 'react';\r\nimport { useRouter, usePathname } from 'next/navigation';\r\nimport { isAuthenticated, hasRole, getAuth } from '@/lib/auth';\r\n\r\ninterface ProtectedRouteProps {\r\n  children: React.ReactNode;\r\n  allowedRoles?: string[];\r\n}\r\n\r\nexport default function ProtectedRoute({ children, allowedRoles }: ProtectedRouteProps) {\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  const checkAuth = useCallback(() => {\r\n    if (!isAuthenticated()) {\r\n      router.push('/login');\r\n      return false;\r\n    }\r\n    \r\n    const { user } = getAuth();\r\n    \r\n    // KASIR can only access /pos - redirect to /pos for any other page\r\n    if (user?.role === 'KASIR' && !pathname.startsWith('/pos')) {\r\n      router.push('/pos');\r\n      return false;\r\n    }\r\n    \r\n    if (allowedRoles && !hasRole(allowedRoles)) {\r\n      router.push('/access-denied');\r\n      return false;\r\n    }\r\n    \r\n    return true;\r\n  }, [router, allowedRoles, pathname]);\r\n\r\n  useEffect(() => {\r\n    if (checkAuth()) {\r\n      setIsLoading(false);\r\n    }\r\n  }, [checkAuth]);\r\n\r\n  // Listen for auth changes from other tabs (via localStorage storage event)\r\n  useEffect(() => {\r\n    const handleAuthChange = () => {\r\n      if (!isAuthenticated()) {\r\n        router.push('/login');\r\n      }\r\n    };\r\n\r\n    window.addEventListener('authChange', handleAuthChange);\r\n    window.addEventListener('storage', (e) => {\r\n      if (e.key === 'token' && !e.newValue) {\r\n        // Token was removed in another tab\r\n        router.push('/login');\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      window.removeEventListener('authChange', handleAuthChange);\r\n    };\r\n  }, [router]);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-slate-600\"></div>\r\n          <p className=\"mt-4 text-gray-600\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return <>{children}</>;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\TransactionHistory.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CachedTransaction' is defined but never used.","line":5,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":56},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1433,1436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1433,1436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2855,2858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2855,2858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3088,3091],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3088,3091],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3236,3239],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3236,3239],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'settingsLoaded' is assigned a value but never used.","line":108,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":108,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTransactions'. Either include it or remove the dependency array.","line":116,"column":6,"nodeType":"ArrayExpression","endLine":116,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [effectiveCabangId, fetchTransactions]","fix":{"range":[4038,4057],"text":"[effectiveCabangId, fetchTransactions]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'hasMultipleVariants'. Either include it or remove the dependency array.","line":129,"column":6,"nodeType":"ArrayExpression","endLine":129,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [requestItems, selectedTransaction, requestReason, hasMultipleVariants]","fix":{"range":[4472,4522],"text":"[requestItems, selectedTransaction, requestReason, hasMultipleVariants]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'searchProducts'. Either include it or remove the dependency array.","line":206,"column":6,"nodeType":"ArrayExpression","endLine":206,"endColumn":55,"suggestions":[{"desc":"Update the dependencies array to be: [productSearch, requestReason, effectiveCabangId, searchProducts]","fix":{"range":[6904,6953],"text":"[productSearch, requestReason, effectiveCabangId, searchProducts]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchTransactions'. Either include it or remove the dependency array.","line":229,"column":6,"nodeType":"ArrayExpression","endLine":229,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchTransactions]","fix":{"range":[7559,7561],"text":"[fetchTransactions]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":245,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8148,8151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8148,8151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":281,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9526,9529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9526,9529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":287,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":287,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9798,9801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9798,9801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":310,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":310,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10551,10554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10551,10554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":320,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":320,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11029,11032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11029,11032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleItemSelectForExchange' is assigned a value but never used.","line":414,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":414,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isOverdue' is assigned a value but never used.","line":432,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":432,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isWriteOffReason' is assigned a value but never used.","line":442,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":442,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":450,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":450,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":551,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":551,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19473,19476],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19473,19476],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":645,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":645,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24343,24346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24343,24346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":650,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":650,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24945,24948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24945,24948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":982,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":982,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45603,45606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45603,45606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { transactionsAPI, returnsAPI, api } from '@/lib/api';\r\nimport { getOfflineCacheService, type CachedTransaction } from '@/lib/offlineCache';\r\n\r\ninterface Transaction {\r\n  id: string;\r\n  transactionNo: string;\r\n  customerName?: string;\r\n  customerPhone?: string;\r\n  total: number;\r\n  totalAmount?: number; // Backend uses totalAmount\r\n  paymentMethod: string;\r\n  isSplitPayment: boolean;\r\n  paymentAmount1?: number;\r\n  paymentMethod2?: string;\r\n  paymentAmount2?: number;\r\n  createdAt: string;\r\n  hasReturnRequest?: boolean;\r\n  returnStatus?: 'PENDING' | 'APPROVED' | 'REJECTED' | 'COMPLETED';\r\n  items: Array<{\r\n    id: string;\r\n    productName?: string;\r\n    variantInfo?: string;\r\n    quantity: number;\r\n    price: number;\r\n    subtotal?: number;\r\n    productVariantId: string;\r\n    productVariant?: {\r\n      id: string;\r\n      variantName: string;\r\n      variantValue: string;\r\n      product: {\r\n        id: string;\r\n        name: string;\r\n      };\r\n    };\r\n  }>;\r\n}\r\n\r\ninterface ReturnableItem {\r\n  productVariantId: string;\r\n  productName: string;\r\n  variantInfo: string;\r\n  originalQty: number;\r\n  returnedQty: number;\r\n  returnableQty: number;\r\n  price: number;\r\n}\r\n\r\ninterface AppSettings {\r\n  returnEnabled: boolean;\r\n  returnDeadlineDays: number;\r\n  returnRequiresApproval: boolean;\r\n  exchangeEnabled: boolean;\r\n}\r\n\r\ninterface Props {\r\n  user: any;\r\n  onClose: () => void;\r\n  cabangId?: string | null;\r\n}\r\n\r\nexport default function TransactionHistory({ user, onClose, cabangId }: Props) {\r\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [search, setSearch] = useState('');\r\n  const [selectedTransaction, setSelectedTransaction] = useState<Transaction | null>(null);\r\n  const [showRequestModal, setShowRequestModal] = useState(false);\r\n  \r\n  // Offline state\r\n  const [isFromCache, setIsFromCache] = useState(false);\r\n  const [isOffline, setIsOffline] = useState(false);\r\n  const [cacheTime, setCacheTime] = useState<Date | null>(null);\r\n  const [requestItems, setRequestItems] = useState<{ [key: string]: number }>({});\r\n  const [requestReason, setRequestReason] = useState('CUSTOMER_REQUEST');\r\n  const [requestReasonDetail, setRequestReasonDetail] = useState('');\r\n  const [requestNotes, setRequestNotes] = useState('');\r\n  const [requestConditionNote, setRequestConditionNote] = useState('');\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [photoUrls, setPhotoUrls] = useState<string[]>([]);\r\n  const [managerOverride, setManagerOverride] = useState(false);\r\n  \r\n  // Exchange product selection\r\n  const [exchangeVariants, setExchangeVariants] = useState<{ [originalVariantId: string]: string }>({});\r\n  const [availableVariants, setAvailableVariants] = useState<any[]>([]);\r\n  const [loadingVariants, setLoadingVariants] = useState(false);\r\n  \r\n  // For WRONG_ITEM - product search\r\n  const [productSearch, setProductSearch] = useState('');\r\n  const [searchResults, setSearchResults] = useState<any[]>([]);\r\n  const [loadingSearch, setLoadingSearch] = useState(false);\r\n  const [selectedExchangeProduct, setSelectedExchangeProduct] = useState<any>(null);\r\n  const searchRequestRef = useRef<number>(0); // Track search request to prevent race conditions\r\n  \r\n  // Returnable quantities tracking\r\n  const [returnableItems, setReturnableItems] = useState<ReturnableItem[]>([]);\r\n  const [loadingReturnable, setLoadingReturnable] = useState(false);\r\n  \r\n  // Settings from backend\r\n  const [appSettings, setAppSettings] = useState<AppSettings>({\r\n    returnEnabled: false,\r\n    returnDeadlineDays: 7,\r\n    returnRequiresApproval: true,\r\n    exchangeEnabled: false,\r\n  });\r\n  const [settingsLoaded, setSettingsLoaded] = useState(false);\r\n\r\n  // Get effective cabang ID (use prop if provided, otherwise user's cabang)\r\n  const effectiveCabangId = cabangId || user?.cabangId;\r\n\r\n  useEffect(() => {\r\n    loadSettings();\r\n    fetchTransactions();\r\n  }, [effectiveCabangId]);\r\n\r\n  // Auto-reset WRONG_SIZE if no variant items selected\r\n  useEffect(() => {\r\n    if (!selectedTransaction || requestReason !== 'WRONG_SIZE') return;\r\n    \r\n    const hasVariantItems = selectedTransaction.items.some(\r\n      item => (requestItems[item.productVariantId] || 0) > 0 && hasMultipleVariants(item)\r\n    );\r\n    \r\n    if (!hasVariantItems) {\r\n      setRequestReason('CUSTOMER_REQUEST');\r\n    }\r\n  }, [requestItems, selectedTransaction, requestReason]);\r\n\r\n  const loadSettings = async () => {\r\n    try {\r\n      const response = await api.get('/settings/app');\r\n      setAppSettings(response.data);\r\n    } catch (error) {\r\n      console.error('Error loading app settings:', error);\r\n    } finally {\r\n      setSettingsLoaded(true);\r\n    }\r\n  };\r\n\r\n  // Load variants for a specific product (for WRONG_SIZE exchange)\r\n  const loadVariantsForProduct = async (productId: string) => {\r\n    setLoadingVariants(true);\r\n    try {\r\n      const response = await api.get(`/products/${productId}`);\r\n      const product = response.data;\r\n      if (product?.variants) {\r\n        setAvailableVariants(product.variants);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading variants:', error);\r\n    } finally {\r\n      setLoadingVariants(false);\r\n    }\r\n  };\r\n\r\n  // Search products (for WRONG_ITEM exchange)\r\n  const searchProducts = async (query: string, requestId: number) => {\r\n    if (query.length < 2) {\r\n      setSearchResults([]);\r\n      return;\r\n    }\r\n    setLoadingSearch(true);\r\n    try {\r\n      const response = await api.get(`/products?search=${encodeURIComponent(query)}&cabangId=${effectiveCabangId}`);\r\n      // Only update results if this is still the latest request\r\n      if (requestId === searchRequestRef.current) {\r\n        const products = Array.isArray(response.data) ? response.data : (response.data?.data || response.data?.products || []);\r\n        setSearchResults(products);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error searching products:', error);\r\n      if (requestId === searchRequestRef.current) {\r\n        setSearchResults([]);\r\n      }\r\n    } finally {\r\n      if (requestId === searchRequestRef.current) {\r\n        setLoadingSearch(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Debounced product search - only trigger when reason is WRONG_ITEM\r\n  useEffect(() => {\r\n    // Only search when in WRONG_ITEM mode\r\n    if (requestReason !== 'WRONG_ITEM') {\r\n      return;\r\n    }\r\n    \r\n    if (!productSearch || productSearch.length < 2) {\r\n      setSearchResults([]);\r\n      setLoadingSearch(false);\r\n      return;\r\n    }\r\n    \r\n    // Increment request ID\r\n    const requestId = ++searchRequestRef.current;\r\n    setLoadingSearch(true);\r\n    \r\n    const timer = setTimeout(() => {\r\n      searchProducts(productSearch, requestId);\r\n    }, 500);\r\n    \r\n    return () => clearTimeout(timer);\r\n  }, [productSearch, requestReason, effectiveCabangId]);\r\n\r\n  // Listen for online/offline events\r\n  useEffect(() => {\r\n    const handleOnline = () => {\r\n      setIsOffline(false);\r\n      // Refetch when back online\r\n      fetchTransactions();\r\n    };\r\n    const handleOffline = () => {\r\n      setIsOffline(true);\r\n    };\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n    \r\n    // Set initial state\r\n    setIsOffline(!navigator.onLine);\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, []);\r\n\r\n  const fetchTransactions = async () => {\r\n    setLoading(true);\r\n    const cacheService = getOfflineCacheService();\r\n    await cacheService.initialize();\r\n    \r\n    const cabangIdToUse = effectiveCabangId || 'default';\r\n    \r\n    // Check if we're offline - load from cache directly\r\n    if (!navigator.onLine) {\r\n      try {\r\n        const cached = await cacheService.getCachedTransactions(cabangIdToUse);\r\n        const meta = await cacheService.getCacheMetadata(`transactions_${cabangIdToUse}`);\r\n        \r\n        if (cached.length > 0) {\r\n          setTransactions(cached as any);\r\n          setIsFromCache(true);\r\n          setCacheTime(meta?.lastUpdated ? new Date(meta.lastUpdated) : null);\r\n        } else {\r\n          setTransactions([]);\r\n          setIsFromCache(false);\r\n        }\r\n      } catch (error) {\r\n        console.error('[History] Error loading from cache:', error);\r\n        setTransactions([]);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n      return;\r\n    }\r\n    \r\n    // Online - try to fetch from server\r\n    try {\r\n      const res = await transactionsAPI.getTransactions({\r\n        cabangId: effectiveCabangId || undefined,\r\n      });\r\n      \r\n      // Backend returns paginated response: { data: [...], pagination: {...} }\r\n      const txList = Array.isArray(res.data) ? res.data : (res.data?.data || res.data?.transactions || []);\r\n      \r\n      // Check return status for each transaction\r\n      let finalTxList = txList;\r\n      try {\r\n        const returnsRes = await returnsAPI.getReturns({\r\n          cabangId: effectiveCabangId,\r\n        });\r\n        const returns = Array.isArray(returnsRes.data) ? returnsRes.data : (returnsRes.data?.returns || []);\r\n        \r\n        finalTxList = txList.map((tx: Transaction) => {\r\n          // Find active return (PENDING or COMPLETED only)\r\n          // REJECTED returns should allow user to submit new return request\r\n          const activeReturn = returns.find((ret: any) => \r\n            ret.transactionId === tx.id && \r\n            (ret.status === 'PENDING' || ret.status === 'COMPLETED')\r\n          );\r\n          \r\n          // Also get any return for status display (including rejected)\r\n          const anyReturn = returns.find((ret: any) => ret.transactionId === tx.id);\r\n          \r\n          return {\r\n            ...tx,\r\n            hasReturnRequest: !!activeReturn, // Only block if PENDING or COMPLETED\r\n            returnStatus: anyReturn?.status   // Show any status for display\r\n          };\r\n        });\r\n      } catch {\r\n        // Continue with txList without return status\r\n      }\r\n      \r\n      setTransactions(finalTxList);\r\n      setIsFromCache(false);\r\n      setCacheTime(null);\r\n      \r\n      // Cache the transactions for offline use\r\n      try {\r\n        await cacheService.cacheTransactions(cabangIdToUse, finalTxList);\r\n      } catch (cacheError) {\r\n        console.error('[History] Error caching transactions:', cacheError);\r\n      }\r\n      \r\n    } catch (error: any) {\r\n      console.error('[History] Error fetching transactions:', error);\r\n      \r\n      // If network error, try to load from cache\r\n      if (error.code === 'ERR_NETWORK' || !error.response) {\r\n        try {\r\n          const cached = await cacheService.getCachedTransactions(cabangIdToUse);\r\n          const meta = await cacheService.getCacheMetadata(`transactions_${cabangIdToUse}`);\r\n          \r\n          if (cached.length > 0) {\r\n            setTransactions(cached as any);\r\n            setIsFromCache(true);\r\n            setCacheTime(meta?.lastUpdated ? new Date(meta.lastUpdated) : null);\r\n          } else {\r\n            setTransactions([]);\r\n          }\r\n        } catch (cacheError) {\r\n          console.error('[History] Error loading from cache:', cacheError);\r\n          setTransactions([]);\r\n        }\r\n      } else {\r\n        setTransactions([]);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Helper functions to get item display info\r\n  const getProductName = (item: Transaction['items'][0]) => {\r\n    return item.productName || item.productVariant?.product?.name || 'Unknown Product';\r\n  };\r\n\r\n  const getVariantInfo = (item: Transaction['items'][0]) => {\r\n    if (item.variantInfo) return item.variantInfo;\r\n    if (item.productVariant) {\r\n      return item.productVariant.variantValue;\r\n    }\r\n    return '';\r\n  };\r\n\r\n  // Check if item has multiple variants (not a single product)\r\n  const hasMultipleVariants = (item: Transaction['items'][0]) => {\r\n    const variantInfo = getVariantInfo(item);\r\n    // Single products have default variant values\r\n    const defaultValues = ['Default', 'Standar', 'Standard', 'default', 'standar', 'standard'];\r\n    return variantInfo && !defaultValues.includes(variantInfo);\r\n  };\r\n\r\n  const getSubtotal = (item: Transaction['items'][0]) => {\r\n    return item.subtotal || (item.price * item.quantity);\r\n  };\r\n\r\n  const getTotal = (transaction: Transaction) => {\r\n    return transaction.total || transaction.totalAmount || 0;\r\n  };\r\n\r\n  const filteredTransactions = transactions.filter((t) =>\r\n    t.transactionNo.toLowerCase().includes(search.toLowerCase()) ||\r\n    t.customerName?.toLowerCase().includes(search.toLowerCase()) ||\r\n    t.customerPhone?.includes(search)\r\n  );\r\n\r\n  const handleRequestClick = async (transaction: Transaction) => {\r\n    setSelectedTransaction(transaction);\r\n    setShowRequestModal(true);\r\n    const items: { [key: string]: number } = {};\r\n    transaction.items.forEach((item) => {\r\n      items[item.productVariantId] = 0;\r\n    });\r\n    setRequestItems(items);\r\n    setPhotoUrls([]);\r\n    setRequestReasonDetail('');\r\n    setRequestConditionNote('');\r\n    setManagerOverride(false);\r\n    setExchangeVariants({});\r\n    setAvailableVariants([]);\r\n    setSelectedExchangeProduct(null);\r\n    setProductSearch('');\r\n    setSearchResults([]);\r\n    \r\n    // Fetch returnable quantities\r\n    setLoadingReturnable(true);\r\n    try {\r\n      const res = await returnsAPI.getReturnableQty(transaction.id);\r\n      setReturnableItems(res.data.items || []);\r\n    } catch (error) {\r\n      console.error('Error fetching returnable quantities:', error);\r\n      // Fallback: assume all quantities are returnable\r\n      setReturnableItems(transaction.items.map(item => ({\r\n        productVariantId: item.productVariantId,\r\n        productName: item.productName || '',\r\n        variantInfo: item.variantInfo || '',\r\n        originalQty: item.quantity,\r\n        returnedQty: 0,\r\n        returnableQty: item.quantity,\r\n        price: item.price,\r\n      })));\r\n    } finally {\r\n      setLoadingReturnable(false);\r\n    }\r\n  };\r\n\r\n  // Load variants when selecting an item for WRONG_SIZE exchange\r\n  const handleItemSelectForExchange = async (item: Transaction['items'][0], qty: number) => {\r\n    setRequestItems({\r\n      ...requestItems,\r\n      [item.productVariantId]: qty,\r\n    });\r\n    \r\n    // Load variants for this product if exchange mode\r\n    if (requestReason === 'WRONG_SIZE' && item.productVariant?.product?.id) {\r\n      await loadVariantsForProduct(item.productVariant.product.id);\r\n    }\r\n  };\r\n\r\n  const getDaysSinceTransaction = (createdAt: string): number => {\r\n    const transactionDate = new Date(createdAt);\r\n    const today = new Date();\r\n    return Math.floor((today.getTime() - transactionDate.getTime()) / (1000 * 60 * 60 * 24));\r\n  };\r\n\r\n  const isOverdue = (transaction: Transaction): boolean => {\r\n    return getDaysSinceTransaction(transaction.createdAt) > appSettings.returnDeadlineDays;\r\n  };\r\n\r\n  // Check if the reason is for exchange (tukar barang)\r\n  const isExchangeReason = (reason: string): boolean => {\r\n    return ['WRONG_SIZE', 'WRONG_ITEM', 'DEFECTIVE', 'EXPIRED'].includes(reason);\r\n  };\r\n\r\n  // Check if it's a write-off exchange (barang rusak tidak masuk stok)\r\n  const isWriteOffReason = (reason: string): boolean => {\r\n    return reason === 'DEFECTIVE' || reason === 'EXPIRED';\r\n  };\r\n\r\n  const handleRequestSubmit = async () => {\r\n    if (!selectedTransaction) return;\r\n\r\n    const itemsToReturn = Object.entries(requestItems)\r\n      .filter(([_, qty]) => (qty as number) > 0)\r\n      .map(([variantId, qty]) => {\r\n        const item = selectedTransaction.items.find((i) => i.productVariantId === variantId);\r\n        return {\r\n          productVariantId: variantId,\r\n          quantity: qty as number,\r\n          price: item!.price,\r\n        };\r\n      });\r\n\r\n    if (itemsToReturn.length === 0) {\r\n      alert('Pilih minimal 1 item untuk diretur');\r\n      return;\r\n    }\r\n\r\n    // Validate exchange selections\r\n    if (requestReason === 'WRONG_SIZE') {\r\n      const hasAllVariants = itemsToReturn.every(item => exchangeVariants[item.productVariantId]);\r\n      if (!hasAllVariants) {\r\n        alert('Pilih varian pengganti untuk semua item yang akan ditukar');\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (requestReason === 'WRONG_ITEM') {\r\n      if (!selectedExchangeProduct) {\r\n        alert('Pilih produk pengganti untuk item yang akan ditukar');\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Check if overdue and needs manager override\r\n    const daysSince = getDaysSinceTransaction(selectedTransaction.createdAt);\r\n    const needsOverride = daysSince > appSettings.returnDeadlineDays;\r\n\r\n    if (needsOverride && !managerOverride && user?.role !== 'OWNER' && user?.role !== 'MANAGER') {\r\n      alert(`Transaksi ini sudah ${daysSince} hari (batas: ${appSettings.returnDeadlineDays} hari).\\n\\nPerlu persetujuan Manager/Owner untuk melanjutkan.`);\r\n      return;\r\n    }\r\n\r\n    // Prepare exchange items data\r\n    let exchangeItems: Array<{\r\n      productVariantId: string;\r\n      quantity: number;\r\n    }> | undefined;\r\n\r\n    if (requestReason === 'WRONG_SIZE') {\r\n      exchangeItems = itemsToReturn.map(item => ({\r\n        productVariantId: exchangeVariants[item.productVariantId],\r\n        quantity: item.quantity,\r\n      }));\r\n    } else if (requestReason === 'WRONG_ITEM' && selectedExchangeProduct) {\r\n      // For WRONG_ITEM, exchange all items to the selected product\r\n      const totalQty = itemsToReturn.reduce((sum, item) => sum + item.quantity, 0);\r\n      exchangeItems = [{\r\n        productVariantId: selectedExchangeProduct.variantId,\r\n        quantity: totalQty,\r\n      }];\r\n    } else if (requestReason === 'DEFECTIVE' || requestReason === 'EXPIRED') {\r\n      // For DEFECTIVE/EXPIRED, exchange with same product variant (new unit)\r\n      exchangeItems = itemsToReturn.map(item => ({\r\n        productVariantId: item.productVariantId, // Same variant\r\n        quantity: item.quantity,\r\n      }));\r\n    }\r\n\r\n    try {\r\n      setSubmitting(true);\r\n      \r\n      await returnsAPI.createReturn({\r\n        transactionId: selectedTransaction.id,\r\n        cabangId: effectiveCabangId,\r\n        reason: requestReason,\r\n        reasonDetail: requestReason === 'OTHER' ? requestReasonDetail : undefined,\r\n        notes: requestNotes || undefined,\r\n        conditionNote: requestConditionNote || undefined,\r\n        photoUrls: photoUrls.length > 0 ? photoUrls : undefined,\r\n        items: itemsToReturn,\r\n        refundMethod: selectedTransaction.paymentMethod,\r\n        managerOverride: needsOverride ? managerOverride : undefined,\r\n        exchangeItems: exchangeItems,\r\n      });\r\n      \r\n      const messageType = isExchangeReason(requestReason) ? 'Tukar' : 'Return';\r\n      alert(`${messageType} request berhasil dikirim!\\n\\nRequest Anda akan diproses oleh Manager/Owner.`);\r\n      \r\n      setShowRequestModal(false);\r\n      setSelectedTransaction(null);\r\n      setRequestItems({});\r\n      setRequestReason('CUSTOMER_REQUEST');\r\n      setRequestReasonDetail('');\r\n      setRequestNotes('');\r\n      setRequestConditionNote('');\r\n      setPhotoUrls([]);\r\n      setManagerOverride(false);\r\n      setExchangeVariants({});\r\n      setSelectedExchangeProduct(null);\r\n      setProductSearch('');\r\n      setSearchResults([]);\r\n      \r\n      await fetchTransactions();\r\n    } catch (error: any) {\r\n      console.error('[History] Error creating return request:', error);\r\n      const errorData = error.response?.data;\r\n      \r\n      if (errorData?.requiresManagerOverride) {\r\n        alert(`Transaksi ini sudah ${errorData.daysSinceTransaction} hari (batas: ${errorData.deadline} hari).\\n\\nPerlu persetujuan Manager/Owner.`);\r\n      } else {\r\n        const errorMessage = errorData?.error || error.message || 'Gagal mengirim request';\r\n        alert('Gagal mengirim request return:\\n\\n' + errorMessage);\r\n      }\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const getTotalReturn = () => {\r\n    if (!selectedTransaction) return 0;\r\n    return Object.entries(requestItems).reduce((sum, [variantId, qty]) => {\r\n      const item = selectedTransaction.items.find((i) => i.productVariantId === variantId);\r\n      return sum + (item ? item.price * (qty as number) : 0);\r\n    }, 0);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-xl p-8\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-600 mx-auto\"></div>\r\n          <p className=\"text-center mt-4 text-gray-600 dark:text-gray-400\">Loading...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {/* History Modal */}\r\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\r\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\r\n          <div className=\"p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <h3 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Riwayat Transaksi</h3>\r\n              {/* Offline/Cache Indicator */}\r\n              {(isOffline || isFromCache) && (\r\n                <div className=\"flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400\">\r\n                  <svg className=\"w-3.5 h-3.5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                  </svg>\r\n                  <span>\r\n                    {isOffline ? 'Mode Offline' : 'Data tersimpan lokal'}\r\n                    {cacheTime && ` ΓÇó ${cacheTime.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}`}\r\n                  </span>\r\n                </div>\r\n              )}\r\n            </div>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\"\r\n            >\r\n              <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\r\n            <input\r\n              type=\"text\"\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n              placeholder=\"Cari invoice number, nama customer, atau nomor HP...\"\r\n              className=\"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-slate-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex-1 overflow-y-auto p-6\">\r\n            {filteredTransactions.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <p className=\"text-gray-500 dark:text-gray-400\">\r\n                  {search ? 'Tidak ada transaksi yang cocok' : 'Belum ada transaksi'}\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {filteredTransactions.map((transaction) => (\r\n                  <div\r\n                    key={transaction.id}\r\n                    className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-md transition-shadow\"\r\n                  >\r\n                    <div className=\"flex items-start justify-between mb-3\">\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\r\n                          <p className=\"font-semibold text-gray-900 dark:text-white\">{transaction.transactionNo}</p>\r\n                          {/* Offline transaction badge */}\r\n                          {(transaction as any).isOffline && (\r\n                            <span className=\"px-2 py-0.5 bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300 text-xs font-semibold rounded-full flex items-center gap-1\">\r\n                              <svg className=\"w-3 h-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" />\r\n                              </svg>\r\n                              {(transaction as any).syncStatus === 'pending' ? 'Belum Sync' : 'Offline'}\r\n                            </span>\r\n                          )}\r\n                          {transaction.returnStatus === 'APPROVED' && (\r\n                            <span className=\"px-2 py-0.5 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300 text-xs font-semibold rounded-full\">\r\n                              Approved\r\n                            </span>\r\n                          )}\r\n                          {transaction.returnStatus === 'REJECTED' && (\r\n                            <span className=\"px-2 py-0.5 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 text-xs font-semibold rounded-full\">\r\n                              Rejected\r\n                            </span>\r\n                          )}\r\n                          {transaction.returnStatus === 'PENDING' && (\r\n                            <span className=\"px-2 py-0.5 bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300 text-xs font-semibold rounded-full\">\r\n                              ΓÅ│ Pending\r\n                            </span>\r\n                          )}\r\n                          {transaction.returnStatus === 'COMPLETED' && (\r\n                            <span className=\"px-2 py-0.5 bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 text-xs font-semibold rounded-full\">\r\n                              Completed\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                          {new Date(transaction.createdAt).toLocaleString('id-ID')}\r\n                        </p>\r\n                        {transaction.customerName && (\r\n                          <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\r\n                            {transaction.customerName}\r\n                            {transaction.customerPhone && ` - ${transaction.customerPhone}`}\r\n                          </p>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        <p className=\"text-lg font-bold text-gray-900 dark:text-white\">\r\n                          Rp {getTotal(transaction).toLocaleString('id-ID')}\r\n                        </p>\r\n                        {transaction.isSplitPayment ? (\r\n                          <div className=\"text-xs text-blue-600 dark:text-blue-400 mt-1\">\r\n                            <p>{transaction.paymentMethod}: Rp {transaction.paymentAmount1?.toLocaleString('id-ID')}</p>\r\n                            <p>{transaction.paymentMethod2}: Rp {transaction.paymentAmount2?.toLocaleString('id-ID')}</p>\r\n                          </div>\r\n                        ) : (\r\n                          <p className=\"text-sm text-gray-600 dark:text-gray-400\">{transaction.paymentMethod}</p>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"border-t border-gray-200 dark:border-gray-700 pt-3\">\r\n                      <p className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Items:</p>\r\n                      <div className=\"space-y-1\">\r\n                        {transaction.items.map((item) => {\r\n                          const productName = getProductName(item);\r\n                          const variantInfo = getVariantInfo(item);\r\n                          const subtotal = getSubtotal(item);\r\n                          const showVariant = variantInfo && !['Default', 'Standar', 'Standard', 'default', 'standar', 'standard', 'Default: Default', 'Default: Standard', 'Default: Standar', '-', ''].includes(variantInfo);\r\n                          return (\r\n                            <div key={item.id} className=\"flex justify-between text-sm text-gray-600 dark:text-gray-400\">\r\n                              <span>\r\n                                {item.quantity}x {productName}\r\n                                {showVariant && ` (${variantInfo})`}\r\n                              </span>\r\n                              <span>Rp {subtotal.toLocaleString('id-ID')}</span>\r\n                            </div>\r\n                          );\r\n                        })}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"mt-4\">\r\n                      {!appSettings.returnEnabled ? (\r\n                        <div className=\"w-full py-2 rounded-lg font-medium bg-gray-200 dark:bg-gray-700 text-gray-400 dark:text-gray-500 flex items-center justify-center gap-2 cursor-not-allowed\">\r\n                          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636\" />\r\n                          </svg>\r\n                          Fitur Retur Tidak Aktif\r\n                        </div>\r\n                      ) : transaction.hasReturnRequest ? (\r\n                        <div className=\"w-full py-2 rounded-lg font-medium bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 flex items-center justify-center gap-2 cursor-not-allowed\">\r\n                          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                          </svg>\r\n                          Return Sudah Diajukan\r\n                        </div>\r\n                      ) : (\r\n                        <button\r\n                          onClick={() => handleRequestClick(transaction)}\r\n                          className=\"w-full py-2 rounded-lg font-medium transition-colors bg-orange-600 text-white hover:bg-orange-700 flex items-center justify-center gap-2\"\r\n                        >\r\n                          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6\" />\r\n                          </svg>\r\n                          Request Return / Tukar\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Request Return Modal */}\r\n      {showRequestModal && selectedTransaction && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4\">\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\r\n            <div className=\"p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between\">\r\n              <div>\r\n                <h3 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\r\n                  {isExchangeReason(requestReason) ? 'Request Tukar Barang' : 'Request Return Barang'}\r\n                </h3>\r\n                <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">{selectedTransaction.transactionNo}</p>\r\n                <p className=\"text-xs text-gray-400 dark:text-gray-500 mt-0.5\">\r\n                  {appSettings.returnRequiresApproval \r\n                    ? 'Request akan dikirim ke Manager/Owner untuk diproses'\r\n                    : 'Request akan langsung diproses'}\r\n                </p>\r\n              </div>\r\n              <button\r\n                onClick={() => {\r\n                  setShowRequestModal(false);\r\n                  setSelectedTransaction(null);\r\n                }}\r\n                className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\"\r\n              >\r\n                <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"flex-1 overflow-y-auto p-6 space-y-4\">\r\n              {/* Items */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Pilih Item & Jumlah Return\r\n                </label>\r\n                {loadingReturnable ? (\r\n                  <div className=\"flex items-center justify-center p-4\">\r\n                    <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-red-600\"></div>\r\n                    <span className=\"ml-2 text-gray-500 dark:text-gray-400\">Memuat data...</span>\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-2\">\r\n                    {selectedTransaction.items.map((item) => {\r\n                      const productName = getProductName(item);\r\n                      const variantInfo = getVariantInfo(item);\r\n                      const showVariant = variantInfo && !['Default', 'Standar', 'Standard', 'default', 'standar', 'standard', 'Default: Default', 'Default: Standard', 'Default: Standar'].includes(variantInfo);\r\n                      \r\n                      // Get returnable info\r\n                      const returnableInfo = returnableItems.find(ri => ri.productVariantId === item.productVariantId);\r\n                      const maxReturnable = returnableInfo?.returnableQty ?? item.quantity;\r\n                      const returnedQty = returnableInfo?.returnedQty ?? 0;\r\n                      const isFullyReturned = maxReturnable <= 0;\r\n                      \r\n                      return (\r\n                        <div key={item.productVariantId} className={`flex items-center gap-3 p-3 border rounded-lg ${isFullyReturned ? 'border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/50 opacity-60' : 'border-gray-200 dark:border-gray-700'}`}>\r\n                          <div className=\"flex-1\">\r\n                            <p className={`font-medium ${isFullyReturned ? 'text-gray-500 dark:text-gray-400' : 'text-gray-900 dark:text-white'}`}>{productName}</p>\r\n                            {showVariant && (\r\n                              <p className=\"text-sm text-gray-500 dark:text-gray-400\">{variantInfo}</p>\r\n                            )}\r\n                            <p className=\"text-sm text-gray-600 dark:text-gray-400\">Rp {item.price.toLocaleString('id-ID')} x {item.quantity}</p>\r\n                            {/* Show returnable info */}\r\n                            {returnedQty > 0 && (\r\n                              <p className=\"text-xs text-amber-600 dark:text-amber-400 mt-1\">\r\n                                Sudah diretur: {returnedQty} | Sisa: {maxReturnable}\r\n                              </p>\r\n                            )}\r\n                            {isFullyReturned && (\r\n                              <p className=\"text-xs text-red-600 dark:text-red-400 mt-1 font-medium\">\r\n                                Γ£ô Sudah diretur semua\r\n                              </p>\r\n                            )}\r\n                          </div>\r\n                          <input\r\n                            type=\"number\"\r\n                            min=\"0\"\r\n                            max={maxReturnable}\r\n                            value={requestItems[item.productVariantId] || 0}\r\n                            disabled={isFullyReturned}\r\n                            onChange={(e) => {\r\n                              const val = parseInt(e.target.value) || 0;\r\n                              setRequestItems({\r\n                                ...requestItems,\r\n                                [item.productVariantId]: Math.min(Math.max(0, val), maxReturnable),\r\n                              });\r\n                            }}\r\n                            className={`w-20 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white ${isFullyReturned ? 'cursor-not-allowed bg-gray-100 dark:bg-gray-600' : ''}`}\r\n                          />\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Reason */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Alasan *\r\n                </label>\r\n                <select\r\n                  value={requestReason}\r\n                  onChange={(e) => setRequestReason(e.target.value)}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                >\r\n                  <optgroup label=\"Return (Refund) - Uang Kembali\">\r\n                    <option value=\"CUSTOMER_REQUEST\">Permintaan Customer</option>\r\n                    <option value=\"OTHER\">Lainnya</option>\r\n                  </optgroup>\r\n                  {appSettings.exchangeEnabled && (() => {\r\n                    // Check if any selected item has variants\r\n                    const hasVariantItems = selectedTransaction.items.some(\r\n                      item => (requestItems[item.productVariantId] || 0) > 0 && hasMultipleVariants(item)\r\n                    );\r\n                    return (\r\n                      <optgroup label=\"Tukar Barang - Ganti Unit Baru\">\r\n                        {hasVariantItems && (\r\n                          <option value=\"WRONG_SIZE\">Salah Ukuran (Tukar Varian)</option>\r\n                        )}\r\n                        <option value=\"WRONG_ITEM\">Salah Barang (Tukar Produk)</option>\r\n                        <option value=\"DEFECTIVE\">Barang Rusak/Cacat (Ganti Baru)</option>\r\n                        <option value=\"EXPIRED\">Kadaluarsa (Ganti Baru)</option>\r\n                      </optgroup>\r\n                    );\r\n                  })()}\r\n                </select>\r\n                \r\n                {/* Exchange Info */}\r\n                {isExchangeReason(requestReason) && (\r\n                  <div className=\"mt-2 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-800\">\r\n                    <p className=\"text-sm text-blue-700 dark:text-blue-300\">\r\n                      <strong>Mode Tukar:</strong> Barang lama akan dikembalikan dan ditukar dengan barang baru.\r\n                      {requestReason === 'WRONG_SIZE' && ' Pilih varian/ukuran lain dari produk yang sama di bawah.'}\r\n                      {requestReason === 'WRONG_ITEM' && ' Cari dan pilih produk pengganti di bawah.'}\r\n                      {(requestReason === 'DEFECTIVE' || requestReason === 'EXPIRED') && ' Barang lama akan di-write off (tidak masuk stok).'}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Exchange: Variant Picker for WRONG_SIZE */}\r\n              {requestReason === 'WRONG_SIZE' && (\r\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-700\">\r\n                  <label className=\"block text-sm font-medium text-blue-700 dark:text-blue-300 mb-3\">\r\n                    Pilih Varian Pengganti *\r\n                  </label>\r\n                  {selectedTransaction.items.filter(item => (requestItems[item.productVariantId] || 0) > 0).length === 0 ? (\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                      Pilih item yang ingin ditukar terlebih dahulu\r\n                    </p>\r\n                  ) : (\r\n                    <div className=\"space-y-3\">\r\n                      {selectedTransaction.items\r\n                        .filter(item => (requestItems[item.productVariantId] || 0) > 0)\r\n                        .map((item) => {\r\n                          const productName = getProductName(item);\r\n                          const productId = item.productVariant?.product?.id;\r\n                          return (\r\n                            <div key={item.productVariantId} className=\"bg-white dark:bg-gray-800 p-3 rounded-lg\">\r\n                              <p className=\"font-medium text-gray-900 dark:text-white mb-2\">\r\n                                {productName} ΓåÆ Tukar ke:\r\n                              </p>\r\n                              {productId ? (\r\n                                <select\r\n                                  value={exchangeVariants[item.productVariantId] || ''}\r\n                                  onChange={(e) => setExchangeVariants({\r\n                                    ...exchangeVariants,\r\n                                    [item.productVariantId]: e.target.value\r\n                                  })}\r\n                                  onFocus={() => loadVariantsForProduct(productId)}\r\n                                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                                >\r\n                                  <option value=\"\">-- Pilih Varian Baru --</option>\r\n                                  {loadingVariants ? (\r\n                                    <option disabled>Loading...</option>\r\n                                  ) : (\r\n                                    availableVariants\r\n                                      .filter(v => v.id !== item.productVariantId) // Exclude current variant\r\n                                      .map(v => (\r\n                                        <option key={v.id} value={v.id}>\r\n                                          {v.variantValue} - Rp {v.stocks?.[0]?.price?.toLocaleString('id-ID') || 'N/A'}\r\n                                        </option>\r\n                                      ))\r\n                                  )}\r\n                                </select>\r\n                              ) : (\r\n                                <p className=\"text-sm text-red-500\">Produk tidak ditemukan</p>\r\n                              )}\r\n                            </div>\r\n                          );\r\n                        })}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Exchange: Product Search for WRONG_ITEM */}\r\n              {requestReason === 'WRONG_ITEM' && (\r\n                <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-700\">\r\n                  <label className=\"block text-sm font-medium text-blue-700 dark:text-blue-300 mb-3\">\r\n                    Cari Produk Pengganti *\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={productSearch}\r\n                    onChange={(e) => setProductSearch(e.target.value)}\r\n                    placeholder=\"Ketik nama produk atau SKU (min 2 karakter)...\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white mb-3\"\r\n                  />\r\n                  \r\n                  {loadingSearch && (\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">Mencari...</p>\r\n                  )}\r\n\r\n                  {!loadingSearch && productSearch.length >= 2 && searchResults.length === 0 && (\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                      Tidak ada produk ditemukan untuk &quot;{productSearch}&quot;\r\n                    </p>\r\n                  )}\r\n                  \r\n                  {searchResults.length > 0 && (\r\n                    <div className=\"max-h-48 overflow-y-auto space-y-2 border border-gray-200 dark:border-gray-600 rounded-lg\">\r\n                      {searchResults.map((product) => (\r\n                        <div key={product.id} className=\"bg-white dark:bg-gray-800 p-3 border-b border-gray-100 dark:border-gray-700 last:border-b-0\">\r\n                          <p className=\"font-medium text-gray-900 dark:text-white\">{product.name}</p>\r\n                          {product.variants && product.variants.length > 0 ? (\r\n                            <div className=\"mt-2 space-y-1\">\r\n                              {product.variants.map((variant: any) => (\r\n                                <button\r\n                                  key={variant.id}\r\n                                  type=\"button\"\r\n                                  onClick={() => {\r\n                                    setSelectedExchangeProduct({\r\n                                      productId: product.id,\r\n                                      productName: product.name,\r\n                                      variantId: variant.id,\r\n                                      variantInfo: variant.variantValue,\r\n                                      price: variant.stocks?.[0]?.price || 0,\r\n                                      sku: variant.sku\r\n                                    });\r\n                                    // Clear search after selection\r\n                                    setProductSearch('');\r\n                                    setSearchResults([]);\r\n                                  }}\r\n                                  className={`w-full text-left px-3 py-2 rounded text-sm transition ${\r\n                                    selectedExchangeProduct?.variantId === variant.id\r\n                                      ? 'bg-blue-100 dark:bg-blue-900 border-2 border-blue-500'\r\n                                      : 'bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600'\r\n                                  }`}\r\n                                >\r\n                                  <span className=\"font-medium\">{variant.variantValue}</span>\r\n                                  <span className=\"text-gray-500 dark:text-gray-400 ml-2\">\r\n                                    Rp {(variant.stocks?.[0]?.price || 0).toLocaleString('id-ID')}\r\n                                  </span>\r\n                                  {variant.sku && (\r\n                                    <span className=\"text-gray-400 dark:text-gray-500 ml-2 text-xs\">\r\n                                      SKU: {variant.sku}\r\n                                    </span>\r\n                                  )}\r\n                                </button>\r\n                              ))}\r\n                            </div>\r\n                          ) : (\r\n                            <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\r\n                              Tidak ada varian tersedia\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                  \r\n                  {/* Selected Product Display */}\r\n                  {selectedExchangeProduct && (\r\n                    <div className=\"mt-3 p-3 bg-green-50 dark:bg-green-900/30 rounded-lg border border-green-200 dark:border-green-700\">\r\n                      <p className=\"text-sm font-medium text-green-700 dark:text-green-300\">\r\n                        Γ£ô Produk Pengganti Dipilih:\r\n                      </p>\r\n                      <p className=\"text-green-800 dark:text-green-200\">\r\n                        {selectedExchangeProduct.productName} - {selectedExchangeProduct.variantInfo}\r\n                      </p>\r\n                      <p className=\"text-sm text-green-600 dark:text-green-400\">\r\n                        Rp {selectedExchangeProduct.price.toLocaleString('id-ID')}\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Reason Detail (for OTHER) */}\r\n              {requestReason === 'OTHER' && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                    Detail Alasan *\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={requestReasonDetail}\r\n                    onChange={(e) => setRequestReasonDetail(e.target.value)}\r\n                    placeholder=\"Jelaskan alasan return...\"\r\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                  />\r\n                </div>\r\n              )}\r\n\r\n              {/* Condition Note */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Kondisi Barang (opsional)\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={requestConditionNote}\r\n                  onChange={(e) => setRequestConditionNote(e.target.value)}\r\n                  placeholder=\"Misal: Segel rusak, kemasan penyok, dll\"\r\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                />\r\n              </div>\r\n\r\n              {/* Photo URLs (simple text input for MVP) */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Foto Bukti (opsional)\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={photoUrls.join(', ')}\r\n                  onChange={(e) => setPhotoUrls(e.target.value.split(',').map(u => u.trim()).filter(Boolean))}\r\n                  placeholder=\"URL foto (pisahkan dengan koma jika lebih dari 1)\"\r\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\r\n                />\r\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\r\n                  Foto produk rusak/defect (upload ke cloud storage dulu)\r\n                </p>\r\n              </div>\r\n\r\n              {/* Notes */}\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\r\n                  Catatan (opsional)\r\n                </label>\r\n                <textarea\r\n                  value={requestNotes}\r\n                  onChange={(e) => setRequestNotes(e.target.value)}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none\"\r\n                  rows={3}\r\n                  placeholder=\"Keterangan tambahan...\"\r\n                />\r\n              </div>\r\n\r\n              {/* Total */}\r\n              <div className=\"bg-gray-50 dark:bg-gray-900/50 p-4 rounded-lg\">\r\n                <div className=\"flex justify-between items-center\">\r\n                  <span className=\"font-medium text-gray-700 dark:text-gray-300\">\r\n                    {isExchangeReason(requestReason) ? 'Nilai Tukar:' : 'Total Return:'}\r\n                  </span>\r\n                  <span className={`text-xl font-bold ${isExchangeReason(requestReason) ? 'text-blue-600 dark:text-blue-400' : 'text-red-600 dark:text-red-400'}`}>\r\n                    Rp {getTotalReturn().toLocaleString('id-ID')}\r\n                  </span>\r\n                </div>\r\n                {isExchangeReason(requestReason) && (\r\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\r\n                    * Jika produk pengganti berbeda harga, customer bayar/dapat selisih\r\n                  </p>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"p-6 border-t border-gray-200 dark:border-gray-700\">\r\n              <div className=\"flex gap-3\">\r\n                <button\r\n                  onClick={() => {\r\n                    setShowRequestModal(false);\r\n                    setSelectedTransaction(null);\r\n                  }}\r\n                  className=\"flex-1 py-2.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-semibold hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors\"\r\n                >\r\n                  Batal\r\n                </button>\r\n                <button\r\n                  onClick={handleRequestSubmit}\r\n                  disabled={getTotalReturn() === 0 || submitting}\r\n                  className={`flex-1 py-2.5 text-white rounded-lg font-semibold disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2 ${\r\n                    isExchangeReason(requestReason)\r\n                      ? 'bg-blue-600 hover:bg-blue-700'\r\n                      : 'bg-purple-600 hover:bg-purple-700'\r\n                  }`}\r\n                >\r\n                  {submitting ? (\r\n                    <>\r\n                      <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\r\n                      Mengirim...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                      </svg>\r\n                      {isExchangeReason(requestReason) ? 'Kirim Request Tukar' : 'Kirim Return Request'}\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\UnderConstruction.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'title' is assigned a value but never used.","line":20,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":8}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { Construction, ArrowLeft, CheckCircle2 } from 'lucide-react'\r\nimport { useRouter } from 'next/navigation'\r\n\r\ninterface Feature {\r\n  name: string\r\n  description?: string\r\n}\r\n\r\ninterface UnderConstructionProps {\r\n  title?: string\r\n  description?: string\r\n  showBackButton?: boolean\r\n  features?: Feature[]\r\n  icon?: React.ReactNode\r\n}\r\n\r\nexport default function UnderConstruction({ \r\n  title = \"Halaman Dalam Pengembangan\",\r\n  description = \"Fitur ini sedang dalam tahap pengembangan dan akan segera tersedia.\",\r\n  showBackButton = true,\r\n  features = [],\r\n  icon\r\n}: UnderConstructionProps) {\r\n  const router = useRouter()\r\n\r\n  return (\r\n    <div className=\"min-h-[60vh] flex items-center justify-center p-4\">\r\n      <div className=\"text-center max-w-lg\">\r\n        <div className=\"inline-flex items-center justify-center w-20 h-20 rounded-full bg-emerald-100 dark:bg-emerald-900/30 mb-6\">\r\n          {icon || <Construction className=\"w-10 h-10 text-emerald-600 dark:text-emerald-400\" />}\r\n        </div>\r\n        \r\n        <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-3\">\r\n          Coming Soon\r\n        </h1>\r\n        \r\n        <p className=\"text-gray-600 dark:text-gray-400 mb-6\">\r\n          {description}\r\n        </p>\r\n\r\n        {features.length > 0 && (\r\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700 text-left mt-6\">\r\n            <h3 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4\">\r\n              Fitur yang akan datang:\r\n            </h3>\r\n            <div className=\"space-y-3\">\r\n              {features.map((feature, index) => (\r\n                <div key={index} className=\"flex items-start gap-3\">\r\n                  <CheckCircle2 className=\"w-5 h-5 text-emerald-500 flex-shrink-0 mt-0.5\" />\r\n                  <div>\r\n                    <p className=\"text-sm font-medium text-gray-900 dark:text-white\">{feature.name}</p>\r\n                    {feature.description && (\r\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">{feature.description}</p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        {showBackButton && (\r\n          <button\r\n            onClick={() => router.back()}\r\n            className=\"mt-6 inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors\"\r\n          >\r\n            <ArrowLeft className=\"w-4 h-4\" />\r\n            Kembali\r\n          </button>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\charts\\charts.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[307,310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[307,310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[438,441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[438,441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[569,572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[569,572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[700,703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[700,703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1292,1295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1292,1295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi } from 'vitest';\r\nimport { render, screen } from '@testing-library/react';\r\nimport {\r\n  ChartContainer,\r\n  Line,\r\n  Bar,\r\n  XAxis,\r\n  YAxis,\r\n  ResponsiveContainer,\r\n} from './index';\r\n\r\n// Mock recharts\r\nvi.mock('recharts', () => ({\r\n  LineChart: ({ children, ...props }: any) => (\r\n    <div data-testid=\"line-chart\" {...props}>\r\n      {children}\r\n    </div>\r\n  ),\r\n  BarChart: ({ children, ...props }: any) => (\r\n    <div data-testid=\"bar-chart\" {...props}>\r\n      {children}\r\n    </div>\r\n  ),\r\n  AreaChart: ({ children, ...props }: any) => (\r\n    <div data-testid=\"area-chart\" {...props}>\r\n      {children}\r\n    </div>\r\n  ),\r\n  PieChart: ({ children, ...props }: any) => (\r\n    <div data-testid=\"pie-chart\" {...props}>\r\n      {children}\r\n    </div>\r\n  ),\r\n  Line: () => <div data-testid=\"line\" />,\r\n  Bar: () => <div data-testid=\"bar\" />,\r\n  Area: () => <div data-testid=\"area\" />,\r\n  Pie: () => <div data-testid=\"pie\" />,\r\n  Cell: () => <div data-testid=\"cell\" />,\r\n  XAxis: () => <div data-testid=\"x-axis\" />,\r\n  YAxis: () => <div data-testid=\"y-axis\" />,\r\n  CartesianGrid: () => <div data-testid=\"grid\" />,\r\n  Tooltip: () => <div data-testid=\"tooltip\" />,\r\n  Legend: () => <div data-testid=\"legend\" />,\r\n  ResponsiveContainer: ({ children, ...props }: any) => (\r\n    <div data-testid=\"responsive-container\" {...props}>\r\n      {children}\r\n    </div>\r\n  ),\r\n  ReferenceLine: () => <div data-testid=\"reference-line\" />,\r\n  Brush: () => <div data-testid=\"brush\" />,\r\n}));\r\n\r\n// Mock skeleton\r\nvi.mock('@/components/ui/Skeleton', () => ({\r\n  SkeletonChart: ({ height }: { height: number }) => (\r\n    <div data-testid=\"skeleton-chart\" style={{ height }} />\r\n  ),\r\n}));\r\n\r\ndescribe('Chart Components', () => {\r\n  describe('ChartContainer', () => {\r\n    it('should render children when not loading', () => {\r\n      render(\r\n        <ChartContainer height={300}>\r\n          <div data-testid=\"chart-content\">Chart</div>\r\n        </ChartContainer>\r\n      );\r\n\r\n      expect(screen.getByTestId('responsive-container')).toBeInTheDocument();\r\n      expect(screen.getByTestId('chart-content')).toBeInTheDocument();\r\n    });\r\n\r\n    it('should show skeleton when loading', () => {\r\n      render(\r\n        <ChartContainer height={300} loading>\r\n          <div data-testid=\"chart-content\">Chart</div>\r\n        </ChartContainer>\r\n      );\r\n\r\n      expect(screen.getByTestId('skeleton-chart')).toBeInTheDocument();\r\n      expect(screen.queryByTestId('chart-content')).not.toBeInTheDocument();\r\n    });\r\n\r\n    it('should pass height to skeleton', () => {\r\n      render(\r\n        <ChartContainer height={400} loading>\r\n          <div>Chart</div>\r\n        </ChartContainer>\r\n      );\r\n\r\n      const skeleton = screen.getByTestId('skeleton-chart');\r\n      expect(skeleton).toHaveStyle({ height: '400px' });\r\n    });\r\n  });\r\n\r\n  describe('Re-exported components', () => {\r\n    it('should export Line component', () => {\r\n      render(<Line />);\r\n      expect(screen.getByTestId('line')).toBeInTheDocument();\r\n    });\r\n\r\n    it('should export Bar component', () => {\r\n      render(<Bar />);\r\n      expect(screen.getByTestId('bar')).toBeInTheDocument();\r\n    });\r\n\r\n    it('should export XAxis component', () => {\r\n      render(<XAxis />);\r\n      expect(screen.getByTestId('x-axis')).toBeInTheDocument();\r\n    });\r\n\r\n    it('should export YAxis component', () => {\r\n      render(<YAxis />);\r\n      expect(screen.getByTestId('y-axis')).toBeInTheDocument();\r\n    });\r\n\r\n    it('should export ResponsiveContainer component', () => {\r\n      render(<ResponsiveContainer><div>content</div></ResponsiveContainer>);\r\n      expect(screen.getByTestId('responsive-container')).toBeInTheDocument();\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\charts\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\pos\\POSCart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\pos\\POSHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\pos\\POSHoldModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\pos\\POSMobileBlock.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\pos\\POSProductGrid.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[446,449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[446,449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { RefObject } from 'react';\r\nimport { Product, CartItem } from './types';\r\n\r\ninterface POSProductGridProps {\r\n  searchInputRef: RefObject<HTMLInputElement | null>;\r\n  search: string;\r\n  setSearch: (value: string) => void;\r\n  filteredProducts: Product[];\r\n  products: Product[];\r\n  loading: boolean;\r\n  cart: CartItem[];\r\n  getEffectiveCabangId: () => string | undefined | null;\r\n  onAddToCart: (product: Product, variant: any) => void;\r\n  onRequestProduct: () => void;\r\n  onShowHistory: () => void;\r\n}\r\n\r\n// Helper function for stock info\r\nfunction getStockInfo(quantity: number, inCart: number = 0) {\r\n  const available = quantity - inCart;\r\n  if (available <= 0) return { color: 'text-gray-400', text: 'Habis', available };\r\n  return { color: 'text-green-600 dark:text-green-400', text: `${available} pcs`, available };\r\n}\r\n\r\n// Format variant display more naturally\r\nfunction formatVariantDisplay(variantName: string, variantValue: string) {\r\n  const cleanValue = variantValue.replace(/\\s*\\|\\s*/g, ' ').trim();\r\n  const lowerValue = cleanValue.toLowerCase();\r\n  \r\n  if (/^\\d+$/.test(cleanValue)) {\r\n    return cleanValue;\r\n  }\r\n  \r\n  if (/^[a-zA-Z]+\\s+\\d+$/.test(cleanValue)) {\r\n    return cleanValue;\r\n  }\r\n  \r\n  const nameLower = variantName.toLowerCase();\r\n  if (lowerValue.startsWith(nameLower)) {\r\n    return cleanValue.substring(variantName.length).trim();\r\n  }\r\n  \r\n  return cleanValue;\r\n}\r\n\r\nexport function POSProductGrid({\r\n  searchInputRef,\r\n  search,\r\n  setSearch,\r\n  filteredProducts,\r\n  products,\r\n  loading,\r\n  cart,\r\n  getEffectiveCabangId,\r\n  onAddToCart,\r\n  onRequestProduct,\r\n  onShowHistory,\r\n}: POSProductGridProps) {\r\n  return (\r\n    <div className=\"xl:col-span-2 flex flex-col min-h-0\">\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-100 dark:border-gray-700 p-5 flex flex-col flex-1 min-h-0\">\r\n        <div className=\"mb-4 flex-shrink-0 flex gap-2\">\r\n          <div className=\"relative flex-1\">\r\n            <input\r\n              ref={searchInputRef}\r\n              type=\"text\"\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n              placeholder=\"Cari produk, SKU, atau kategori...\"\r\n              className=\"w-full px-5 py-3 pl-12 border-2 border-gray-200 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:ring-4 focus:ring-slate-500 focus:border-slate-500 transition text-lg\"\r\n            />\r\n            <svg className=\"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400 dark:text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\r\n            </svg>\r\n            {search && (\r\n              <button\r\n                onClick={() => setSearch('')}\r\n                className=\"absolute right-3 top-1/2 transform -translate-y-1/2 p-1 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-full transition\"\r\n              >\r\n                <svg className=\"w-5 h-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            )}\r\n          </div>\r\n          \r\n          <button\r\n            onClick={onRequestProduct}\r\n            tabIndex={-1}\r\n            className=\"px-4 py-3 border-2 border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover:border-blue-300 dark:hover:border-blue-600 hover:bg-gray-50 dark:hover:bg-gray-600 transition-all flex items-center gap-2 whitespace-nowrap\"\r\n            title=\"Request Produk Baru\"\r\n          >\r\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\r\n            </svg>\r\n            <span className=\"hidden md:inline\">Request Produk</span>\r\n          </button>\r\n          \r\n          <button\r\n            onClick={onShowHistory}\r\n            tabIndex={-1}\r\n            className=\"px-4 py-3 border-2 border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover:border-green-300 dark:hover:border-green-600 hover:bg-gray-50 dark:hover:bg-gray-600 transition-all flex items-center gap-2 whitespace-nowrap\"\r\n            title=\"History Transaksi\"\r\n          >\r\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <span className=\"hidden md:inline\">History</span>\r\n          </button>\r\n        </div>\r\n\r\n        {search && !loading && (\r\n          <div className=\"mb-3 flex-shrink-0 text-sm text-gray-500 dark:text-gray-400\">\r\n            Menampilkan <span className=\"font-semibold text-gray-700 dark:text-gray-300\">{filteredProducts.length}</span> dari {products.length} produk\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"space-y-3 overflow-y-auto flex-1 min-h-0\">\r\n          {loading ? (\r\n            <div className=\"flex flex-col items-center justify-center h-full py-8\">\r\n              <div className=\"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-gray-100\"></div>\r\n              <p className=\"text-gray-500 dark:text-gray-400 mt-2 text-sm\">Memuat produk...</p>\r\n            </div>\r\n          ) : filteredProducts.length === 0 ? (\r\n            <div className=\"flex flex-col items-center justify-center h-full py-8\">\r\n              <svg className=\"h-12 w-12 text-gray-300 dark:text-gray-600 mb-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4\" />\r\n              </svg>\r\n              <p className=\"text-gray-500 dark:text-gray-400 font-medium\">\r\n                {search ? `Tidak ada hasil untuk \"${search}\"` : 'Tidak ada produk'}\r\n              </p>\r\n              <p className=\"text-gray-400 dark:text-gray-500 text-sm mt-1\">\r\n                {search ? 'Coba kata kunci lain' : 'Tambahkan produk terlebih dahulu'}\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            filteredProducts.map((product) => (\r\n              <div key={product.id} className=\"border-2 border-gray-100 dark:border-gray-700 rounded-xl p-5 hover:border-blue-300 dark:hover:border-blue-600 hover:shadow-md transition\">\r\n                <div className=\"flex items-start justify-between mb-3\">\r\n                  <div className=\"flex-1\">\r\n                    <h3 className=\"text-lg font-bold text-gray-900 dark:text-white\">{product.name}</h3>\r\n                    <div className=\"flex items-center gap-2 mt-1 flex-wrap\">\r\n                      <span className=\"inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300\">\r\n                        {product.category?.name}\r\n                      </span>\r\n                      {product.productType === 'VARIANT' && (\r\n                        <span className=\"inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300\">\r\n                          {product.variants?.length || 0} varian\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                    {search && product.description && (\r\n                      <p className=\"text-xs text-gray-600 dark:text-gray-400 mt-2 line-clamp-2\">\r\n                        {product.description}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                {product.productType === 'SINGLE' ? (\r\n                  (() => {\r\n                    const v = product.variants?.[0];\r\n                    if (!v) return null;\r\n                    const stock = v.stocks?.find((s) => s.cabangId === getEffectiveCabangId());\r\n                    const inCartQty = cart.find(i => i.productVariantId === v.id)?.quantity || 0;\r\n                    const stockInfo = getStockInfo(stock?.quantity || 0, inCartQty);\r\n                    const isOut = stockInfo.available <= 0;\r\n\r\n                    return (\r\n                      <div>\r\n                        {search && v.sku && (\r\n                          <div className=\"mb-2 text-xs text-gray-500 dark:text-gray-400 font-mono flex items-center gap-1\">\r\n                            <svg className=\"w-3.5 h-3.5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 20l4-16m2 16l4-16M6 9h14M4 15h14\" />\r\n                            </svg>\r\n                            SKU: {v.sku}\r\n                          </div>\r\n                        )}\r\n                        <button\r\n                          onClick={() => onAddToCart(product, v)}\r\n                          disabled={isOut}\r\n                          className={`w-full p-3 rounded-xl border-2 text-sm font-medium transition ${\r\n                            isOut ? 'bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-400 cursor-not-allowed'\r\n                              : 'bg-gradient-to-br from-white to-blue-50 dark:from-gray-700 dark:to-blue-900/20 border-gray-200 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-500 hover:shadow-md'\r\n                          }`}\r\n                        >\r\n                          <div className=\"text-sm font-bold text-gray-900 dark:text-white\">Rp {(stock?.price || 0).toLocaleString('id-ID')}</div>\r\n                          <div className={`text-xs mt-1.5 font-semibold ${stockInfo.color}`}>Stock: {stockInfo.text}</div>\r\n                        </button>\r\n                      </div>\r\n                    );\r\n                  })()\r\n                ) : (\r\n                  <div className=\"grid grid-cols-2 md:grid-cols-3 gap-2\">\r\n                    {product.variants?.map((v) => {\r\n                      const stock = v.stocks?.find((s) => s.cabangId === getEffectiveCabangId());\r\n                      const inCartQty = cart.find(i => i.productVariantId === v.id)?.quantity || 0;\r\n                      const stockInfo = getStockInfo(stock?.quantity || 0, inCartQty);\r\n                      const isOut = stockInfo.available <= 0;\r\n\r\n                      return (\r\n                        <div key={v.id} className=\"relative\">\r\n                          {search && v.sku && (\r\n                            <div className=\"absolute -top-1 -right-1 z-10 group\">\r\n                              <div className=\"bg-gray-800 dark:bg-gray-700 text-white text-[10px] px-1.5 py-0.5 rounded font-mono opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap\">\r\n                                {v.sku}\r\n                              </div>\r\n                            </div>\r\n                          )}\r\n                          <button\r\n                            onClick={() => onAddToCart(product, v)}\r\n                            disabled={isOut}\r\n                            className={`w-full p-3 rounded-lg border-2 text-sm font-medium transition ${\r\n                              isOut ? 'bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-400 cursor-not-allowed'\r\n                                : 'bg-gradient-to-br from-white to-blue-50 dark:from-gray-700 dark:to-blue-900/20 border-gray-200 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-500 hover:shadow-md'\r\n                            }`}\r\n                          >\r\n                            <div className=\"font-bold text-gray-900 dark:text-white truncate\" title={v.variantValue}>\r\n                              {formatVariantDisplay(v.variantName, v.variantValue)}\r\n                            </div>\r\n                            <div className=\"mt-1 text-xs font-semibold text-slate-600 dark:text-slate-400\">\r\n                              Rp {(stock?.price || 0).toLocaleString('id-ID')}\r\n                            </div>\r\n                            <div className={`mt-1 text-xs font-semibold ${stockInfo.color}`}>\r\n                              Stock: {stockInfo.text}\r\n                            </div>\r\n                          </button>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\pos\\POSRequestProductModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\pos\\POSSuccessModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\pos\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\pos\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\ui\\AlertDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\ui\\OfflineStatusIndicator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\ui\\OptimizedImage.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[327,330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[327,330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":9,"column":7,"nodeType":"JSXOpeningElement","endLine":17,"endColumn":9}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi } from 'vitest';\r\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\r\nimport { OptimizedImage, ProductImage, AvatarImage } from './OptimizedImage';\r\n\r\n// Mock next/image\r\nvi.mock('next/image', () => ({\r\n  default: ({ src, alt, onError, onLoad, className, ...props }: any) => {\r\n    return (\r\n      <img\r\n        src={src}\r\n        alt={alt}\r\n        className={className}\r\n        onError={onError}\r\n        onLoad={onLoad}\r\n        data-testid=\"next-image\"\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n}));\r\n\r\ndescribe('OptimizedImage', () => {\r\n  it('should render image with correct props', () => {\r\n    render(\r\n      <OptimizedImage\r\n        src=\"/test.jpg\"\r\n        alt=\"Test image\"\r\n        width={200}\r\n        height={200}\r\n      />\r\n    );\r\n\r\n    const img = screen.getByTestId('next-image');\r\n    expect(img).toHaveAttribute('src', '/test.jpg');\r\n    expect(img).toHaveAttribute('alt', 'Test image');\r\n  });\r\n\r\n  it('should show loading state initially', () => {\r\n    render(\r\n      <OptimizedImage\r\n        src=\"/test.jpg\"\r\n        alt=\"Test image\"\r\n        width={200}\r\n        height={200}\r\n      />\r\n    );\r\n\r\n    // Should have animate-pulse loading indicator\r\n    const container = screen.getByTestId('next-image').parentElement;\r\n    const loadingIndicator = container?.querySelector('.animate-pulse');\r\n    expect(loadingIndicator).toBeInTheDocument();\r\n  });\r\n\r\n  it('should show fallback on error', async () => {\r\n    render(\r\n      <OptimizedImage\r\n        src=\"/broken.jpg\"\r\n        alt=\"Broken image\"\r\n        width={200}\r\n        height={200}\r\n      />\r\n    );\r\n\r\n    const img = screen.getByTestId('next-image');\r\n    fireEvent.error(img);\r\n\r\n    await waitFor(() => {\r\n      // Should show fallback SVG icon (the container with svg)\r\n      const fallback = document.querySelector('svg');\r\n      expect(fallback).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  it('should hide loading on load', async () => {\r\n    render(\r\n      <OptimizedImage\r\n        src=\"/test.jpg\"\r\n        alt=\"Test image\"\r\n        width={200}\r\n        height={200}\r\n      />\r\n    );\r\n\r\n    const img = screen.getByTestId('next-image');\r\n    fireEvent.load(img);\r\n\r\n    await waitFor(() => {\r\n      expect(img).toHaveClass('opacity-100');\r\n    });\r\n  });\r\n});\r\n\r\ndescribe('ProductImage', () => {\r\n  it('should render with correct size', () => {\r\n    render(\r\n      <ProductImage\r\n        src=\"/product.jpg\"\r\n        alt=\"Product\"\r\n        size=\"md\"\r\n      />\r\n    );\r\n\r\n    const img = screen.getByTestId('next-image');\r\n    expect(img).toHaveAttribute('width', '80');\r\n    expect(img).toHaveAttribute('height', '80');\r\n  });\r\n\r\n  it('should render small size', () => {\r\n    render(\r\n      <ProductImage\r\n        src=\"/product.jpg\"\r\n        alt=\"Product\"\r\n        size=\"sm\"\r\n      />\r\n    );\r\n\r\n    const img = screen.getByTestId('next-image');\r\n    expect(img).toHaveAttribute('width', '48');\r\n    expect(img).toHaveAttribute('height', '48');\r\n  });\r\n\r\n  it('should render large size', () => {\r\n    render(\r\n      <ProductImage\r\n        src=\"/product.jpg\"\r\n        alt=\"Product\"\r\n        size=\"lg\"\r\n      />\r\n    );\r\n\r\n    const img = screen.getByTestId('next-image');\r\n    expect(img).toHaveAttribute('width', '120');\r\n    expect(img).toHaveAttribute('height', '120');\r\n  });\r\n\r\n  it('should render xl size', () => {\r\n    render(\r\n      <ProductImage\r\n        src=\"/product.jpg\"\r\n        alt=\"Product\"\r\n        size=\"xl\"\r\n      />\r\n    );\r\n\r\n    const img = screen.getByTestId('next-image');\r\n    expect(img).toHaveAttribute('width', '200');\r\n    expect(img).toHaveAttribute('height', '200');\r\n  });\r\n});\r\n\r\ndescribe('AvatarImage', () => {\r\n  it('should render avatar with image', () => {\r\n    render(\r\n      <AvatarImage\r\n        src=\"/avatar.jpg\"\r\n        alt=\"User\"\r\n        size=\"md\"\r\n      />\r\n    );\r\n\r\n    const img = screen.getByTestId('next-image');\r\n    expect(img).toHaveClass('rounded-full');\r\n  });\r\n\r\n  it('should show initials fallback when no src', () => {\r\n    render(\r\n      <AvatarImage\r\n        src=\"\"\r\n        alt=\"John Doe\"\r\n        size=\"md\"\r\n        initials=\"JD\"\r\n      />\r\n    );\r\n\r\n    expect(screen.getByText('JD')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should use first letter of alt as fallback', () => {\r\n    render(\r\n      <AvatarImage\r\n        src=\"\"\r\n        alt=\"Alice\"\r\n        size=\"md\"\r\n      />\r\n    );\r\n\r\n    expect(screen.getByText('A')).toBeInTheDocument();\r\n  });\r\n\r\n  it('should render different sizes', () => {\r\n    const { rerender } = render(\r\n      <AvatarImage src=\"/avatar.jpg\" alt=\"User\" size=\"xs\" />\r\n    );\r\n\r\n    let img = screen.getByTestId('next-image');\r\n    expect(img).toHaveAttribute('width', '24');\r\n\r\n    rerender(<AvatarImage src=\"/avatar.jpg\" alt=\"User\" size=\"sm\" />);\r\n    img = screen.getByTestId('next-image');\r\n    expect(img).toHaveAttribute('width', '32');\r\n\r\n    rerender(<AvatarImage src=\"/avatar.jpg\" alt=\"User\" size=\"lg\" />);\r\n    img = screen.getByTestId('next-image');\r\n    expect(img).toHaveAttribute('width', '56');\r\n\r\n    rerender(<AvatarImage src=\"/avatar.jpg\" alt=\"User\" size=\"xl\" />);\r\n    img = screen.getByTestId('next-image');\r\n    expect(img).toHaveAttribute('width', '80');\r\n  });\r\n\r\n  it('should show fallback on error', async () => {\r\n    render(\r\n      <AvatarImage\r\n        src=\"/broken.jpg\"\r\n        alt=\"John\"\r\n        size=\"md\"\r\n      />\r\n    );\r\n\r\n    const img = screen.getByTestId('next-image');\r\n    fireEvent.error(img);\r\n\r\n    await waitFor(() => {\r\n      expect(screen.getByText('J')).toBeInTheDocument();\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\ui\\OptimizedImage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fallback' is assigned a value but never used.","line":32,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport NextImage, { ImageProps as NextImageProps } from 'next/image';\r\nimport { useState, useCallback } from 'react';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface OptimizedImageProps extends Omit<NextImageProps, 'onError'> {\r\n  fallback?: string;\r\n  fallbackClassName?: string;\r\n}\r\n\r\n/**\r\n * Optimized Image Component\r\n * \r\n * Wraps next/image with:\r\n * - Automatic fallback on error\r\n * - Loading placeholder\r\n * - Blur placeholder for local images\r\n * \r\n * @example\r\n * <OptimizedImage\r\n *   src=\"/products/image.jpg\"\r\n *   alt=\"Product\"\r\n *   width={200}\r\n *   height={200}\r\n *   className=\"rounded-lg\"\r\n * />\r\n */\r\nexport function OptimizedImage({\r\n  src,\r\n  alt,\r\n  fallback = '/placeholder-image.svg',\r\n  fallbackClassName,\r\n  className,\r\n  ...props\r\n}: OptimizedImageProps) {\r\n  const [error, setError] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const handleError = useCallback(() => {\r\n    setError(true);\r\n    setLoading(false);\r\n  }, []);\r\n\r\n  const handleLoad = useCallback(() => {\r\n    setLoading(false);\r\n  }, []);\r\n\r\n  // If error, show fallback\r\n  if (error) {\r\n    return (\r\n      <div \r\n        className={cn(\r\n          'flex items-center justify-center bg-gray-100 dark:bg-gray-800',\r\n          fallbackClassName || className\r\n        )}\r\n        style={{ width: props.width, height: props.height }}\r\n      >\r\n        <svg \r\n          className=\"w-8 h-8 text-gray-400\" \r\n          fill=\"none\" \r\n          stroke=\"currentColor\" \r\n          viewBox=\"0 0 24 24\"\r\n        >\r\n          <path \r\n            strokeLinecap=\"round\" \r\n            strokeLinejoin=\"round\" \r\n            strokeWidth={1.5} \r\n            d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\" \r\n          />\r\n        </svg>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"relative\" style={{ width: props.width, height: props.height }}>\r\n      {loading && (\r\n        <div \r\n          className={cn(\r\n            'absolute inset-0 bg-gray-200 dark:bg-gray-700 animate-pulse rounded',\r\n            className\r\n          )}\r\n        />\r\n      )}\r\n      <NextImage\r\n        src={src}\r\n        alt={alt}\r\n        className={cn(\r\n          loading ? 'opacity-0' : 'opacity-100 transition-opacity duration-300',\r\n          className\r\n        )}\r\n        onError={handleError}\r\n        onLoad={handleLoad}\r\n        {...props}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Product Image Component\r\n * \r\n * Specialized image component for product displays with:\r\n * - Consistent sizing\r\n * - Object-cover fit\r\n * - Product-specific placeholder\r\n */\r\nexport function ProductImage({\r\n  src,\r\n  alt,\r\n  size = 'md',\r\n  className,\r\n  ...props\r\n}: Omit<OptimizedImageProps, 'width' | 'height'> & {\r\n  size?: 'sm' | 'md' | 'lg' | 'xl';\r\n}) {\r\n  const sizes = {\r\n    sm: { width: 48, height: 48 },\r\n    md: { width: 80, height: 80 },\r\n    lg: { width: 120, height: 120 },\r\n    xl: { width: 200, height: 200 },\r\n  };\r\n\r\n  const { width, height } = sizes[size];\r\n\r\n  return (\r\n    <OptimizedImage\r\n      src={src}\r\n      alt={alt}\r\n      width={width}\r\n      height={height}\r\n      className={cn('object-cover rounded-lg', className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\n/**\r\n * Avatar Image Component\r\n * \r\n * Circular image for user avatars with fallback initials\r\n */\r\nexport function AvatarImage({\r\n  src,\r\n  alt,\r\n  size = 'md',\r\n  initials,\r\n  className,\r\n  ...props\r\n}: Omit<OptimizedImageProps, 'width' | 'height'> & {\r\n  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl';\r\n  initials?: string;\r\n}) {\r\n  const [error, setError] = useState(false);\r\n\r\n  const sizes = {\r\n    xs: { width: 24, height: 24, text: 'text-xs' },\r\n    sm: { width: 32, height: 32, text: 'text-sm' },\r\n    md: { width: 40, height: 40, text: 'text-base' },\r\n    lg: { width: 56, height: 56, text: 'text-lg' },\r\n    xl: { width: 80, height: 80, text: 'text-xl' },\r\n  };\r\n\r\n  const { width, height, text } = sizes[size];\r\n\r\n  if (error || !src) {\r\n    return (\r\n      <div\r\n        className={cn(\r\n          'flex items-center justify-center rounded-full bg-gradient-to-br from-purple-500 to-blue-500 text-white font-medium',\r\n          text,\r\n          className\r\n        )}\r\n        style={{ width, height }}\r\n      >\r\n        {initials || alt?.charAt(0)?.toUpperCase() || '?'}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"relative\" style={{ width, height }}>\r\n      <NextImage\r\n        src={src}\r\n        alt={alt}\r\n        width={width}\r\n        height={height}\r\n        className={cn('rounded-full object-cover', className)}\r\n        onError={() => setError(true)}\r\n        {...props}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Background Image Component\r\n * \r\n * For hero sections, banners, etc. with blur placeholder\r\n */\r\nexport function BackgroundImage({\r\n  src,\r\n  alt,\r\n  children,\r\n  className,\r\n  overlayClassName,\r\n  ...props\r\n}: OptimizedImageProps & {\r\n  children?: React.ReactNode;\r\n  overlayClassName?: string;\r\n}) {\r\n  return (\r\n    <div className={cn('relative overflow-hidden', className)}>\r\n      <OptimizedImage\r\n        src={src}\r\n        alt={alt}\r\n        fill\r\n        className=\"object-cover\"\r\n        priority\r\n        {...props}\r\n      />\r\n      {overlayClassName && (\r\n        <div className={cn('absolute inset-0', overlayClassName)} />\r\n      )}\r\n      {children && (\r\n        <div className=\"relative z-10\">{children}</div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default OptimizedImage;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\ui\\Skeleton.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'screen' is defined but never used.","line":2,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonTableRow' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonStatCard' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonChart' is defined but never used.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonForm' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonListItem' is defined but never used.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonPageHeader' is defined but never used.","line":17,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonFilterBar' is defined but never used.","line":18,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SkeletonProductCard' is defined but never used.","line":19,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\r\nimport { render, screen } from '@testing-library/react';\r\nimport {\r\n  Skeleton,\r\n  SkeletonText,\r\n  SkeletonAvatar,\r\n  SkeletonButton,\r\n  SkeletonCard,\r\n  SkeletonTableRow,\r\n  SkeletonTable,\r\n  SkeletonStatCard,\r\n  SkeletonDashboardStats,\r\n  SkeletonChart,\r\n  SkeletonForm,\r\n  SkeletonListItem,\r\n  SkeletonList,\r\n  SkeletonPageHeader,\r\n  SkeletonFilterBar,\r\n  SkeletonProductCard,\r\n  SkeletonProductGrid,\r\n  SkeletonPage,\r\n  SkeletonDashboardPage,\r\n} from './Skeleton';\r\n\r\ndescribe('Skeleton Components', () => {\r\n  describe('Skeleton (base)', () => {\r\n    it('should render with default props', () => {\r\n      const { container } = render(<Skeleton />);\r\n      const skeleton = container.firstChild as HTMLElement;\r\n      expect(skeleton).toBeInTheDocument();\r\n      expect(skeleton).toHaveClass('animate-pulse');\r\n      expect(skeleton).toHaveClass('rounded-md');\r\n    });\r\n\r\n    it('should render with custom dimensions', () => {\r\n      const { container } = render(<Skeleton width={100} height={50} />);\r\n      const skeleton = container.firstChild as HTMLElement;\r\n      expect(skeleton).toHaveStyle({ width: '100px', height: '50px' });\r\n    });\r\n\r\n    it('should apply different rounded styles', () => {\r\n      const { container } = render(<Skeleton rounded=\"full\" />);\r\n      const skeleton = container.firstChild as HTMLElement;\r\n      expect(skeleton).toHaveClass('rounded-full');\r\n    });\r\n\r\n    it('should disable animation when animate is false', () => {\r\n      const { container } = render(<Skeleton animate={false} />);\r\n      const skeleton = container.firstChild as HTMLElement;\r\n      expect(skeleton).not.toHaveClass('animate-pulse');\r\n    });\r\n  });\r\n\r\n  describe('SkeletonText', () => {\r\n    it('should render with default width', () => {\r\n      const { container } = render(<SkeletonText />);\r\n      const skeleton = container.firstChild as HTMLElement;\r\n      expect(skeleton).toHaveClass('h-4');\r\n      expect(skeleton).toHaveStyle({ width: '100%' });\r\n    });\r\n\r\n    it('should render with custom width', () => {\r\n      const { container } = render(<SkeletonText width=\"50%\" />);\r\n      const skeleton = container.firstChild as HTMLElement;\r\n      expect(skeleton).toHaveStyle({ width: '50%' });\r\n    });\r\n  });\r\n\r\n  describe('SkeletonAvatar', () => {\r\n    it('should render with default size', () => {\r\n      const { container } = render(<SkeletonAvatar />);\r\n      const skeleton = container.firstChild as HTMLElement;\r\n      expect(skeleton).toHaveClass('rounded-full');\r\n      expect(skeleton).toHaveStyle({ width: '40px', height: '40px' });\r\n    });\r\n\r\n    it('should render with custom size', () => {\r\n      const { container } = render(<SkeletonAvatar size={60} />);\r\n      const skeleton = container.firstChild as HTMLElement;\r\n      expect(skeleton).toHaveStyle({ width: '60px', height: '60px' });\r\n    });\r\n  });\r\n\r\n  describe('SkeletonButton', () => {\r\n    it('should render with default dimensions', () => {\r\n      const { container } = render(<SkeletonButton />);\r\n      const skeleton = container.firstChild as HTMLElement;\r\n      expect(skeleton).toHaveStyle({ width: '80px', height: '36px' });\r\n    });\r\n  });\r\n\r\n  describe('SkeletonCard', () => {\r\n    it('should render with avatar and text skeletons', () => {\r\n      const { container } = render(<SkeletonCard />);\r\n      expect(container.querySelector('.rounded-full')).toBeInTheDocument();\r\n      expect(container.querySelectorAll('.h-4').length).toBeGreaterThan(0);\r\n    });\r\n  });\r\n\r\n  describe('SkeletonTable', () => {\r\n    it('should render correct number of rows', () => {\r\n      const { container } = render(<SkeletonTable rows={3} columns={4} />);\r\n      const tbody = container.querySelector('tbody');\r\n      expect(tbody?.children.length).toBe(3);\r\n    });\r\n\r\n    it('should render header when showHeader is true', () => {\r\n      const { container } = render(<SkeletonTable showHeader={true} />);\r\n      expect(container.querySelector('thead')).toBeInTheDocument();\r\n    });\r\n\r\n    it('should not render header when showHeader is false', () => {\r\n      const { container } = render(<SkeletonTable showHeader={false} />);\r\n      expect(container.querySelector('thead')).not.toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  describe('SkeletonDashboardStats', () => {\r\n    it('should render correct number of stat cards', () => {\r\n      const { container } = render(<SkeletonDashboardStats count={6} />);\r\n      const cards = container.querySelectorAll('.shadow');\r\n      expect(cards.length).toBe(6);\r\n    });\r\n  });\r\n\r\n  describe('SkeletonList', () => {\r\n    it('should render correct number of items', () => {\r\n      const { container } = render(<SkeletonList items={3} />);\r\n      const items = container.querySelectorAll('.border-b');\r\n      expect(items.length).toBe(3);\r\n    });\r\n  });\r\n\r\n  describe('SkeletonProductGrid', () => {\r\n    it('should render correct number of product cards', () => {\r\n      const { container } = render(<SkeletonProductGrid items={6} />);\r\n      const cards = container.querySelectorAll('.shadow');\r\n      expect(cards.length).toBe(6);\r\n    });\r\n  });\r\n\r\n  describe('SkeletonPage', () => {\r\n    it('should render header, filter bar, and table', () => {\r\n      const { container } = render(<SkeletonPage />);\r\n      expect(container.querySelector('table')).toBeInTheDocument();\r\n    });\r\n  });\r\n\r\n  describe('SkeletonDashboardPage', () => {\r\n    it('should render stats, charts, and table', () => {\r\n      const { container } = render(<SkeletonDashboardPage />);\r\n      // Should have stats cards (4 by default)\r\n      expect(container.querySelectorAll('.shadow').length).toBeGreaterThan(0);\r\n      // Should have table\r\n      expect(container.querySelector('table')).toBeInTheDocument();\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\ui\\Skeleton.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\ui\\Skeleton.tsx:120:40\n  118 |       {Array.from({ length: columns }).map((_, i) => (\n  119 |         <td key={i} className=\"px-4 py-3\">\n> 120 |           <SkeletonText width={`${60 + Math.random() * 30}%`} />\n      |                                        ^^^^^^^^^^^^^ Cannot call impure function\n  121 |         </td>\n  122 |       ))}\n  123 |     </tr>","line":120,"column":40,"nodeType":null,"endLine":120,"endColumn":53}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\n\r\ninterface SkeletonProps {\r\n  className?: string;\r\n  width?: string | number;\r\n  height?: string | number;\r\n  rounded?: 'none' | 'sm' | 'md' | 'lg' | 'full';\r\n  animate?: boolean;\r\n}\r\n\r\n/**\r\n * Base Skeleton component with shimmer animation\r\n */\r\nexport function Skeleton({\r\n  className = '',\r\n  width,\r\n  height,\r\n  rounded = 'md',\r\n  animate = true,\r\n}: SkeletonProps) {\r\n  const roundedClasses = {\r\n    none: '',\r\n    sm: 'rounded-sm',\r\n    md: 'rounded-md',\r\n    lg: 'rounded-lg',\r\n    full: 'rounded-full',\r\n  };\r\n\r\n  const style: React.CSSProperties = {\r\n    width: width,\r\n    height: height,\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={`\r\n        bg-gray-200 dark:bg-gray-700\r\n        ${animate ? 'animate-pulse' : ''}\r\n        ${roundedClasses[rounded]}\r\n        ${className}\r\n      `}\r\n      style={style}\r\n    />\r\n  );\r\n}\r\n\r\n/**\r\n * Text skeleton - single line of text\r\n */\r\nexport function SkeletonText({\r\n  width = '100%',\r\n  className = '',\r\n}: {\r\n  width?: string | number;\r\n  className?: string;\r\n}) {\r\n  return <Skeleton className={`h-4 ${className}`} width={width} />;\r\n}\r\n\r\n/**\r\n * Avatar/circle skeleton\r\n */\r\nexport function SkeletonAvatar({\r\n  size = 40,\r\n  className = '',\r\n}: {\r\n  size?: number;\r\n  className?: string;\r\n}) {\r\n  return <Skeleton className={className} width={size} height={size} rounded=\"full\" />;\r\n}\r\n\r\n/**\r\n * Button skeleton\r\n */\r\nexport function SkeletonButton({\r\n  width = 80,\r\n  height = 36,\r\n  className = '',\r\n}: {\r\n  width?: number;\r\n  height?: number;\r\n  className?: string;\r\n}) {\r\n  return <Skeleton className={className} width={width} height={height} rounded=\"md\" />;\r\n}\r\n\r\n/**\r\n * Card skeleton with header and content\r\n */\r\nexport function SkeletonCard({ className = '' }: { className?: string }) {\r\n  return (\r\n    <div className={`bg-white dark:bg-gray-800 rounded-lg shadow p-4 ${className}`}>\r\n      <div className=\"flex items-center gap-3 mb-4\">\r\n        <SkeletonAvatar size={32} />\r\n        <div className=\"flex-1\">\r\n          <SkeletonText width=\"60%\" className=\"mb-2\" />\r\n          <SkeletonText width=\"40%\" className=\"h-3\" />\r\n        </div>\r\n      </div>\r\n      <div className=\"space-y-2\">\r\n        <SkeletonText />\r\n        <SkeletonText width=\"80%\" />\r\n        <SkeletonText width=\"90%\" />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Table row skeleton\r\n */\r\nexport function SkeletonTableRow({ columns = 5 }: { columns?: number }) {\r\n  return (\r\n    <tr className=\"border-b border-gray-200 dark:border-gray-700\">\r\n      {Array.from({ length: columns }).map((_, i) => (\r\n        <td key={i} className=\"px-4 py-3\">\r\n          <SkeletonText width={`${60 + Math.random() * 30}%`} />\r\n        </td>\r\n      ))}\r\n    </tr>\r\n  );\r\n}\r\n\r\n/**\r\n * Full table skeleton\r\n */\r\nexport function SkeletonTable({\r\n  rows = 5,\r\n  columns = 5,\r\n  showHeader = true,\r\n  className = '',\r\n}: {\r\n  rows?: number;\r\n  columns?: number;\r\n  showHeader?: boolean;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <div className={`overflow-x-auto ${className}`}>\r\n      <table className=\"w-full\">\r\n        {showHeader && (\r\n          <thead>\r\n            <tr className=\"border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800\">\r\n              {Array.from({ length: columns }).map((_, i) => (\r\n                <th key={i} className=\"px-4 py-3 text-left\">\r\n                  <SkeletonText width={80} />\r\n                </th>\r\n              ))}\r\n            </tr>\r\n          </thead>\r\n        )}\r\n        <tbody>\r\n          {Array.from({ length: rows }).map((_, i) => (\r\n            <SkeletonTableRow key={i} columns={columns} />\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Stats card skeleton (for dashboard)\r\n */\r\nexport function SkeletonStatCard({ className = '' }: { className?: string }) {\r\n  return (\r\n    <div className={`bg-white dark:bg-gray-800 rounded-lg shadow p-4 ${className}`}>\r\n      <div className=\"flex items-center justify-between mb-2\">\r\n        <SkeletonText width={100} className=\"h-3\" />\r\n        <Skeleton width={32} height={32} rounded=\"md\" />\r\n      </div>\r\n      <SkeletonText width=\"60%\" className=\"h-8 mb-1\" />\r\n      <SkeletonText width={80} className=\"h-3\" />\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Dashboard stats grid skeleton\r\n */\r\nexport function SkeletonDashboardStats({ count = 4 }: { count?: number }) {\r\n  return (\r\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n      {Array.from({ length: count }).map((_, i) => (\r\n        <SkeletonStatCard key={i} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Chart skeleton\r\n */\r\nexport function SkeletonChart({\r\n  height = 300,\r\n  className = '',\r\n}: {\r\n  height?: number;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <div className={`bg-white dark:bg-gray-800 rounded-lg shadow p-4 ${className}`}>\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <SkeletonText width={150} className=\"h-5\" />\r\n        <SkeletonButton width={100} height={32} />\r\n      </div>\r\n      <Skeleton height={height} className=\"w-full\" />\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Form skeleton\r\n */\r\nexport function SkeletonForm({\r\n  fields = 4,\r\n  className = '',\r\n}: {\r\n  fields?: number;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <div className={`space-y-4 ${className}`}>\r\n      {Array.from({ length: fields }).map((_, i) => (\r\n        <div key={i}>\r\n          <SkeletonText width={100} className=\"h-3 mb-2\" />\r\n          <Skeleton height={40} className=\"w-full\" />\r\n        </div>\r\n      ))}\r\n      <div className=\"flex gap-2 pt-2\">\r\n        <SkeletonButton width={100} />\r\n        <SkeletonButton width={80} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * List item skeleton\r\n */\r\nexport function SkeletonListItem({ \r\n  className = '',\r\n  withAvatar = true,\r\n}: { \r\n  className?: string;\r\n  withAvatar?: boolean;\r\n}) {\r\n  return (\r\n    <div className={`flex items-center gap-3 p-3 border-b border-gray-200 dark:border-gray-700 ${className}`}>\r\n      {withAvatar && <SkeletonAvatar size={40} />}\r\n      <div className=\"flex-1\">\r\n        <SkeletonText width=\"70%\" className=\"mb-1\" />\r\n        <SkeletonText width=\"50%\" className=\"h-3\" />\r\n      </div>\r\n      <SkeletonButton width={60} height={28} />\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * List skeleton\r\n */\r\nexport function SkeletonList({\r\n  items = 5,\r\n  className = '',\r\n  withAvatar = true,\r\n}: {\r\n  items?: number;\r\n  className?: string;\r\n  withAvatar?: boolean;\r\n}) {\r\n  return (\r\n    <div className={className}>\r\n      {Array.from({ length: items }).map((_, i) => (\r\n        <SkeletonListItem key={i} withAvatar={withAvatar} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Page header skeleton\r\n */\r\nexport function SkeletonPageHeader({ className = '' }: { className?: string }) {\r\n  return (\r\n    <div className={`flex items-center justify-between mb-6 ${className}`}>\r\n      <div>\r\n        <SkeletonText width={200} className=\"h-7 mb-2\" />\r\n        <SkeletonText width={300} className=\"h-4\" />\r\n      </div>\r\n      <div className=\"flex gap-2\">\r\n        <SkeletonButton width={120} />\r\n        <SkeletonButton width={100} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Filter bar skeleton\r\n */\r\nexport function SkeletonFilterBar({ filters = 3, className = '' }: { filters?: number; className?: string }) {\r\n  return (\r\n    <div className={`flex flex-wrap gap-3 mb-4 ${className}`}>\r\n      {Array.from({ length: filters }).map((_, i) => (\r\n        <Skeleton key={i} width={150} height={40} />\r\n      ))}\r\n      <SkeletonButton width={100} />\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Product grid item skeleton\r\n */\r\nexport function SkeletonProductCard({ className = '' }: { className?: string }) {\r\n  return (\r\n    <div className={`bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden ${className}`}>\r\n      <Skeleton height={150} className=\"w-full\" rounded=\"none\" />\r\n      <div className=\"p-3\">\r\n        <SkeletonText width=\"80%\" className=\"mb-2\" />\r\n        <SkeletonText width=\"50%\" className=\"h-3 mb-2\" />\r\n        <div className=\"flex items-center justify-between\">\r\n          <SkeletonText width={80} className=\"h-5\" />\r\n          <SkeletonButton width={60} height={28} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Product grid skeleton\r\n */\r\nexport function SkeletonProductGrid({\r\n  items = 8,\r\n  count,\r\n  columns = 4,\r\n  className = '',\r\n}: {\r\n  items?: number;\r\n  count?: number;\r\n  columns?: number;\r\n  className?: string;\r\n}) {\r\n  const itemCount = count ?? items;\r\n  const gridColsClass = {\r\n    2: 'grid-cols-2',\r\n    3: 'grid-cols-2 md:grid-cols-3',\r\n    4: 'grid-cols-2 md:grid-cols-3 lg:grid-cols-4',\r\n    5: 'grid-cols-2 md:grid-cols-3 lg:grid-cols-5',\r\n    6: 'grid-cols-2 md:grid-cols-3 lg:grid-cols-6',\r\n  }[columns] || 'grid-cols-4';\r\n\r\n  return (\r\n    <div className={`grid ${gridColsClass} gap-4 ${className}`}>\r\n      {Array.from({ length: itemCount }).map((_, i) => (\r\n        <SkeletonProductCard key={i} />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Full page loading skeleton\r\n */\r\nexport function SkeletonPage({ className = '' }: { className?: string }) {\r\n  return (\r\n    <div className={`space-y-6 ${className}`}>\r\n      <SkeletonPageHeader />\r\n      <SkeletonFilterBar />\r\n      <SkeletonTable rows={10} columns={6} />\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Dashboard page loading skeleton\r\n */\r\nexport function SkeletonDashboardPage({ className = '' }: { className?: string }) {\r\n  return (\r\n    <div className={`space-y-6 ${className}`}>\r\n      <SkeletonPageHeader />\r\n      <SkeletonDashboardStats count={4} />\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        <SkeletonChart height={250} />\r\n        <SkeletonChart height={250} />\r\n      </div>\r\n      <SkeletonTable rows={5} columns={5} />\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\components\\ui\\Toast.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'id' is defined but never used.","line":90,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":90,"endColumn":5}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport * as React from 'react';\r\nimport * as ToastPrimitive from '@radix-ui/react-toast';\r\nimport { X, CheckCircle, XCircle, AlertCircle, Info } from 'lucide-react';\r\n\r\n// Toast Context\r\ninterface ToastContextType {\r\n  toast: (options: ToastOptions) => void;\r\n  success: (message: string, description?: string) => void;\r\n  error: (message: string, description?: string) => void;\r\n  warning: (message: string, description?: string) => void;\r\n  info: (message: string, description?: string) => void;\r\n}\r\n\r\ninterface ToastOptions {\r\n  title: string;\r\n  description?: string;\r\n  type?: 'success' | 'error' | 'warning' | 'info';\r\n  duration?: number;\r\n}\r\n\r\ninterface ToastItem extends ToastOptions {\r\n  id: string;\r\n  open: boolean;\r\n}\r\n\r\nconst ToastContext = React.createContext<ToastContextType | null>(null);\r\n\r\nexport function useToast() {\r\n  const context = React.useContext(ToastContext);\r\n  if (!context) {\r\n    throw new Error('useToast must be used within a ToastProvider');\r\n  }\r\n  return context;\r\n}\r\n\r\n// Toast Provider\r\nexport function ToastProvider({ children }: { children: React.ReactNode }) {\r\n  const [toasts, setToasts] = React.useState<ToastItem[]>([]);\r\n\r\n  const addToast = React.useCallback((options: ToastOptions) => {\r\n    const id = Math.random().toString(36).substring(2, 9);\r\n    setToasts((prev) => [...prev, { ...options, id, open: true }]);\r\n  }, []);\r\n\r\n  const removeToast = React.useCallback((id: string) => {\r\n    setToasts((prev) => prev.map(t => t.id === id ? { ...t, open: false } : t));\r\n    // Remove from array after animation\r\n    setTimeout(() => {\r\n      setToasts((prev) => prev.filter((t) => t.id !== id));\r\n    }, 300);\r\n  }, []);\r\n\r\n  const toast = React.useCallback((options: ToastOptions) => {\r\n    addToast(options);\r\n  }, [addToast]);\r\n\r\n  const success = React.useCallback((message: string, description?: string) => {\r\n    addToast({ title: message, description, type: 'success' });\r\n  }, [addToast]);\r\n\r\n  const error = React.useCallback((message: string, description?: string) => {\r\n    addToast({ title: message, description, type: 'error' });\r\n  }, [addToast]);\r\n\r\n  const warning = React.useCallback((message: string, description?: string) => {\r\n    addToast({ title: message, description, type: 'warning' });\r\n  }, [addToast]);\r\n\r\n  const info = React.useCallback((message: string, description?: string) => {\r\n    addToast({ title: message, description, type: 'info' });\r\n  }, [addToast]);\r\n\r\n  return (\r\n    <ToastContext.Provider value={{ toast, success, error, warning, info }}>\r\n      <ToastPrimitive.Provider swipeDirection=\"right\">\r\n        {children}\r\n        {toasts.map((t) => (\r\n          <ToastItem key={t.id} {...t} onClose={() => removeToast(t.id)} />\r\n        ))}\r\n        <ToastPrimitive.Viewport className=\"fixed bottom-0 right-0 z-[100] flex max-h-screen w-full flex-col-reverse gap-2 p-4 sm:max-w-[420px]\" />\r\n      </ToastPrimitive.Provider>\r\n    </ToastContext.Provider>\r\n  );\r\n}\r\n\r\n// Toast Item Component\r\nfunction ToastItem({\r\n  id,\r\n  title,\r\n  description,\r\n  type = 'info',\r\n  duration = 4000,\r\n  open,\r\n  onClose,\r\n}: ToastItem & { onClose: () => void }) {\r\n  const icons = {\r\n    success: <CheckCircle className=\"w-5 h-5 text-green-500\" />,\r\n    error: <XCircle className=\"w-5 h-5 text-red-500\" />,\r\n    warning: <AlertCircle className=\"w-5 h-5 text-amber-500\" />,\r\n    info: <Info className=\"w-5 h-5 text-blue-500\" />,\r\n  };\r\n\r\n  const backgrounds = {\r\n    success: 'border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-950',\r\n    error: 'border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-950',\r\n    warning: 'border-amber-200 bg-amber-50 dark:border-amber-800 dark:bg-amber-950',\r\n    info: 'border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-950',\r\n  };\r\n\r\n  return (\r\n    <ToastPrimitive.Root\r\n      open={open}\r\n      onOpenChange={(open) => !open && onClose()}\r\n      duration={duration}\r\n      className={`\r\n        group pointer-events-auto relative flex w-full items-start gap-3 overflow-hidden rounded-lg border p-4 shadow-lg transition-all\r\n        data-[swipe=cancel]:translate-x-0 \r\n        data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] \r\n        data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] \r\n        data-[swipe=move]:transition-none \r\n        data-[state=open]:animate-in \r\n        data-[state=closed]:animate-out \r\n        data-[swipe=end]:animate-out \r\n        data-[state=closed]:fade-out-80 \r\n        data-[state=closed]:slide-out-to-right-full \r\n        data-[state=open]:slide-in-from-bottom-full \r\n        data-[state=open]:sm:slide-in-from-bottom-full\r\n        ${backgrounds[type]}\r\n      `}\r\n    >\r\n      <div className=\"flex-shrink-0 mt-0.5\">{icons[type]}</div>\r\n      <div className=\"flex-1 grid gap-1\">\r\n        <ToastPrimitive.Title className=\"text-sm font-semibold text-gray-900 dark:text-gray-100\">\r\n          {title}\r\n        </ToastPrimitive.Title>\r\n        {description && (\r\n          <ToastPrimitive.Description className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n            {description}\r\n          </ToastPrimitive.Description>\r\n        )}\r\n      </div>\r\n      <ToastPrimitive.Close className=\"absolute right-2 top-2 rounded-md p-1 text-gray-500 opacity-0 transition-opacity hover:text-gray-900 focus:opacity-100 focus:outline-none group-hover:opacity-100 dark:hover:text-gray-100\">\r\n        <X className=\"w-4 h-4\" />\r\n      </ToastPrimitive.Close>\r\n    </ToastPrimitive.Root>\r\n  );\r\n}\r\n\r\nexport default ToastProvider;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\contexts\\ThemeContext.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\contexts\\ThemeContext.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\contexts\\ThemeContext.tsx:55:5\n  53 |\n  54 |   useEffect(() => {\n> 55 |     setMounted(true);\n     |     ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  56 |     \n  57 |     // Check authentication status\n  58 |     const authenticated = checkAuth();","line":55,"column":5,"nodeType":null,"endLine":55,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'themeMode'. Either include it or remove the dependency array.","line":79,"column":6,"nodeType":"ArrayExpression","endLine":79,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [themeMode]","fix":{"range":[2588,2590],"text":"[themeMode]"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\contexts\\ThemeContext.tsx:85:7\n  83 |     if (mounted) {\n  84 |       const authenticated = checkAuth();\n> 85 |       setIsAuthenticated(authenticated);\n     |       ^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  86 |       applyTheme(themeMode, !authenticated);\n  87 |     }\n  88 |   }, [themeMode, mounted]);","line":85,"column":7,"nodeType":null,"endLine":85,"endColumn":25}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { createContext, useContext, useEffect, useState } from 'react';\r\nimport { getAuth } from '@/lib/auth';\r\n\r\ntype ThemeMode = 'light' | 'dark' | 'system';\r\ntype ResolvedTheme = 'light' | 'dark';\r\n\r\ninterface ThemeContextType {\r\n  themeMode: ThemeMode;\r\n  resolvedTheme: ResolvedTheme;\r\n  theme: ResolvedTheme; // Alias for backward compatibility\r\n  setThemeMode: (mode: ThemeMode) => void;\r\n  toggleTheme: () => void;\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\r\n  const [themeMode, setThemeModeState] = useState<ThemeMode>('system');\r\n  const [resolvedTheme, setResolvedTheme] = useState<ResolvedTheme>('light');\r\n  const [mounted, setMounted] = useState(false);\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n\r\n  // Check if user is authenticated\r\n  const checkAuth = () => {\r\n    const { token } = getAuth();\r\n    return !!token;\r\n  };\r\n\r\n  // Apply theme to document\r\n  const applyTheme = (mode: ThemeMode, forceLight: boolean = false) => {\r\n    let resolved: ResolvedTheme;\r\n    \r\n    // Force light mode for unauthenticated users (public pages)\r\n    if (forceLight) {\r\n      resolved = 'light';\r\n    } else if (mode === 'system') {\r\n      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\r\n      resolved = prefersDark ? 'dark' : 'light';\r\n    } else {\r\n      resolved = mode;\r\n    }\r\n    \r\n    setResolvedTheme(resolved);\r\n    \r\n    if (resolved === 'dark') {\r\n      document.documentElement.classList.add('dark');\r\n    } else {\r\n      document.documentElement.classList.remove('dark');\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n    \r\n    // Check authentication status\r\n    const authenticated = checkAuth();\r\n    setIsAuthenticated(authenticated);\r\n    \r\n    // Load theme from localStorage\r\n    const savedTheme = localStorage.getItem('theme') as ThemeMode | null;\r\n    const initialMode = savedTheme || 'system';\r\n    setThemeModeState(initialMode);\r\n    \r\n    // Only apply dark mode if authenticated, otherwise force light\r\n    applyTheme(initialMode, !authenticated);\r\n    \r\n    // Listen for system theme changes\r\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\r\n    const handleChange = () => {\r\n      if (themeMode === 'system') {\r\n        applyTheme('system', !checkAuth());\r\n      }\r\n    };\r\n    \r\n    mediaQuery.addEventListener('change', handleChange);\r\n    return () => mediaQuery.removeEventListener('change', handleChange);\r\n  }, []);\r\n\r\n  // Re-apply when themeMode changes or auth status changes\r\n  useEffect(() => {\r\n    if (mounted) {\r\n      const authenticated = checkAuth();\r\n      setIsAuthenticated(authenticated);\r\n      applyTheme(themeMode, !authenticated);\r\n    }\r\n  }, [themeMode, mounted]);\r\n\r\n  // Listen for storage changes (login/logout)\r\n  useEffect(() => {\r\n    const handleStorageChange = () => {\r\n      const authenticated = checkAuth();\r\n      setIsAuthenticated(authenticated);\r\n      applyTheme(themeMode, !authenticated);\r\n    };\r\n\r\n    window.addEventListener('storage', handleStorageChange);\r\n    \r\n    // Also listen for custom auth change event\r\n    window.addEventListener('authChange', handleStorageChange);\r\n    \r\n    return () => {\r\n      window.removeEventListener('storage', handleStorageChange);\r\n      window.removeEventListener('authChange', handleStorageChange);\r\n    };\r\n  }, [themeMode]);\r\n\r\n  const setThemeMode = (mode: ThemeMode) => {\r\n    setThemeModeState(mode);\r\n    localStorage.setItem('theme', mode);\r\n    applyTheme(mode, !isAuthenticated);\r\n  };\r\n\r\n  const toggleTheme = () => {\r\n    const newMode: ThemeMode = resolvedTheme === 'light' ? 'dark' : 'light';\r\n    setThemeMode(newMode);\r\n  };\r\n\r\n  // Prevent hydration mismatch\r\n  if (!mounted) {\r\n    return <>{children}</>;\r\n  }\r\n\r\n  return (\r\n    <ThemeContext.Provider value={{ themeMode, resolvedTheme, theme: resolvedTheme, setThemeMode, toggleTheme }}>\r\n      {children}\r\n    </ThemeContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useTheme() {\r\n  const context = useContext(ThemeContext);\r\n  if (context === undefined) {\r\n    // Return default values for SSR/static generation\r\n    return {\r\n      themeMode: 'system' as ThemeMode,\r\n      resolvedTheme: 'light' as ResolvedTheme,\r\n      theme: 'light' as ResolvedTheme,\r\n      setThemeMode: () => {},\r\n      toggleTheme: () => {},\r\n    };\r\n  }\r\n  return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'waitFor' is defined but never used.","line":2,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport { renderHook, act, waitFor } from '@testing-library/react';\r\nimport {\r\n  useDebounceCallback,\r\n  useDebounceValue,\r\n  useThrottleCallback,\r\n  usePrevious,\r\n  useStableCallback,\r\n  useMemoFilter,\r\n  useMemoSort,\r\n  useMemoMap,\r\n  useLazyValue,\r\n} from './useMemoization';\r\n\r\ndescribe('useMemoization Hooks', () => {\r\n  beforeEach(() => {\r\n    vi.useFakeTimers();\r\n  });\r\n\r\n  afterEach(() => {\r\n    vi.useRealTimers();\r\n  });\r\n\r\n  describe('useDebounceCallback', () => {\r\n    it('should debounce callback calls', () => {\r\n      const callback = vi.fn();\r\n      const { result } = renderHook(() => useDebounceCallback(callback, 300));\r\n\r\n      // Call multiple times rapidly\r\n      act(() => {\r\n        result.current('a');\r\n        result.current('b');\r\n        result.current('c');\r\n      });\r\n\r\n      // Should not have called yet\r\n      expect(callback).not.toHaveBeenCalled();\r\n\r\n      // Fast forward time\r\n      act(() => {\r\n        vi.advanceTimersByTime(300);\r\n      });\r\n\r\n      // Should have been called once with last value\r\n      expect(callback).toHaveBeenCalledTimes(1);\r\n      expect(callback).toHaveBeenCalledWith('c');\r\n    });\r\n\r\n    it('should reset timer on each call', () => {\r\n      const callback = vi.fn();\r\n      const { result } = renderHook(() => useDebounceCallback(callback, 300));\r\n\r\n      act(() => {\r\n        result.current('a');\r\n      });\r\n\r\n      act(() => {\r\n        vi.advanceTimersByTime(200);\r\n      });\r\n\r\n      act(() => {\r\n        result.current('b');\r\n      });\r\n\r\n      act(() => {\r\n        vi.advanceTimersByTime(200);\r\n      });\r\n\r\n      expect(callback).not.toHaveBeenCalled();\r\n\r\n      act(() => {\r\n        vi.advanceTimersByTime(100);\r\n      });\r\n\r\n      expect(callback).toHaveBeenCalledWith('b');\r\n    });\r\n  });\r\n\r\n  describe('useDebounceValue', () => {\r\n    it('should debounce value updates', async () => {\r\n      const { result, rerender } = renderHook(\r\n        ({ value }) => useDebounceValue(value, 300),\r\n        { initialProps: { value: 'initial' } }\r\n      );\r\n\r\n      expect(result.current).toBe('initial');\r\n\r\n      rerender({ value: 'updated' });\r\n      expect(result.current).toBe('initial');\r\n\r\n      act(() => {\r\n        vi.advanceTimersByTime(300);\r\n      });\r\n\r\n      expect(result.current).toBe('updated');\r\n    });\r\n  });\r\n\r\n  describe('useThrottleCallback', () => {\r\n    it('should throttle callback calls', () => {\r\n      const callback = vi.fn();\r\n      const { result } = renderHook(() => useThrottleCallback(callback, 300));\r\n\r\n      // First call should execute immediately\r\n      act(() => {\r\n        result.current('a');\r\n      });\r\n      expect(callback).toHaveBeenCalledWith('a');\r\n      expect(callback).toHaveBeenCalledTimes(1);\r\n\r\n      // Subsequent calls within interval should be ignored\r\n      act(() => {\r\n        result.current('b');\r\n        result.current('c');\r\n      });\r\n      expect(callback).toHaveBeenCalledTimes(1);\r\n\r\n      // After interval, should allow new call\r\n      act(() => {\r\n        vi.advanceTimersByTime(300);\r\n      });\r\n\r\n      act(() => {\r\n        result.current('d');\r\n      });\r\n      expect(callback).toHaveBeenCalledTimes(2);\r\n      expect(callback).toHaveBeenLastCalledWith('d');\r\n    });\r\n  });\r\n\r\n  describe('usePrevious', () => {\r\n    it('should return previous value', () => {\r\n      const { result, rerender } = renderHook(\r\n        ({ value }) => usePrevious(value),\r\n        { initialProps: { value: 1 } }\r\n      );\r\n\r\n      // Initially undefined\r\n      expect(result.current).toBeUndefined();\r\n\r\n      // After update, should have previous value\r\n      rerender({ value: 2 });\r\n      expect(result.current).toBe(1);\r\n\r\n      rerender({ value: 3 });\r\n      expect(result.current).toBe(2);\r\n    });\r\n  });\r\n\r\n  describe('useStableCallback', () => {\r\n    it('should maintain stable reference', () => {\r\n      const { result, rerender } = renderHook(\r\n        ({ fn }) => useStableCallback(fn),\r\n        { initialProps: { fn: () => 'a' as string } }\r\n      );\r\n\r\n      const firstRef = result.current;\r\n\r\n      rerender({ fn: () => 'b' as string });\r\n\r\n      // Reference should be stable\r\n      expect(result.current).toBe(firstRef);\r\n\r\n      // But should use latest closure\r\n      expect(result.current()).toBe('b');\r\n    });\r\n  });\r\n\r\n  describe('useMemoFilter', () => {\r\n    it('should filter items', () => {\r\n      const items = [1, 2, 3, 4, 5];\r\n      const { result } = renderHook(() =>\r\n        useMemoFilter(items, (n) => n > 2, [])\r\n      );\r\n\r\n      expect(result.current).toEqual([3, 4, 5]);\r\n    });\r\n\r\n    it('should update when deps change', () => {\r\n      const items = [1, 2, 3, 4, 5];\r\n      const { result, rerender } = renderHook(\r\n        ({ threshold }) =>\r\n          useMemoFilter(items, (n) => n > threshold, [threshold]),\r\n        { initialProps: { threshold: 2 } }\r\n      );\r\n\r\n      expect(result.current).toEqual([3, 4, 5]);\r\n\r\n      rerender({ threshold: 3 });\r\n      expect(result.current).toEqual([4, 5]);\r\n    });\r\n  });\r\n\r\n  describe('useMemoSort', () => {\r\n    it('should sort items', () => {\r\n      const items = [3, 1, 4, 1, 5, 9, 2, 6];\r\n      const { result } = renderHook(() =>\r\n        useMemoSort(items, (a, b) => a - b, [])\r\n      );\r\n\r\n      expect(result.current).toEqual([1, 1, 2, 3, 4, 5, 6, 9]);\r\n    });\r\n\r\n    it('should not mutate original array', () => {\r\n      const items = [3, 1, 2];\r\n      renderHook(() => useMemoSort(items, (a, b) => a - b, []));\r\n\r\n      expect(items).toEqual([3, 1, 2]);\r\n    });\r\n  });\r\n\r\n  describe('useMemoMap', () => {\r\n    it('should map items', () => {\r\n      const items = [1, 2, 3];\r\n      const { result } = renderHook(() =>\r\n        useMemoMap(items, (n) => n * 2)\r\n      );\r\n\r\n      expect(result.current).toEqual([2, 4, 6]);\r\n    });\r\n\r\n    it('should provide index to map function', () => {\r\n      const items = ['a', 'b', 'c'];\r\n      const { result } = renderHook(() =>\r\n        useMemoMap(items, (item, i) => `${item}-${i}`)\r\n      );\r\n\r\n      expect(result.current).toEqual(['a-0', 'b-1', 'c-2']);\r\n    });\r\n  });\r\n\r\n  describe('useLazyValue', () => {\r\n    it('should compute value only once', () => {\r\n      const factory = vi.fn(() => 'computed');\r\n      const { result, rerender } = renderHook(() => useLazyValue(factory));\r\n\r\n      expect(result.current).toBe('computed');\r\n      expect(factory).toHaveBeenCalledTimes(1);\r\n\r\n      rerender();\r\n      rerender();\r\n      rerender();\r\n\r\n      expect(factory).toHaveBeenCalledTimes(1);\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[372,375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[372,375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[382,385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[382,385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/use-memo","severity":2,"message":"Error: Expected the first argument to be an inline function expression\n\nExpected the first argument to be an inline function expression.\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:25:5\n  23 |\n  24 |   return useCallback(\n> 25 |     ((...args: Parameters<T>) => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 26 |       if (timeoutRef.current) {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 27 |         clearTimeout(timeoutRef.current);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 28 |       }\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 29 |       timeoutRef.current = setTimeout(() => {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 30 |         callbackRef.current(...args);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 31 |       }, delay);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 32 |     }) as T,\n     | ^^^^^^^^^^^^ Expected the first argument to be an inline function expression\n  33 |     [delay]\n  34 |   );\n  35 | }","line":25,"column":5,"nodeType":null,"endLine":32,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1895,1898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1895,1898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1905,1908],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1905,1908],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/use-memo","severity":2,"message":"Error: Expected the first argument to be an inline function expression\n\nExpected the first argument to be an inline function expression.\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:85:5\n  83 |\n  84 |   return useCallback(\n> 85 |     ((...args: Parameters<T>) => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 86 |       const now = Date.now();\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 87 |       if (now - lastCallRef.current >= interval) {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 88 |         lastCallRef.current = now;\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 89 |         callbackRef.current(...args);\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 90 |       }\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 91 |     }) as T,\n     | ^^^^^^^^^^^^ Expected the first argument to be an inline function expression\n  92 |     [interval]\n  93 |   );\n  94 | }","line":85,"column":5,"nodeType":null,"endLine":91,"endColumn":12},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:108:7\n  106 |   const ref = useRef<{ deps: DependencyList; value: T } | undefined>(undefined);\n  107 |\n> 108 |   if (!ref.current || !deepEqual(ref.current.deps, deps)) {\n      |       ^^^^^^^^^^^^ Cannot access ref value during render\n  109 |     ref.current = { deps, value: factory() };\n  110 |   }\n  111 |","line":108,"column":7,"nodeType":null,"endLine":108,"endColumn":19},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:108:7\n  106 |   const ref = useRef<{ deps: DependencyList; value: T } | undefined>(undefined);\n  107 |\n> 108 |   if (!ref.current || !deepEqual(ref.current.deps, deps)) {\n      |       ^^^^^^^^^^^^ Cannot access ref value during render\n  109 |     ref.current = { deps, value: factory() };\n  110 |   }\n  111 |","line":108,"column":7,"nodeType":null,"endLine":108,"endColumn":19},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:108:7\n  106 |   const ref = useRef<{ deps: DependencyList; value: T } | undefined>(undefined);\n  107 |\n> 108 |   if (!ref.current || !deepEqual(ref.current.deps, deps)) {\n      |       ^^^^^^^^^^^^ Cannot access ref value during render\n  109 |     ref.current = { deps, value: factory() };\n  110 |   }\n  111 |","line":108,"column":7,"nodeType":null,"endLine":108,"endColumn":19},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:108:8\n  106 |   const ref = useRef<{ deps: DependencyList; value: T } | undefined>(undefined);\n  107 |\n> 108 |   if (!ref.current || !deepEqual(ref.current.deps, deps)) {\n      |        ^^^^^^^^^^^ Cannot access ref value during render\n  109 |     ref.current = { deps, value: factory() };\n  110 |   }\n  111 |\n\nTo initialize a ref only once, check that the ref is null with the pattern `if (ref.current == null) { ref.current = ... }`","line":108,"column":8,"nodeType":null,"endLine":108,"endColumn":19},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:108:34\n  106 |   const ref = useRef<{ deps: DependencyList; value: T } | undefined>(undefined);\n  107 |\n> 108 |   if (!ref.current || !deepEqual(ref.current.deps, deps)) {\n      |                                  ^^^^^^^^^^^^^^^^ Passing a ref to a function may read its value during render\n  109 |     ref.current = { deps, value: factory() };\n  110 |   }\n  111 |","line":108,"column":34,"nodeType":null,"endLine":108,"endColumn":50},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:112:10\n  110 |   }\n  111 |\n> 112 |   return ref.current.value;\n      |          ^^^^^^^^^^^^^^^^^ Cannot access ref value during render\n  113 | }\n  114 |\n  115 | /**","line":112,"column":10,"nodeType":null,"endLine":112,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3075,3078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3075,3078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3083,3086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3083,3086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:152:10\n  150 |   }, [value]);\n  151 |   \n> 152 |   return ref.current;\n      |          ^^^^^^^^^^^ Cannot access ref value during render\n  153 | }\n  154 |\n  155 | /**","line":152,"column":10,"nodeType":null,"endLine":152,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4267,4270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4267,4270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4277,4280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4277,4280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/use-memo","severity":2,"message":"Error: Expected the first argument to be an inline function expression\n\nExpected the first argument to be an inline function expression.\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:172:5\n  170 |   \n  171 |   return useCallback(\n> 172 |     ((...args: Parameters<T>) => callbackRef.current(...args)) as T,\n      |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Expected the first argument to be an inline function expression\n  173 |     []\n  174 |   );\n  175 | }","line":172,"column":5,"nodeType":null,"endLine":172,"endColumn":68},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:255:8\n  253 |   });\n  254 |   \n> 255 |   if (!ref.current.initialized) {\n      |        ^^^^^^^^^^^^^^^^^^^^^^^ Cannot access ref value during render\n  256 |     ref.current.value = factory();\n  257 |     ref.current.initialized = true;\n  258 |   }","line":255,"column":8,"nodeType":null,"endLine":255,"endColumn":31},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:256:5\n  254 |   \n  255 |   if (!ref.current.initialized) {\n> 256 |     ref.current.value = factory();\n      |     ^^^^^^^^^^^ Cannot update ref during render\n  257 |     ref.current.initialized = true;\n  258 |   }\n  259 |   ","line":256,"column":5,"nodeType":null,"endLine":256,"endColumn":16},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:257:5\n  255 |   if (!ref.current.initialized) {\n  256 |     ref.current.value = factory();\n> 257 |     ref.current.initialized = true;\n      |     ^^^^^^^^^^^ Cannot update ref during render\n  258 |   }\n  259 |   \n  260 |   return ref.current.value;","line":257,"column":5,"nodeType":null,"endLine":257,"endColumn":16},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useMemoization.ts:260:10\n  258 |   }\n  259 |   \n> 260 |   return ref.current.value;\n      |          ^^^^^^^^^^^^^^^^^ Cannot access ref value during render\n  261 | }\n  262 |\n  263 | /**","line":260,"column":10,"nodeType":null,"endLine":260,"endColumn":27}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'predicate'. Either include it or remove the dependency array.","line":196,"column":5,"nodeType":"ArrayExpression","endLine":196,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [items, predicate]","fix":{"range":[5028,5044],"text":"[items, predicate]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a spread element in its dependency array. This means we can't statically verify whether you've passed the correct dependencies.","line":196,"column":13,"nodeType":"SpreadElement","endLine":196,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'compareFn'. Either include it or remove the dependency array.","line":219,"column":5,"nodeType":"ArrayExpression","endLine":219,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [compareFn, items]","fix":{"range":[5545,5561],"text":"[compareFn, items]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a spread element in its dependency array. This means we can't statically verify whether you've passed the correct dependencies.","line":219,"column":13,"nodeType":"SpreadElement","endLine":219,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'mapFn'. Either include it or remove the dependency array.","line":238,"column":5,"nodeType":"ArrayExpression","endLine":238,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [items, mapFn]","fix":{"range":[5985,6001],"text":"[items, mapFn]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a spread element in its dependency array. This means we can't statically verify whether you've passed the correct dependencies.","line":238,"column":13,"nodeType":"SpreadElement","endLine":238,"endColumn":20,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":22,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo, useCallback, useRef, useEffect, DependencyList } from 'react';\r\n\r\n/**\r\n * Custom hook for debouncing a callback function\r\n * Useful for search inputs, resize handlers, etc.\r\n * \r\n * @example\r\n * const debouncedSearch = useDebounceCallback((term) => {\r\n *   searchProducts(term);\r\n * }, 300);\r\n */\r\nexport function useDebounceCallback<T extends (...args: any[]) => any>(\r\n  callback: T,\r\n  delay: number\r\n): T {\r\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const callbackRef = useRef(callback);\r\n  \r\n  // Update callback ref when callback changes\r\n  useEffect(() => {\r\n    callbackRef.current = callback;\r\n  }, [callback]);\r\n\r\n  return useCallback(\r\n    ((...args: Parameters<T>) => {\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n      timeoutRef.current = setTimeout(() => {\r\n        callbackRef.current(...args);\r\n      }, delay);\r\n    }) as T,\r\n    [delay]\r\n  );\r\n}\r\n\r\n/**\r\n * Custom hook for debouncing a value\r\n * Returns the debounced value after delay\r\n * \r\n * @example\r\n * const [search, setSearch] = useState('');\r\n * const debouncedSearch = useDebounceValue(search, 300);\r\n */\r\nexport function useDebounceValue<T>(value: T, delay: number): T {\r\n  const [debouncedValue, setDebouncedValue] = useState(value);\r\n\r\n  useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setDebouncedValue(value);\r\n    }, delay);\r\n\r\n    return () => {\r\n      clearTimeout(timer);\r\n    };\r\n  }, [value, delay]);\r\n\r\n  return debouncedValue;\r\n}\r\n\r\n// Need to import useState for useDebounceValue\r\nimport { useState } from 'react';\r\n\r\n/**\r\n * Custom hook for throttling a callback function\r\n * Ensures callback is called at most once per interval\r\n * \r\n * @example\r\n * const throttledScroll = useThrottleCallback(() => {\r\n *   updateScrollPosition();\r\n * }, 100);\r\n */\r\nexport function useThrottleCallback<T extends (...args: any[]) => any>(\r\n  callback: T,\r\n  interval: number\r\n): T {\r\n  const lastCallRef = useRef<number>(0);\r\n  const callbackRef = useRef(callback);\r\n\r\n  useEffect(() => {\r\n    callbackRef.current = callback;\r\n  }, [callback]);\r\n\r\n  return useCallback(\r\n    ((...args: Parameters<T>) => {\r\n      const now = Date.now();\r\n      if (now - lastCallRef.current >= interval) {\r\n        lastCallRef.current = now;\r\n        callbackRef.current(...args);\r\n      }\r\n    }) as T,\r\n    [interval]\r\n  );\r\n}\r\n\r\n/**\r\n * Custom hook for memoizing expensive computations with deep comparison\r\n * Use when dependencies are objects/arrays that might have same values but different references\r\n * \r\n * @example\r\n * const processedData = useDeepMemo(() => {\r\n *   return heavyComputation(data);\r\n * }, [data]);\r\n */\r\nexport function useDeepMemo<T>(factory: () => T, deps: DependencyList): T {\r\n  const ref = useRef<{ deps: DependencyList; value: T } | undefined>(undefined);\r\n\r\n  if (!ref.current || !deepEqual(ref.current.deps, deps)) {\r\n    ref.current = { deps, value: factory() };\r\n  }\r\n\r\n  return ref.current.value;\r\n}\r\n\r\n/**\r\n * Deep equality check for objects and arrays\r\n */\r\nfunction deepEqual(a: any, b: any): boolean {\r\n  if (a === b) return true;\r\n  if (a == null || b == null) return false;\r\n  if (typeof a !== typeof b) return false;\r\n  \r\n  if (typeof a === 'object') {\r\n    if (Array.isArray(a) !== Array.isArray(b)) return false;\r\n    \r\n    const keysA = Object.keys(a);\r\n    const keysB = Object.keys(b);\r\n    \r\n    if (keysA.length !== keysB.length) return false;\r\n    \r\n    return keysA.every(key => deepEqual(a[key], b[key]));\r\n  }\r\n  \r\n  return false;\r\n}\r\n\r\n/**\r\n * Custom hook to get previous value of a state/prop\r\n * Useful for comparing current vs previous values\r\n * \r\n * @example\r\n * const prevCount = usePrevious(count);\r\n * if (count !== prevCount) { ... }\r\n */\r\nexport function usePrevious<T>(value: T): T | undefined {\r\n  const ref = useRef<T>(undefined);\r\n  \r\n  useEffect(() => {\r\n    ref.current = value;\r\n  }, [value]);\r\n  \r\n  return ref.current;\r\n}\r\n\r\n/**\r\n * Custom hook for stable callback reference\r\n * Similar to useCallback but always has the latest closure values\r\n * \r\n * @example\r\n * const handleClick = useStableCallback(() => {\r\n *   console.log(someState); // Always has latest value\r\n * });\r\n */\r\nexport function useStableCallback<T extends (...args: any[]) => any>(callback: T): T {\r\n  const callbackRef = useRef(callback);\r\n  \r\n  useEffect(() => {\r\n    callbackRef.current = callback;\r\n  });\r\n  \r\n  return useCallback(\r\n    ((...args: Parameters<T>) => callbackRef.current(...args)) as T,\r\n    []\r\n  );\r\n}\r\n\r\n/**\r\n * Memoization helper for filtering arrays\r\n * Only recomputes when items or filter criteria change\r\n * \r\n * @example\r\n * const filteredProducts = useMemoFilter(\r\n *   products,\r\n *   (product) => product.name.includes(search),\r\n *   [search]\r\n * );\r\n */\r\nexport function useMemoFilter<T>(\r\n  items: T[],\r\n  predicate: (item: T) => boolean,\r\n  deps: DependencyList\r\n): T[] {\r\n  return useMemo(\r\n    () => items.filter(predicate),\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    [items, ...deps]\r\n  );\r\n}\r\n\r\n/**\r\n * Memoization helper for sorting arrays\r\n * Only recomputes when items or sort criteria change\r\n * \r\n * @example\r\n * const sortedProducts = useMemoSort(\r\n *   products,\r\n *   (a, b) => a.price - b.price,\r\n *   [sortDirection]\r\n * );\r\n */\r\nexport function useMemoSort<T>(\r\n  items: T[],\r\n  compareFn: (a: T, b: T) => number,\r\n  deps: DependencyList\r\n): T[] {\r\n  return useMemo(\r\n    () => [...items].sort(compareFn),\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    [items, ...deps]\r\n  );\r\n}\r\n\r\n/**\r\n * Memoization helper for mapping arrays\r\n * Only recomputes when items change\r\n * \r\n * @example\r\n * const productNames = useMemoMap(products, p => p.name);\r\n */\r\nexport function useMemoMap<T, U>(\r\n  items: T[],\r\n  mapFn: (item: T, index: number) => U,\r\n  deps: DependencyList = []\r\n): U[] {\r\n  return useMemo(\r\n    () => items.map(mapFn),\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    [items, ...deps]\r\n  );\r\n}\r\n\r\n/**\r\n * Custom hook for lazy initialization of expensive values\r\n * Value is only computed once on first access\r\n * \r\n * @example\r\n * const expensiveValue = useLazyValue(() => computeExpensiveValue());\r\n */\r\nexport function useLazyValue<T>(factory: () => T): T {\r\n  const ref = useRef<{ value: T; initialized: boolean }>({ \r\n    value: undefined as T, \r\n    initialized: false \r\n  });\r\n  \r\n  if (!ref.current.initialized) {\r\n    ref.current.value = factory();\r\n    ref.current.initialized = true;\r\n  }\r\n  \r\n  return ref.current.value;\r\n}\r\n\r\n/**\r\n * Custom hook for intersection observer (lazy loading, infinite scroll)\r\n * \r\n * @example\r\n * const { ref, isIntersecting } = useIntersectionObserver({\r\n *   threshold: 0.5,\r\n *   onIntersect: () => loadMore()\r\n * });\r\n * return <div ref={ref}>...</div>\r\n */\r\nexport function useIntersectionObserver(options: {\r\n  threshold?: number;\r\n  rootMargin?: string;\r\n  onIntersect?: () => void;\r\n  enabled?: boolean;\r\n}) {\r\n  const { threshold = 0, rootMargin = '0px', onIntersect, enabled = true } = options;\r\n  const [isIntersecting, setIsIntersecting] = useState(false);\r\n  const targetRef = useRef<HTMLElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!enabled) return;\r\n    \r\n    const observer = new IntersectionObserver(\r\n      ([entry]) => {\r\n        setIsIntersecting(entry.isIntersecting);\r\n        if (entry.isIntersecting && onIntersect) {\r\n          onIntersect();\r\n        }\r\n      },\r\n      { threshold, rootMargin }\r\n    );\r\n\r\n    const target = targetRef.current;\r\n    if (target) {\r\n      observer.observe(target);\r\n    }\r\n\r\n    return () => {\r\n      if (target) {\r\n        observer.unobserve(target);\r\n      }\r\n    };\r\n  }, [threshold, rootMargin, onIntersect, enabled]);\r\n\r\n  return { ref: targetRef, isIntersecting };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\usePOSCart.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'cart'. Either exclude it or remove the dependency array.","line":184,"column":49,"nodeType":"ArrayExpression","endLine":184,"endColumn":68,"suggestions":[{"desc":"Update the dependencies array to be: [getSubtotal]","fix":{"range":[5414,5433],"text":"[getSubtotal]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'cart'. Either exclude it or remove the dependency array.","line":187,"column":5,"nodeType":"ArrayExpression","endLine":187,"endColumn":45,"suggestions":[{"desc":"Update the dependencies array to be: [discount, discountType, getTotal]","fix":{"range":[5512,5552],"text":"[discount, discountType, getTotal]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'cart'. Either exclude it or remove the dependency array.","line":191,"column":5,"nodeType":"ArrayExpression","endLine":191,"endColumn":54,"suggestions":[{"desc":"Update the dependencies array to be: [discount, discountType, getDiscountAmount]","fix":{"range":[5653,5702],"text":"[discount, discountType, getDiscountAmount]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'cart'. Either exclude it or remove the dependency array.","line":193,"column":51,"nodeType":"ArrayExpression","endLine":193,"endColumn":71,"suggestions":[{"desc":"Update the dependencies array to be: [getItemCount]","fix":{"range":[5760,5780],"text":"[getItemCount]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Custom hook untuk POS Cart operations\r\n * Wrapper around Zustand store untuk kemudahan migrasi\r\n */\r\n\r\nimport { useCallback, useMemo } from 'react';\r\nimport { useCartStore, useCheckoutStore } from '@/stores';\r\nimport { useToast } from '@/components/ui/Toast';\r\n\r\ninterface Product {\r\n  id: string;\r\n  name: string;\r\n  productType: 'SINGLE' | 'VARIANT';\r\n  variants?: ProductVariant[];\r\n}\r\n\r\ninterface ProductVariant {\r\n  id: string;\r\n  sku: string;\r\n  variantValue: string;\r\n  stocks?: Array<{ cabangId: string; quantity: number; price: number }>;\r\n}\r\n\r\nexport function usePOSCart(cabangId: string) {\r\n  const toast = useToast();\r\n  \r\n  // Cart store\r\n  const cart = useCartStore((s) => s.cart);\r\n  const heldTransactions = useCartStore((s) => s.heldTransactions);\r\n  const addToCartStore = useCartStore((s) => s.addToCart);\r\n  const updateQuantityStore = useCartStore((s) => s.updateQuantity);\r\n  const removeFromCart = useCartStore((s) => s.removeFromCart);\r\n  const clearCart = useCartStore((s) => s.clearCart);\r\n  const holdTransaction = useCartStore((s) => s.holdTransaction);\r\n  const retrieveHeld = useCartStore((s) => s.retrieveHeld);\r\n  const deleteHeld = useCartStore((s) => s.deleteHeld);\r\n  const updateItemStock = useCartStore((s) => s.updateItemStock);\r\n  const getSubtotal = useCartStore((s) => s.getSubtotal);\r\n  const getTotal = useCartStore((s) => s.getTotal);\r\n  const getDiscountAmount = useCartStore((s) => s.getDiscountAmount);\r\n  const getItemCount = useCartStore((s) => s.getItemCount);\r\n  const getCartItemByVariantId = useCartStore((s) => s.getCartItemByVariantId);\r\n  \r\n  // Checkout store\r\n  const checkoutState = useCheckoutStore();\r\n  const {\r\n    customerName,\r\n    customerPhone,\r\n    paymentMethod,\r\n    cashReceived,\r\n    bankName,\r\n    referenceNo,\r\n    discount,\r\n    discountType,\r\n    showCustomerInfo,\r\n    showDiscount,\r\n    processing,\r\n    lastTransaction,\r\n    lastCashReceived,\r\n    showSuccess,\r\n  } = checkoutState;\r\n\r\n  // Add to cart with toast feedback\r\n  const addToCart = useCallback(\r\n    (product: Product, variant: ProductVariant) => {\r\n      const stock = variant.stocks?.find((s) => s.cabangId === cabangId);\r\n      \r\n      if (!stock || stock.quantity <= 0) {\r\n        toast.warning('Stok tidak tersedia!');\r\n        return false;\r\n      }\r\n\r\n      // Check if already in cart and exceeds stock\r\n      const existingItem = getCartItemByVariantId(variant.id);\r\n      if (existingItem && existingItem.quantity >= stock.quantity) {\r\n        toast.warning('Stok tidak mencukupi!');\r\n        return false;\r\n      }\r\n\r\n      // Hide default variant info for SINGLE products\r\n      let variantInfo = variant.variantValue;\r\n      const defaultVariants = ['default', 'standar', 'standard', 'default:', '-'];\r\n      if (\r\n        product.productType === 'SINGLE' ||\r\n        defaultVariants.some((v) => variantInfo.toLowerCase().includes(v))\r\n      ) {\r\n        variantInfo = '';\r\n      }\r\n\r\n      const success = addToCartStore({\r\n        productVariantId: variant.id,\r\n        productName: product.name,\r\n        variantInfo,\r\n        sku: variant.sku,\r\n        price: stock.price || 0,\r\n        availableStock: stock.quantity,\r\n      });\r\n\r\n      if (!success) {\r\n        toast.warning('Stok tidak mencukupi!');\r\n      }\r\n      \r\n      return success;\r\n    },\r\n    [cabangId, addToCartStore, getCartItemByVariantId, toast]\r\n  );\r\n\r\n  // Update quantity with toast feedback\r\n  const updateQuantity = useCallback(\r\n    (variantId: string, newQty: number) => {\r\n      if (newQty <= 0) {\r\n        removeFromCart(variantId);\r\n        return true;\r\n      }\r\n      \r\n      const success = updateQuantityStore(variantId, newQty);\r\n      if (!success) {\r\n        toast.warning('Stok tidak mencukupi!');\r\n      }\r\n      return success;\r\n    },\r\n    [updateQuantityStore, removeFromCart, toast]\r\n  );\r\n\r\n  // Hold current transaction\r\n  const handleHoldTransaction = useCallback(() => {\r\n    if (cart.length === 0) {\r\n      toast.warning('Keranjang masih kosong!');\r\n      return;\r\n    }\r\n\r\n    holdTransaction({\r\n      customerName,\r\n      customerPhone,\r\n      paymentMethod,\r\n      discount,\r\n      discountType,\r\n      bankName,\r\n      referenceNo,\r\n    });\r\n\r\n    checkoutState.resetCheckout();\r\n    toast.success('Transaksi berhasil di-hold!');\r\n  }, [\r\n    cart,\r\n    customerName,\r\n    customerPhone,\r\n    paymentMethod,\r\n    discount,\r\n    discountType,\r\n    bankName,\r\n    referenceNo,\r\n    holdTransaction,\r\n    checkoutState,\r\n    toast,\r\n  ]);\r\n\r\n  // Retrieve held transaction\r\n  const handleRetrieveHeld = useCallback(\r\n    (heldId: string) => {\r\n      const held = retrieveHeld(heldId);\r\n      if (held) {\r\n        // Also restore checkout state\r\n        checkoutState.setCustomerName(held.customerName);\r\n        checkoutState.setCustomerPhone(held.customerPhone);\r\n        checkoutState.setPaymentMethod(held.paymentMethod);\r\n        checkoutState.setDiscount(held.discount);\r\n        checkoutState.setDiscountType(held.discountType);\r\n        checkoutState.setBankName(held.bankName);\r\n        checkoutState.setReferenceNo(held.referenceNo);\r\n      }\r\n      return held;\r\n    },\r\n    [retrieveHeld, checkoutState]\r\n  );\r\n\r\n  // Reset all\r\n  const resetTransaction = useCallback(() => {\r\n    clearCart();\r\n    checkoutState.resetCheckout();\r\n  }, [clearCart, checkoutState]);\r\n\r\n  // Computed values\r\n  const subtotal = useMemo(() => getSubtotal(), [cart, getSubtotal]);\r\n  const total = useMemo(\r\n    () => getTotal(discount, discountType),\r\n    [cart, discount, discountType, getTotal]\r\n  );\r\n  const discountAmount = useMemo(\r\n    () => getDiscountAmount(discount, discountType),\r\n    [cart, discount, discountType, getDiscountAmount]\r\n  );\r\n  const itemCount = useMemo(() => getItemCount(), [cart, getItemCount]);\r\n\r\n  return {\r\n    // Cart state\r\n    cart,\r\n    heldTransactions,\r\n    \r\n    // Checkout state\r\n    customerName,\r\n    customerPhone,\r\n    paymentMethod,\r\n    cashReceived,\r\n    bankName,\r\n    referenceNo,\r\n    discount,\r\n    discountType,\r\n    showCustomerInfo,\r\n    showDiscount,\r\n    processing,\r\n    lastTransaction,\r\n    lastCashReceived,\r\n    showSuccess,\r\n    \r\n    // Setters\r\n    setCustomerName: checkoutState.setCustomerName,\r\n    setCustomerPhone: checkoutState.setCustomerPhone,\r\n    setPaymentMethod: checkoutState.setPaymentMethod,\r\n    setCashReceived: checkoutState.setCashReceived,\r\n    setBankName: checkoutState.setBankName,\r\n    setReferenceNo: checkoutState.setReferenceNo,\r\n    setDiscount: checkoutState.setDiscount,\r\n    setDiscountType: checkoutState.setDiscountType,\r\n    setShowCustomerInfo: checkoutState.setShowCustomerInfo,\r\n    setShowDiscount: checkoutState.setShowDiscount,\r\n    setProcessing: checkoutState.setProcessing,\r\n    setTransactionSuccess: checkoutState.setTransactionSuccess,\r\n    closeSuccessModal: checkoutState.closeSuccessModal,\r\n    \r\n    // Cart actions\r\n    addToCart,\r\n    updateQuantity,\r\n    removeFromCart,\r\n    clearCart,\r\n    updateItemStock,\r\n    getCartItemByVariantId,\r\n    \r\n    // Hold actions\r\n    handleHoldTransaction,\r\n    handleRetrieveHeld,\r\n    deleteHeld,\r\n    \r\n    // Reset\r\n    resetTransaction,\r\n    \r\n    // Computed\r\n    subtotal,\r\n    total,\r\n    discountAmount,\r\n    itemCount,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\usePOSProducts.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3524,3527],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3524,3527],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3689,3692],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3689,3692],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3763,3766],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3763,3766],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4225,4228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4225,4228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Custom hook untuk POS Products operations\r\n * Wrapper around Zustand store untuk kemudahan migrasi\r\n */\r\n\r\nimport { useEffect, useCallback } from 'react';\r\nimport { useProductStore } from '@/stores';\r\nimport { useProductSocket } from '@/hooks/useProductSocket';\r\nimport { useCartStore } from '@/stores';\r\n\r\ninterface UsePOSProductsOptions {\r\n  userRole?: string;\r\n  userCabangId?: string;\r\n  enabled?: boolean;\r\n}\r\n\r\nexport function usePOSProducts(options: UsePOSProductsOptions = {}) {\r\n  const { userRole, userCabangId, enabled = true } = options;\r\n  \r\n  // Product store\r\n  const products = useProductStore((s) => s.products);\r\n  const branches = useProductStore((s) => s.branches);\r\n  const categories = useProductStore((s) => s.categories);\r\n  const selectedCabangId = useProductStore((s) => s.selectedCabangId);\r\n  const search = useProductStore((s) => s.search);\r\n  const loading = useProductStore((s) => s.loading);\r\n  const adminWhatsApp = useProductStore((s) => s.adminWhatsApp);\r\n  \r\n  const setSelectedCabangId = useProductStore((s) => s.setSelectedCabangId);\r\n  const setSearch = useProductStore((s) => s.setSearch);\r\n  const fetchProducts = useProductStore((s) => s.fetchProducts);\r\n  const fetchBranches = useProductStore((s) => s.fetchBranches);\r\n  const fetchCategories = useProductStore((s) => s.fetchCategories);\r\n  const fetchSettings = useProductStore((s) => s.fetchSettings);\r\n  const updateProduct = useProductStore((s) => s.updateProduct);\r\n  const deleteProduct = useProductStore((s) => s.deleteProduct);\r\n  const updateStock = useProductStore((s) => s.updateStock);\r\n  const getFilteredProducts = useProductStore((s) => s.getFilteredProducts);\r\n  const getStockForVariant = useProductStore((s) => s.getStockForVariant);\r\n\r\n  // Cart store for stock updates\r\n  const updateItemStock = useCartStore((s) => s.updateItemStock);\r\n\r\n  // Get effective cabang ID\r\n  const getEffectiveCabangId = useCallback(() => {\r\n    if (userRole === 'KASIR') {\r\n      return userCabangId || '';\r\n    }\r\n    return selectedCabangId || userCabangId || '';\r\n  }, [userRole, userCabangId, selectedCabangId]);\r\n\r\n  const effectiveCabangId = getEffectiveCabangId();\r\n\r\n  // Initialize branches and select default\r\n  useEffect(() => {\r\n    const initBranches = async () => {\r\n      if (userRole === 'KASIR') return;\r\n\r\n      const activeBranches = await fetchBranches();\r\n      \r\n      // Auto-select branch\r\n      const savedCabangId = typeof window !== 'undefined' \r\n        ? localStorage.getItem('activeCabangId') \r\n        : null;\r\n        \r\n      if (savedCabangId && activeBranches.some((b) => b.id === savedCabangId)) {\r\n        setSelectedCabangId(savedCabangId);\r\n      } else if (userCabangId) {\r\n        setSelectedCabangId(userCabangId);\r\n      } else if (activeBranches.length > 0) {\r\n        setSelectedCabangId(activeBranches[0].id);\r\n      }\r\n    };\r\n\r\n    initBranches();\r\n  }, [userRole, userCabangId, fetchBranches, setSelectedCabangId]);\r\n\r\n  // Fetch products when cabang changes\r\n  useEffect(() => {\r\n    if (effectiveCabangId || userRole === 'KASIR') {\r\n      fetchProducts(effectiveCabangId);\r\n      fetchSettings();\r\n      fetchCategories();\r\n    }\r\n  }, [effectiveCabangId, userRole, fetchProducts, fetchSettings, fetchCategories]);\r\n\r\n  // WebSocket for real-time updates\r\n  useProductSocket({\r\n    onProductCreated: useCallback(() => {\r\n      fetchProducts(effectiveCabangId);\r\n    }, [fetchProducts, effectiveCabangId]),\r\n    \r\n    onProductUpdated: useCallback(\r\n      (updatedProduct: any) => {\r\n        updateProduct(updatedProduct);\r\n        \r\n        // Update cart items if product was updated\r\n        updatedProduct.variants?.forEach((variant: any) => {\r\n          const stock = variant.stocks?.find(\r\n            (s: any) => s.cabangId === effectiveCabangId\r\n          );\r\n          if (stock) {\r\n            updateItemStock(variant.id, stock.quantity, stock.price);\r\n          }\r\n        });\r\n      },\r\n      [updateProduct, updateItemStock, effectiveCabangId]\r\n    ),\r\n    \r\n    onProductDeleted: useCallback(\r\n      (productId: string) => {\r\n        deleteProduct(productId);\r\n      },\r\n      [deleteProduct]\r\n    ),\r\n    \r\n    onStockUpdated: useCallback(\r\n      (stockData: any) => {\r\n        if (stockData.cabangId !== effectiveCabangId) return;\r\n        \r\n        updateStock(\r\n          stockData.cabangId,\r\n          stockData.productVariantId,\r\n          stockData.quantity,\r\n          stockData.price\r\n        );\r\n        \r\n        // Update cart item stock\r\n        updateItemStock(\r\n          stockData.productVariantId,\r\n          stockData.quantity,\r\n          stockData.price\r\n        );\r\n      },\r\n      [updateStock, updateItemStock, effectiveCabangId]\r\n    ),\r\n    \r\n    onRefreshNeeded: useCallback(() => {\r\n      fetchProducts(effectiveCabangId);\r\n    }, [fetchProducts, effectiveCabangId]),\r\n    \r\n    enabled: enabled && !loading,\r\n  });\r\n\r\n  // Get stock info for UI display\r\n  const getStockInfo = useCallback(\r\n    (quantity: number, inCart: number = 0) => {\r\n      const available = quantity - inCart;\r\n      if (available <= 0) {\r\n        return { color: 'text-gray-400', text: 'Habis', available };\r\n      }\r\n      return {\r\n        color: 'text-green-600 dark:text-green-400',\r\n        text: `${available} pcs`,\r\n        available,\r\n      };\r\n    },\r\n    []\r\n  );\r\n\r\n  // Format variant display\r\n  const formatVariantDisplay = useCallback(\r\n    (variantName: string, variantValue: string) => {\r\n      const cleanValue = variantValue.replace(/\\s*\\|\\s*/g, ' ').trim();\r\n      const lowerValue = cleanValue.toLowerCase();\r\n\r\n      if (/^\\d+$/.test(cleanValue)) {\r\n        return cleanValue;\r\n      }\r\n\r\n      if (/^[a-zA-Z]+\\s+\\d+$/.test(cleanValue)) {\r\n        return cleanValue;\r\n      }\r\n\r\n      const nameLower = variantName.toLowerCase();\r\n      if (lowerValue.startsWith(nameLower)) {\r\n        return cleanValue.substring(variantName.length).trim();\r\n      }\r\n\r\n      return cleanValue;\r\n    },\r\n    []\r\n  );\r\n\r\n  return {\r\n    // State\r\n    products,\r\n    branches,\r\n    categories,\r\n    selectedCabangId,\r\n    search,\r\n    loading,\r\n    adminWhatsApp,\r\n    effectiveCabangId,\r\n    \r\n    // Setters\r\n    setSelectedCabangId,\r\n    setSearch,\r\n    \r\n    // Actions\r\n    fetchProducts: () => fetchProducts(effectiveCabangId),\r\n    fetchCategories,\r\n    \r\n    // Getters\r\n    getFilteredProducts,\r\n    getStockForVariant,\r\n    getStockInfo,\r\n    formatVariantDisplay,\r\n    getEffectiveCabangId,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useProductSocket.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useProductSocket.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useCallback' is defined but never used.","line":3,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[209,212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[209,212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[255,258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[255,258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[352,355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[352,355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/refs","severity":2,"message":"Error: Cannot access refs during render\n\nReact refs are values that are not needed for rendering. Refs should only be accessed outside of render, such as in event handlers or effects. Accessing a ref value (the `current` property) during render can cause your component not to update as expected (https://react.dev/reference/react/useRef).\n\nD:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useProductSocket.ts:37:3\n  35 |\n  36 |   const optionsRef = useRef(options);\n> 37 |   optionsRef.current = options;\n     |   ^^^^^^^^^^^^^^^^^^ Cannot update ref during render\n  38 |\n  39 |   // Initialize socket connection\n  40 |   useEffect(() => {","line":37,"column":3,"nodeType":null,"endLine":37,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mounted' is assigned a value but never used.","line":43,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":16}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useCallback, useRef } from 'react';\r\nimport { initSocket, subscribe, isConnected } from '@/lib/socket';\r\n\r\ninterface ProductSocketOptions {\r\n  onProductCreated?: (product: any) => void;\r\n  onProductUpdated?: (product: any) => void;\r\n  onProductDeleted?: (productId: string) => void;\r\n  onStockUpdated?: (stockData: any) => void;\r\n  onRefreshNeeded?: () => void;\r\n  enabled?: boolean;\r\n}\r\n\r\n/**\r\n * Custom hook for product real-time updates via WebSocket\r\n * Usage:\r\n * ```\r\n * useProductSocket({\r\n *   onProductUpdated: (product) => { ... },\r\n *   onStockUpdated: (data) => { ... },\r\n *   onRefreshNeeded: () => fetchProducts(),\r\n * });\r\n * ```\r\n */\r\nexport function useProductSocket(options: ProductSocketOptions = {}) {\r\n  const {\r\n    onProductCreated,\r\n    onProductUpdated,\r\n    onProductDeleted,\r\n    onStockUpdated,\r\n    onRefreshNeeded,\r\n    enabled = true,\r\n  } = options;\r\n\r\n  const optionsRef = useRef(options);\r\n  optionsRef.current = options;\r\n\r\n  // Initialize socket connection\r\n  useEffect(() => {\r\n    if (!enabled) return;\r\n\r\n    let mounted = true;\r\n    \r\n    const connect = async () => {\r\n      if (!isConnected()) {\r\n        await initSocket();\r\n      }\r\n    };\r\n\r\n    connect();\r\n\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [enabled]);\r\n\r\n  // Subscribe to product:created\r\n  useEffect(() => {\r\n    if (!enabled || !onProductCreated) return;\r\n\r\n    const unsubscribe = subscribe('product:created', (event) => {\r\n      onProductCreated(event.data);\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, [enabled, onProductCreated]);\r\n\r\n  // Subscribe to product:updated\r\n  useEffect(() => {\r\n    if (!enabled || !onProductUpdated) return;\r\n\r\n    const unsubscribe = subscribe('product:updated', (event) => {\r\n      onProductUpdated(event.data);\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, [enabled, onProductUpdated]);\r\n\r\n  // Subscribe to product:deleted\r\n  useEffect(() => {\r\n    if (!enabled || !onProductDeleted) return;\r\n\r\n    const unsubscribe = subscribe('product:deleted', (event) => {\r\n      onProductDeleted(event.data?.id);\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, [enabled, onProductDeleted]);\r\n\r\n  // Subscribe to stock:updated\r\n  useEffect(() => {\r\n    if (!enabled || !onStockUpdated) return;\r\n\r\n    const unsubscribe = subscribe('stock:updated', (event) => {\r\n      onStockUpdated(event.data);\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, [enabled, onStockUpdated]);\r\n\r\n  // Subscribe to sync:trigger for full refresh\r\n  useEffect(() => {\r\n    if (!enabled || !onRefreshNeeded) return;\r\n\r\n    const unsubscribe = subscribe('sync:trigger', (event) => {\r\n      if (event.syncType === 'products' || event.syncType === 'all') {\r\n        onRefreshNeeded();\r\n      }\r\n    });\r\n\r\n    return unsubscribe;\r\n  }, [enabled, onRefreshNeeded]);\r\n\r\n  return {\r\n    isConnected: isConnected(),\r\n  };\r\n}\r\n\r\nexport default useProductSocket;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useSocket.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'stockCallback' is assigned a value but never used.","line":80,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":80,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2490,2493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2490,2493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { renderHook, waitFor } from '@testing-library/react';\r\nimport { useRealtime } from './useSocket';\r\nimport * as socket from '@/lib/socket';\r\n\r\n// Mock socket module\r\nvi.mock('@/lib/socket', () => ({\r\n  initSocket: vi.fn().mockResolvedValue({\r\n    on: vi.fn(),\r\n    off: vi.fn(),\r\n  }),\r\n  subscribe: vi.fn().mockReturnValue(() => {}),\r\n  isConnected: vi.fn().mockReturnValue(false),\r\n}));\r\n\r\ndescribe('useRealtime', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  it('should initialize socket on mount', async () => {\r\n    renderHook(() => useRealtime());\r\n\r\n    await waitFor(() => {\r\n      expect(socket.initSocket).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  it('should return connected state', () => {\r\n    vi.mocked(socket.isConnected).mockReturnValue(true);\r\n    \r\n    const { result } = renderHook(() => useRealtime());\r\n\r\n    // Initially false, will update after socket init\r\n    expect(typeof result.current.connected).toBe('boolean');\r\n  });\r\n\r\n  it('should subscribe to stock:updated when onStockUpdate provided', async () => {\r\n    const onStockUpdate = vi.fn();\r\n    \r\n    renderHook(() => useRealtime({ onStockUpdate }));\r\n\r\n    await waitFor(() => {\r\n      expect(socket.subscribe).toHaveBeenCalledWith('stock:updated', expect.any(Function));\r\n    });\r\n  });\r\n\r\n  it('should subscribe to product:created when onProductCreate provided', async () => {\r\n    const onProductCreate = vi.fn();\r\n    \r\n    renderHook(() => useRealtime({ onProductCreate }));\r\n\r\n    await waitFor(() => {\r\n      expect(socket.subscribe).toHaveBeenCalledWith('product:created', expect.any(Function));\r\n    });\r\n  });\r\n\r\n  it('should subscribe to product:updated when onProductUpdate provided', async () => {\r\n    const onProductUpdate = vi.fn();\r\n    \r\n    renderHook(() => useRealtime({ onProductUpdate }));\r\n\r\n    await waitFor(() => {\r\n      expect(socket.subscribe).toHaveBeenCalledWith('product:updated', expect.any(Function));\r\n    });\r\n  });\r\n\r\n  it('should subscribe to product:deleted when onProductDelete provided', async () => {\r\n    const onProductDelete = vi.fn();\r\n    \r\n    renderHook(() => useRealtime({ onProductDelete }));\r\n\r\n    await waitFor(() => {\r\n      expect(socket.subscribe).toHaveBeenCalledWith('product:deleted', expect.any(Function));\r\n    });\r\n  });\r\n\r\n  it('should call onRefresh when stock is updated', async () => {\r\n    const onRefresh = vi.fn();\r\n    let stockCallback: (data: any) => void;\r\n    \r\n    vi.mocked(socket.subscribe).mockImplementation((event, callback) => {\r\n      if (event === 'stock:updated') {\r\n        stockCallback = callback;\r\n      }\r\n      return () => {};\r\n    });\r\n    \r\n    renderHook(() => useRealtime({ onRefresh }));\r\n\r\n    await waitFor(() => {\r\n      expect(socket.subscribe).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  it('should cleanup subscriptions on unmount', async () => {\r\n    const unsubscribe = vi.fn();\r\n    vi.mocked(socket.subscribe).mockReturnValue(unsubscribe);\r\n    \r\n    const { unmount } = renderHook(() => \r\n      useRealtime({ onStockUpdate: vi.fn() })\r\n    );\r\n\r\n    await waitFor(() => {\r\n      expect(socket.subscribe).toHaveBeenCalled();\r\n    });\r\n\r\n    unmount();\r\n\r\n    expect(unsubscribe).toHaveBeenCalled();\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useSocket.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\hooks\\useZodForm.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1223,1226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1223,1226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1231,1234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1231,1234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useForm, UseFormReturn, FieldValues, Path, DefaultValues } from 'react-hook-form';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport { z, ZodError } from 'zod';\r\nimport { useState, useCallback } from 'react';\r\n\r\ninterface UseZodFormOptions<T extends FieldValues> {\r\n  schema: z.ZodSchema;\r\n  defaultValues?: DefaultValues<T>;\r\n  onSubmit: (data: T) => Promise<void> | void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\ninterface UseZodFormReturn<T extends FieldValues> extends UseFormReturn<T> {\r\n  isSubmitting: boolean;\r\n  submitError: string | null;\r\n  setSubmitError: (error: string | null) => void;\r\n  onSubmit: (e?: React.BaseSyntheticEvent) => Promise<void>;\r\n  getFieldError: (name: Path<T>) => string | undefined;\r\n  hasFieldError: (name: Path<T>) => boolean;\r\n}\r\n\r\nexport function useZodForm<T extends FieldValues>({\r\n  schema,\r\n  defaultValues,\r\n  onSubmit,\r\n  onError,\r\n}: UseZodFormOptions<T>): UseZodFormReturn<T> {\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [submitError, setSubmitError] = useState<string | null>(null);\r\n\r\n  // Cast schema to any to support both Zod v3 and v4\r\n  const form = useForm<T>({\r\n    resolver: zodResolver(schema as any) as any,\r\n    defaultValues,\r\n  });\r\n\r\n  const handleFormSubmit = useCallback(\r\n    async (data: T) => {\r\n      setIsSubmitting(true);\r\n      setSubmitError(null);\r\n      \r\n      try {\r\n        await onSubmit(data);\r\n      } catch (error) {\r\n        const errorMessage = error instanceof Error \r\n          ? error.message \r\n          : 'Terjadi kesalahan';\r\n        setSubmitError(errorMessage);\r\n        onError?.(error instanceof Error ? error : new Error(errorMessage));\r\n      } finally {\r\n        setIsSubmitting(false);\r\n      }\r\n    },\r\n    [onSubmit, onError]\r\n  );\r\n\r\n  const getFieldError = useCallback(\r\n    (name: Path<T>): string | undefined => {\r\n      const error = form.formState.errors[name];\r\n      return error?.message as string | undefined;\r\n    },\r\n    [form.formState.errors]\r\n  );\r\n\r\n  const hasFieldError = useCallback(\r\n    (name: Path<T>): boolean => {\r\n      return !!form.formState.errors[name];\r\n    },\r\n    [form.formState.errors]\r\n  );\r\n\r\n  return {\r\n    ...form,\r\n    isSubmitting,\r\n    submitError,\r\n    setSubmitError,\r\n    onSubmit: form.handleSubmit(handleFormSubmit),\r\n    getFieldError,\r\n    hasFieldError,\r\n  };\r\n}\r\n\r\n// Validation helper for inline validation\r\nexport function validateWithSchema<T>(schema: z.ZodSchema<T>, data: unknown): {\r\n  success: boolean;\r\n  data?: T;\r\n  errors?: Record<string, string>;\r\n} {\r\n  try {\r\n    const validData = schema.parse(data);\r\n    return { success: true, data: validData };\r\n  } catch (error) {\r\n    if (error instanceof ZodError) {\r\n      const errors: Record<string, string> = {};\r\n      error.issues.forEach((issue) => {\r\n        const path = issue.path.join('.');\r\n        errors[path] = issue.message;\r\n      });\r\n      return { success: false, errors };\r\n    }\r\n    return { success: false, errors: { _form: 'Validation failed' } };\r\n  }\r\n}\r\n\r\n// Async validation helper\r\nexport async function validateAsync<T>(\r\n  schema: z.ZodSchema<T>,\r\n  data: unknown\r\n): Promise<{ success: boolean; data?: T; errors?: Record<string, string> }> {\r\n  try {\r\n    const validData = await schema.parseAsync(data);\r\n    return { success: true, data: validData };\r\n  } catch (error) {\r\n    if (error instanceof ZodError) {\r\n      const errors: Record<string, string> = {};\r\n      error.issues.forEach((issue) => {\r\n        const path = issue.path.join('.');\r\n        errors[path] = issue.message;\r\n      });\r\n      return { success: false, errors };\r\n    }\r\n    return { success: false, errors: { _form: 'Validation failed' } };\r\n  }\r\n}\r\n\r\nexport default useZodForm;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\api.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'afterEach' is defined but never used.","line":1,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'axios' is defined but never used.","line":2,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport axios from 'axios';\r\n\r\n// Mock axios before importing api\r\nvi.mock('axios', () => {\r\n  const mockAxiosInstance = {\r\n    get: vi.fn(),\r\n    post: vi.fn(),\r\n    put: vi.fn(),\r\n    delete: vi.fn(),\r\n    interceptors: {\r\n      request: { use: vi.fn() },\r\n      response: { use: vi.fn() },\r\n    },\r\n  };\r\n  return {\r\n    default: {\r\n      create: vi.fn(() => mockAxiosInstance),\r\n      ...mockAxiosInstance,\r\n    },\r\n  };\r\n});\r\n\r\n// Import after mocking\r\nimport api, { authAPI, productsAPI, cabangAPI, transactionsAPI } from './api';\r\n\r\ndescribe('API Module', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n  });\r\n\r\n  describe('authAPI', () => {\r\n    it('login should call post with correct params', async () => {\r\n      const mockResponse = { data: { token: 'test-token', user: {} } };\r\n      (api.post as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      await authAPI.login('test@example.com', 'password123');\r\n\r\n      expect(api.post).toHaveBeenCalledWith('/auth/login', {\r\n        email: 'test@example.com',\r\n        password: 'password123',\r\n      });\r\n    });\r\n\r\n    it('me should call get /auth/me', async () => {\r\n      const mockResponse = { data: { user: {} } };\r\n      (api.get as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      await authAPI.me();\r\n\r\n      expect(api.get).toHaveBeenCalledWith('/auth/me');\r\n    });\r\n\r\n    it('getUsers should call get /auth/users', async () => {\r\n      const mockResponse = { data: [] };\r\n      (api.get as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      await authAPI.getUsers();\r\n\r\n      expect(api.get).toHaveBeenCalledWith('/auth/users');\r\n    });\r\n\r\n    it('createUser should call post with user data', async () => {\r\n      const mockResponse = { data: { id: '1' } };\r\n      (api.post as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      const userData = {\r\n        email: 'new@example.com',\r\n        password: 'password',\r\n        name: 'New User',\r\n        role: 'KASIR',\r\n        cabangId: 'cabang-1',\r\n      };\r\n\r\n      await authAPI.createUser(userData);\r\n\r\n      expect(api.post).toHaveBeenCalledWith('/auth/users', userData);\r\n    });\r\n\r\n    it('updateUser should call put with correct params', async () => {\r\n      const mockResponse = { data: { id: '1' } };\r\n      (api.put as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      const updateData = { name: 'Updated', role: 'MANAGER', cabangId: 'cabang-1' };\r\n\r\n      await authAPI.updateUser('user-1', updateData);\r\n\r\n      expect(api.put).toHaveBeenCalledWith('/auth/users/user-1', updateData);\r\n    });\r\n\r\n    it('deleteUser should call delete with user id', async () => {\r\n      const mockResponse = { data: {} };\r\n      (api.delete as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      await authAPI.deleteUser('user-1');\r\n\r\n      expect(api.delete).toHaveBeenCalledWith('/auth/users/user-1');\r\n    });\r\n  });\r\n\r\n  describe('productsAPI', () => {\r\n    it('getProducts should call get with params', async () => {\r\n      const mockResponse = { data: [] };\r\n      (api.get as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      const params = { categoryId: 'cat-1', search: 'test' };\r\n      await productsAPI.getProducts(params);\r\n\r\n      expect(api.get).toHaveBeenCalledWith('/products', { params });\r\n    });\r\n\r\n    it('getProduct should call get with id', async () => {\r\n      const mockResponse = { data: {} };\r\n      (api.get as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      await productsAPI.getProduct('prod-1');\r\n\r\n      expect(api.get).toHaveBeenCalledWith('/products/prod-1');\r\n    });\r\n\r\n    it('createProduct should call post with data', async () => {\r\n      const mockResponse = { data: { id: '1' } };\r\n      (api.post as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      const productData = { name: 'Test Product', categoryId: 'cat-1', productType: 'SINGLE' as const };\r\n      await productsAPI.createProduct(productData);\r\n\r\n      expect(api.post).toHaveBeenCalledWith('/products', productData);\r\n    });\r\n\r\n    it('updateProduct should call put with id and data', async () => {\r\n      const mockResponse = { data: {} };\r\n      (api.put as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      const productData = { name: 'Updated Product' };\r\n      await productsAPI.updateProduct('prod-1', productData);\r\n\r\n      expect(api.put).toHaveBeenCalledWith('/products/prod-1', productData);\r\n    });\r\n\r\n    it('deleteProduct should call delete with id', async () => {\r\n      const mockResponse = { data: {} };\r\n      (api.delete as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      await productsAPI.deleteProduct('prod-1');\r\n\r\n      expect(api.delete).toHaveBeenCalledWith('/products/prod-1');\r\n    });\r\n\r\n    it('getCategories should call get /products/categories', async () => {\r\n      const mockResponse = { data: [] };\r\n      (api.get as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      await productsAPI.getCategories();\r\n\r\n      expect(api.get).toHaveBeenCalledWith('/products/categories');\r\n    });\r\n\r\n    it('searchBySKU should call get with sku', async () => {\r\n      const mockResponse = { data: {} };\r\n      (api.get as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      await productsAPI.searchBySKU('SKU-001');\r\n\r\n      expect(api.get).toHaveBeenCalledWith('/products/search/sku/SKU-001');\r\n    });\r\n  });\r\n\r\n  describe('cabangAPI', () => {\r\n    it('getCabangs should call get /cabang', async () => {\r\n      const mockResponse = { data: [] };\r\n      (api.get as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      await cabangAPI.getCabangs();\r\n\r\n      expect(api.get).toHaveBeenCalledWith('/cabang');\r\n    });\r\n\r\n    it('createCabang should call post with data', async () => {\r\n      const mockResponse = { data: { id: '1' } };\r\n      (api.post as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      const cabangData = { name: 'New Branch', address: 'Address' };\r\n      await cabangAPI.createCabang(cabangData);\r\n\r\n      expect(api.post).toHaveBeenCalledWith('/cabang', cabangData);\r\n    });\r\n  });\r\n\r\n  describe('transactionsAPI', () => {\r\n    it('createTransaction should call post with transaction data', async () => {\r\n      const mockResponse = { data: { id: '1' } };\r\n      (api.post as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      const transactionData = {\r\n        cabangId: 'cab-1',\r\n        items: [{ productVariantId: 'var-1', quantity: 2, price: 10000 }],\r\n        paymentMethod: 'CASH',\r\n      };\r\n      await transactionsAPI.createTransaction(transactionData);\r\n\r\n      expect(api.post).toHaveBeenCalledWith('/transactions', transactionData);\r\n    });\r\n\r\n    it('getTransaction should call get with id', async () => {\r\n      const mockResponse = { data: {} };\r\n      (api.get as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      await transactionsAPI.getTransaction('trans-1');\r\n\r\n      expect(api.get).toHaveBeenCalledWith('/transactions/trans-1');\r\n    });\r\n\r\n    it('getSummary should call get with params', async () => {\r\n      const mockResponse = { data: {} };\r\n      (api.get as ReturnType<typeof vi.fn>).mockResolvedValue(mockResponse);\r\n\r\n      const params = { startDate: '2025-01-01', endDate: '2025-01-31' };\r\n      await transactionsAPI.getSummary(params);\r\n\r\n      expect(api.get).toHaveBeenCalledWith('/transactions/reports/summary', { params });\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\auth.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\emailjs.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\env.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\env.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\logger.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[295,298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[295,298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[396,399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[396,399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[498,501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[498,501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[740,743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[740,743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Frontend Logger Utility\r\n * Only logs in development, silent in production\r\n * Errors are always sent to Sentry in production\r\n */\r\n\r\nimport * as Sentry from '@sentry/nextjs';\r\n\r\nconst isDevelopment = process.env.NODE_ENV !== 'production';\r\n\r\nexport const logger = {\r\n  debug: (...args: any[]) => {\r\n    if (isDevelopment) {\r\n      console.log(...args);\r\n    }\r\n  },\r\n\r\n  info: (...args: any[]) => {\r\n    if (isDevelopment) {\r\n      console.info(...args);\r\n    }\r\n  },\r\n\r\n  warn: (...args: any[]) => {\r\n    if (isDevelopment) {\r\n      console.warn(...args);\r\n    } else {\r\n      // Send warnings to Sentry in production\r\n      Sentry.captureMessage(args.map(a => String(a)).join(' '), 'warning');\r\n    }\r\n  },\r\n\r\n  error: (...args: any[]) => {\r\n    // Always log errors to console\r\n    console.error(...args);\r\n    \r\n    // Send to Sentry in production\r\n    if (!isDevelopment) {\r\n      const error = args[0];\r\n      if (error instanceof Error) {\r\n        Sentry.captureException(error, {\r\n          extra: { additionalArgs: args.slice(1) }\r\n        });\r\n      } else {\r\n        Sentry.captureMessage(args.map(a => String(a)).join(' '), 'error');\r\n      }\r\n    }\r\n  },\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\offlineCache.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":280,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8536,8539],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8536,8539],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":319,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9800,9803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9800,9803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Offline Cache Service untuk menyimpan data lokal\r\n * Menggunakan IndexedDB untuk cache besar seperti transactions, products\r\n */\r\n\r\n// Database configuration\r\nconst DB_NAME = 'pelaris_offline_cache';\r\nconst DB_VERSION = 1;\r\n\r\n// Store names\r\nconst STORES = {\r\n  TRANSACTIONS: 'cached_transactions',\r\n  PRODUCTS: 'cached_products',\r\n  METADATA: 'cache_metadata',\r\n};\r\n\r\nexport interface CachedTransaction {\r\n  id: string;\r\n  transactionNo: string;\r\n  customerName?: string;\r\n  customerPhone?: string;\r\n  total: number;\r\n  totalAmount?: number;\r\n  paymentMethod: string;\r\n  createdAt: string;\r\n  cabangId: string;\r\n  items: Array<{\r\n    id: string;\r\n    productName?: string;\r\n    variantInfo?: string;\r\n    quantity: number;\r\n    price: number;\r\n    subtotal?: number;\r\n    productVariantId: string;\r\n  }>;\r\n  // Offline-specific flags\r\n  isOffline?: boolean;\r\n  syncStatus?: 'pending' | 'synced';\r\n}\r\n\r\nexport interface CacheMetadata {\r\n  key: string;\r\n  lastUpdated: Date;\r\n  expiresAt?: Date;\r\n}\r\n\r\nclass OfflineCacheService {\r\n  private db: IDBDatabase | null = null;\r\n  private isInitialized = false;\r\n\r\n  /**\r\n   * Initialize IndexedDB\r\n   */\r\n  async initialize(): Promise<void> {\r\n    if (this.isInitialized) return;\r\n    if (typeof window === 'undefined') return;\r\n\r\n    try {\r\n      this.db = await this.openDatabase();\r\n      this.isInitialized = true;\r\n    } catch (error) {\r\n      console.error('Failed to initialize OfflineCacheService:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Open IndexedDB database\r\n   */\r\n  private openDatabase(): Promise<IDBDatabase> {\r\n    return new Promise((resolve, reject) => {\r\n      const request = indexedDB.open(DB_NAME, DB_VERSION);\r\n\r\n      request.onerror = () => reject(request.error);\r\n\r\n      request.onsuccess = () => resolve(request.result);\r\n\r\n      request.onupgradeneeded = (event) => {\r\n        const db = (event.target as IDBOpenDBRequest).result;\r\n\r\n        // Create transactions store\r\n        if (!db.objectStoreNames.contains(STORES.TRANSACTIONS)) {\r\n          const txStore = db.createObjectStore(STORES.TRANSACTIONS, { keyPath: 'id' });\r\n          txStore.createIndex('cabangId', 'cabangId', { unique: false });\r\n          txStore.createIndex('createdAt', 'createdAt', { unique: false });\r\n          txStore.createIndex('transactionNo', 'transactionNo', { unique: true });\r\n        }\r\n\r\n        // Create products store\r\n        if (!db.objectStoreNames.contains(STORES.PRODUCTS)) {\r\n          const prodStore = db.createObjectStore(STORES.PRODUCTS, { keyPath: 'id' });\r\n          prodStore.createIndex('cabangId', 'cabangId', { unique: false });\r\n        }\r\n\r\n        // Create metadata store\r\n        if (!db.objectStoreNames.contains(STORES.METADATA)) {\r\n          db.createObjectStore(STORES.METADATA, { keyPath: 'key' });\r\n        }\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Check if browser is online\r\n   */\r\n  get isOnline(): boolean {\r\n    return typeof navigator !== 'undefined' ? navigator.onLine : true;\r\n  }\r\n\r\n  // ==================== TRANSACTIONS ====================\r\n\r\n  /**\r\n   * Cache transactions for a specific cabang\r\n   */\r\n  async cacheTransactions(cabangId: string, transactions: CachedTransaction[]): Promise<void> {\r\n    if (!this.db) return;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const txn = this.db!.transaction([STORES.TRANSACTIONS, STORES.METADATA], 'readwrite');\r\n      const store = txn.objectStore(STORES.TRANSACTIONS);\r\n      const metaStore = txn.objectStore(STORES.METADATA);\r\n\r\n      // Clear old transactions for this cabang first (optional: or merge)\r\n      const deleteRequest = store.index('cabangId').openCursor(IDBKeyRange.only(cabangId));\r\n      \r\n      deleteRequest.onsuccess = (event) => {\r\n        const cursor = (event.target as IDBRequest<IDBCursorWithValue>).result;\r\n        if (cursor) {\r\n          // Only delete non-offline transactions (keep pending offline ones)\r\n          const record = cursor.value as CachedTransaction;\r\n          if (!record.isOffline || record.syncStatus === 'synced') {\r\n            cursor.delete();\r\n          }\r\n          cursor.continue();\r\n        } else {\r\n          // After deleting, add new transactions\r\n          for (const tx of transactions) {\r\n            store.put({ ...tx, cabangId });\r\n          }\r\n\r\n          // Update metadata\r\n          metaStore.put({\r\n            key: `transactions_${cabangId}`,\r\n            lastUpdated: new Date(),\r\n            expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours\r\n          });\r\n        }\r\n      };\r\n\r\n      txn.oncomplete = () => resolve();\r\n      txn.onerror = () => reject(txn.error);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get cached transactions for a cabang\r\n   */\r\n  async getCachedTransactions(cabangId: string): Promise<CachedTransaction[]> {\r\n    if (!this.db) return [];\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const txn = this.db!.transaction([STORES.TRANSACTIONS], 'readonly');\r\n      const store = txn.objectStore(STORES.TRANSACTIONS);\r\n      const index = store.index('cabangId');\r\n      const request = index.getAll(IDBKeyRange.only(cabangId));\r\n\r\n      request.onerror = () => reject(request.error);\r\n      request.onsuccess = () => {\r\n        const results = request.result as CachedTransaction[];\r\n        // Sort by createdAt descending\r\n        results.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\r\n        resolve(results);\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add a single offline transaction to cache\r\n   */\r\n  async addOfflineTransaction(transaction: CachedTransaction): Promise<void> {\r\n    if (!this.db) return;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const txn = this.db!.transaction([STORES.TRANSACTIONS], 'readwrite');\r\n      const store = txn.objectStore(STORES.TRANSACTIONS);\r\n      \r\n      const offlineTx: CachedTransaction = {\r\n        ...transaction,\r\n        isOffline: true,\r\n        syncStatus: 'pending',\r\n      };\r\n      \r\n      store.put(offlineTx);\r\n\r\n      txn.oncomplete = () => resolve();\r\n      txn.onerror = () => reject(txn.error);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Mark offline transaction as synced\r\n   */\r\n  async markTransactionSynced(localId: string, serverId: string): Promise<void> {\r\n    if (!this.db) return;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const txn = this.db!.transaction([STORES.TRANSACTIONS], 'readwrite');\r\n      const store = txn.objectStore(STORES.TRANSACTIONS);\r\n      \r\n      const getRequest = store.get(localId);\r\n      \r\n      getRequest.onsuccess = () => {\r\n        const tx = getRequest.result as CachedTransaction;\r\n        if (tx) {\r\n          tx.id = serverId; // Update to server ID\r\n          tx.syncStatus = 'synced';\r\n          tx.isOffline = false;\r\n          store.put(tx);\r\n          // Delete the old local ID entry\r\n          store.delete(localId);\r\n        }\r\n      };\r\n\r\n      txn.oncomplete = () => resolve();\r\n      txn.onerror = () => reject(txn.error);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get cache metadata\r\n   */\r\n  async getCacheMetadata(key: string): Promise<CacheMetadata | null> {\r\n    if (!this.db) return null;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const txn = this.db!.transaction([STORES.METADATA], 'readonly');\r\n      const store = txn.objectStore(STORES.METADATA);\r\n      const request = store.get(key);\r\n\r\n      request.onerror = () => reject(request.error);\r\n      request.onsuccess = () => resolve(request.result || null);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Check if cache is valid (not expired)\r\n   */\r\n  async isCacheValid(cabangId: string): Promise<boolean> {\r\n    const meta = await this.getCacheMetadata(`transactions_${cabangId}`);\r\n    if (!meta) return false;\r\n    if (meta.expiresAt && new Date(meta.expiresAt) < new Date()) return false;\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Clear all cached data\r\n   */\r\n  async clearAll(): Promise<void> {\r\n    if (!this.db) return;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const txn = this.db!.transaction(\r\n        [STORES.TRANSACTIONS, STORES.PRODUCTS, STORES.METADATA],\r\n        'readwrite'\r\n      );\r\n      \r\n      txn.objectStore(STORES.TRANSACTIONS).clear();\r\n      txn.objectStore(STORES.PRODUCTS).clear();\r\n      txn.objectStore(STORES.METADATA).clear();\r\n\r\n      txn.oncomplete = () => resolve();\r\n      txn.onerror = () => reject(txn.error);\r\n    });\r\n  }\r\n\r\n  // ==================== PRODUCTS (for future use) ====================\r\n\r\n  /**\r\n   * Cache products for a cabang\r\n   */\r\n  async cacheProducts(cabangId: string, products: any[]): Promise<void> {\r\n    if (!this.db) return;\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const txn = this.db!.transaction([STORES.PRODUCTS, STORES.METADATA], 'readwrite');\r\n      const store = txn.objectStore(STORES.PRODUCTS);\r\n      const metaStore = txn.objectStore(STORES.METADATA);\r\n\r\n      // Clear old products for this cabang\r\n      const deleteRequest = store.index('cabangId').openCursor(IDBKeyRange.only(cabangId));\r\n      \r\n      deleteRequest.onsuccess = (event) => {\r\n        const cursor = (event.target as IDBRequest<IDBCursorWithValue>).result;\r\n        if (cursor) {\r\n          cursor.delete();\r\n          cursor.continue();\r\n        } else {\r\n          // Add new products\r\n          for (const product of products) {\r\n            store.put({ ...product, cabangId });\r\n          }\r\n\r\n          // Update metadata\r\n          metaStore.put({\r\n            key: `products_${cabangId}`,\r\n            lastUpdated: new Date(),\r\n            expiresAt: new Date(Date.now() + 60 * 60 * 1000), // 1 hour\r\n          });\r\n        }\r\n      };\r\n\r\n      txn.oncomplete = () => resolve();\r\n      txn.onerror = () => reject(txn.error);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get cached products\r\n   */\r\n  async getCachedProducts(cabangId: string): Promise<any[]> {\r\n    if (!this.db) return [];\r\n\r\n    return new Promise((resolve, reject) => {\r\n      const txn = this.db!.transaction([STORES.PRODUCTS], 'readonly');\r\n      const store = txn.objectStore(STORES.PRODUCTS);\r\n      const index = store.index('cabangId');\r\n      const request = index.getAll(IDBKeyRange.only(cabangId));\r\n\r\n      request.onerror = () => reject(request.error);\r\n      request.onsuccess = () => resolve(request.result);\r\n    });\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nlet instance: OfflineCacheService | null = null;\r\n\r\nexport function getOfflineCacheService(): OfflineCacheService {\r\n  if (!instance) {\r\n    instance = new OfflineCacheService();\r\n  }\r\n  return instance;\r\n}\r\n\r\nexport default OfflineCacheService;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\offlineQueue.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\qz-print.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[179,182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[179,182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":203,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7565,7568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7565,7568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":239,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8759,8762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8759,8762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'center' is assigned a value but never used.","line":372,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":372,"endColumn":15}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * QZ Tray Print Library for Web-based Thermal Printing\r\n * Requires QZ Tray to be installed: https://qz.io/download/\r\n */\r\n\r\ndeclare global {\r\n  interface Window {\r\n    qz: any;\r\n  }\r\n}\r\n\r\nimport { logger } from './logger';\r\n\r\n// QZ Tray connection state\r\nlet qzConnection: Promise<void> | null = null;\r\nlet isConnected = false;\r\nlet certificateConfigured = false;\r\n\r\n// Demo certificate for QZ Tray (auto-trust without prompt)\r\nconst DEMO_CERTIFICATE = `-----BEGIN CERTIFICATE-----\r\nMIIECzCCAvOgAwIBAgIGAZrvpquaMA0GCSqGSIb3DQEBCwUAMIGiMQswCQYDVQQG\r\nEwJVUzELMAkGA1UECAwCTlkxEjAQBgNVBAcMCUNhbmFzdG90YTEbMBkGA1UECgwS\r\nUVogSW5kdXN0cmllcywgTExDMRswGQYDVQQLDBJRWiBJbmR1c3RyaWVzLCBMTEMx\r\nHDAaBgkqhkiG9w0BCQEWDXN1cHBvcnRAcXouaW8xGjAYBgNVBAMMEVFaIFRyYXkg\r\nRGVtbyBDZXJ0MB4XDTI1MTIwNDE3NTQyOFoXDTQ1MTIwNDE3NTQyOFowgaIxCzAJ\r\nBgNVBAYTAlVTMQswCQYDVQQIDAJOWTESMBAGA1UEBwwJQ2FuYXN0b3RhMRswGQYD\r\nVQQKDBJRWiBJbmR1c3RyaWVzLCBMTEMxGzAZBgNVBAsMElFaIEluZHVzdHJpZXMs\r\nIExMQzEcMBoGCSqGSIb3DQEJARYNc3VwcG9ydEBxei5pbzEaMBgGA1UEAwwRUVog\r\nVHJheSBEZW1vIENlcnQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDE\r\nxJsmV4D96F5J3XleYShgvvDU/IY5VjBFL3cnzNqHKsT/MN0Fm1J43JG8eGE/FkEP\r\nUf0jcOFZ/15jaRy+eEKqyHWadUcrvcfnFFZvGHWvUkS0dDjTdqlhwRb67z2EZUAM\r\nFtM0H3MNQmRuRBYBDcdcztUY/NccNElAGx21cSt0Zvm8XEv6Jigj+EaAc4ePRqi9\r\nfVMpq+p+jgf7YU2P5apbe4pcpm7OfoFYLanf6HRzVeLDHuWUx5K04SGc83gQ+Ba+\r\nVj5EvO1pHa2kpzDCioTmmWQypf8+3OZauDW1x1boKc0XEe0KfQVPnqx1VFzgX3KI\r\nv8hxQ2Nl9IPmbl+dbecjAgMBAAGjRTBDMBIGA1UdEwEB/wQIMAYBAf8CAQEwDgYD\r\nVR0PAQH/BAQDAgEGMB0GA1UdDgQWBBS/8hEW+h91c0AgDGByfC28rtW6HzANBgkq\r\nhkiG9w0BAQsFAAOCAQEAMQr1KqDEG7wYu6z2KyEEjUi4V+BtI327Sp57Slmr4UJV\r\n6DuJXXnWuYKHKjWNkRNQfO3MTvju1CHci3bC34Lf1IopK5YRjbKgmgGmN3msLRNr\r\n2l/VdXyms2YnXXNnA996ZWEVsaOKZSpQThn37jbOJtDvNJz/PJg2e9zszj6qYmMA\r\ncpl3UM9I3m/69REFtJSCtEAOjH2QiPJ78A/f3MiC8n33Bmzu2i3U8arcflm67zkd\r\nDFV01HdspqB4KY3PQiKRmtbyqYDnl/M5sLRgoJb/yH5DAjwFdhqXdGQUu4TW6wgm\r\nVPR1pXUONP16YUDzbfUMwHb50y6sVpHoW3qvxJ/dGw==\r\n-----END CERTIFICATE-----`;\r\n\r\n// Demo private key for signing\r\nconst DEMO_PRIVATE_KEY = `-----BEGIN PRIVATE KEY-----\r\nMIIEuwIBADANBgkqhkiG9w0BAQEFAASCBKUwggShAgEAAoIBAQDExJsmV4D96F5J\r\n3XleYShgvvDU/IY5VjBFL3cnzNqHKsT/MN0Fm1J43JG8eGE/FkEPUf0jcOFZ/15j\r\naRy+eEKqyHWadUcrvcfnFFZvGHWvUkS0dDjTdqlhwRb67z2EZUAMFtM0H3MNQmRu\r\nRBYBDcdcztUY/NccNElAGx21cSt0Zvm8XEv6Jigj+EaAc4ePRqi9fVMpq+p+jgf7\r\nYU2P5apbe4pcpm7OfoFYLanf6HRzVeLDHuWUx5K04SGc83gQ+Ba+Vj5EvO1pHa2k\r\npzDCioTmmWQypf8+3OZauDW1x1boKc0XEe0KfQVPnqx1VFzgX3KIv8hxQ2Nl9IPm\r\nbl+dbecjAgMBAAECggEAJfAyaeYdPNd8tok5SXU6L80g6i/2QT/Y9r38H3Rj/gPF\r\nD97//oDAGgWNI+Wh+mP0D1wjjp3JFW0jac9ud1sAn6Ue57UND+X7kRZew/TXXAJk\r\ntNZjzoHmjq6IG8Hc/pX3D12nQzl9GWVfr9L42yMo+T/33mWBpDKAnRedVsqHMl4B\r\nf+/K4Bq3Aen2DaeLsVtYPryOyHgfV1i1xx3PTCLPQRkGJ4OrZ++TCJS09QO824rJ\r\nKR9TGRYYwKqOFBED+S4IJiy1+GDoTRj6y0aGa/eOBsQ8Av3K05TLjVVitI3IBflH\r\nNlHx5UzlaxrN6zdTUs9hH7Nb56Kunh/ZjLshK/jUIQKBgQD23e7RxB5c2dwD9HpA\r\n8JOAnDvF4V96IAUAYkCIWq7xtENv6clZzsFuP6qJnwGblraiyWeLvn8MRpK5fnKF\r\nR2F1v6pEVZoavRKCSSNdy+xzQjzvihmGYrAaCNS/5RXAYS3VZtv6dzoGdT47GI8a\r\n4Endagm5T0/gzPkdKQObUsZO1QKBgQDMDDAnzBTHOY8XhfHLBKpfRlr3lXgfV3vg\r\n8kdLsSjgSGYRMwysYvM6o6kFUF2xP6h5WjkWuqACXQ8kJ+wpSCEtbhT/vy8ggl0u\r\nrMUGiMVARefdx9++HrcRKMh5QrRpoxQDCrUC4RU8HjOG4Kz51T3HYeHT6ft8vxng\r\n2lV/BaaKFwJ/awnPgySGBbxwqUZXu9CUJC+ZuzL9MvavNHtlf7nSIPsIQn4bz9TW\r\nCfeQ+hr3l37BsdOiEfWHIMt40vUAsslAeM2iBf8X0oAohlUwAHtrCo6t3S8D4kDo\r\nGmG53Xp28/Mu7FitCOypPCOZ2AXOBtk5LcfMb4z0FYTKftpJtg8t7QKBgQCfkySR\r\n6xuQ1qXeWqVHBWYMTqRTnbQspqk9uZwiSPFTvar85nSR2GypvlYvzrMHLGagSPv+\r\nl4MNdiOiPgqGGl+//Kg1fhnoDau8Feeb/ZhtdH4pxudm8vRuWfu2QYGAX8YFvvji\r\nwI5vzpqzb8A3PhordJQ8u28vFvCxFW7pgMzGjwKBgG5HKANzLcHKaDSgBbsbVksg\r\n0HbfcgumvF82HEcfaCmFFUjuMWIuBpeKp0961GsIPI9y1pvnncsQ8ovEj6iLJATh\r\nBDFChtsm0SiykWVLDT8iJTk0LpkN09BesllkTacmjfNyG0B35NeMnOP/R0aBwacu\r\nl96s5MGu3MYM6BrTWtHH\r\n-----END PRIVATE KEY-----`;\r\n\r\n/**\r\n * Configure QZ Tray certificate and signing\r\n */\r\nfunction configureCertificate(): void {\r\n  if (certificateConfigured || !window.qz) return;\r\n  \r\n  // Set certificate promise\r\n  window.qz.security.setCertificatePromise((resolve: (cert: string) => void) => {\r\n    resolve(DEMO_CERTIFICATE);\r\n  });\r\n  \r\n  // Set signature promise using the private key\r\n  window.qz.security.setSignatureAlgorithm('SHA512');\r\n  window.qz.security.setSignaturePromise((toSign: string) => {\r\n    return (resolve: (signature: string) => void, reject: (error: Error) => void) => {\r\n      try {\r\n        // Use SubtleCrypto for signing\r\n        const crypto = window.crypto;\r\n        const encoder = new TextEncoder();\r\n        const data = encoder.encode(toSign);\r\n        \r\n        // Convert PEM to ArrayBuffer\r\n        const pemContents = DEMO_PRIVATE_KEY\r\n          .replace('-----BEGIN PRIVATE KEY-----', '')\r\n          .replace('-----END PRIVATE KEY-----', '')\r\n          .replace(/\\s/g, '');\r\n        const binaryString = atob(pemContents);\r\n        const bytes = new Uint8Array(binaryString.length);\r\n        for (let i = 0; i < binaryString.length; i++) {\r\n          bytes[i] = binaryString.charCodeAt(i);\r\n        }\r\n        \r\n        crypto.subtle.importKey(\r\n          'pkcs8',\r\n          bytes.buffer,\r\n          { name: 'RSASSA-PKCS1-v1_5', hash: 'SHA-512' },\r\n          false,\r\n          ['sign']\r\n        ).then((key) => {\r\n          return crypto.subtle.sign('RSASSA-PKCS1-v1_5', key, data);\r\n        }).then((signature) => {\r\n          const signatureArray = new Uint8Array(signature);\r\n          let binary = '';\r\n          signatureArray.forEach(byte => binary += String.fromCharCode(byte));\r\n          resolve(btoa(binary));\r\n        }).catch(reject);\r\n      } catch (error) {\r\n        reject(error as Error);\r\n      }\r\n    };\r\n  });\r\n  \r\n  certificateConfigured = true;\r\n}\r\n\r\n/**\r\n * Load QZ Tray script dynamically\r\n */\r\nexport async function loadQZTray(): Promise<void> {\r\n  if (typeof window === 'undefined') return;\r\n  \r\n  // Check if already loaded\r\n  if (window.qz) {\r\n    // Disable logging if already loaded\r\n    if (window.qz.log) {\r\n      window.qz.log.setLevel('OFF');\r\n    }\r\n    return;\r\n  }\r\n  \r\n  return new Promise((resolve, reject) => {\r\n    const script = document.createElement('script');\r\n    script.src = 'https://cdn.jsdelivr.net/npm/qz-tray@2.2.4/qz-tray.min.js';\r\n    script.async = true;\r\n    script.onload = () => {\r\n      // Disable logging immediately after load\r\n      if (window.qz?.log) {\r\n        window.qz.log.setLevel('OFF');\r\n      }\r\n      resolve();\r\n    };\r\n    script.onerror = () => reject(new Error('Failed to load QZ Tray script'));\r\n    document.head.appendChild(script);\r\n  });\r\n}\r\n\r\n/**\r\n * Connect to QZ Tray\r\n */\r\nexport async function connectQZ(): Promise<void> {\r\n  if (typeof window === 'undefined') {\r\n    throw new Error('QZ Tray only works in browser');\r\n  }\r\n  \r\n  // Load script if not loaded\r\n  await loadQZTray();\r\n  \r\n  if (!window.qz) {\r\n    throw new Error('QZ Tray not loaded');\r\n  }\r\n  \r\n  // Disable QZ Tray's internal logging to console\r\n  if (window.qz.log) {\r\n    window.qz.log.setLevel('OFF');\r\n  }\r\n  \r\n  // Configure certificate for auto-trust (no prompt)\r\n  configureCertificate();\r\n  \r\n  // Already connected - check actual websocket state\r\n  if (window.qz.websocket.isActive()) {\r\n    isConnected = true;\r\n    return;\r\n  }\r\n  \r\n  // Reuse existing connection promise if still connecting\r\n  if (qzConnection) {\r\n    return qzConnection;\r\n  }\r\n  \r\n  qzConnection = new Promise(async (resolve, reject) => {\r\n    try {\r\n      // Setup connection event handlers\r\n      window.qz.websocket.setClosedCallbacks(() => {\r\n        isConnected = false;\r\n        qzConnection = null;\r\n      });\r\n      \r\n      window.qz.websocket.setErrorCallbacks((error: any) => {\r\n        logger.error('QZ Tray error:', error);\r\n      });\r\n      \r\n      // Temporarily suppress console.log during connect to hide QZ Tray's built-in message\r\n      const originalLog = console.log;\r\n      console.log = (...args: unknown[]) => {\r\n        // Only suppress QZ Tray connection messages\r\n        const msg = args[0];\r\n        if (typeof msg === 'string' && msg.includes('Established connection with QZ Tray')) {\r\n          return; // Suppress this specific message\r\n        }\r\n        originalLog.apply(console, args);\r\n      };\r\n      \r\n      try {\r\n        await window.qz.websocket.connect();\r\n      } finally {\r\n        // Restore console.log\r\n        console.log = originalLog;\r\n      }\r\n      \r\n      // Wait until websocket is truly active (max 3 seconds)\r\n      let attempts = 0;\r\n      const maxAttempts = 30;\r\n      while (!window.qz.websocket.isActive() && attempts < maxAttempts) {\r\n        await new Promise(r => setTimeout(r, 100));\r\n        attempts++;\r\n      }\r\n      \r\n      if (!window.qz.websocket.isActive()) {\r\n        throw new Error('QZ Tray connection timeout');\r\n      }\r\n      \r\n      isConnected = true;\r\n      resolve();\r\n    } catch (error: any) {\r\n      qzConnection = null;\r\n      isConnected = false;\r\n      if (error.message?.includes('Unable to establish')) {\r\n        reject(new Error('QZ Tray tidak terdeteksi. Pastikan QZ Tray sudah diinstall dan berjalan.'));\r\n      } else if (error.message?.includes('already exists')) {\r\n        // Connection already exists, treat as success\r\n        isConnected = true;\r\n        resolve();\r\n      } else {\r\n        reject(error);\r\n      }\r\n    }\r\n  });\r\n  \r\n  return qzConnection;\r\n}\r\n\r\n/**\r\n * Disconnect from QZ Tray\r\n */\r\nexport async function disconnectQZ(): Promise<void> {\r\n  if (typeof window === 'undefined' || !window.qz) return;\r\n  \r\n  if (isConnected) {\r\n    await window.qz.websocket.disconnect();\r\n    isConnected = false;\r\n    qzConnection = null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get list of available printers\r\n */\r\nexport async function getPrinters(): Promise<string[]> {\r\n  await connectQZ();\r\n  return window.qz.printers.find();\r\n}\r\n\r\n/**\r\n * Get default printer\r\n */\r\nexport async function getDefaultPrinter(): Promise<string> {\r\n  await connectQZ();\r\n  return window.qz.printers.getDefault();\r\n}\r\n\r\n/**\r\n * Print receipt using ESC/POS commands\r\n */\r\nexport interface PrintReceiptOptions {\r\n  printerName: string;\r\n  storeName: string;\r\n  branchName?: string;\r\n  address?: string;\r\n  phone?: string;\r\n  cashierName?: string;\r\n  transactionNo: string;\r\n  items: Array<{\r\n    name: string;\r\n    variant?: string;\r\n    qty: number;\r\n    price: number;\r\n    subtotal: number;\r\n  }>;\r\n  subtotal: number;\r\n  discount?: number;\r\n  discountType?: 'PERCENTAGE' | 'NOMINAL';\r\n  discountValue?: number;\r\n  tax?: number;\r\n  total: number;\r\n  paymentMethod: string;\r\n  cashReceived?: number;\r\n  change?: number;\r\n  splitPayments?: Array<{\r\n    method: string;\r\n    amount: number;\r\n  }>;\r\n  customerName?: string;\r\n  customerPhone?: string;\r\n  date: Date | string;\r\n  paperWidth?: 58 | 80;\r\n  footerText1?: string;\r\n  footerText2?: string;\r\n}\r\n\r\nexport async function printReceipt(options: PrintReceiptOptions): Promise<void> {\r\n  const {\r\n    printerName,\r\n    storeName,\r\n    branchName,\r\n    address,\r\n    phone,\r\n    cashierName,\r\n    transactionNo,\r\n    items,\r\n    subtotal,\r\n    discount = 0,\r\n    discountType,\r\n    discountValue,\r\n    tax = 0,\r\n    total,\r\n    paymentMethod,\r\n    cashReceived,\r\n    change,\r\n    splitPayments,\r\n    customerName,\r\n    customerPhone,\r\n    date,\r\n    paperWidth = 58,\r\n    footerText1 = 'Terima Kasih',\r\n    footerText2 = 'Selamat Berbelanja',\r\n  } = options;\r\n  \r\n  // Ensure connection is active before printing\r\n  await connectQZ();\r\n  \r\n  // Double check connection is truly active\r\n  if (!window.qz.websocket.isActive()) {\r\n    // Try reconnecting once\r\n    qzConnection = null;\r\n    isConnected = false;\r\n    await connectQZ();\r\n  }\r\n  \r\n  if (!window.qz.websocket.isActive()) {\r\n    throw new Error('QZ Tray tidak terhubung. Silakan refresh halaman dan coba lagi.');\r\n  }\r\n  \r\n  const config = window.qz.configs.create(printerName);\r\n  const charWidth = paperWidth === 58 ? 32 : 48;\r\n  \r\n  // Helper functions\r\n  const center = (text: string) => {\r\n    const padding = Math.max(0, Math.floor((charWidth - text.length) / 2));\r\n    return ' '.repeat(padding) + text;\r\n  };\r\n  \r\n  const leftRight = (left: string, right: string) => {\r\n    const spaces = Math.max(1, charWidth - left.length - right.length);\r\n    return left + ' '.repeat(spaces) + right;\r\n  };\r\n  \r\n  const line = (char: string = '-') => char.repeat(charWidth);\r\n  \r\n  const formatCurrency = (amount: number) => {\r\n    return 'Rp ' + amount.toLocaleString('id-ID');\r\n  };\r\n  \r\n  const formatDate = (d: Date | string) => {\r\n    if (typeof d === 'string') return d;\r\n    return d.toLocaleDateString('id-ID', {\r\n      day: '2-digit',\r\n      month: '2-digit',\r\n      year: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n  };\r\n  \r\n  // Word wrap function for long text\r\n  const wrapText = (text: string, maxWidth: number): string[] => {\r\n    if (text.length <= maxWidth) return [text];\r\n    const words = text.split(' ');\r\n    const lines: string[] = [];\r\n    let currentLine = '';\r\n    \r\n    for (const word of words) {\r\n      if (currentLine.length + word.length + 1 <= maxWidth) {\r\n        currentLine += (currentLine ? ' ' : '') + word;\r\n      } else {\r\n        if (currentLine) lines.push(currentLine);\r\n        currentLine = word;\r\n      }\r\n    }\r\n    if (currentLine) lines.push(currentLine);\r\n    return lines;\r\n  };\r\n  \r\n  // Build ESC/POS commands - Layout sama dengan local\r\n  const data = [\r\n    '\\x1B\\x40', // Initialize printer\r\n    '\\x1B\\x61\\x01', // Center align\r\n    '\\x1B\\x21\\x30', // Double height + width\r\n    storeName + '\\n',\r\n    '\\x1B\\x21\\x00', // Normal text\r\n  ];\r\n  \r\n  // Only show branch/address/phone if explicitly provided and not empty\r\n  if (branchName && branchName.trim() !== '') {\r\n    data.push(branchName + '\\n');\r\n  }\r\n  if (address && address.trim() !== '') {\r\n    data.push(address + '\\n');\r\n  }\r\n  if (phone && phone.trim() !== '') {\r\n    data.push('Telp: ' + phone + '\\n');\r\n  }\r\n  \r\n  data.push(\r\n    '\\x1B\\x61\\x00', // Left align\r\n    line() + '\\n',\r\n  );\r\n  \r\n  // Transaction info - simplified format like local\r\n  data.push('Nomor   : ' + transactionNo + '\\n');\r\n  data.push('Tanggal : ' + formatDate(date) + '\\n');\r\n  if (cashierName) {\r\n    data.push('Kasir   : ' + cashierName + '\\n');\r\n  }\r\n  \r\n  if (customerName) {\r\n    data.push('Pelanggan: ' + customerName + '\\n');\r\n    if (customerPhone) {\r\n      data.push('Telp    : ' + customerPhone + '\\n');\r\n    }\r\n  }\r\n  \r\n  data.push(line() + '\\n');\r\n  \r\n  // Items\r\n  for (const item of items) {\r\n    let itemName = item.name;\r\n    \r\n    // Truncate long product names\r\n    if (itemName.length > charWidth - 2) {\r\n      itemName = itemName.substring(0, charWidth - 5) + '...';\r\n    }\r\n    \r\n    data.push(itemName + '\\n');\r\n    \r\n    // Print variant info on separate line if exists\r\n    if (item.variant) {\r\n      let variantText = `  ${item.variant}`; // Indented\r\n      if (variantText.length > charWidth - 2) {\r\n        variantText = variantText.substring(0, charWidth - 5) + '...';\r\n      }\r\n      data.push(variantText + '\\n');\r\n    }\r\n    \r\n    data.push(\r\n      leftRight(\r\n        `${item.qty} x ${formatCurrency(item.price)}`,\r\n        formatCurrency(item.subtotal)\r\n      ) + '\\n'\r\n    );\r\n  }\r\n  \r\n  data.push(line() + '\\n');\r\n  \r\n  // Totals\r\n  data.push(leftRight('Subtotal', formatCurrency(subtotal)) + '\\n');\r\n  \r\n  if (discount > 0) {\r\n    let discountLabel = 'Diskon';\r\n    if (discountType === 'PERCENTAGE' && discountValue) {\r\n      discountLabel += ` (${discountValue}%)`;\r\n    }\r\n    data.push(leftRight(discountLabel, '-' + formatCurrency(discount)) + '\\n');\r\n  }\r\n  \r\n  if (tax > 0) {\r\n    data.push(leftRight('Pajak', formatCurrency(tax)) + '\\n');\r\n  }\r\n  \r\n  data.push(line() + '\\n');\r\n  \r\n  // Grand Total - Bold only\r\n  data.push(\r\n    '\\x1B\\x21\\x08', // Bold\r\n    leftRight('GRAND TOTAL', formatCurrency(total)) + '\\n',\r\n    '\\x1B\\x21\\x00', // Normal text\r\n  );\r\n  \r\n  // Payment info\r\n  if (splitPayments && splitPayments.length > 1) {\r\n    data.push('Pembayaran Split:\\n');\r\n    for (const payment of splitPayments) {\r\n      data.push(leftRight(`  ${payment.method}`, formatCurrency(payment.amount)) + '\\n');\r\n    }\r\n  } else {\r\n    data.push(leftRight(`Bayar (${paymentMethod})`, formatCurrency(cashReceived || total)) + '\\n');\r\n  }\r\n  \r\n  if (paymentMethod === 'CASH' || (splitPayments?.some(p => p.method === 'TUNAI'))) {\r\n    if (change !== undefined && change > 0) {\r\n      data.push(leftRight('Kembali', formatCurrency(change)) + '\\n');\r\n    }\r\n  }\r\n  \r\n  // Footer - wrap long text\r\n  data.push(\r\n    line() + '\\n',\r\n    '\\x1B\\x61\\x01', // Center alignment\r\n  );\r\n  \r\n  // Wrap footer text if too long - use printer's center alignment\r\n  if (footerText1 && footerText1.trim() !== '') {\r\n    const footer1Lines = wrapText(footerText1, charWidth - 2); // Leave margin\r\n    for (const footerLine of footer1Lines) {\r\n      data.push(footerLine.trim() + '\\n'); // Let printer handle centering\r\n    }\r\n  }\r\n  \r\n  if (footerText2 && footerText2.trim() !== '') {\r\n    data.push('\\n'); // Space between footer lines\r\n    const footer2Lines = wrapText(footerText2, charWidth - 2); // Leave margin\r\n    for (const footerLine of footer2Lines) {\r\n      data.push(footerLine.trim() + '\\n'); // Let printer handle centering\r\n    }\r\n  }\r\n  \r\n  // Reset to left alignment\r\n  data.push('\\x1B\\x61\\x00');\r\n  \r\n  data.push(\r\n    '\\n\\n\\n',\r\n    '\\x1D\\x56\\x00', // Cut paper\r\n  );\r\n  \r\n  await window.qz.print(config, [{ type: 'raw', format: 'plain', data: data.join('') }]);\r\n}\r\n\r\n/**\r\n * Open cash drawer\r\n */\r\nexport async function openCashDrawer(printerName: string): Promise<void> {\r\n  await connectQZ();\r\n  \r\n  const config = window.qz.configs.create(printerName);\r\n  // Standard cash drawer kick command\r\n  const data = '\\x1B\\x70\\x00\\x19\\xFA';\r\n  \r\n  await window.qz.print(config, [{ type: 'raw', format: 'plain', data }]);\r\n}\r\n\r\n/**\r\n * Check if QZ Tray is available\r\n */\r\nexport async function isQZAvailable(): Promise<boolean> {\r\n  try {\r\n    await connectQZ();\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\socket.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'afterEach' is defined but never used.","line":1,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":57}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\r\nimport { subscribe, isConnected } from './socket';\r\n\r\n// Mock socket.io-client\r\nconst mockSocket = {\r\n  connected: false,\r\n  on: vi.fn(),\r\n  off: vi.fn(),\r\n  emit: vi.fn(),\r\n  disconnect: vi.fn(),\r\n  connect: vi.fn(),\r\n};\r\n\r\nvi.mock('socket.io-client', () => ({\r\n  io: vi.fn(() => mockSocket),\r\n}));\r\n\r\ndescribe('socket', () => {\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n    mockSocket.connected = false;\r\n  });\r\n\r\n  describe('subscribe', () => {\r\n    it('should add callback to event listeners', () => {\r\n      const callback = vi.fn();\r\n      const unsubscribe = subscribe('stock:updated', callback);\r\n\r\n      expect(typeof unsubscribe).toBe('function');\r\n    });\r\n\r\n    it('should return unsubscribe function', () => {\r\n      const callback = vi.fn();\r\n      const unsubscribe = subscribe('product:created', callback);\r\n\r\n      // Should not throw\r\n      expect(() => unsubscribe()).not.toThrow();\r\n    });\r\n\r\n    it('should allow multiple subscribers for same event', () => {\r\n      const callback1 = vi.fn();\r\n      const callback2 = vi.fn();\r\n\r\n      const unsub1 = subscribe('stock:updated', callback1);\r\n      const unsub2 = subscribe('stock:updated', callback2);\r\n\r\n      expect(typeof unsub1).toBe('function');\r\n      expect(typeof unsub2).toBe('function');\r\n    });\r\n  });\r\n\r\n  describe('isConnected', () => {\r\n    it('should return false when socket is not connected', () => {\r\n      mockSocket.connected = false;\r\n      expect(isConnected()).toBe(false);\r\n    });\r\n  });\r\n});\r\n\r\ndescribe('Socket Event Types', () => {\r\n  it('should handle StockUpdateData type', () => {\r\n    const stockUpdate = {\r\n      productVariantId: 'var-1',\r\n      cabangId: 'cab-1',\r\n      quantity: 100,\r\n      previousQuantity: 50,\r\n      price: 10000,\r\n    };\r\n\r\n    expect(stockUpdate).toHaveProperty('productVariantId');\r\n    expect(stockUpdate).toHaveProperty('quantity');\r\n  });\r\n\r\n  it('should handle ProductUpdateData type', () => {\r\n    const productUpdate = {\r\n      id: 'prod-1',\r\n      name: 'Test Product',\r\n      categoryId: 'cat-1',\r\n      productType: 'SINGLE',\r\n      variants: [],\r\n    };\r\n\r\n    expect(productUpdate).toHaveProperty('id');\r\n    expect(productUpdate).toHaveProperty('name');\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\socket.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[778,781],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[778,781],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3771,3774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3771,3774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4070,4073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4070,4073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":228,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5871,5874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5871,5874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\utils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1846,1849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1846,1849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1856,1859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1856,1859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2176,2179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2176,2179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2186,2189],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2186,2189],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { type ClassValue, clsx } from 'clsx';\r\nimport { twMerge } from 'tailwind-merge';\r\n\r\n/**\r\n * Merge class names with Tailwind CSS support\r\n * Combines clsx for conditional classes and tailwind-merge for deduplication\r\n * \r\n * @example\r\n * cn('px-2 py-1', 'px-4') // => 'py-1 px-4'\r\n * cn('bg-red-500', condition && 'bg-blue-500') // => conditional result\r\n */\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs));\r\n}\r\n\r\n/**\r\n * Format number to Indonesian Rupiah\r\n */\r\nexport function formatRupiah(amount: number): string {\r\n  return new Intl.NumberFormat('id-ID', {\r\n    style: 'currency',\r\n    currency: 'IDR',\r\n    minimumFractionDigits: 0,\r\n    maximumFractionDigits: 0,\r\n  }).format(amount);\r\n}\r\n\r\n/**\r\n * Format date to Indonesian locale\r\n */\r\nexport function formatDate(date: Date | string, options?: Intl.DateTimeFormatOptions): string {\r\n  const d = typeof date === 'string' ? new Date(date) : date;\r\n  return d.toLocaleDateString('id-ID', options || {\r\n    year: 'numeric',\r\n    month: 'long',\r\n    day: 'numeric',\r\n  });\r\n}\r\n\r\n/**\r\n * Format date with time\r\n */\r\nexport function formatDateTime(date: Date | string): string {\r\n  const d = typeof date === 'string' ? new Date(date) : date;\r\n  return d.toLocaleString('id-ID', {\r\n    year: 'numeric',\r\n    month: 'short',\r\n    day: 'numeric',\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n  });\r\n}\r\n\r\n/**\r\n * Truncate text with ellipsis\r\n */\r\nexport function truncate(text: string, length: number): string {\r\n  if (text.length <= length) return text;\r\n  return text.slice(0, length) + '...';\r\n}\r\n\r\n/**\r\n * Generate random ID\r\n */\r\nexport function generateId(prefix = ''): string {\r\n  return `${prefix}${Date.now().toString(36)}${Math.random().toString(36).substr(2, 9)}`;\r\n}\r\n\r\n/**\r\n * Debounce function\r\n */\r\nexport function debounce<T extends (...args: any[]) => any>(\r\n  fn: T,\r\n  delay: number\r\n): (...args: Parameters<T>) => void {\r\n  let timeoutId: NodeJS.Timeout;\r\n  return (...args: Parameters<T>) => {\r\n    clearTimeout(timeoutId);\r\n    timeoutId = setTimeout(() => fn(...args), delay);\r\n  };\r\n}\r\n\r\n/**\r\n * Throttle function\r\n */\r\nexport function throttle<T extends (...args: any[]) => any>(\r\n  fn: T,\r\n  limit: number\r\n): (...args: Parameters<T>) => void {\r\n  let inThrottle = false;\r\n  return (...args: Parameters<T>) => {\r\n    if (!inThrottle) {\r\n      fn(...args);\r\n      inThrottle = true;\r\n      setTimeout(() => (inThrottle = false), limit);\r\n    }\r\n  };\r\n}\r\n\r\n/**\r\n * Sleep/delay function\r\n */\r\nexport function sleep(ms: number): Promise<void> {\r\n  return new Promise((resolve) => setTimeout(resolve, ms));\r\n}\r\n\r\n/**\r\n * Check if value is empty (null, undefined, empty string, empty array, empty object)\r\n */\r\nexport function isEmpty(value: unknown): boolean {\r\n  if (value === null || value === undefined) return true;\r\n  if (typeof value === 'string') return value.trim() === '';\r\n  if (Array.isArray(value)) return value.length === 0;\r\n  if (typeof value === 'object') return Object.keys(value).length === 0;\r\n  return false;\r\n}\r\n\r\n/**\r\n * Deep clone object\r\n */\r\nexport function deepClone<T>(obj: T): T {\r\n  return JSON.parse(JSON.stringify(obj));\r\n}\r\n\r\n/**\r\n * Group array by key\r\n */\r\nexport function groupBy<T>(array: T[], key: keyof T): Record<string, T[]> {\r\n  return array.reduce((result, item) => {\r\n    const groupKey = String(item[key]);\r\n    if (!result[groupKey]) {\r\n      result[groupKey] = [];\r\n    }\r\n    result[groupKey].push(item);\r\n    return result;\r\n  }, {} as Record<string, T[]>);\r\n}\r\n\r\n/**\r\n * Sort array by key\r\n */\r\nexport function sortBy<T>(array: T[], key: keyof T, direction: 'asc' | 'desc' = 'asc'): T[] {\r\n  return [...array].sort((a, b) => {\r\n    const aVal = a[key];\r\n    const bVal = b[key];\r\n    \r\n    if (aVal < bVal) return direction === 'asc' ? -1 : 1;\r\n    if (aVal > bVal) return direction === 'asc' ? 1 : -1;\r\n    return 0;\r\n  });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\validations.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\lib\\validations.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\sentry.client.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\sentry.edge.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\sentry.server.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\storeUtils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\storeUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useCabangStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useCabangStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useCartStore.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cart' is assigned a value but never used.","line":27,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'heldTransactions' is assigned a value but never used.","line":158,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":158,"endColumn":59}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, beforeEach } from 'vitest';\r\nimport { act } from '@testing-library/react';\r\nimport { useCartStore } from './useCartStore';\r\n\r\ndescribe('useCartStore', () => {\r\n  beforeEach(() => {\r\n    // Reset store before each test\r\n    act(() => {\r\n      useCartStore.setState({\r\n        cart: [],\r\n        heldTransactions: [],\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('cart operations', () => {\r\n    const mockItem = {\r\n      productVariantId: 'var-1',\r\n      productName: 'Test Product',\r\n      variantInfo: 'Size M',\r\n      sku: 'SKU-001',\r\n      price: 10000,\r\n      availableStock: 10,\r\n    };\r\n\r\n    it('should add item to cart', () => {\r\n      const { addToCart, cart } = useCartStore.getState();\r\n      \r\n      const result = addToCart(mockItem);\r\n      \r\n      expect(result).toBe(true);\r\n      expect(useCartStore.getState().cart).toHaveLength(1);\r\n      expect(useCartStore.getState().cart[0].quantity).toBe(1);\r\n    });\r\n\r\n    it('should increment quantity for existing item', () => {\r\n      const { addToCart } = useCartStore.getState();\r\n      \r\n      addToCart(mockItem);\r\n      addToCart(mockItem);\r\n      \r\n      expect(useCartStore.getState().cart).toHaveLength(1);\r\n      expect(useCartStore.getState().cart[0].quantity).toBe(2);\r\n    });\r\n\r\n    it('should not add if stock is 0', () => {\r\n      const { addToCart } = useCartStore.getState();\r\n      const noStockItem = { ...mockItem, availableStock: 0 };\r\n      \r\n      addToCart(noStockItem);\r\n      addToCart(noStockItem); // Try adding again\r\n      \r\n      // First add succeeds (qty=1), second fails (stock=0, qty already 1)\r\n      expect(useCartStore.getState().cart[0]?.quantity).toBe(1);\r\n    });\r\n\r\n    it('should update quantity', () => {\r\n      const { addToCart, updateQuantity } = useCartStore.getState();\r\n      \r\n      addToCart(mockItem);\r\n      const result = updateQuantity('var-1', 5);\r\n      \r\n      expect(result).toBe(true);\r\n      expect(useCartStore.getState().cart[0].quantity).toBe(5);\r\n    });\r\n\r\n    it('should not update quantity beyond stock', () => {\r\n      const { addToCart, updateQuantity } = useCartStore.getState();\r\n      \r\n      addToCart(mockItem);\r\n      const result = updateQuantity('var-1', 15); // Stock is 10\r\n      \r\n      expect(result).toBe(false);\r\n      expect(useCartStore.getState().cart[0].quantity).toBe(1);\r\n    });\r\n\r\n    it('should remove item when quantity is 0', () => {\r\n      const { addToCart, updateQuantity } = useCartStore.getState();\r\n      \r\n      addToCart(mockItem);\r\n      updateQuantity('var-1', 0);\r\n      \r\n      expect(useCartStore.getState().cart).toHaveLength(0);\r\n    });\r\n\r\n    it('should remove item from cart', () => {\r\n      const { addToCart, removeFromCart } = useCartStore.getState();\r\n      \r\n      addToCart(mockItem);\r\n      removeFromCart('var-1');\r\n      \r\n      expect(useCartStore.getState().cart).toHaveLength(0);\r\n    });\r\n\r\n    it('should clear cart', () => {\r\n      const { addToCart, clearCart } = useCartStore.getState();\r\n      \r\n      addToCart(mockItem);\r\n      addToCart({ ...mockItem, productVariantId: 'var-2' });\r\n      clearCart();\r\n      \r\n      expect(useCartStore.getState().cart).toHaveLength(0);\r\n    });\r\n  });\r\n\r\n  describe('calculations', () => {\r\n    const items = [\r\n      { productVariantId: 'v1', productName: 'P1', variantInfo: '', sku: 'S1', price: 10000, availableStock: 10 },\r\n      { productVariantId: 'v2', productName: 'P2', variantInfo: '', sku: 'S2', price: 25000, availableStock: 10 },\r\n    ];\r\n\r\n    beforeEach(() => {\r\n      const { addToCart, updateQuantity } = useCartStore.getState();\r\n      addToCart(items[0]);\r\n      addToCart(items[1]);\r\n      updateQuantity('v1', 2); // 2 x 10000 = 20000\r\n      updateQuantity('v2', 3); // 3 x 25000 = 75000\r\n    });\r\n\r\n    it('should calculate subtotal', () => {\r\n      const { getSubtotal } = useCartStore.getState();\r\n      expect(getSubtotal()).toBe(95000); // 20000 + 75000\r\n    });\r\n\r\n    it('should calculate total with nominal discount', () => {\r\n      const { getTotal } = useCartStore.getState();\r\n      expect(getTotal(5000, 'NOMINAL')).toBe(90000);\r\n    });\r\n\r\n    it('should calculate total with percentage discount', () => {\r\n      const { getTotal } = useCartStore.getState();\r\n      expect(getTotal(10, 'PERCENTAGE')).toBe(85500); // 95000 - 9500\r\n    });\r\n\r\n    it('should calculate discount amount', () => {\r\n      const { getDiscountAmount } = useCartStore.getState();\r\n      expect(getDiscountAmount(10, 'PERCENTAGE')).toBe(9500);\r\n      expect(getDiscountAmount(5000, 'NOMINAL')).toBe(5000);\r\n    });\r\n\r\n    it('should count items', () => {\r\n      const { getItemCount } = useCartStore.getState();\r\n      expect(getItemCount()).toBe(5); // 2 + 3\r\n    });\r\n  });\r\n\r\n  describe('held transactions', () => {\r\n    const mockItem = {\r\n      productVariantId: 'var-1',\r\n      productName: 'Test Product',\r\n      variantInfo: '',\r\n      sku: 'SKU-001',\r\n      price: 10000,\r\n      availableStock: 10,\r\n    };\r\n\r\n    it('should hold transaction', () => {\r\n      const { addToCart, holdTransaction, heldTransactions } = useCartStore.getState();\r\n      \r\n      addToCart(mockItem);\r\n      holdTransaction({\r\n        customerName: 'John',\r\n        customerPhone: '08123',\r\n        paymentMethod: 'CASH',\r\n        discount: 0,\r\n        discountType: 'NOMINAL',\r\n        bankName: '',\r\n        referenceNo: '',\r\n      });\r\n      \r\n      expect(useCartStore.getState().heldTransactions).toHaveLength(1);\r\n      expect(useCartStore.getState().cart).toHaveLength(0); // Cart cleared\r\n    });\r\n\r\n    it('should retrieve held transaction', () => {\r\n      const { addToCart, holdTransaction, retrieveHeld } = useCartStore.getState();\r\n      \r\n      addToCart(mockItem);\r\n      holdTransaction({\r\n        customerName: 'John',\r\n        customerPhone: '08123',\r\n        paymentMethod: 'CASH',\r\n        discount: 0,\r\n        discountType: 'NOMINAL',\r\n        bankName: '',\r\n        referenceNo: '',\r\n      });\r\n      \r\n      const heldId = useCartStore.getState().heldTransactions[0].id;\r\n      const retrieved = retrieveHeld(heldId);\r\n      \r\n      expect(retrieved).not.toBeNull();\r\n      expect(retrieved?.customerName).toBe('John');\r\n      expect(useCartStore.getState().cart).toHaveLength(1); // Cart restored\r\n      expect(useCartStore.getState().heldTransactions).toHaveLength(0); // Removed from held\r\n    });\r\n\r\n    it('should delete held transaction', () => {\r\n      const { addToCart, holdTransaction, deleteHeld } = useCartStore.getState();\r\n      \r\n      addToCart(mockItem);\r\n      holdTransaction({\r\n        customerName: 'John',\r\n        customerPhone: '',\r\n        paymentMethod: 'CASH',\r\n        discount: 0,\r\n        discountType: 'NOMINAL',\r\n        bankName: '',\r\n        referenceNo: '',\r\n      });\r\n      \r\n      const heldId = useCartStore.getState().heldTransactions[0].id;\r\n      deleteHeld(heldId);\r\n      \r\n      expect(useCartStore.getState().heldTransactions).toHaveLength(0);\r\n    });\r\n  });\r\n\r\n  describe('stock updates', () => {\r\n    it('should update item stock', () => {\r\n      const { addToCart, updateItemStock } = useCartStore.getState();\r\n      \r\n      addToCart({\r\n        productVariantId: 'v1',\r\n        productName: 'P1',\r\n        variantInfo: '',\r\n        sku: 'S1',\r\n        price: 10000,\r\n        availableStock: 10,\r\n      });\r\n      \r\n      updateItemStock('v1', 5, 12000);\r\n      \r\n      const item = useCartStore.getState().cart[0];\r\n      expect(item.availableStock).toBe(5);\r\n      expect(item.price).toBe(12000);\r\n    });\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useCartStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useCategoryStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useCategoryStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useCheckoutStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useCheckoutStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[618,621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[618,621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1278,1281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1278,1281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\n\r\nexport type PaymentMethod = 'CASH' | 'DEBIT' | 'TRANSFER' | 'QRIS';\r\nexport type DiscountType = 'NOMINAL' | 'PERCENTAGE';\r\n\r\ninterface CheckoutState {\r\n  // Customer info\r\n  customerName: string;\r\n  customerPhone: string;\r\n  \r\n  // Payment\r\n  paymentMethod: PaymentMethod;\r\n  cashReceived: number;\r\n  bankName: string;\r\n  referenceNo: string;\r\n  \r\n  // Discount\r\n  discount: number;\r\n  discountType: DiscountType;\r\n  \r\n  // UI States\r\n  showCustomerInfo: boolean;\r\n  showDiscount: boolean;\r\n  processing: boolean;\r\n  \r\n  // Last transaction (for success modal)\r\n  lastTransaction: any | null;\r\n  lastCashReceived: number;\r\n  showSuccess: boolean;\r\n  \r\n  // Actions\r\n  setCustomerName: (name: string) => void;\r\n  setCustomerPhone: (phone: string) => void;\r\n  setPaymentMethod: (method: PaymentMethod) => void;\r\n  setCashReceived: (amount: number) => void;\r\n  setBankName: (name: string) => void;\r\n  setReferenceNo: (ref: string) => void;\r\n  setDiscount: (amount: number) => void;\r\n  setDiscountType: (type: DiscountType) => void;\r\n  setShowCustomerInfo: (show: boolean) => void;\r\n  setShowDiscount: (show: boolean) => void;\r\n  setProcessing: (processing: boolean) => void;\r\n  \r\n  // Transaction result\r\n  setTransactionSuccess: (transaction: any, cashReceived: number) => void;\r\n  closeSuccessModal: () => void;\r\n  \r\n  // Reset\r\n  resetCheckout: () => void;\r\n  \r\n  // Get checkout data for API\r\n  getCheckoutData: () => {\r\n    customerName: string;\r\n    customerPhone: string;\r\n    paymentMethod: PaymentMethod;\r\n    discount: number;\r\n    discountType: DiscountType;\r\n    bankName: string;\r\n    referenceNo: string;\r\n  };\r\n}\r\n\r\nconst initialState = {\r\n  customerName: '',\r\n  customerPhone: '',\r\n  paymentMethod: 'CASH' as PaymentMethod,\r\n  cashReceived: 0,\r\n  bankName: '',\r\n  referenceNo: '',\r\n  discount: 0,\r\n  discountType: 'NOMINAL' as DiscountType,\r\n  showCustomerInfo: false,\r\n  showDiscount: false,\r\n  processing: false,\r\n  lastTransaction: null,\r\n  lastCashReceived: 0,\r\n  showSuccess: false,\r\n};\r\n\r\nexport const useCheckoutStore = create<CheckoutState>()((set, get) => ({\r\n  ...initialState,\r\n\r\n  setCustomerName: (name) => set({ customerName: name }),\r\n  setCustomerPhone: (phone) => set({ customerPhone: phone }),\r\n  setPaymentMethod: (method) => set({ paymentMethod: method }),\r\n  setCashReceived: (amount) => set({ cashReceived: amount }),\r\n  setBankName: (name) => set({ bankName: name }),\r\n  setReferenceNo: (ref) => set({ referenceNo: ref }),\r\n  setDiscount: (amount) => set({ discount: amount }),\r\n  setDiscountType: (type) => set({ discountType: type }),\r\n  setShowCustomerInfo: (show) => set({ showCustomerInfo: show }),\r\n  setShowDiscount: (show) => set({ showDiscount: show }),\r\n  setProcessing: (processing) => set({ processing }),\r\n\r\n  setTransactionSuccess: (transaction, cashReceived) => set({\r\n    lastTransaction: transaction,\r\n    lastCashReceived: cashReceived,\r\n    showSuccess: true,\r\n    processing: false,\r\n  }),\r\n\r\n  closeSuccessModal: () => set({ showSuccess: false }),\r\n\r\n  resetCheckout: () => set({\r\n    customerName: '',\r\n    customerPhone: '',\r\n    paymentMethod: 'CASH',\r\n    cashReceived: 0,\r\n    bankName: '',\r\n    referenceNo: '',\r\n    discount: 0,\r\n    discountType: 'NOMINAL',\r\n    showCustomerInfo: false,\r\n    showDiscount: false,\r\n    processing: false,\r\n  }),\r\n\r\n  getCheckoutData: () => {\r\n    const state = get();\r\n    return {\r\n      customerName: state.customerName,\r\n      customerPhone: state.customerPhone,\r\n      paymentMethod: state.paymentMethod,\r\n      discount: state.discount,\r\n      discountType: state.discountType,\r\n      bankName: state.bankName,\r\n      referenceNo: state.referenceNo,\r\n    };\r\n  },\r\n}));\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useCommonStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1714,1717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1714,1717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2134,2137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2134,2137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2598,2601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2598,2601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { cabangAPI, productsAPI, settingsAPI } from '@/lib/api';\r\n\r\ninterface Branch {\r\n  id: string;\r\n  name: string;\r\n  address?: string;\r\n  phone?: string;\r\n  isActive: boolean;\r\n}\r\n\r\ninterface Category {\r\n  id: string;\r\n  name: string;\r\n}\r\n\r\ninterface CommonState {\r\n  // Data\r\n  branches: Branch[];\r\n  categories: Category[];\r\n  adminWhatsApp: string;\r\n  \r\n  // Loading states\r\n  loadingBranches: boolean;\r\n  loadingCategories: boolean;\r\n  loadingSettings: boolean;\r\n  \r\n  // Error states\r\n  errorBranches: string | null;\r\n  errorCategories: string | null;\r\n  errorSettings: string | null;\r\n  \r\n  // Actions\r\n  fetchBranches: () => Promise<void>;\r\n  fetchCategories: () => Promise<void>;\r\n  fetchSettings: () => Promise<void>;\r\n  fetchAll: () => Promise<void>;\r\n  \r\n  // Setters\r\n  setBranches: (branches: Branch[]) => void;\r\n  setCategories: (categories: Category[]) => void;\r\n  \r\n  // Getters\r\n  getBranchById: (id: string) => Branch | undefined;\r\n  getCategoryById: (id: string) => Category | undefined;\r\n  getActiveBranches: () => Branch[];\r\n}\r\n\r\nexport const useCommonStore = create<CommonState>()((set, get) => ({\r\n  // Initial data\r\n  branches: [],\r\n  categories: [],\r\n  adminWhatsApp: '',\r\n  \r\n  // Initial loading states\r\n  loadingBranches: false,\r\n  loadingCategories: false,\r\n  loadingSettings: false,\r\n  \r\n  // Initial error states\r\n  errorBranches: null,\r\n  errorCategories: null,\r\n  errorSettings: null,\r\n  \r\n  // Fetch branches\r\n  fetchBranches: async () => {\r\n    set({ loadingBranches: true, errorBranches: null });\r\n    try {\r\n      const res = await cabangAPI.getCabangs();\r\n      set({ branches: res.data, loadingBranches: false });\r\n    } catch (error: any) {\r\n      set({ \r\n        errorBranches: error.message || 'Failed to fetch branches',\r\n        loadingBranches: false \r\n      });\r\n    }\r\n  },\r\n  \r\n  // Fetch categories\r\n  fetchCategories: async () => {\r\n    set({ loadingCategories: true, errorCategories: null });\r\n    try {\r\n      const res = await productsAPI.getCategories();\r\n      set({ categories: res.data, loadingCategories: false });\r\n    } catch (error: any) {\r\n      set({ \r\n        errorCategories: error.message || 'Failed to fetch categories',\r\n        loadingCategories: false \r\n      });\r\n    }\r\n  },\r\n  \r\n  // Fetch settings\r\n  fetchSettings: async () => {\r\n    set({ loadingSettings: true, errorSettings: null });\r\n    try {\r\n      const res = await settingsAPI.getSettings();\r\n      set({ \r\n        adminWhatsApp: res.data.adminWhatsApp || '',\r\n        loadingSettings: false \r\n      });\r\n    } catch (error: any) {\r\n      set({ \r\n        errorSettings: error.message || 'Failed to fetch settings',\r\n        loadingSettings: false \r\n      });\r\n    }\r\n  },\r\n  \r\n  // Fetch all common data\r\n  fetchAll: async () => {\r\n    await Promise.all([\r\n      get().fetchBranches(),\r\n      get().fetchCategories(),\r\n      get().fetchSettings(),\r\n    ]);\r\n  },\r\n  \r\n  // Setters\r\n  setBranches: (branches) => set({ branches }),\r\n  setCategories: (categories) => set({ categories }),\r\n  \r\n  // Getters\r\n  getBranchById: (id) => get().branches.find(b => b.id === id),\r\n  getCategoryById: (id) => get().categories.find(c => c.id === id),\r\n  getActiveBranches: () => get().branches.filter(b => b.isActive),\r\n}));\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useDashboardStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useDashboardStore.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'productsAPI' is defined but never used.","line":2,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":38},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":133,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":133,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4426,4429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4426,4429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":178,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":178,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { transactionsAPI, productsAPI, stockAPI } from '@/lib/api';\r\nimport { getAuth } from '@/lib/auth';\r\n\r\n// Types\r\nexport interface WidgetVisibility {\r\n  salesTrend: boolean;\r\n  topProducts: boolean;\r\n  branchPerformance: boolean;\r\n  timeStats: boolean;\r\n  dailyDistribution: boolean;\r\n  paymentMethods: boolean;\r\n  lowStock: boolean;\r\n}\r\n\r\nexport interface Summary {\r\n  totalTransactions: number;\r\n  totalRevenue: number;\r\n  paymentMethodBreakdown?: Array<{\r\n    paymentMethod: string;\r\n    _count: { id: number };\r\n    _sum: { total: number };\r\n  }>;\r\n}\r\n\r\nexport interface LowStockAlert {\r\n  id: string;\r\n  productName: string;\r\n  variantName: string;\r\n  sku: string;\r\n  cabangName: string;\r\n  currentStock: number;\r\n  minStock: number;\r\n}\r\n\r\nexport interface SalesTrend {\r\n  date: string;\r\n  total: number;\r\n  count: number;\r\n}\r\n\r\nexport interface TopProduct {\r\n  productVariantId: string;\r\n  productName: string;\r\n  variantName: string;\r\n  category: string;\r\n  totalQuantity: number;\r\n  totalRevenue: number;\r\n}\r\n\r\nexport interface BranchPerformance {\r\n  cabangId: string;\r\n  cabangName: string;\r\n  totalTransactions: number;\r\n  totalRevenue: number;\r\n}\r\n\r\nexport interface TimeStats {\r\n  busiestHour: { hour: number; count: number; total: number };\r\n  busiestDay: { day: string; count: number; total: number };\r\n  hourlyDistribution: Array<{ hour: number; count: number; total: number }>;\r\n  dailyDistribution: Array<{ day: string; count: number; total: number }>;\r\n  dailyStats?: Array<{ day: string; count: number; total: number }>;\r\n}\r\n\r\ninterface DashboardState {\r\n  // Data\r\n  summary: Summary | null;\r\n  lowStockAlerts: LowStockAlert[];\r\n  salesTrend: SalesTrend[];\r\n  topProducts: TopProduct[];\r\n  branchPerformance: BranchPerformance[];\r\n  timeStats: TimeStats | null;\r\n  loading: boolean;\r\n  \r\n  // UI State\r\n  showScreenOptions: boolean;\r\n  widgetVisibility: WidgetVisibility;\r\n  \r\n  // Actions - Setters\r\n  setLoading: (loading: boolean) => void;\r\n  setShowScreenOptions: (show: boolean) => void;\r\n  \r\n  // Actions - Widget visibility\r\n  toggleWidget: (widget: keyof WidgetVisibility) => void;\r\n  loadWidgetVisibility: () => void;\r\n  \r\n  // Actions - Fetch\r\n  fetchDashboardData: () => Promise<void>;\r\n}\r\n\r\nconst defaultWidgetVisibility: WidgetVisibility = {\r\n  salesTrend: true,\r\n  topProducts: true,\r\n  branchPerformance: true,\r\n  timeStats: true,\r\n  dailyDistribution: true,\r\n  paymentMethods: true,\r\n  lowStock: true\r\n};\r\n\r\nexport const useDashboardStore = create<DashboardState>()((set, get) => ({\r\n  // Initial data\r\n  summary: null,\r\n  lowStockAlerts: [],\r\n  salesTrend: [],\r\n  topProducts: [],\r\n  branchPerformance: [],\r\n  timeStats: null,\r\n  loading: true,\r\n  \r\n  // Initial UI state\r\n  showScreenOptions: false,\r\n  widgetVisibility: defaultWidgetVisibility,\r\n  \r\n  // Setters\r\n  setLoading: (loading) => set({ loading }),\r\n  setShowScreenOptions: (show) => set({ showScreenOptions: show }),\r\n  \r\n  // Widget visibility actions\r\n  toggleWidget: (widget) => {\r\n    const { widgetVisibility } = get();\r\n    const newVisibility = { ...widgetVisibility, [widget]: !widgetVisibility[widget] };\r\n    set({ widgetVisibility: newVisibility });\r\n    localStorage.setItem('dashboardWidgetVisibility', JSON.stringify(newVisibility));\r\n  },\r\n  \r\n  loadWidgetVisibility: () => {\r\n    const saved = localStorage.getItem('dashboardWidgetVisibility');\r\n    if (saved) {\r\n      try {\r\n        set({ widgetVisibility: JSON.parse(saved) });\r\n      } catch (e) {\r\n        // Use default if parse fails\r\n      }\r\n    }\r\n  },\r\n  \r\n  // Fetch actions\r\n  fetchDashboardData: async () => {\r\n    const { user } = getAuth();\r\n    \r\n    // Only fetch for owner/manager (not kasir)\r\n    if (!user || user.role === 'KASIR') {\r\n      set({ loading: false });\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const [summaryRes, trendRes, topProductsRes, branchRes, timeStatsRes, lowStockRes] = await Promise.all([\r\n        transactionsAPI.getSummary(),\r\n        transactionsAPI.getSalesTrend({ days: 7 }),\r\n        transactionsAPI.getTopProducts({ limit: 5 }),\r\n        transactionsAPI.getBranchPerformance(),\r\n        transactionsAPI.getTimeStats(),\r\n        stockAPI.getLowStockItems().catch(() => ({ data: { data: [] } })) // Graceful fallback\r\n      ]);\r\n\r\n      // Transform low stock alerts to match expected format\r\n      const lowStockAlerts = (lowStockRes.data?.data || []).map((alert: any) => ({\r\n        id: alert.id,\r\n        productName: alert.productVariant?.product?.name || 'Unknown',\r\n        variantName: `${alert.productVariant?.variantName}: ${alert.productVariant?.variantValue}`,\r\n        sku: alert.productVariant?.sku || '',\r\n        cabangName: alert.cabang?.name || 'Unknown',\r\n        currentStock: alert.productVariant?.stocks?.[0]?.quantity || 0,\r\n        minStock: alert.minStock\r\n      }));\r\n\r\n      set({\r\n        summary: summaryRes.data,\r\n        lowStockAlerts,\r\n        salesTrend: trendRes.data.trend,\r\n        topProducts: topProductsRes.data.topProducts,\r\n        branchPerformance: branchRes.data.branchPerformance,\r\n        timeStats: timeStatsRes.data,\r\n      });\r\n    } catch (error) {\r\n      // Error handled - dashboard shows empty state\r\n    } finally {\r\n      set({ loading: false });\r\n    }\r\n  },\r\n}));\r\n\r\n// Widget labels constant\r\nexport const WIDGET_LABELS: Record<keyof WidgetVisibility, string> = {\r\n  salesTrend: 'Tren Penjualan',\r\n  topProducts: 'Produk Terlaris',\r\n  branchPerformance: 'Performa Cabang',\r\n  timeStats: 'Waktu Tersibuk',\r\n  dailyDistribution: 'Distribusi Transaksi',\r\n  paymentMethods: 'Metode Pembayaran',\r\n  lowStock: 'Peringatan Stok Menipis'\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useFilterStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useModalStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[142,145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[142,145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\n\r\ntype ModalType = 'create' | 'edit' | 'delete' | 'detail' | 'confirm' | null;\r\n\r\ninterface ModalState<T = any> {\r\n  // Modal state\r\n  isOpen: boolean;\r\n  type: ModalType;\r\n  data: T | null;\r\n  \r\n  // Form state\r\n  isSubmitting: boolean;\r\n  error: string | null;\r\n  \r\n  // Actions\r\n  openModal: (type: ModalType, data?: T) => void;\r\n  closeModal: () => void;\r\n  setSubmitting: (isSubmitting: boolean) => void;\r\n  setError: (error: string | null) => void;\r\n  reset: () => void;\r\n}\r\n\r\n// Generic modal store factory\r\nexport function createModalStore<T = unknown>() {\r\n  return create<ModalState<T>>()((set) => ({\r\n    isOpen: false,\r\n    type: null,\r\n    data: null,\r\n    isSubmitting: false,\r\n    error: null,\r\n    \r\n    openModal: (type, data) => set({ \r\n      isOpen: true, \r\n      type, \r\n      data: (data ?? null) as T | null,\r\n      error: null \r\n    }),\r\n    \r\n    closeModal: () => set({ \r\n      isOpen: false, \r\n      type: null, \r\n      data: null,\r\n      error: null \r\n    }),\r\n    \r\n    setSubmitting: (isSubmitting) => set({ isSubmitting }),\r\n    \r\n    setError: (error) => set({ error }),\r\n    \r\n    reset: () => set({\r\n      isOpen: false,\r\n      type: null,\r\n      data: null,\r\n      isSubmitting: false,\r\n      error: null,\r\n    }),\r\n  }));\r\n}\r\n\r\n// Pre-configured modal stores for common entities\r\nexport const useUserModalStore = createModalStore<{\r\n  id?: string;\r\n  name?: string;\r\n  email?: string;\r\n  role?: string;\r\n  cabangId?: string;\r\n}>();\r\n\r\nexport const useProductModalStore = createModalStore<{\r\n  id?: string;\r\n  name?: string;\r\n  categoryId?: string;\r\n  productType?: string;\r\n}>();\r\n\r\nexport const useCategoryModalStore = createModalStore<{\r\n  id?: string;\r\n  name?: string;\r\n}>();\r\n\r\nexport const useBranchModalStore = createModalStore<{\r\n  id?: string;\r\n  name?: string;\r\n  address?: string;\r\n  phone?: string;\r\n}>();\r\n\r\n// Confirmation dialog store\r\ninterface ConfirmDialogState {\r\n  isOpen: boolean;\r\n  title: string;\r\n  description: string;\r\n  confirmText: string;\r\n  cancelText: string;\r\n  variant: 'danger' | 'warning' | 'default';\r\n  onConfirm: (() => void) | (() => Promise<void>);\r\n  isLoading: boolean;\r\n  \r\n  show: (options: {\r\n    title: string;\r\n    description: string;\r\n    confirmText?: string;\r\n    cancelText?: string;\r\n    variant?: 'danger' | 'warning' | 'default';\r\n    onConfirm: (() => void) | (() => Promise<void>);\r\n  }) => void;\r\n  hide: () => void;\r\n  setLoading: (isLoading: boolean) => void;\r\n}\r\n\r\nexport const useConfirmDialogStore = create<ConfirmDialogState>()((set) => ({\r\n  isOpen: false,\r\n  title: '',\r\n  description: '',\r\n  confirmText: 'Konfirmasi',\r\n  cancelText: 'Batal',\r\n  variant: 'default',\r\n  onConfirm: () => {},\r\n  isLoading: false,\r\n  \r\n  show: ({ title, description, confirmText, cancelText, variant, onConfirm }) => set({\r\n    isOpen: true,\r\n    title,\r\n    description,\r\n    confirmText: confirmText || 'Konfirmasi',\r\n    cancelText: cancelText || 'Batal',\r\n    variant: variant || 'default',\r\n    onConfirm,\r\n    isLoading: false,\r\n  }),\r\n  \r\n  hide: () => set({\r\n    isOpen: false,\r\n    isLoading: false,\r\n  }),\r\n  \r\n  setLoading: (isLoading) => set({ isLoading }),\r\n}));\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useNewProductStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useNewProductStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2681,2684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2681,2684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3216,3219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3216,3219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":216,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5965,5968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5965,5968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":220,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6148,6151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6148,6151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":385,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10911,10914],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10911,10914],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":438,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":438,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13156,13159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13156,13159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { productsAPI, cabangAPI } from '@/lib/api';\r\nimport { logger } from '@/lib/logger';\r\n\r\n// Types\r\nexport interface Category {\r\n  id: string;\r\n  name: string;\r\n}\r\n\r\nexport interface Cabang {\r\n  id: string;\r\n  name: string;\r\n  isActive: boolean;\r\n}\r\n\r\nexport interface StockItem {\r\n  cabangId: string;\r\n  cabangName: string;\r\n  quantity: number;\r\n  price: number;\r\n}\r\n\r\nexport interface Variant {\r\n  variantName: string;\r\n  variantValue: string;\r\n  sku: string;\r\n  weight?: number;\r\n  length?: number;\r\n  width?: number;\r\n  height?: number;\r\n  imageUrl?: string;\r\n  stocks: StockItem[];\r\n}\r\n\r\nexport interface FormData {\r\n  name: string;\r\n  description: string;\r\n  categoryId: string;\r\n  productType: 'SINGLE' | 'VARIANT';\r\n  sku: string;\r\n}\r\n\r\nexport interface VariantTypes {\r\n  type1: string;\r\n  type2: string;\r\n  type3: string;\r\n}\r\n\r\nexport interface BulkApply {\r\n  sku: string;\r\n  price: string;\r\n  stock: string;\r\n}\r\n\r\nexport interface SingleBulkApply {\r\n  price: string;\r\n  stock: string;\r\n}\r\n\r\nexport interface SingleMarketplaceInfo {\r\n  weight: string;\r\n  length: string;\r\n  width: string;\r\n  height: string;\r\n  imageUrl: string;\r\n}\r\n\r\ninterface NewProductState {\r\n  // Data\r\n  categories: Category[];\r\n  cabangs: Cabang[];\r\n  \r\n  // Form state\r\n  loading: boolean;\r\n  formData: FormData;\r\n  variantTypes: VariantTypes;\r\n  attributeCount: 1 | 2 | 3;\r\n  singleProductStocks: StockItem[];\r\n  variants: Variant[];\r\n  bulkApply: BulkApply;\r\n  singleBulkApply: SingleBulkApply;\r\n  singleMarketplaceInfo: SingleMarketplaceInfo;\r\n  \r\n  // Actions - Setters\r\n  setLoading: (loading: boolean) => void;\r\n  setFormData: (data: FormData | ((prev: FormData) => FormData)) => void;\r\n  setVariantTypes: (types: VariantTypes | ((prev: VariantTypes) => VariantTypes)) => void;\r\n  setAttributeCount: (count: 1 | 2 | 3 | ((prev: 1 | 2 | 3) => 1 | 2 | 3)) => void;\r\n  setSingleProductStocks: (stocks: StockItem[] | ((prev: StockItem[]) => StockItem[])) => void;\r\n  setVariants: (variants: Variant[] | ((prev: Variant[]) => Variant[])) => void;\r\n  setBulkApply: (bulk: BulkApply | ((prev: BulkApply) => BulkApply)) => void;\r\n  setSingleBulkApply: (bulk: SingleBulkApply | ((prev: SingleBulkApply) => SingleBulkApply)) => void;\r\n  setSingleMarketplaceInfo: (info: SingleMarketplaceInfo | ((prev: SingleMarketplaceInfo) => SingleMarketplaceInfo)) => void;\r\n  \r\n  // Actions - Fetch\r\n  fetchCategories: () => Promise<void>;\r\n  fetchCabangs: () => Promise<void>;\r\n  initializeData: () => Promise<void>;\r\n  \r\n  // Actions - Variants\r\n  addVariant: () => void;\r\n  removeVariant: (index: number) => void;\r\n  updateVariant: (index: number, field: string, value: any) => void;\r\n  handleStockChange: (variantIndex: number, cabangIndex: number, field: string, value: string) => void;\r\n  handleGeneratedVariants: (generated: Array<{ variantName: string; variantValue: string; sku: string; price: string; stock: string }>) => void;\r\n  applyBulkValues: () => void;\r\n  \r\n  // Actions - Single Product\r\n  handleSingleStockChange: (cabangIndex: number, field: string, value: string) => void;\r\n  applySingleBulkValues: () => void;\r\n  \r\n  // Actions - Form\r\n  updateFormField: (field: keyof FormData, value: any) => void;\r\n  submitProduct: () => Promise<{ success: boolean; error?: string }>;\r\n  resetForm: () => void;\r\n}\r\n\r\nconst initialFormData: FormData = {\r\n  name: '',\r\n  description: '',\r\n  categoryId: '',\r\n  productType: 'SINGLE',\r\n  sku: '',\r\n};\r\n\r\nconst initialVariantTypes: VariantTypes = {\r\n  type1: '',\r\n  type2: '',\r\n  type3: '',\r\n};\r\n\r\nconst initialBulkApply: BulkApply = {\r\n  sku: '',\r\n  price: '',\r\n  stock: '',\r\n};\r\n\r\nconst initialSingleBulkApply: SingleBulkApply = {\r\n  price: '',\r\n  stock: '',\r\n};\r\n\r\nconst initialSingleMarketplaceInfo: SingleMarketplaceInfo = {\r\n  weight: '',\r\n  length: '',\r\n  width: '',\r\n  height: '',\r\n  imageUrl: '',\r\n};\r\n\r\nexport const useNewProductStore = create<NewProductState>()((set, get) => ({\r\n  // Initial data\r\n  categories: [],\r\n  cabangs: [],\r\n  \r\n  // Initial form state\r\n  loading: false,\r\n  formData: initialFormData,\r\n  variantTypes: initialVariantTypes,\r\n  attributeCount: 1,\r\n  singleProductStocks: [],\r\n  variants: [],\r\n  bulkApply: initialBulkApply,\r\n  singleBulkApply: initialSingleBulkApply,\r\n  singleMarketplaceInfo: initialSingleMarketplaceInfo,\r\n  \r\n  // Setters\r\n  setLoading: (loading) => set({ loading }),\r\n  \r\n  setFormData: (data) => set((state) => ({\r\n    formData: typeof data === 'function' ? data(state.formData) : data\r\n  })),\r\n  \r\n  setVariantTypes: (types) => set((state) => ({\r\n    variantTypes: typeof types === 'function' ? types(state.variantTypes) : types\r\n  })),\r\n  \r\n  setAttributeCount: (count) => set((state) => ({\r\n    attributeCount: typeof count === 'function' ? count(state.attributeCount) : count\r\n  })),\r\n  \r\n  setSingleProductStocks: (stocks) => set((state) => ({\r\n    singleProductStocks: typeof stocks === 'function' ? stocks(state.singleProductStocks) : stocks\r\n  })),\r\n  \r\n  setVariants: (variants) => set((state) => ({\r\n    variants: typeof variants === 'function' ? variants(state.variants) : variants\r\n  })),\r\n  \r\n  setBulkApply: (bulk) => set((state) => ({\r\n    bulkApply: typeof bulk === 'function' ? bulk(state.bulkApply) : bulk\r\n  })),\r\n  \r\n  setSingleBulkApply: (bulk) => set((state) => ({\r\n    singleBulkApply: typeof bulk === 'function' ? bulk(state.singleBulkApply) : bulk\r\n  })),\r\n  \r\n  setSingleMarketplaceInfo: (info) => set((state) => ({\r\n    singleMarketplaceInfo: typeof info === 'function' ? info(state.singleMarketplaceInfo) : info\r\n  })),\r\n  \r\n  // Fetch actions\r\n  fetchCategories: async () => {\r\n    try {\r\n      const res = await productsAPI.getCategories();\r\n      set({ categories: res.data });\r\n    } catch (error) {\r\n      logger.error('Error fetching categories:', error);\r\n    }\r\n  },\r\n  \r\n  fetchCabangs: async () => {\r\n    try {\r\n      const res = await cabangAPI.getCabangs();\r\n      const activeCabangs = res.data.filter((c: any) => c.isActive);\r\n      set({ cabangs: activeCabangs });\r\n      \r\n      // Initialize single product stocks with active cabangs\r\n      const initialStocks = activeCabangs.map((c: any) => ({\r\n        cabangId: c.id,\r\n        cabangName: c.name,\r\n        quantity: 0,\r\n        price: 0\r\n      }));\r\n      set({ singleProductStocks: initialStocks });\r\n    } catch (error) {\r\n      logger.error('Error fetching cabangs:', error);\r\n    }\r\n  },\r\n  \r\n  initializeData: async () => {\r\n    await Promise.all([\r\n      get().fetchCategories(),\r\n      get().fetchCabangs()\r\n    ]);\r\n  },\r\n  \r\n  // Variant actions\r\n  addVariant: () => {\r\n    const { variantTypes, attributeCount, cabangs } = get();\r\n    \r\n    // Auto-generate variantName from defined types based on attributeCount\r\n    const typesArray = [variantTypes.type1];\r\n    if (attributeCount >= 2) typesArray.push(variantTypes.type2);\r\n    if (attributeCount >= 3) typesArray.push(variantTypes.type3);\r\n    const types = typesArray.filter(t => t).join(' | ');\r\n    \r\n    set((state) => ({\r\n      variants: [...state.variants, {\r\n        variantName: types || 'Default',\r\n        variantValue: '',\r\n        sku: '',\r\n        weight: undefined,\r\n        length: undefined,\r\n        width: undefined,\r\n        height: undefined,\r\n        imageUrl: undefined,\r\n        stocks: cabangs.map(c => ({ cabangId: c.id, cabangName: c.name, quantity: 0, price: 0 }))\r\n      }]\r\n    }));\r\n  },\r\n  \r\n  removeVariant: (index) => {\r\n    set((state) => ({\r\n      variants: state.variants.filter((_, i) => i !== index)\r\n    }));\r\n  },\r\n  \r\n  updateVariant: (index, field, value) => {\r\n    set((state) => {\r\n      const newVariants = [...state.variants];\r\n      newVariants[index] = { ...newVariants[index], [field]: value };\r\n      return { variants: newVariants };\r\n    });\r\n  },\r\n  \r\n  handleStockChange: (variantIndex, cabangIndex, field, value) => {\r\n    set((state) => ({\r\n      variants: state.variants.map((variant, vIdx) => {\r\n        if (vIdx === variantIndex) {\r\n          return {\r\n            ...variant,\r\n            stocks: variant.stocks.map((stock, sIdx) => {\r\n              if (sIdx === cabangIndex) {\r\n                if (field === 'price') {\r\n                  return { ...stock, [field]: parseFloat(value) || 0 };\r\n                } else {\r\n                  return { ...stock, [field]: parseInt(value) || 0 };\r\n                }\r\n              }\r\n              return stock;\r\n            })\r\n          };\r\n        }\r\n        return variant;\r\n      })\r\n    }));\r\n  },\r\n  \r\n  handleGeneratedVariants: (generated) => {\r\n    const { cabangs } = get();\r\n    \r\n    if (cabangs.length === 0) {\r\n      return; // Let the page handle the alert\r\n    }\r\n    \r\n    const converted = generated.map(v => ({\r\n      variantName: v.variantName,\r\n      variantValue: v.variantValue,\r\n      sku: v.sku,\r\n      stocks: cabangs.map(c => ({\r\n        cabangId: c.id,\r\n        cabangName: c.name,\r\n        quantity: parseInt(v.stock) || 0,\r\n        price: parseFloat(v.price) || 0\r\n      }))\r\n    }));\r\n    \r\n    set({ variants: converted });\r\n  },\r\n  \r\n  applyBulkValues: () => {\r\n    const { bulkApply } = get();\r\n    \r\n    set((state) => ({\r\n      variants: state.variants.map((v, index) => ({\r\n        ...v,\r\n        ...(bulkApply.sku && { sku: `${bulkApply.sku}${index + 1}` }),\r\n        ...(bulkApply.price || bulkApply.stock ? {\r\n          stocks: v.stocks.map(s => ({\r\n            ...s,\r\n            ...(bulkApply.price && { price: parseFloat(bulkApply.price) }),\r\n            ...(bulkApply.stock && { quantity: parseInt(bulkApply.stock) })\r\n          }))\r\n        } : {})\r\n      })),\r\n      bulkApply: initialBulkApply\r\n    }));\r\n  },\r\n  \r\n  // Single product actions\r\n  handleSingleStockChange: (cabangIndex, field, value) => {\r\n    set((state) => ({\r\n      singleProductStocks: state.singleProductStocks.map((stock, idx) => {\r\n        if (idx === cabangIndex) {\r\n          if (field === 'price') {\r\n            return { ...stock, [field]: parseFloat(value) || 0 };\r\n          } else {\r\n            return { ...stock, [field]: parseInt(value) || 0 };\r\n          }\r\n        }\r\n        return stock;\r\n      })\r\n    }));\r\n  },\r\n  \r\n  applySingleBulkValues: () => {\r\n    const { singleBulkApply } = get();\r\n    const price = parseFloat(singleBulkApply.price) || 0;\r\n    const stock = parseInt(singleBulkApply.stock) || 0;\r\n    \r\n    set((state) => ({\r\n      singleProductStocks: state.singleProductStocks.map(s => ({\r\n        ...s,\r\n        price: price > 0 ? price : s.price,\r\n        quantity: stock >= 0 ? stock : s.quantity\r\n      }))\r\n    }));\r\n  },\r\n  \r\n  // Form actions\r\n  updateFormField: (field, value) => {\r\n    set((state) => ({\r\n      formData: { ...state.formData, [field]: value }\r\n    }));\r\n  },\r\n  \r\n  submitProduct: async () => {\r\n    const { formData, singleProductStocks, singleMarketplaceInfo, variants } = get();\r\n    \r\n    set({ loading: true });\r\n    \r\n    try {\r\n      const payload: any = {\r\n        name: formData.name,\r\n        description: formData.description,\r\n        categoryId: formData.categoryId,\r\n        productType: formData.productType,\r\n      };\r\n      \r\n      if (formData.productType === 'SINGLE') {\r\n        // Validate single product has at least one cabang with price\r\n        const hasPrice = singleProductStocks.some(s => s.price && s.price > 0);\r\n        if (!hasPrice) {\r\n          set({ loading: false });\r\n          return { success: false, error: 'Produk harus punya harga minimal di 1 cabang!' };\r\n        }\r\n        \r\n        payload.sku = formData.sku;\r\n        payload.stocks = singleProductStocks;\r\n        payload.weight = singleMarketplaceInfo.weight ? parseInt(singleMarketplaceInfo.weight) : null;\r\n        payload.length = singleMarketplaceInfo.length ? parseInt(singleMarketplaceInfo.length) : null;\r\n        payload.width = singleMarketplaceInfo.width ? parseInt(singleMarketplaceInfo.width) : null;\r\n        payload.height = singleMarketplaceInfo.height ? parseInt(singleMarketplaceInfo.height) : null;\r\n        payload.imageUrl = singleMarketplaceInfo.imageUrl || null;\r\n      } else {\r\n        // Validate variants have at least one cabang with price\r\n        for (const variant of variants) {\r\n          const hasPrice = variant.stocks.some(s => s.price && s.price > 0);\r\n          if (!hasPrice) {\r\n            set({ loading: false });\r\n            return { \r\n              success: false, \r\n              error: `Varian \"${variant.variantName}: ${variant.variantValue}\" harus punya harga minimal di 1 cabang!` \r\n            };\r\n          }\r\n        }\r\n        \r\n        payload.variants = variants\r\n          .filter(v => v.variantName && v.variantValue)\r\n          .map(v => ({\r\n            variantName: v.variantName,\r\n            variantValue: v.variantValue,\r\n            sku: v.sku,\r\n            weight: v.weight || null,\r\n            length: v.length || null,\r\n            width: v.width || null,\r\n            height: v.height || null,\r\n            imageUrl: v.imageUrl || null,\r\n            stocks: v.stocks\r\n          }));\r\n      }\r\n      \r\n      await productsAPI.createProduct(payload);\r\n      set({ loading: false });\r\n      return { success: true };\r\n    } catch (error: any) {\r\n      set({ loading: false });\r\n      return { \r\n        success: false, \r\n        error: error.response?.data?.error || 'Gagal menambahkan produk' \r\n      };\r\n    }\r\n  },\r\n  \r\n  resetForm: () => {\r\n    const { cabangs } = get();\r\n    set({\r\n      formData: initialFormData,\r\n      variantTypes: initialVariantTypes,\r\n      attributeCount: 1,\r\n      singleProductStocks: cabangs.map(c => ({\r\n        cabangId: c.id,\r\n        cabangName: c.name,\r\n        quantity: 0,\r\n        price: 0\r\n      })),\r\n      variants: [],\r\n      bulkApply: initialBulkApply,\r\n      singleBulkApply: initialSingleBulkApply,\r\n      singleMarketplaceInfo: initialSingleMarketplaceInfo,\r\n    });\r\n  },\r\n}));\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useOfflineQueueStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useProductPageStore.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2150,2153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2150,2153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2180,2183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2180,2183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2978,2981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2978,2981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\r\nimport { useProductPageStore } from './useProductPageStore';\r\n\r\n// Mock API\r\nvi.mock('@/lib/api', () => ({\r\n  productsAPI: {\r\n    getProducts: vi.fn().mockResolvedValue({ data: [] }),\r\n    getCategories: vi.fn().mockResolvedValue({ data: [] }),\r\n    updateStock: vi.fn().mockResolvedValue({ data: {} }),\r\n    deleteProduct: vi.fn().mockResolvedValue({ data: {} }),\r\n    importProducts: vi.fn().mockResolvedValue({ data: { success: true, imported: 1, failed: 0 } }),\r\n    exportProducts: vi.fn().mockResolvedValue({ data: new ArrayBuffer(0) }),\r\n    getTemplate: vi.fn().mockResolvedValue({ data: new ArrayBuffer(0) }),\r\n  },\r\n  cabangAPI: {\r\n    getCabangs: vi.fn().mockResolvedValue({ data: [] }),\r\n  },\r\n}));\r\n\r\ndescribe('useProductPageStore', () => {\r\n  beforeEach(() => {\r\n    useProductPageStore.setState({\r\n      products: [],\r\n      categories: [],\r\n      cabangs: [],\r\n      search: '',\r\n      selectedCategory: '',\r\n      selectedProducts: [],\r\n      loading: true,\r\n      deleting: false,\r\n      activeTab: 'products',\r\n      variantModal: { isOpen: false, product: null },\r\n      editingStock: null,\r\n      newStockQty: '',\r\n      adjustmentReason: '',\r\n      savingStock: false,\r\n      importFile: null,\r\n      importing: false,\r\n      exporting: false,\r\n      importResult: null,\r\n    });\r\n  });\r\n\r\n  it('should initialize with default state', () => {\r\n    const state = useProductPageStore.getState();\r\n    expect(state.products).toEqual([]);\r\n    expect(state.search).toBe('');\r\n    expect(state.activeTab).toBe('products');\r\n    expect(state.loading).toBe(true);\r\n  });\r\n\r\n  it('should update search', () => {\r\n    useProductPageStore.getState().setSearch('test');\r\n    expect(useProductPageStore.getState().search).toBe('test');\r\n  });\r\n\r\n  it('should update selected category', () => {\r\n    useProductPageStore.getState().setSelectedCategory('cat-1');\r\n    expect(useProductPageStore.getState().selectedCategory).toBe('cat-1');\r\n  });\r\n\r\n  it('should handle select all products', () => {\r\n    useProductPageStore.setState({\r\n      products: [\r\n        { id: 'p1' } as any,\r\n        { id: 'p2' } as any,\r\n      ],\r\n    });\r\n    \r\n    useProductPageStore.getState().handleSelectAll(true);\r\n    expect(useProductPageStore.getState().selectedProducts).toEqual(['p1', 'p2']);\r\n    \r\n    useProductPageStore.getState().handleSelectAll(false);\r\n    expect(useProductPageStore.getState().selectedProducts).toEqual([]);\r\n  });\r\n\r\n  it('should handle select individual product', () => {\r\n    useProductPageStore.getState().handleSelectProduct('p1', true);\r\n    expect(useProductPageStore.getState().selectedProducts).toContain('p1');\r\n    \r\n    useProductPageStore.getState().handleSelectProduct('p1', false);\r\n    expect(useProductPageStore.getState().selectedProducts).not.toContain('p1');\r\n  });\r\n\r\n  it('should open/close variant modal', () => {\r\n    const product = { id: 'p1', name: 'Product 1' } as any;\r\n    \r\n    useProductPageStore.getState().openVariantModal(product);\r\n    expect(useProductPageStore.getState().variantModal.isOpen).toBe(true);\r\n    expect(useProductPageStore.getState().variantModal.product?.id).toBe('p1');\r\n    \r\n    useProductPageStore.getState().closeVariantModal();\r\n    expect(useProductPageStore.getState().variantModal.isOpen).toBe(false);\r\n    expect(useProductPageStore.getState().variantModal.product).toBeNull();\r\n  });\r\n\r\n  it('should start editing stock', () => {\r\n    useProductPageStore.getState().startEditingStock('v1', 'c1', 10, { x: 100, y: 200 });\r\n    \r\n    const state = useProductPageStore.getState();\r\n    expect(state.editingStock?.variantId).toBe('v1');\r\n    expect(state.editingStock?.cabangId).toBe('c1');\r\n    expect(state.editingStock?.currentQty).toBe(10);\r\n    expect(state.newStockQty).toBe('10');\r\n  });\r\n\r\n  it('should cancel editing stock', () => {\r\n    useProductPageStore.setState({\r\n      editingStock: { variantId: 'v1', cabangId: 'c1', currentQty: 10, position: { x: 0, y: 0 } },\r\n      newStockQty: '15',\r\n      adjustmentReason: 'test',\r\n    });\r\n    \r\n    useProductPageStore.getState().cancelEditingStock();\r\n    expect(useProductPageStore.getState().editingStock).toBeNull();\r\n    expect(useProductPageStore.getState().newStockQty).toBe('');\r\n    expect(useProductPageStore.getState().adjustmentReason).toBe('');\r\n  });\r\n\r\n  it('should update stock quantity', () => {\r\n    useProductPageStore.getState().setNewStockQty('25');\r\n    expect(useProductPageStore.getState().newStockQty).toBe('25');\r\n  });\r\n\r\n  it('should update adjustment reason', () => {\r\n    useProductPageStore.getState().setAdjustmentReason('Restock');\r\n    expect(useProductPageStore.getState().adjustmentReason).toBe('Restock');\r\n  });\r\n\r\n  it('should set active tab', () => {\r\n    useProductPageStore.getState().setActiveTab('import-export');\r\n    expect(useProductPageStore.getState().activeTab).toBe('import-export');\r\n  });\r\n\r\n  it('should set import file', () => {\r\n    const file = new File([''], 'test.xlsx', { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\r\n    useProductPageStore.getState().setImportFile(file);\r\n    expect(useProductPageStore.getState().importFile).toBe(file);\r\n  });\r\n\r\n  it('should clear import file', () => {\r\n    const file = new File([''], 'test.xlsx', { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\r\n    useProductPageStore.setState({ importFile: file });\r\n    \r\n    useProductPageStore.getState().setImportFile(null);\r\n    expect(useProductPageStore.getState().importFile).toBeNull();\r\n  });\r\n\r\n  it('should set import result', () => {\r\n    const result = { success: true, imported: 5, failed: 1 };\r\n    useProductPageStore.getState().setImportResult(result);\r\n    expect(useProductPageStore.getState().importResult).toEqual(result);\r\n  });\r\n});\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useProductPageStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1018,1021],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1018,1021],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":283,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7765,7768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7765,7768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":332,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9374,9377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9374,9377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":462,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":462,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14086,14089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14086,14089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { productsAPI, cabangAPI } from '@/lib/api';\r\nimport { logger } from '@/lib/logger';\r\nimport { getAuth } from '@/lib/auth';\r\n\r\ninterface Stock {\r\n  id: string;\r\n  quantity: number;\r\n  price: number;\r\n  cabangId: string;\r\n  cabang: { id: string; name: string };\r\n}\r\n\r\ninterface Variant {\r\n  id: string;\r\n  sku: string;\r\n  variantName: string;\r\n  variantValue: string;\r\n  stocks: Stock[];\r\n}\r\n\r\ninterface Category {\r\n  id: string;\r\n  name: string;\r\n  _count?: { products: number };\r\n}\r\n\r\ninterface Cabang {\r\n  id: string;\r\n  name: string;\r\n  isActive: boolean;\r\n}\r\n\r\ninterface Product {\r\n  id: string;\r\n  name: string;\r\n  productType: string;\r\n  isActive: boolean;\r\n  description?: string;\r\n  category: Category;\r\n  variants: Variant[];\r\n}\r\n\r\ninterface EditingStock {\r\n  variantId: string;\r\n  cabangId: string;\r\n  currentQty: number;\r\n  position: { x: number; y: number };\r\n}\r\n\r\ninterface ImportResult {\r\n  success: boolean;\r\n  imported: number;\r\n  failed: number;\r\n  details?: any;\r\n}\r\n\r\ninterface ProductPageState {\r\n  // Data\r\n  products: Product[];\r\n  categories: Category[];\r\n  cabangs: Cabang[];\r\n  \r\n  // Filters\r\n  search: string;\r\n  selectedCategory: string;\r\n  \r\n  // Selection\r\n  selectedProducts: string[];\r\n  \r\n  // UI State\r\n  loading: boolean;\r\n  deleting: boolean;\r\n  activeTab: 'products' | 'import-export';\r\n  \r\n  // Variant modal\r\n  variantModal: { isOpen: boolean; product: Product | null };\r\n  \r\n  // Inline stock editing\r\n  editingStock: EditingStock | null;\r\n  newStockQty: string;\r\n  adjustmentReason: string;\r\n  savingStock: boolean;\r\n  \r\n  // Import/Export\r\n  importFile: File | null;\r\n  importing: boolean;\r\n  exporting: boolean;\r\n  importResult: ImportResult | null;\r\n  \r\n  // Actions\r\n  setProducts: (products: Product[]) => void;\r\n  setCategories: (categories: Category[]) => void;\r\n  setCabangs: (cabangs: Cabang[]) => void;\r\n  setSearch: (search: string) => void;\r\n  setSelectedCategory: (categoryId: string) => void;\r\n  setSelectedProducts: (ids: string[]) => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setDeleting: (deleting: boolean) => void;\r\n  setActiveTab: (tab: 'products' | 'import-export') => void;\r\n  \r\n  // Selection actions\r\n  handleSelectAll: (checked: boolean) => void;\r\n  handleSelectProduct: (productId: string, checked: boolean) => void;\r\n  \r\n  // Variant modal actions\r\n  openVariantModal: (product: Product) => void;\r\n  closeVariantModal: () => void;\r\n  \r\n  // Stock editing actions\r\n  startEditingStock: (variantId: string, cabangId: string, currentQty: number, position: { x: number; y: number }) => void;\r\n  setNewStockQty: (qty: string) => void;\r\n  setAdjustmentReason: (reason: string) => void;\r\n  cancelEditingStock: () => void;\r\n  saveStock: () => Promise<boolean>;\r\n  \r\n  // Import/Export actions\r\n  setImportFile: (file: File | null) => void;\r\n  setImportResult: (result: ImportResult | null) => void;\r\n  importProducts: () => Promise<boolean>;\r\n  exportProducts: () => Promise<boolean>;\r\n  downloadTemplate: () => Promise<void>;\r\n  \r\n  // API actions\r\n  fetchData: () => Promise<void>;\r\n  fetchDataSilent: () => Promise<void>;\r\n  bulkDeleteProducts: () => Promise<boolean>;\r\n}\r\n\r\nexport const useProductPageStore = create<ProductPageState>()((set, get) => ({\r\n  // Initial data\r\n  products: [],\r\n  categories: [],\r\n  cabangs: [],\r\n  \r\n  // Initial filters\r\n  search: '',\r\n  selectedCategory: '',\r\n  \r\n  // Selection\r\n  selectedProducts: [],\r\n  \r\n  // UI State\r\n  loading: true,\r\n  deleting: false,\r\n  activeTab: 'products',\r\n  \r\n  // Variant modal\r\n  variantModal: { isOpen: false, product: null },\r\n  \r\n  // Stock editing\r\n  editingStock: null,\r\n  newStockQty: '',\r\n  adjustmentReason: '',\r\n  savingStock: false,\r\n  \r\n  // Import/Export\r\n  importFile: null,\r\n  importing: false,\r\n  exporting: false,\r\n  importResult: null,\r\n  \r\n  // Setters\r\n  setProducts: (products) => set({ products }),\r\n  setCategories: (categories) => set({ categories }),\r\n  setCabangs: (cabangs) => set({ cabangs }),\r\n  setSearch: (search) => set({ search }),\r\n  setSelectedCategory: (selectedCategory) => set({ selectedCategory }),\r\n  setSelectedProducts: (selectedProducts) => set({ selectedProducts }),\r\n  setLoading: (loading) => set({ loading }),\r\n  setDeleting: (deleting) => set({ deleting }),\r\n  setActiveTab: (activeTab) => set({ activeTab }),\r\n  \r\n  // Selection actions\r\n  handleSelectAll: (checked) => {\r\n    const { products } = get();\r\n    set({ selectedProducts: checked ? products.map(p => p.id) : [] });\r\n  },\r\n  \r\n  handleSelectProduct: (productId, checked) => {\r\n    const { selectedProducts } = get();\r\n    set({\r\n      selectedProducts: checked\r\n        ? [...selectedProducts, productId]\r\n        : selectedProducts.filter(id => id !== productId)\r\n    });\r\n  },\r\n  \r\n  // Variant modal actions\r\n  openVariantModal: (product) => set({ variantModal: { isOpen: true, product } }),\r\n  closeVariantModal: () => set({ variantModal: { isOpen: false, product: null } }),\r\n  \r\n  // Stock editing actions\r\n  startEditingStock: (variantId, cabangId, currentQty, position) => set({\r\n    editingStock: { variantId, cabangId, currentQty, position },\r\n    newStockQty: currentQty.toString(),\r\n    adjustmentReason: '',\r\n  }),\r\n  \r\n  setNewStockQty: (newStockQty) => set({ newStockQty }),\r\n  setAdjustmentReason: (adjustmentReason) => set({ adjustmentReason }),\r\n  \r\n  cancelEditingStock: () => set({\r\n    editingStock: null,\r\n    newStockQty: '',\r\n    adjustmentReason: '',\r\n  }),\r\n  \r\n  saveStock: async () => {\r\n    const { editingStock, newStockQty, adjustmentReason, products } = get();\r\n    if (!editingStock) return false;\r\n    \r\n    const qty = parseInt(newStockQty);\r\n    if (isNaN(qty) || qty < 0) return false;\r\n    \r\n    set({ savingStock: true });\r\n    try {\r\n      await productsAPI.updateStock(\r\n        editingStock.variantId,\r\n        editingStock.cabangId,\r\n        {\r\n          quantity: qty,\r\n          reason: adjustmentReason || undefined,\r\n        }\r\n      );\r\n      \r\n      // Update local state\r\n      set({\r\n        products: products.map(product => ({\r\n          ...product,\r\n          variants: product.variants?.map((variant) =>\r\n            variant.id === editingStock.variantId\r\n              ? {\r\n                  ...variant,\r\n                  stocks: variant.stocks?.map((stock) =>\r\n                    stock.cabangId === editingStock.cabangId\r\n                      ? { ...stock, quantity: qty }\r\n                      : stock\r\n                  ),\r\n                }\r\n              : variant\r\n          ),\r\n        })),\r\n        savingStock: false,\r\n        editingStock: null,\r\n        newStockQty: '',\r\n        adjustmentReason: '',\r\n      });\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('Error saving stock:', error);\r\n      set({ savingStock: false });\r\n      return false;\r\n    }\r\n  },\r\n  \r\n  // Import/Export actions\r\n  setImportFile: (importFile) => set({ importFile }),\r\n  setImportResult: (importResult) => set({ importResult }),\r\n  \r\n  importProducts: async () => {\r\n    const { importFile } = get();\r\n    if (!importFile) return false;\r\n    \r\n    set({ importing: true, importResult: null });\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append('file', importFile);\r\n      \r\n      const response = await productsAPI.importProducts(formData);\r\n      set({ importResult: response.data, importFile: null, importing: false });\r\n      \r\n      // Reset file input\r\n      if (typeof document !== 'undefined') {\r\n        const fileInput = document.getElementById('file-upload') as HTMLInputElement;\r\n        if (fileInput) fileInput.value = '';\r\n      }\r\n      \r\n      if (response.data.success) {\r\n        get().fetchData();\r\n      }\r\n      return response.data.success;\r\n    } catch (error: any) {\r\n      set({\r\n        importResult: {\r\n          success: false,\r\n          imported: 0,\r\n          failed: 0,\r\n          details: { success: [], errors: [{ error: error.response?.data?.error || 'Gagal import produk' }] },\r\n        },\r\n        importing: false,\r\n      });\r\n      return false;\r\n    }\r\n  },\r\n  \r\n  exportProducts: async () => {\r\n    set({ exporting: true });\r\n    try {\r\n      const { token } = getAuth();\r\n      const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5100/api';\r\n      \r\n      const response = await fetch(`${apiUrl}/products/export`, {\r\n        method: 'GET',\r\n        headers: { 'Authorization': `Bearer ${token}` },\r\n        credentials: 'include', // Include cookies for HttpOnly auth\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        throw new Error(errorData.error || 'Export failed');\r\n      }\r\n      \r\n      const result = await response.json();\r\n      const binaryString = atob(result.data);\r\n      const bytes = new Uint8Array(binaryString.length);\r\n      for (let i = 0; i < binaryString.length; i++) {\r\n        bytes[i] = binaryString.charCodeAt(i);\r\n      }\r\n      \r\n      const blob = new Blob([bytes], { type: result.mimeType });\r\n      const url = window.URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.download = result.filename;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n      window.URL.revokeObjectURL(url);\r\n      \r\n      return true;\r\n    } catch (error: any) {\r\n      logger.error('Export error:', error);\r\n      throw error;\r\n    } finally {\r\n      set({ exporting: false });\r\n    }\r\n  },\r\n  \r\n  downloadTemplate: async () => {\r\n    try {\r\n      const { token } = getAuth();\r\n      const apiUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:5100/api';\r\n      \r\n      const response = await fetch(`${apiUrl}/products/template`, {\r\n        method: 'GET',\r\n        headers: { 'Authorization': `Bearer ${token}` },\r\n        credentials: 'include', // Include cookies for HttpOnly auth\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        logger.error('Template download failed:', response.status, errorData);\r\n        throw new Error(errorData.error || `Download failed: ${response.status}`);\r\n      }\r\n      \r\n      const result = await response.json();\r\n      const binaryString = atob(result.data);\r\n      const bytes = new Uint8Array(binaryString.length);\r\n      for (let i = 0; i < binaryString.length; i++) {\r\n        bytes[i] = binaryString.charCodeAt(i);\r\n      }\r\n      \r\n      const blob = new Blob([bytes], { type: result.mimeType });\r\n      const url = window.URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.download = result.filename;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n      window.URL.revokeObjectURL(url);\r\n    } catch (error) {\r\n      logger.error('Template download error:', error);\r\n      throw error;\r\n    }\r\n  },\r\n  \r\n  // API actions\r\n  fetchData: async () => {\r\n    const { selectedCategory, search } = get();\r\n    set({ loading: true });\r\n    try {\r\n      const [productsRes, categoriesRes, cabangsRes] = await Promise.all([\r\n        productsAPI.getProducts({\r\n          categoryId: selectedCategory || undefined,\r\n          search: search || undefined,\r\n          isActive: true,\r\n        }),\r\n        productsAPI.getCategories(),\r\n        cabangAPI.getCabangs(),\r\n      ]);\r\n      \r\n      // Backend returns { data: [...], pagination: {...} } for products\r\n      const productsData = productsRes.data?.data || productsRes.data || [];\r\n      const categoriesData = Array.isArray(categoriesRes.data) ? categoriesRes.data : [];\r\n      const cabangsData = Array.isArray(cabangsRes.data) ? cabangsRes.data : [];\r\n      \r\n      set({\r\n        products: Array.isArray(productsData) ? productsData : [],\r\n        categories: categoriesData,\r\n        cabangs: cabangsData.filter((c: Cabang) => c.isActive),\r\n        selectedProducts: [],\r\n        loading: false,\r\n      });\r\n    } catch (error) {\r\n      logger.error('Error fetching data:', error);\r\n      set({ products: [], categories: [], cabangs: [], loading: false });\r\n    }\r\n  },\r\n  \r\n  fetchDataSilent: async () => {\r\n    const { selectedCategory, search } = get();\r\n    try {\r\n      const [productsRes, categoriesRes, cabangsRes] = await Promise.all([\r\n        productsAPI.getProducts({\r\n          categoryId: selectedCategory || undefined,\r\n          search: search || undefined,\r\n          isActive: true,\r\n        }),\r\n        productsAPI.getCategories(),\r\n        cabangAPI.getCabangs(),\r\n      ]);\r\n      \r\n      // Backend returns { data: [...], pagination: {...} } for products\r\n      const productsData = productsRes.data?.data || productsRes.data || [];\r\n      const categoriesData = Array.isArray(categoriesRes.data) ? categoriesRes.data : [];\r\n      const cabangsData = Array.isArray(cabangsRes.data) ? cabangsRes.data : [];\r\n      \r\n      set({\r\n        products: Array.isArray(productsData) ? productsData : [],\r\n        categories: categoriesData,\r\n        cabangs: cabangsData.filter((c: Cabang) => c.isActive),\r\n      });\r\n    } catch (error) {\r\n      logger.error('Error fetching data:', error);\r\n    }\r\n  },\r\n  \r\n  bulkDeleteProducts: async () => {\r\n    const { selectedProducts, products } = get();\r\n    if (selectedProducts.length === 0) return false;\r\n    \r\n    set({ deleting: true });\r\n    try {\r\n      const response = await productsAPI.bulkDelete(selectedProducts);\r\n      const result = response.data;\r\n      \r\n      // Get IDs that were successfully deleted or deactivated\r\n      const successIds = result.details?.deletedIds || [];\r\n      const deactivatedIds = result.details?.deactivatedIds || [];\r\n      const allSuccessIds = [...successIds, ...deactivatedIds];\r\n      \r\n      set({\r\n        products: products.filter(p => !allSuccessIds.includes(p.id)),\r\n        selectedProducts: [],\r\n        deleting: false,\r\n      });\r\n      \r\n      // Return true if at least one product was processed\r\n      return allSuccessIds.length > 0;\r\n    } catch (error: any) {\r\n      const errorMsg = error?.response?.data?.error || error?.message || 'Unknown error';\r\n      logger.error('Error deleting products:', errorMsg);\r\n      set({ deleting: false });\r\n      return false;\r\n    }\r\n  },\r\n}));\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useProductStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[342,345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[342,345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[499,502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[499,502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[685,688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[685,688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[767,770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[767,770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { productsAPI, cabangAPI, settingsAPI, categoriesAPI } from '@/lib/api';\r\nimport { logger } from '@/lib/logger';\r\n\r\ninterface Product {\r\n  id: string;\r\n  name: string;\r\n  productType: 'SINGLE' | 'VARIANT';\r\n  category?: { id: string; name: string };\r\n  variants?: ProductVariant[];\r\n  [key: string]: any;\r\n}\r\n\r\ninterface ProductVariant {\r\n  id: string;\r\n  sku: string;\r\n  variantName: string;\r\n  variantValue: string;\r\n  stocks?: Stock[];\r\n  [key: string]: any;\r\n}\r\n\r\ninterface Stock {\r\n  cabangId: string;\r\n  quantity: number;\r\n  price: number;\r\n}\r\n\r\ninterface Branch {\r\n  id: string;\r\n  name: string;\r\n  isActive: boolean;\r\n  [key: string]: any;\r\n}\r\n\r\ninterface Category {\r\n  id: string;\r\n  name: string;\r\n  [key: string]: any;\r\n}\r\n\r\ninterface ProductState {\r\n  // Data\r\n  products: Product[];\r\n  branches: Branch[];\r\n  categories: Category[];\r\n  \r\n  // Selected branch\r\n  selectedCabangId: string;\r\n  \r\n  // Search\r\n  search: string;\r\n  \r\n  // Loading states\r\n  loading: boolean;\r\n  \r\n  // Settings\r\n  adminWhatsApp: string;\r\n  \r\n  // Actions\r\n  setProducts: (products: Product[]) => void;\r\n  setBranches: (branches: Branch[]) => void;\r\n  setCategories: (categories: Category[]) => void;\r\n  setSelectedCabangId: (id: string) => void;\r\n  setSearch: (search: string) => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setAdminWhatsApp: (phone: string) => void;\r\n  \r\n  // Fetch actions\r\n  fetchProducts: (cabangId: string) => Promise<void>;\r\n  fetchBranches: () => Promise<Branch[]>;\r\n  fetchCategories: () => Promise<void>;\r\n  fetchSettings: () => Promise<void>;\r\n  \r\n  // Product updates (from WebSocket)\r\n  updateProduct: (product: Product) => void;\r\n  deleteProduct: (productId: string) => void;\r\n  updateStock: (cabangId: string, variantId: string, quantity: number, price?: number) => void;\r\n  \r\n  // Filtered products (client-side search)\r\n  getFilteredProducts: () => Product[];\r\n  \r\n  // Helpers\r\n  getStockForVariant: (variant: ProductVariant, cabangId: string) => Stock | undefined;\r\n}\r\n\r\nexport const useProductStore = create<ProductState>()((set, get) => ({\r\n  products: [],\r\n  branches: [],\r\n  categories: [],\r\n  selectedCabangId: '',\r\n  search: '',\r\n  loading: true,\r\n  adminWhatsApp: '6282112406540',\r\n\r\n  setProducts: (products) => set({ products }),\r\n  setBranches: (branches) => set({ branches }),\r\n  setCategories: (categories) => set({ categories }),\r\n  setSelectedCabangId: (id) => {\r\n    set({ selectedCabangId: id });\r\n    if (typeof window !== 'undefined') {\r\n      localStorage.setItem('activeCabangId', id);\r\n    }\r\n  },\r\n  setSearch: (search) => set({ search }),\r\n  setLoading: (loading) => set({ loading }),\r\n  setAdminWhatsApp: (phone) => set({ adminWhatsApp: phone }),\r\n\r\n  fetchProducts: async (cabangId) => {\r\n    try {\r\n      set({ loading: true });\r\n      const res = await productsAPI.getProducts({ isActive: true });\r\n      // Backend returns paginated response: { data: [...], pagination: {...} }\r\n      const productsData = res.data.data || res.data;\r\n      \r\n      if (cabangId) {\r\n        const filtered = productsData.filter((product: Product) => {\r\n          if (product.productType === 'SINGLE') {\r\n            const v = product.variants?.[0];\r\n            return v?.stocks?.some((s) => s.cabangId === cabangId);\r\n          }\r\n          return product.variants?.some((variant) =>\r\n            variant.stocks?.some((s) => s.cabangId === cabangId)\r\n          );\r\n        });\r\n        set({ products: filtered });\r\n      } else {\r\n        set({ products: productsData });\r\n      }\r\n    } catch (e) {\r\n      logger.error('Failed to fetch products:', e);\r\n    } finally {\r\n      set({ loading: false });\r\n    }\r\n  },\r\n\r\n  fetchBranches: async () => {\r\n    try {\r\n      const res = await cabangAPI.getCabangs();\r\n      const activeBranches = res.data.filter((b: Branch) => b.isActive);\r\n      set({ branches: activeBranches });\r\n      return activeBranches;\r\n    } catch (e) {\r\n      logger.error('Failed to fetch branches:', e);\r\n      return [];\r\n    }\r\n  },\r\n\r\n  fetchCategories: async () => {\r\n    try {\r\n      const res = await categoriesAPI.getCategories();\r\n      set({ categories: res.data });\r\n    } catch (e) {\r\n      logger.error('Failed to fetch categories:', e);\r\n    }\r\n  },\r\n\r\n  fetchSettings: async () => {\r\n    try {\r\n      const res = await settingsAPI.getSettings();\r\n      set({ adminWhatsApp: res.data.adminWhatsApp || '6282112406540' });\r\n    } catch (e) {\r\n      logger.error('Failed to fetch settings:', e);\r\n    }\r\n  },\r\n\r\n  updateProduct: (product) => {\r\n    set((state) => ({\r\n      products: state.products.map((p) => (p.id === product.id ? product : p)),\r\n    }));\r\n  },\r\n\r\n  deleteProduct: (productId) => {\r\n    set((state) => ({\r\n      products: state.products.filter((p) => p.id !== productId),\r\n    }));\r\n  },\r\n\r\n  updateStock: (cabangId, variantId, quantity, price) => {\r\n    set((state) => ({\r\n      products: state.products.map((product) => ({\r\n        ...product,\r\n        variants: product.variants?.map((variant) => ({\r\n          ...variant,\r\n          stocks: variant.stocks?.map((stock) =>\r\n            stock.cabangId === cabangId && variant.id === variantId\r\n              ? { ...stock, quantity, ...(price !== undefined && { price }) }\r\n              : stock\r\n          ),\r\n        })),\r\n      })),\r\n    }));\r\n  },\r\n\r\n  getFilteredProducts: () => {\r\n    const { products, search } = get();\r\n    if (!search.trim()) return products;\r\n\r\n    const searchWords = search.toLowerCase().trim().split(/\\s+/).filter((w) => w.length > 0);\r\n\r\n    const filtered: Product[] = [];\r\n    \r\n    for (const product of products) {\r\n      const productText = [product.name, product.category?.name]\r\n        .filter(Boolean)\r\n        .join(' ')\r\n        .toLowerCase();\r\n\r\n      const filteredVariants = product.variants?.filter((v) => {\r\n        const variantText = [\r\n          productText,\r\n          v.sku || '',\r\n          v.variantValue || '',\r\n          v.variantName || '',\r\n        ]\r\n          .join(' ')\r\n          .toLowerCase();\r\n\r\n        return searchWords.every((word) => variantText.includes(word));\r\n      });\r\n\r\n      if (filteredVariants && filteredVariants.length > 0) {\r\n        filtered.push({ ...product, variants: filteredVariants });\r\n      }\r\n    }\r\n    \r\n    return filtered;\r\n  },\r\n\r\n  getStockForVariant: (variant, cabangId) => {\r\n    return variant.stocks?.find((s) => s.cabangId === cabangId);\r\n  },\r\n}));\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useReturnsStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useReturnsStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3267,3270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3267,3270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":155,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":155,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":182,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4735,4738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4735,4738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":213,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5615,5618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5615,5618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { returnsAPI } from '@/lib/api';\r\nimport { getAuth } from '@/lib/auth';\r\nimport { logger } from '@/lib/logger';\r\n\r\n// Types\r\nexport interface ReturnItem {\r\n  id: string;\r\n  productName: string;\r\n  variantInfo: string;\r\n  sku: string;\r\n  quantity: number;\r\n  price: number;\r\n  subtotal: number;\r\n}\r\n\r\nexport interface ExchangeItem {\r\n  id: string;\r\n  productName: string;\r\n  variantInfo: string;\r\n  sku: string;\r\n  quantity: number;\r\n  price: number;\r\n  subtotal: number;\r\n}\r\n\r\nexport interface Return {\r\n  id: string;\r\n  returnNo: string;\r\n  createdAt: string;\r\n  status: 'PENDING' | 'REJECTED' | 'COMPLETED';\r\n  reason: string;\r\n  reasonDetail?: string;\r\n  notes: string;\r\n  photoUrls?: string[];\r\n  conditionNote?: string;\r\n  subtotal: number;\r\n  refundAmount: number;\r\n  refundMethod: string;\r\n  approvedBy: string | null;\r\n  approvedAt: string | null;\r\n  isOverdue?: boolean;\r\n  managerOverride?: boolean;\r\n  returnType: 'REFUND' | 'EXCHANGE';\r\n  priceDifference?: number | null;\r\n  transaction: {\r\n    transactionNo: string;\r\n    customerName: string | null;\r\n    customerPhone: string | null;\r\n    paymentMethod: string;\r\n    total: number;\r\n    createdAt: string;\r\n  };\r\n  cabang: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n  processedBy: {\r\n    id: string;\r\n    name: string;\r\n    role: string;\r\n  };\r\n  items: ReturnItem[];\r\n  exchangeItems?: ExchangeItem[];\r\n}\r\n\r\nexport interface Stats {\r\n  pending: number;\r\n  rejected: number;\r\n  completed: number;\r\n  total: number;\r\n  totalRefundAmount: number;\r\n}\r\n\r\n// Simplified modal state\r\ninterface ModalState {\r\n  type: 'detail' | 'approve' | 'reject' | null;\r\n  selectedReturn: Return | null;\r\n  notes: string;\r\n}\r\n\r\ninterface ReturnsState {\r\n  // Data\r\n  returns: Return[];\r\n  stats: Stats | null;\r\n  loading: boolean;\r\n  processing: boolean;\r\n  \r\n  // Simplified modal state\r\n  modal: ModalState;\r\n  \r\n  // Actions - Setters\r\n  setReturns: (returns: Return[]) => void;\r\n  setStats: (stats: Stats | null) => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setProcessing: (processing: boolean) => void;\r\n  \r\n  // Actions - Fetch\r\n  fetchReturns: (filters: { status?: string; search?: string; startDate?: string; endDate?: string }) => Promise<void>;\r\n  fetchStats: () => Promise<void>;\r\n  \r\n  // Actions - Business logic\r\n  handleApprove: () => Promise<{ success: boolean; message: string }>;\r\n  handleReject: () => Promise<{ success: boolean; message: string }>;\r\n  \r\n  // Actions - Modal helpers (simplified)\r\n  openModal: (type: 'detail' | 'approve' | 'reject', ret: Return) => void;\r\n  closeModal: () => void;\r\n  setModalNotes: (notes: string) => void;\r\n}\r\n\r\nexport const useReturnsStore = create<ReturnsState>()((set, get) => ({\r\n  // Initial data\r\n  returns: [],\r\n  stats: null,\r\n  loading: true,\r\n  processing: false,\r\n  \r\n  // Initial modal state\r\n  modal: {\r\n    type: null,\r\n    selectedReturn: null,\r\n    notes: '',\r\n  },\r\n  \r\n  // Setters\r\n  setReturns: (returns) => set({ returns }),\r\n  setStats: (stats) => set({ stats }),\r\n  setLoading: (loading) => set({ loading }),\r\n  setProcessing: (processing) => set({ processing }),\r\n  \r\n  // Fetch actions\r\n  fetchReturns: async (filters) => {\r\n    try {\r\n      set({ loading: true });\r\n      const params: any = {};\r\n      if (filters.status && filters.status !== 'ALL') params.status = filters.status;\r\n      if (filters.search) params.search = filters.search;\r\n      if (filters.startDate) params.startDate = filters.startDate;\r\n      if (filters.endDate) params.endDate = filters.endDate;\r\n      \r\n      const response = await returnsAPI.getReturns(params);\r\n      set({ returns: response.data.returns });\r\n    } catch (error) {\r\n      logger.error('Failed to fetch returns:', error);\r\n    } finally {\r\n      set({ loading: false });\r\n    }\r\n  },\r\n  \r\n  fetchStats: async () => {\r\n    try {\r\n      const response = await returnsAPI.getStats();\r\n      set({ stats: response.data });\r\n    } catch (error) {\r\n      // Stats fetch failed - UI will handle gracefully\r\n    }\r\n  },\r\n  \r\n  // Business logic\r\n  handleApprove: async () => {\r\n    const { modal } = get();\r\n    if (!modal.selectedReturn) return { success: false, message: 'No return selected' };\r\n    \r\n    const { user } = getAuth();\r\n    if (!user) {\r\n      return { success: false, message: 'User tidak terautentikasi' };\r\n    }\r\n    \r\n    try {\r\n      set({ processing: true });\r\n      await returnsAPI.approveReturn(modal.selectedReturn.id, {\r\n        approvedBy: user.id,\r\n        notes: modal.notes\r\n      });\r\n      \r\n      set({ \r\n        modal: { type: null, selectedReturn: null, notes: '' }\r\n      });\r\n      \r\n      return { success: true, message: 'Return berhasil disetujui!' };\r\n    } catch (error: any) {\r\n      return { \r\n        success: false, \r\n        message: error.response?.data?.error || 'Gagal menyetujui return' \r\n      };\r\n    } finally {\r\n      set({ processing: false });\r\n    }\r\n  },\r\n  \r\n  handleReject: async () => {\r\n    const { modal } = get();\r\n    if (!modal.selectedReturn) return { success: false, message: 'No return selected' };\r\n    \r\n    const { user } = getAuth();\r\n    if (!user) {\r\n      return { success: false, message: 'User tidak terautentikasi' };\r\n    }\r\n    \r\n    try {\r\n      set({ processing: true });\r\n      await returnsAPI.rejectReturn(modal.selectedReturn.id, {\r\n        rejectedBy: user.id,\r\n        rejectionNotes: modal.notes\r\n      });\r\n      \r\n      set({ \r\n        modal: { type: null, selectedReturn: null, notes: '' }\r\n      });\r\n      \r\n      return { success: true, message: 'Return berhasil ditolak' };\r\n    } catch (error: any) {\r\n      return { \r\n        success: false, \r\n        message: error.response?.data?.error || 'Gagal menolak return' \r\n      };\r\n    } finally {\r\n      set({ processing: false });\r\n    }\r\n  },\r\n  \r\n  // Simplified modal helpers\r\n  openModal: (type, ret) => {\r\n    set({\r\n      modal: {\r\n        type,\r\n        selectedReturn: ret,\r\n        notes: '',\r\n      },\r\n    });\r\n  },\r\n  \r\n  closeModal: () => {\r\n    set({\r\n      modal: {\r\n        type: null,\r\n        selectedReturn: null,\r\n        notes: '',\r\n      },\r\n    });\r\n  },\r\n  \r\n  setModalNotes: (notes) => {\r\n    set((state) => ({\r\n      modal: {\r\n        ...state.modal,\r\n        notes,\r\n      },\r\n    }));\r\n  },\r\n}));\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useSalesReportStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useSalesReportStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3370,3373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3370,3373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { transactionsAPI, cabangAPI, channelsAPI } from '@/lib/api';\r\nimport { logger } from '@/lib/logger';\r\n\r\n// Types\r\nexport interface SummaryData {\r\n  totalTransactions: number;\r\n  totalRevenue: number;\r\n  paymentMethodBreakdown: Array<{\r\n    paymentMethod: string;\r\n    _count: { id: number };\r\n    _sum: { total: number };\r\n  }>;\r\n}\r\n\r\nexport interface TrendData {\r\n  date: string;\r\n  total: number;\r\n  count: number;\r\n}\r\n\r\nexport interface TopProduct {\r\n  productVariantId: string;\r\n  productName: string;\r\n  variantName: string;\r\n  variantValue: string;\r\n  category: string;\r\n  totalQuantity: number;\r\n  totalRevenue: number;\r\n  transactionCount: number;\r\n}\r\n\r\nexport interface BranchPerformance {\r\n  cabangId: string;\r\n  cabangName: string;\r\n  totalTransactions: number;\r\n  totalRevenue: number;\r\n}\r\n\r\nexport interface Channel {\r\n  id: string;\r\n  code: string;\r\n  name: string;\r\n  type: string;\r\n  color: string | null;\r\n}\r\n\r\nexport interface Cabang {\r\n  id: string;\r\n  name: string;\r\n}\r\n\r\ninterface SalesReportState {\r\n  // Data\r\n  loading: boolean;\r\n  summary: SummaryData | null;\r\n  trend: TrendData[];\r\n  topProducts: TopProduct[];\r\n  branchPerformance: BranchPerformance[];\r\n  cabangs: Cabang[];\r\n  channels: Channel[];\r\n  \r\n  // Filters\r\n  selectedCabang: string;\r\n  selectedChannel: string;\r\n  dateRange: string;\r\n  startDate: string;\r\n  endDate: string;\r\n  showCustomDate: boolean;\r\n  \r\n  // Actions - Setters\r\n  setLoading: (loading: boolean) => void;\r\n  setSelectedCabang: (cabangId: string) => void;\r\n  setSelectedChannel: (channelId: string) => void;\r\n  setDateRange: (range: string) => void;\r\n  setStartDate: (date: string) => void;\r\n  setEndDate: (date: string) => void;\r\n  setShowCustomDate: (show: boolean) => void;\r\n  \r\n  // Actions - Fetch\r\n  fetchInitialData: () => Promise<void>;\r\n  fetchReportData: () => Promise<void>;\r\n  \r\n  // Actions - Helpers\r\n  handleDateRangeChange: (value: string) => void;\r\n}\r\n\r\nexport const useSalesReportStore = create<SalesReportState>()((set, get) => ({\r\n  // Initial data\r\n  loading: true,\r\n  summary: null,\r\n  trend: [],\r\n  topProducts: [],\r\n  branchPerformance: [],\r\n  cabangs: [],\r\n  channels: [],\r\n  \r\n  // Initial filters\r\n  selectedCabang: '',\r\n  selectedChannel: '',\r\n  dateRange: '7',\r\n  startDate: '',\r\n  endDate: '',\r\n  showCustomDate: false,\r\n  \r\n  // Setters\r\n  setLoading: (loading) => set({ loading }),\r\n  setSelectedCabang: (cabangId) => set({ selectedCabang: cabangId }),\r\n  setSelectedChannel: (channelId) => set({ selectedChannel: channelId }),\r\n  setDateRange: (range) => set({ dateRange: range }),\r\n  setStartDate: (date) => set({ startDate: date }),\r\n  setEndDate: (date) => set({ endDate: date }),\r\n  setShowCustomDate: (show) => set({ showCustomDate: show }),\r\n  \r\n  // Fetch actions\r\n  fetchInitialData: async () => {\r\n    try {\r\n      const [cabangRes, channelRes] = await Promise.all([\r\n        cabangAPI.getCabangs(),\r\n        channelsAPI.getChannels()\r\n      ]);\r\n      set({ \r\n        cabangs: cabangRes.data,\r\n        channels: channelRes.data \r\n      });\r\n    } catch (error) {\r\n      logger.error('Error fetching initial data:', error);\r\n    }\r\n  },\r\n  \r\n  fetchReportData: async () => {\r\n    const { selectedCabang, showCustomDate, startDate, endDate, dateRange } = get();\r\n    \r\n    set({ loading: true });\r\n    try {\r\n      const params: any = {};\r\n      if (selectedCabang) params.cabangId = selectedCabang;\r\n      \r\n      if (showCustomDate && startDate && endDate) {\r\n        params.startDate = startDate;\r\n        params.endDate = endDate;\r\n      } else {\r\n        const end = new Date();\r\n        const start = new Date();\r\n        start.setDate(start.getDate() - parseInt(dateRange));\r\n        params.startDate = start.toISOString().split('T')[0];\r\n        params.endDate = end.toISOString().split('T')[0];\r\n      }\r\n\r\n      const [summaryRes, trendRes, topProductsRes, branchRes] = await Promise.all([\r\n        transactionsAPI.getSummary(params),\r\n        transactionsAPI.getSalesTrend({ ...params, days: dateRange }),\r\n        transactionsAPI.getTopProducts({ ...params, limit: 10 }),\r\n        transactionsAPI.getBranchPerformance(params)\r\n      ]);\r\n\r\n      set({\r\n        summary: summaryRes.data,\r\n        trend: trendRes.data.trend || [],\r\n        topProducts: topProductsRes.data.topProducts || [],\r\n        branchPerformance: branchRes.data.branches || [],\r\n      });\r\n    } catch (error) {\r\n      logger.error('Error fetching report data:', error);\r\n    } finally {\r\n      set({ loading: false });\r\n    }\r\n  },\r\n  \r\n  // Helpers\r\n  handleDateRangeChange: (value) => {\r\n    if (value === 'custom') {\r\n      set({ showCustomDate: true });\r\n    } else {\r\n      set({ showCustomDate: false, dateRange: value });\r\n    }\r\n  },\r\n}));\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useStockOpnameStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useStockOpnameStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useStockStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useStockStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1811,1814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1811,1814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":135,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3158,3161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3158,3161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":146,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3592,3595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3592,3595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5150,5153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5150,5153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":340,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":340,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11136,11139],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11136,11139],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":363,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":363,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11875,11878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11875,11878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":538,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":538,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17879,17882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17879,17882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":564,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":564,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18678,18681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18678,18681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":663,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":663,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22054,22057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22054,22057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":715,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":715,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":753,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":753,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":792,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":792,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25957,25960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25957,25960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":814,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":814,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26708,26711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26708,26711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { stockAPI, productsAPI, cabangAPI } from '@/lib/api';\r\nimport { logger } from '@/lib/logger';\r\n\r\nexport interface Stock {\r\n  id: string;\r\n  quantity: number;\r\n  price: number;\r\n  cabang: { id: string; name: string };\r\n}\r\n\r\nexport interface Variant {\r\n  id: string;\r\n  sku: string;\r\n  variantName: string;\r\n  variantValue: string;\r\n  stocks: Stock[];\r\n}\r\n\r\nexport interface Product {\r\n  id: string;\r\n  name: string;\r\n  productType: string;\r\n  category: { id: string; name: string };\r\n  variants: Variant[];\r\n}\r\n\r\nexport interface Cabang {\r\n  id: string;\r\n  name: string;\r\n  isActive: boolean;\r\n}\r\n\r\nexport interface AdjustmentItem {\r\n  id: string;\r\n  variant: Variant;\r\n  productName: string;\r\n  cabangId: string;\r\n  currentStock: number;\r\n  type: 'add' | 'subtract';\r\n  quantity: number;\r\n  reason: string;\r\n  notes: string;\r\n}\r\n\r\nexport interface AdjustmentModal {\r\n  isOpen: boolean;\r\n  variant: Variant | null;\r\n  productName: string;\r\n  cabangId: string;\r\n  currentStock: number;\r\n}\r\n\r\ninterface QuickHistoryModal {\r\n  isOpen: boolean;\r\n  variantId: string;\r\n  cabangId: string;\r\n  variantName: string;\r\n  productName: string;\r\n}\r\n\r\ninterface AlertModal {\r\n  isOpen: boolean;\r\n  variant: Variant | null;\r\n  productName: string;\r\n  cabangId: string;\r\n  currentStock: number;\r\n  existingAlert?: { minStock: number; isActive: boolean };\r\n}\r\n\r\ninterface StockInItem {\r\n  sku: string;\r\n  productId: string;\r\n  variantId: string;\r\n  productName: string;\r\n  variantName: string;\r\n  quantity: number;\r\n  cabangId: string;\r\n  skuError?: string;\r\n}\r\n\r\ninterface AdjustmentForm {\r\n  type: 'add' | 'subtract';\r\n  quantity: number;\r\n  reason: string;\r\n  notes: string;\r\n}\r\n\r\ninterface StockState {\r\n  // Data\r\n  products: Product[];\r\n  cabangs: Cabang[];\r\n  adjustmentHistory: any[];\r\n  stockAlerts: Map<string, { minStock: number; isActive: boolean }>;\r\n  damagedCounts: Map<string, number>; // variantId-cabangId -> damaged count\r\n  \r\n  // Filters\r\n  searchTerm: string;\r\n  selectedCabangs: Set<string>;\r\n  showLowStockOnly: boolean;\r\n  viewMode: 'simple' | 'advanced';\r\n  activeTab: 'overview' | 'history';\r\n  \r\n  // UI State\r\n  loading: boolean;\r\n  loadingHistory: boolean;\r\n  submitting: boolean;\r\n  expandedProducts: Set<string>;\r\n  \r\n  // Adjustment\r\n  adjustmentItems: AdjustmentItem[];\r\n  \r\n  // Modals\r\n  adjustmentModal: AdjustmentModal;\r\n  quickHistoryModal: QuickHistoryModal;\r\n  alertModal: AlertModal;\r\n  alertMinStock: string;\r\n  adjustmentForm: AdjustmentForm;\r\n  showStockInModal: boolean;\r\n  stockInItems: StockInItem[];\r\n  stockInLoading: boolean;\r\n  showCabangDropdown: boolean;\r\n  activeActionMenu: string | null;\r\n  \r\n  // Actions\r\n  setProducts: (products: Product[]) => void;\r\n  setCabangs: (cabangs: Cabang[]) => void;\r\n  setSearchTerm: (term: string) => void;\r\n  setShowLowStockOnly: (show: boolean) => void;\r\n  setViewMode: (mode: 'simple' | 'advanced') => void;\r\n  setActiveTab: (tab: 'overview' | 'history') => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setLoadingHistory: (loading: boolean) => void;\r\n  setSubmitting: (submitting: boolean) => void;\r\n  setAdjustmentHistory: (history: any[]) => void;\r\n  setStockAlerts: (alerts: Map<string, { minStock: number; isActive: boolean }>) => void;\r\n  toggleCabang: (cabangId: string) => void;\r\n  selectAllCabangs: () => void;\r\n  clearAllCabangs: () => void;\r\n  toggleExpandProduct: (productId: string) => void;\r\n  \r\n  // Fetch actions\r\n  fetchData: () => Promise<void>;\r\n  fetchProducts: () => Promise<void>;\r\n  fetchCabangs: () => Promise<void>;\r\n  fetchHistory: (filters?: any) => Promise<void>;\r\n  fetchStockAlerts: () => Promise<void>;  fetchDamagedCounts: () => Promise<void>;  \r\n  // Adjustment actions\r\n  addAdjustmentItem: (item: AdjustmentItem) => void;\r\n  removeAdjustmentItem: (id: string) => void;\r\n  clearAdjustmentItems: () => void;\r\n  submitAdjustments: () => Promise<boolean>;\r\n  \r\n  // Modal actions\r\n  setAdjustmentModal: (modal: AdjustmentModal | ((prev: AdjustmentModal) => AdjustmentModal)) => void;\r\n  setQuickHistoryModal: (modal: QuickHistoryModal | ((prev: QuickHistoryModal) => QuickHistoryModal)) => void;\r\n  setAlertModal: (modal: AlertModal | ((prev: AlertModal) => AlertModal)) => void;\r\n  setAlertMinStock: (value: string) => void;\r\n  setAdjustmentForm: (form: AdjustmentForm | ((prev: AdjustmentForm) => AdjustmentForm)) => void;\r\n  setShowStockInModal: (show: boolean) => void;\r\n  setStockInItems: (items: StockInItem[] | ((prev: StockInItem[]) => StockInItem[])) => void;\r\n  setStockInLoading: (loading: boolean) => void;\r\n  setShowCabangDropdown: (show: boolean) => void;\r\n  setActiveActionMenu: (id: string | null) => void;\r\n  setAdjustmentItems: (items: AdjustmentItem[] | ((prev: AdjustmentItem[]) => AdjustmentItem[])) => void;\r\n  \r\n  // Modal helpers\r\n  closeAdjustmentModal: () => void;\r\n  closeQuickHistoryModal: () => void;\r\n  closeAlertModal: () => void;\r\n  resetAdjustmentForm: () => void;\r\n  \r\n  // Stock-In actions\r\n  openStockInModal: () => void;\r\n  addStockInItem: () => void;\r\n  removeStockInItem: (index: number) => void;\r\n  updateStockInItem: (index: number, field: string, value: any) => void;\r\n  searchSkuForStockIn: (index: number, sku: string) => Promise<void>;\r\n  submitStockIn: () => Promise<false | { success: number; failed: number }>;\r\n  \r\n  // Adjustment logic actions\r\n  addCurrentItemToAdjustment: () => boolean;\r\n  submitAllAdjustments: () => Promise<false | number>;\r\n  openQuickHistory: (variantId: string, cabangId: string, variantName: string, productName: string) => Promise<void>;\r\n  \r\n  // Alert actions\r\n  openAlertModal: (variant: Variant, productName: string, defaultCabangId: string) => Promise<void>;\r\n  changeAlertCabang: (cabangId: string) => Promise<void>;\r\n  submitAlert: () => Promise<{ success: boolean; message: string }>;\r\n  deleteAlert: () => Promise<{ success: boolean; message: string }>;\r\n  \r\n  // Additional modal actions\r\n  openAdjustmentModal: (variant: Variant, productName: string, defaultCabangId: string) => void;\r\n  changeCabangInAdjustmentModal: (cabangId: string) => void;\r\n  openHistoryForAllCabangs: (variantId: string, variantName: string, productName: string) => Promise<void>;\r\n}\r\n\r\nexport const useStockStore = create<StockState>()((set, get) => ({\r\n  // Initial data\r\n  products: [],\r\n  cabangs: [],\r\n  adjustmentHistory: [],\r\n  stockAlerts: new Map(),\r\n  damagedCounts: new Map(),\r\n  \r\n  // Initial filters\r\n  searchTerm: '',\r\n  selectedCabangs: new Set(),\r\n  showLowStockOnly: false,\r\n  viewMode: 'advanced',\r\n  activeTab: 'overview',\r\n  \r\n  // Initial UI state\r\n  loading: true,\r\n  loadingHistory: false,\r\n  submitting: false,\r\n  expandedProducts: new Set(),\r\n  \r\n  // Adjustment\r\n  adjustmentItems: [],\r\n  \r\n  // Modals initial state\r\n  adjustmentModal: { isOpen: false, variant: null, productName: '', cabangId: '', currentStock: 0 },\r\n  quickHistoryModal: { isOpen: false, variantId: '', cabangId: '', variantName: '', productName: '' },\r\n  alertModal: { isOpen: false, variant: null, productName: '', cabangId: '', currentStock: 0 },\r\n  alertMinStock: '5',\r\n  adjustmentForm: { type: 'add', quantity: 0, reason: '', notes: '' },\r\n  showStockInModal: false,\r\n  stockInItems: [],\r\n  stockInLoading: false,\r\n  showCabangDropdown: false,\r\n  activeActionMenu: null,\r\n  \r\n  // Setters\r\n  setProducts: (products) => set({ products }),\r\n  setCabangs: (cabangs) => set({ cabangs }),\r\n  setSearchTerm: (searchTerm) => set({ searchTerm }),\r\n  setShowLowStockOnly: (showLowStockOnly) => set({ showLowStockOnly }),\r\n  setViewMode: (viewMode) => set({ viewMode }),\r\n  setActiveTab: (activeTab) => set({ activeTab }),\r\n  setLoading: (loading) => set({ loading }),\r\n  setLoadingHistory: (loadingHistory) => set({ loadingHistory }),\r\n  setSubmitting: (submitting) => set({ submitting }),\r\n  setAdjustmentHistory: (adjustmentHistory) => set({ adjustmentHistory }),\r\n  setStockAlerts: (stockAlerts) => set({ stockAlerts }),\r\n  \r\n  toggleCabang: (cabangId) => set((state) => {\r\n    const newSet = new Set(state.selectedCabangs);\r\n    if (newSet.has(cabangId)) {\r\n      newSet.delete(cabangId);\r\n    } else {\r\n      newSet.add(cabangId);\r\n    }\r\n    return { selectedCabangs: newSet };\r\n  }),\r\n  \r\n  selectAllCabangs: () => set((state) => ({\r\n    selectedCabangs: new Set(state.cabangs.map(c => c.id))\r\n  })),\r\n  \r\n  clearAllCabangs: () => set({ selectedCabangs: new Set() }),\r\n  \r\n  toggleExpandProduct: (productId) => set((state) => {\r\n    const newSet = new Set(state.expandedProducts);\r\n    if (newSet.has(productId)) {\r\n      newSet.delete(productId);\r\n    } else {\r\n      newSet.add(productId);\r\n    }\r\n    return { expandedProducts: newSet };\r\n  }),\r\n  \r\n  // Fetch actions\r\n  fetchData: async () => {\r\n    set({ loading: true });\r\n    try {\r\n      const [productsRes, cabangRes] = await Promise.all([\r\n        productsAPI.getProducts({ isActive: true }), // Only fetch active products\r\n        cabangAPI.getCabangs(),\r\n      ]);\r\n      const filteredCabangs = cabangRes.data.filter((c: Cabang) => c.name !== 'Default' && c.isActive);\r\n      // Handle paginated response: { data: [...], pagination: {...} }\r\n      const productsData = productsRes.data.data || productsRes.data;\r\n      set({\r\n        products: Array.isArray(productsData) ? productsData : [],\r\n        cabangs: filteredCabangs,\r\n        selectedCabangs: new Set(filteredCabangs.map((c: Cabang) => c.id)),\r\n        loading: false,\r\n      });\r\n      // Fetch damaged counts after products loaded\r\n      get().fetchDamagedCounts();\r\n    } catch (error) {\r\n      logger.error('Error fetching data:', error);\r\n      set({ loading: false });\r\n    }\r\n  },\r\n  \r\n  fetchProducts: async () => {\r\n    set({ loading: true });\r\n    try {\r\n      const res = await productsAPI.getProducts({ isActive: true });\r\n      // Handle paginated response: { data: [...], pagination: {...} }\r\n      const productsData = res.data.data || res.data;\r\n      set({ products: productsData, loading: false });\r\n    } catch (error) {\r\n      logger.error('Error fetching products:', error);\r\n      set({ loading: false });\r\n    }\r\n  },\r\n  \r\n  fetchCabangs: async () => {\r\n    try {\r\n      const res = await cabangAPI.getCabangs();\r\n      set({ cabangs: res.data.filter((c: Cabang) => c.isActive) });\r\n    } catch (error) {\r\n      logger.error('Error fetching cabangs:', error);\r\n    }\r\n  },\r\n  \r\n  fetchHistory: async (filters = {}) => {\r\n    set({ loadingHistory: true });\r\n    try {\r\n      const res = await stockAPI.getAdjustments(filters);\r\n      const data = res?.data?.data || res?.data || [];\r\n      set({ adjustmentHistory: Array.isArray(data) ? data : [], loadingHistory: false });\r\n    } catch (error) {\r\n      logger.error('Error fetching history:', error);\r\n      set({ loadingHistory: false });\r\n    }\r\n  },\r\n  \r\n  fetchStockAlerts: async () => {\r\n    try {\r\n      const response = await stockAPI.getAlerts();\r\n      const alertsData = response?.data?.data || response?.data || [];\r\n      \r\n      // Build a map of variant+cabang -> alert settings\r\n      const alertsMap = new Map<string, { minStock: number; isActive: boolean }>();\r\n      \r\n      alertsData.forEach((alert: any) => {\r\n        const key = `${alert.productVariantId}-${alert.cabangId}`;\r\n        alertsMap.set(key, {\r\n          minStock: alert.minStock,\r\n          isActive: alert.isActive\r\n        });\r\n      });\r\n      \r\n      set({ stockAlerts: alertsMap });\r\n    } catch (error) {\r\n      logger.error('Error fetching alerts:', error);\r\n    }\r\n  },\r\n\r\n  fetchDamagedCounts: async () => {\r\n    try {\r\n      // Fetch all DAMAGED adjustments\r\n      const response = await stockAPI.getAdjustments({ reason: 'DAMAGED' });\r\n      const adjustments = response?.data?.data || response?.data || [];\r\n      \r\n      // Aggregate damaged count per variant+cabang\r\n      const damagedMap = new Map<string, number>();\r\n      \r\n      adjustments.forEach((adj: any) => {\r\n        // API returns nested objects: productVariant.id and cabang.id\r\n        const variantId = adj.productVariant?.id || adj.productVariantId;\r\n        const cabangId = adj.cabang?.id || adj.cabangId;\r\n        \r\n        if (!variantId || !cabangId) return;\r\n        \r\n        const key = `${variantId}-${cabangId}`;\r\n        const currentCount = damagedMap.get(key) || 0;\r\n        // Sum up all negative differences (damaged items)\r\n        if (adj.difference < 0) {\r\n          damagedMap.set(key, currentCount + Math.abs(adj.difference));\r\n        }\r\n      });\r\n      \r\n      set({ damagedCounts: damagedMap });\r\n    } catch (error) {\r\n      logger.error('Error fetching damaged counts:', error);\r\n    }\r\n  },\r\n  \r\n  // Adjustment actions\r\n  addAdjustmentItem: (item) => set((state) => ({\r\n    adjustmentItems: [...state.adjustmentItems, item]\r\n  })),\r\n  \r\n  removeAdjustmentItem: (id) => set((state) => ({\r\n    adjustmentItems: state.adjustmentItems.filter(i => i.id !== id)\r\n  })),\r\n  \r\n  clearAdjustmentItems: () => set({ adjustmentItems: [] }),\r\n  \r\n  submitAdjustments: async () => {\r\n    const { adjustmentItems } = get();\r\n    if (adjustmentItems.length === 0) return false;\r\n    \r\n    set({ submitting: true });\r\n    try {\r\n      await Promise.all(\r\n        adjustmentItems.map(item => {\r\n          const adjustmentType: 'add' | 'subtract' = item.type === 'add' ? 'add' : 'subtract';\r\n          return stockAPI.createAdjustment({\r\n            variantId: item.variant.id,\r\n            cabangId: item.cabangId,\r\n            type: adjustmentType,\r\n            quantity: item.quantity,\r\n            reason: item.reason,\r\n            notes: item.notes,\r\n          });\r\n        })\r\n      );\r\n      set({ adjustmentItems: [], submitting: false });\r\n      get().fetchProducts();\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('Error submitting adjustments:', error);\r\n      set({ submitting: false });\r\n      return false;\r\n    }\r\n  },\r\n  \r\n  // Modal setters (support callback pattern)\r\n  setAdjustmentModal: (modalOrFn) => set((state) => ({\r\n    adjustmentModal: typeof modalOrFn === 'function' ? modalOrFn(state.adjustmentModal) : modalOrFn\r\n  })),\r\n  setQuickHistoryModal: (modalOrFn) => set((state) => ({\r\n    quickHistoryModal: typeof modalOrFn === 'function' ? modalOrFn(state.quickHistoryModal) : modalOrFn\r\n  })),\r\n  setAlertModal: (modalOrFn) => set((state) => ({\r\n    alertModal: typeof modalOrFn === 'function' ? modalOrFn(state.alertModal) : modalOrFn\r\n  })),\r\n  setAlertMinStock: (alertMinStock) => set({ alertMinStock }),\r\n  setAdjustmentForm: (formOrFn) => set((state) => ({\r\n    adjustmentForm: typeof formOrFn === 'function' ? formOrFn(state.adjustmentForm) : formOrFn\r\n  })),\r\n  setShowStockInModal: (showStockInModal) => set({ showStockInModal }),\r\n  setStockInItems: (itemsOrFn) => set((state) => ({\r\n    stockInItems: typeof itemsOrFn === 'function' ? itemsOrFn(state.stockInItems) : itemsOrFn\r\n  })),\r\n  setStockInLoading: (stockInLoading) => set({ stockInLoading }),\r\n  setShowCabangDropdown: (showCabangDropdown) => set({ showCabangDropdown }),\r\n  setActiveActionMenu: (activeActionMenu) => set({ activeActionMenu }),\r\n  setAdjustmentItems: (itemsOrFn) => set((state) => ({\r\n    adjustmentItems: typeof itemsOrFn === 'function' ? itemsOrFn(state.adjustmentItems) : itemsOrFn\r\n  })),\r\n  \r\n  // Modal helpers\r\n  closeAdjustmentModal: () => set({ \r\n    adjustmentModal: { isOpen: false, variant: null, productName: '', cabangId: '', currentStock: 0 } \r\n  }),\r\n  closeQuickHistoryModal: () => set({ \r\n    quickHistoryModal: { isOpen: false, variantId: '', cabangId: '', variantName: '', productName: '' } \r\n  }),\r\n  closeAlertModal: () => set({ \r\n    alertModal: { isOpen: false, variant: null, productName: '', cabangId: '', currentStock: 0 },\r\n    alertMinStock: '5'\r\n  }),\r\n  resetAdjustmentForm: () => set({ \r\n    adjustmentForm: { type: 'add', quantity: 0, reason: '', notes: '' } \r\n  }),\r\n  \r\n  // Stock-In actions\r\n  openStockInModal: () => {\r\n    const { cabangs } = get();\r\n    set({\r\n      showStockInModal: true,\r\n      stockInItems: [{\r\n        sku: '',\r\n        productId: '',\r\n        variantId: '',\r\n        productName: '',\r\n        variantName: '',\r\n        quantity: 0,\r\n        cabangId: cabangs[0]?.id || ''\r\n      }]\r\n    });\r\n  },\r\n  \r\n  addStockInItem: () => {\r\n    const { cabangs, stockInItems } = get();\r\n    set({\r\n      stockInItems: [...stockInItems, {\r\n        sku: '',\r\n        productId: '',\r\n        variantId: '',\r\n        productName: '',\r\n        variantName: '',\r\n        quantity: 0,\r\n        cabangId: cabangs[0]?.id || ''\r\n      }]\r\n    });\r\n  },\r\n  \r\n  removeStockInItem: (index) => {\r\n    const { stockInItems } = get();\r\n    set({ stockInItems: stockInItems.filter((_, i) => i !== index) });\r\n  },\r\n  \r\n  updateStockInItem: (index, field, value) => {\r\n    const { stockInItems } = get();\r\n    const newItems = [...stockInItems];\r\n    newItems[index] = { ...newItems[index], [field]: value };\r\n    set({ stockInItems: newItems });\r\n  },\r\n  \r\n  searchSkuForStockIn: async (index, sku) => {\r\n    const { stockInItems } = get();\r\n    const newItems = [...stockInItems];\r\n    \r\n    newItems[index] = {\r\n      ...newItems[index],\r\n      sku,\r\n      productId: '',\r\n      variantId: '',\r\n      productName: '',\r\n      variantName: '',\r\n      skuError: undefined\r\n    };\r\n    \r\n    if (sku.trim()) {\r\n      try {\r\n        const response = await productsAPI.searchBySKU(sku.trim());\r\n        const apiData = response.data;\r\n        if (apiData?.success && apiData.data) {\r\n          const { product, variant } = apiData.data;\r\n          newItems[index] = {\r\n            ...newItems[index],\r\n            sku: variant.sku,\r\n            productId: product.id,\r\n            productName: product.name,\r\n            variantId: variant.id,\r\n            variantName: variant.variantType ? `${variant.variantType}: ${variant.value}` : 'Default',\r\n            skuError: undefined\r\n          };\r\n        }\r\n      } catch (error: any) {\r\n        const errorMsg = error?.response?.data?.error || 'SKU tidak ditemukan';\r\n        newItems[index] = { ...newItems[index], skuError: errorMsg };\r\n      }\r\n    }\r\n    \r\n    set({ stockInItems: newItems });\r\n  },\r\n  \r\n  submitStockIn: async () => {\r\n    const { stockInItems, fetchData } = get();\r\n    \r\n    const invalidItems = stockInItems.filter(item => \r\n      !item.sku || !item.variantId || !item.cabangId || item.quantity <= 0\r\n    );\r\n    \r\n    if (invalidItems.length > 0) {\r\n      return false;\r\n    }\r\n\r\n    set({ stockInLoading: true });\r\n    \r\n    try {\r\n      const results = await Promise.allSettled(\r\n        stockInItems.map(async (item) => {\r\n          const stockRes = await productsAPI.getStock(item.variantId);\r\n          const currentStock = stockRes.data.find((s: any) => s.cabangId === item.cabangId);\r\n          const currentQty = currentStock?.quantity || 0;\r\n          const newQty = currentQty + item.quantity;\r\n          \r\n          return productsAPI.updateStock(item.variantId, item.cabangId, {\r\n            quantity: newQty,\r\n            reason: 'STOCK_OPNAME',\r\n            notes: `Stock In: +${item.quantity} (dari ${currentQty} menjadi ${newQty})`\r\n          });\r\n        })\r\n      );\r\n\r\n      const failed = results.filter(r => r.status === 'rejected');\r\n      const success = results.filter(r => r.status === 'fulfilled');\r\n\r\n      await fetchData();\r\n      set({ showStockInModal: false, stockInItems: [], stockInLoading: false });\r\n      \r\n      return { success: success.length, failed: failed.length };\r\n    } catch (error) {\r\n      logger.error('Error stock in:', error);\r\n      set({ stockInLoading: false });\r\n      return false;\r\n    }\r\n  },\r\n  \r\n  // Adjustment logic actions\r\n  addCurrentItemToAdjustment: () => {\r\n    const { adjustmentModal, adjustmentForm, adjustmentItems } = get();\r\n    \r\n    if (!adjustmentModal.variant || !adjustmentForm.quantity || !adjustmentForm.reason) {\r\n      return false;\r\n    }\r\n\r\n    const newItem: AdjustmentItem = {\r\n      id: `${adjustmentModal.variant.id}-${Date.now()}`,\r\n      variant: adjustmentModal.variant,\r\n      productName: adjustmentModal.productName,\r\n      cabangId: adjustmentModal.cabangId,\r\n      currentStock: adjustmentModal.currentStock,\r\n      type: adjustmentForm.type,\r\n      quantity: adjustmentForm.quantity,\r\n      reason: adjustmentForm.reason,\r\n      notes: adjustmentForm.notes\r\n    };\r\n\r\n    set({\r\n      adjustmentItems: [...adjustmentItems, newItem],\r\n      adjustmentForm: { type: 'add', quantity: 0, reason: '', notes: '' }\r\n    });\r\n    \r\n    return true;\r\n  },\r\n  \r\n  submitAllAdjustments: async () => {\r\n    const { adjustmentItems, adjustmentModal, adjustmentForm, fetchData } = get();\r\n    \r\n    const hasItems = adjustmentItems.length > 0;\r\n    const hasSingleForm = adjustmentModal.variant && adjustmentModal.cabangId && adjustmentForm.quantity > 0 && adjustmentForm.reason;\r\n\r\n    if (!hasItems && !hasSingleForm) {\r\n      return false;\r\n    }\r\n\r\n    set({ submitting: true });\r\n    \r\n    try {\r\n      const itemsToSubmit = hasItems ? adjustmentItems : [{\r\n        id: `single-${Date.now()}`,\r\n        variant: adjustmentModal.variant!,\r\n        productName: adjustmentModal.productName,\r\n        cabangId: adjustmentModal.cabangId,\r\n        currentStock: adjustmentModal.currentStock,\r\n        type: adjustmentForm.type,\r\n        quantity: adjustmentForm.quantity,\r\n        reason: adjustmentForm.reason,\r\n        notes: adjustmentForm.notes\r\n      }];\r\n\r\n      for (const item of itemsToSubmit) {\r\n        await stockAPI.createAdjustment({\r\n          variantId: item.variant.id,\r\n          cabangId: item.cabangId,\r\n          type: item.type,\r\n          quantity: item.quantity,\r\n          reason: item.reason,\r\n          notes: item.notes || undefined\r\n        });\r\n      }\r\n      \r\n      set({\r\n        adjustmentModal: { isOpen: false, variant: null, productName: '', cabangId: '', currentStock: 0 },\r\n        adjustmentItems: [],\r\n        adjustmentForm: { type: 'add', quantity: 0, reason: '', notes: '' },\r\n        submitting: false\r\n      });\r\n      \r\n      fetchData();\r\n      return itemsToSubmit.length;\r\n    } catch (error: any) {\r\n      logger.error('Error submitting adjustment:', error);\r\n      set({ submitting: false });\r\n      throw error;\r\n    }\r\n  },\r\n  \r\n  openQuickHistory: async (variantId, cabangId, variantName, productName) => {\r\n    set({\r\n      quickHistoryModal: {\r\n        isOpen: true,\r\n        variantId,\r\n        cabangId,\r\n        variantName,\r\n        productName\r\n      },\r\n      loadingHistory: true\r\n    });\r\n    \r\n    try {\r\n      const response = await stockAPI.getAdjustmentHistory(variantId, cabangId);\r\n      const data = response?.data?.data || response?.data || [];\r\n      set({ adjustmentHistory: Array.isArray(data) ? data : [], loadingHistory: false });\r\n    } catch (error) {\r\n      logger.error('Error fetching history:', error);\r\n      set({ loadingHistory: false });\r\n    }\r\n  },\r\n  \r\n  // Alert actions\r\n  openAlertModal: async (variant, productName, defaultCabangId) => {\r\n    const stock = variant.stocks.find(s => s.cabang.id === defaultCabangId);\r\n    \r\n    try {\r\n      const response = await stockAPI.getAlert(variant.id, defaultCabangId);\r\n      const existingAlert = response?.data?.data || response?.data;\r\n      \r\n      set({\r\n        alertModal: {\r\n          isOpen: true,\r\n          variant,\r\n          productName,\r\n          cabangId: defaultCabangId,\r\n          currentStock: stock?.quantity || 0,\r\n          existingAlert: existingAlert ? {\r\n            minStock: existingAlert.minStock,\r\n            isActive: existingAlert.isActive\r\n          } : undefined\r\n        },\r\n        alertMinStock: existingAlert ? String(existingAlert.minStock) : '5',\r\n        activeActionMenu: null\r\n      });\r\n    } catch (error) {\r\n      // No existing alert, use defaults\r\n      set({\r\n        alertModal: {\r\n          isOpen: true,\r\n          variant,\r\n          productName,\r\n          cabangId: defaultCabangId,\r\n          currentStock: stock?.quantity || 0\r\n        },\r\n        alertMinStock: '5',\r\n        activeActionMenu: null\r\n      });\r\n    }\r\n  },\r\n  \r\n  changeAlertCabang: async (cabangId) => {\r\n    const { alertModal } = get();\r\n    if (!alertModal.variant) return;\r\n    \r\n    const stock = alertModal.variant.stocks.find(s => s.cabang.id === cabangId);\r\n    \r\n    try {\r\n      const response = await stockAPI.getAlert(alertModal.variant.id, cabangId);\r\n      const existingAlert = response?.data?.data || response?.data;\r\n      \r\n      set({\r\n        alertModal: {\r\n          ...alertModal,\r\n          cabangId,\r\n          currentStock: stock?.quantity || 0,\r\n          existingAlert: existingAlert ? {\r\n            minStock: existingAlert.minStock,\r\n            isActive: existingAlert.isActive\r\n          } : undefined\r\n        },\r\n        alertMinStock: existingAlert ? String(existingAlert.minStock) : '5'\r\n      });\r\n    } catch (error) {\r\n      set({\r\n        alertModal: {\r\n          ...alertModal,\r\n          cabangId,\r\n          currentStock: stock?.quantity || 0,\r\n          existingAlert: undefined\r\n        },\r\n        alertMinStock: '5'\r\n      });\r\n    }\r\n  },\r\n  \r\n  submitAlert: async () => {\r\n    const { alertModal, alertMinStock, fetchStockAlerts } = get();\r\n    \r\n    if (!alertModal.variant || !alertModal.cabangId) {\r\n      return { success: false, message: 'Data tidak lengkap' };\r\n    }\r\n    \r\n    const minStock = parseInt(alertMinStock) || 0;\r\n    if (minStock < 0) {\r\n      return { success: false, message: 'Minimum stock tidak boleh negatif' };\r\n    }\r\n    \r\n    try {\r\n      const response = await stockAPI.setAlert({\r\n        variantId: alertModal.variant.id,\r\n        cabangId: alertModal.cabangId,\r\n        minStock\r\n      });\r\n      \r\n      set({\r\n        alertModal: { isOpen: false, variant: null, productName: '', cabangId: '', currentStock: 0 },\r\n        alertMinStock: '5'\r\n      });\r\n      \r\n      fetchStockAlerts();\r\n      return { success: true, message: response.data.message || 'Alert berhasil diatur!' };\r\n    } catch (error: any) {\r\n      logger.error('Error setting alert:', error);\r\n      return { success: false, message: error.response?.data?.error || 'Gagal mengatur alert' };\r\n    }\r\n  },\r\n  \r\n  deleteAlert: async () => {\r\n    const { alertModal, fetchStockAlerts } = get();\r\n    \r\n    if (!alertModal.variant || !alertModal.cabangId) {\r\n      return { success: false, message: 'Data tidak lengkap' };\r\n    }\r\n    \r\n    try {\r\n      await stockAPI.deleteAlert(alertModal.variant.id, alertModal.cabangId);\r\n      \r\n      set({\r\n        alertModal: { isOpen: false, variant: null, productName: '', cabangId: '', currentStock: 0 }\r\n      });\r\n      \r\n      fetchStockAlerts();\r\n      return { success: true, message: 'Alert berhasil dinonaktifkan' };\r\n    } catch (error: any) {\r\n      logger.error('Error deleting alert:', error);\r\n      return { success: false, message: error.response?.data?.error || 'Gagal menghapus alert' };\r\n    }\r\n  },\r\n  \r\n  // Additional modal actions\r\n  openAdjustmentModal: (variant, productName, defaultCabangId) => {\r\n    const stock = variant.stocks.find(s => s.cabang.id === defaultCabangId);\r\n    set({\r\n      adjustmentModal: {\r\n        isOpen: true,\r\n        variant,\r\n        productName,\r\n        cabangId: defaultCabangId,\r\n        currentStock: stock?.quantity || 0\r\n      },\r\n      adjustmentForm: { type: 'add', quantity: 0, reason: '', notes: '' },\r\n      activeActionMenu: null\r\n    });\r\n  },\r\n  \r\n  changeCabangInAdjustmentModal: (cabangId) => {\r\n    const { adjustmentModal } = get();\r\n    const stock = adjustmentModal.variant?.stocks.find(s => s.cabang.id === cabangId);\r\n    set({\r\n      adjustmentModal: {\r\n        ...adjustmentModal,\r\n        cabangId,\r\n        currentStock: stock?.quantity || 0\r\n      }\r\n    });\r\n  },\r\n  \r\n  openHistoryForAllCabangs: async (variantId, variantName, productName) => {\r\n    set({\r\n      quickHistoryModal: {\r\n        isOpen: true,\r\n        variantId,\r\n        cabangId: 'all',\r\n        variantName,\r\n        productName\r\n      },\r\n      loadingHistory: true,\r\n      activeActionMenu: null\r\n    });\r\n    \r\n    try {\r\n      const response = await stockAPI.getAdjustmentHistory(variantId, 'all');\r\n      const data = response?.data?.data || response?.data || [];\r\n      set({ adjustmentHistory: Array.isArray(data) ? data : [], loadingHistory: false });\r\n    } catch (error) {\r\n      logger.error('Error fetching history:', error);\r\n      set({ loadingHistory: false });\r\n    }\r\n  },\r\n}));\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useTransferStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useTransferStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[707,710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[707,710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1383,1386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1383,1386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2514,2517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2514,2517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2654,2657],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2654,2657],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":176,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5164,5167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5164,5167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { stockTransfersAPI, cabangAPI, productsAPI } from '@/lib/api';\r\nimport { logger } from '@/lib/logger';\r\n\r\ninterface Cabang {\r\n  id: string;\r\n  name: string;\r\n  isActive: boolean;\r\n}\r\n\r\ninterface Product {\r\n  id: string;\r\n  name: string;\r\n  variants: Array<{\r\n    id: string;\r\n    variantName: string;\r\n    variantValue: string;\r\n    sku: string;\r\n    stocks: Array<{\r\n      cabangId: string;\r\n      quantity: number;\r\n    }>;\r\n  }>;\r\n}\r\n\r\ninterface Stats {\r\n  total: number;\r\n  completed: number;\r\n  pending: number;\r\n  totalQuantity: number;\r\n}\r\n\r\ninterface TransferState {\r\n  // Data - transfers is any[] to support varying API response structures\r\n  transfers: any[];\r\n  cabangs: Cabang[];\r\n  products: Product[];\r\n  stats: Stats | null;\r\n  \r\n  // Filters\r\n  searchTerm: string;\r\n  statusFilter: string;\r\n  cabangFilter: string;\r\n  fromCabangFilter: string;\r\n  toCabangFilter: string;\r\n  dateFrom: string;\r\n  dateTo: string;\r\n  \r\n  // UI State\r\n  loading: boolean;\r\n  submitting: boolean;\r\n  actionLoading: string | null;\r\n  \r\n  // Create Modal State\r\n  showCreateModal: boolean;\r\n  createLoading: boolean;\r\n  searchProduct: string;\r\n  selectedProduct: Product | null;\r\n  selectedVariant: string;\r\n  fromCabang: string;\r\n  toCabang: string;\r\n  quantity: number;\r\n  notes: string;\r\n  \r\n  // Actions - Setters\r\n  setTransfers: (transfers: any[]) => void;\r\n  setCabangs: (cabangs: Cabang[]) => void;\r\n  setProducts: (products: Product[]) => void;\r\n  setStats: (stats: Stats | null) => void;\r\n  setSearchTerm: (term: string) => void;\r\n  setStatusFilter: (status: string) => void;\r\n  setCabangFilter: (cabangId: string) => void;\r\n  setFromCabangFilter: (cabangId: string) => void;\r\n  setToCabangFilter: (cabangId: string) => void;\r\n  setDateFrom: (date: string) => void;\r\n  setDateTo: (date: string) => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setSubmitting: (submitting: boolean) => void;\r\n  setActionLoading: (id: string | null) => void;\r\n  \r\n  // Create modal actions\r\n  setShowCreateModal: (show: boolean) => void;\r\n  setSearchProduct: (search: string) => void;\r\n  setSelectedProduct: (product: Product | null) => void;\r\n  setSelectedVariant: (variantId: string) => void;\r\n  setFromCabang: (cabangId: string) => void;\r\n  setToCabang: (cabangId: string) => void;\r\n  setQuantity: (qty: number) => void;\r\n  setNotes: (notes: string) => void;\r\n  resetCreateForm: () => void;\r\n  \r\n  // API actions\r\n  fetchData: () => Promise<void>;\r\n  fetchTransfers: (filters?: any) => Promise<void>;\r\n  fetchCabangs: () => Promise<void>;\r\n  fetchProducts: (search: string) => Promise<void>;\r\n  createTransfer: (data: any) => Promise<boolean>;\r\n  approveTransfer: (id: string) => Promise<boolean>;\r\n  rejectTransfer: (id: string) => Promise<boolean>;\r\n  updateTransferStatus: (id: string, status: string) => Promise<boolean>;\r\n}\r\n\r\nexport const useTransferStore = create<TransferState>()((set, get) => ({\r\n  // Initial data\r\n  transfers: [],\r\n  cabangs: [],\r\n  products: [],\r\n  stats: null,\r\n  \r\n  // Initial filters\r\n  searchTerm: '',\r\n  statusFilter: 'ALL',\r\n  cabangFilter: '',\r\n  fromCabangFilter: '',\r\n  toCabangFilter: '',\r\n  dateFrom: '',\r\n  dateTo: '',\r\n  \r\n  // Initial UI state\r\n  loading: true,\r\n  submitting: false,\r\n  actionLoading: null,\r\n  \r\n  // Create modal initial state\r\n  showCreateModal: false,\r\n  createLoading: false,\r\n  searchProduct: '',\r\n  selectedProduct: null,\r\n  selectedVariant: '',\r\n  fromCabang: '',\r\n  toCabang: '',\r\n  quantity: 1,\r\n  notes: '',\r\n  \r\n  // Setters\r\n  setTransfers: (transfers) => set({ transfers }),\r\n  setCabangs: (cabangs) => set({ cabangs }),\r\n  setProducts: (products) => set({ products }),\r\n  setStats: (stats) => set({ stats }),\r\n  setSearchTerm: (searchTerm) => set({ searchTerm }),\r\n  setStatusFilter: (statusFilter) => set({ statusFilter }),\r\n  setCabangFilter: (cabangFilter) => set({ cabangFilter }),\r\n  setFromCabangFilter: (fromCabangFilter) => set({ fromCabangFilter }),\r\n  setToCabangFilter: (toCabangFilter) => set({ toCabangFilter }),\r\n  setDateFrom: (dateFrom) => set({ dateFrom }),\r\n  setDateTo: (dateTo) => set({ dateTo }),\r\n  setLoading: (loading) => set({ loading }),\r\n  setSubmitting: (submitting) => set({ submitting }),\r\n  setActionLoading: (actionLoading) => set({ actionLoading }),\r\n  \r\n  // Create modal setters\r\n  setShowCreateModal: (showCreateModal) => set({ showCreateModal }),\r\n  setSearchProduct: (searchProduct) => set({ searchProduct }),\r\n  setSelectedProduct: (selectedProduct) => set({ selectedProduct }),\r\n  setSelectedVariant: (selectedVariant) => set({ selectedVariant }),\r\n  setFromCabang: (fromCabang) => set({ fromCabang }),\r\n  setToCabang: (toCabang) => set({ toCabang }),\r\n  setQuantity: (quantity) => set({ quantity }),\r\n  setNotes: (notes) => set({ notes }),\r\n  resetCreateForm: () => set({\r\n    searchProduct: '',\r\n    selectedProduct: null,\r\n    selectedVariant: '',\r\n    fromCabang: '',\r\n    toCabang: '',\r\n    quantity: 1,\r\n    notes: '',\r\n    products: [],\r\n  }),\r\n  \r\n  // API actions\r\n  fetchData: async () => {\r\n    const { statusFilter, cabangFilter } = get();\r\n    set({ loading: true });\r\n    try {\r\n      const params: any = {};\r\n      if (statusFilter !== 'ALL') params.status = statusFilter;\r\n      if (cabangFilter) params.cabangId = cabangFilter;\r\n      \r\n      const [transfersRes, statsRes, branchesRes] = await Promise.all([\r\n        stockTransfersAPI.getTransfers(params),\r\n        stockTransfersAPI.getStats(),\r\n        cabangAPI.getCabangs(),\r\n      ]);\r\n      \r\n      set({\r\n        transfers: transfersRes.data,\r\n        stats: statsRes.data,\r\n        cabangs: branchesRes.data.filter((b: Cabang) => b.isActive),\r\n        loading: false,\r\n      });\r\n    } catch (error) {\r\n      logger.error('Error fetching data:', error);\r\n      set({ loading: false });\r\n    }\r\n  },\r\n  \r\n  fetchTransfers: async (filters = {}) => {\r\n    set({ loading: true });\r\n    try {\r\n      const { statusFilter, fromCabangFilter, toCabangFilter, dateFrom, dateTo, searchTerm } = get();\r\n      const queryFilters = {\r\n        ...filters,\r\n        status: statusFilter !== 'ALL' ? statusFilter : undefined,\r\n        fromCabangId: fromCabangFilter || undefined,\r\n        toCabangId: toCabangFilter || undefined,\r\n        dateFrom: dateFrom || undefined,\r\n        dateTo: dateTo || undefined,\r\n        search: searchTerm || undefined,\r\n      };\r\n      const res = await stockTransfersAPI.getTransfers(queryFilters);\r\n      set({ transfers: res.data, loading: false });\r\n    } catch (error) {\r\n      logger.error('Error fetching transfers:', error);\r\n      set({ loading: false });\r\n    }\r\n  },\r\n  \r\n  fetchCabangs: async () => {\r\n    try {\r\n      const res = await cabangAPI.getCabangs();\r\n      set({ cabangs: res.data.filter((c: Cabang) => c.isActive) });\r\n    } catch (error) {\r\n      logger.error('Error fetching cabangs:', error);\r\n    }\r\n  },\r\n  \r\n  fetchProducts: async (search: string) => {\r\n    if (!search || search.length < 2) {\r\n      set({ products: [] });\r\n      return;\r\n    }\r\n    try {\r\n      const res = await productsAPI.getProducts({ search, isActive: true });\r\n      // Handle paginated response: { data: [...], pagination: {...} }\r\n      const productsData = res.data.data || res.data;\r\n      set({ products: productsData });\r\n    } catch (error) {\r\n      logger.error('Error fetching products:', error);\r\n    }\r\n  },\r\n  \r\n  createTransfer: async (data) => {\r\n    set({ createLoading: true });\r\n    try {\r\n      await stockTransfersAPI.createTransfer(data);\r\n      set({ createLoading: false, showCreateModal: false });\r\n      get().resetCreateForm();\r\n      get().fetchData();\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('Error creating transfer:', error);\r\n      set({ createLoading: false });\r\n      return false;\r\n    }\r\n  },\r\n  \r\n  approveTransfer: async (id: string) => {\r\n    set({ actionLoading: id });\r\n    try {\r\n      await stockTransfersAPI.approveTransfer(id);\r\n      set({ actionLoading: null });\r\n      get().fetchData();\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('Error approving transfer:', error);\r\n      set({ actionLoading: null });\r\n      return false;\r\n    }\r\n  },\r\n  \r\n  rejectTransfer: async (id: string) => {\r\n    set({ actionLoading: id });\r\n    try {\r\n      await stockTransfersAPI.rejectTransfer(id);\r\n      set({ actionLoading: null });\r\n      get().fetchData();\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('Error rejecting transfer:', error);\r\n      set({ actionLoading: null });\r\n      return false;\r\n    }\r\n  },\r\n  \r\n  updateTransferStatus: async (id, status) => {\r\n    set({ submitting: true });\r\n    try {\r\n      // Use approve or reject based on status\r\n      if (status === 'COMPLETED' || status === 'APPROVED') {\r\n        await stockTransfersAPI.approveTransfer(id);\r\n      } else if (status === 'CANCELLED' || status === 'REJECTED') {\r\n        await stockTransfersAPI.rejectTransfer(id);\r\n      }\r\n      set({ submitting: false });\r\n      get().fetchTransfers();\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('Error updating transfer status:', error);\r\n      set({ submitting: false });\r\n      return false;\r\n    }\r\n  },\r\n}));\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useUserStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\stores\\useUserStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3433,3436],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3433,3436],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":155,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3819,3822],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3819,3822],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":169,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4191,4194],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4191,4194],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { authAPI } from '@/lib/api';\r\nimport { logger } from '@/lib/logger';\r\n\r\ntype UserRole = 'OWNER' | 'ADMIN' | 'MANAGER' | 'KASIR';\r\n\r\ninterface User {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  role: UserRole;\r\n  isActive: boolean;\r\n  hasMultiCabangAccess: boolean;\r\n  createdAt: string;\r\n  cabang?: { id: string; name: string };\r\n}\r\n\r\ninterface UserForm {\r\n  name: string;\r\n  email: string;\r\n  password: string;\r\n  role: UserRole;\r\n  cabangId: string;\r\n  hasMultiCabangAccess: boolean;\r\n}\r\n\r\ninterface UserState {\r\n  // Data\r\n  users: User[];\r\n  \r\n  // Filters\r\n  searchTerm: string;\r\n  roleFilter: string;\r\n  \r\n  // UI State\r\n  loading: boolean;\r\n  submitting: boolean;\r\n  \r\n  // Form\r\n  formData: UserForm;\r\n  editingUserId: string | null;\r\n  showModal: boolean;\r\n  \r\n  // Actions\r\n  setUsers: (users: User[]) => void;\r\n  setSearchTerm: (term: string) => void;\r\n  setRoleFilter: (role: string) => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setSubmitting: (submitting: boolean) => void;\r\n  setShowModal: (show: boolean) => void;\r\n  \r\n  // Form actions\r\n  setFormData: (data: Partial<UserForm>) => void;\r\n  resetForm: () => void;\r\n  setEditingUser: (user: User | null) => void;\r\n  \r\n  // API actions\r\n  fetchUsers: () => Promise<void>;\r\n  createUser: (data: UserForm) => Promise<boolean>;\r\n  updateUser: (id: string, data: Partial<UserForm>) => Promise<boolean>;\r\n  toggleUserStatus: (id: string, isActive: boolean) => Promise<boolean>;\r\n  deleteUser: (id: string) => Promise<boolean>;\r\n}\r\n\r\nconst defaultForm: UserForm = {\r\n  name: '',\r\n  email: '',\r\n  password: '',\r\n  role: 'KASIR',\r\n  cabangId: '',\r\n  hasMultiCabangAccess: false,\r\n};\r\n\r\nexport const useUserStore = create<UserState>()((set, get) => ({\r\n  // Initial data\r\n  users: [],\r\n  \r\n  // Initial filters\r\n  searchTerm: '',\r\n  roleFilter: '',\r\n  \r\n  // Initial UI state\r\n  loading: true,\r\n  submitting: false,\r\n  \r\n  // Form\r\n  formData: defaultForm,\r\n  editingUserId: null,\r\n  showModal: false,\r\n  \r\n  // Setters\r\n  setUsers: (users) => set({ users }),\r\n  setSearchTerm: (searchTerm) => set({ searchTerm }),\r\n  setRoleFilter: (roleFilter) => set({ roleFilter }),\r\n  setLoading: (loading) => set({ loading }),\r\n  setSubmitting: (submitting) => set({ submitting }),\r\n  setShowModal: (showModal) => set({ showModal }),\r\n  \r\n  // Form actions\r\n  setFormData: (data) => set((state) => ({\r\n    formData: { ...state.formData, ...data }\r\n  })),\r\n  \r\n  resetForm: () => set({ formData: defaultForm, editingUserId: null }),\r\n  \r\n  setEditingUser: (user) => {\r\n    if (user) {\r\n      set({\r\n        editingUserId: user.id,\r\n        formData: {\r\n          name: user.name,\r\n          email: user.email,\r\n          password: '',\r\n          role: user.role,\r\n          cabangId: user.cabang?.id || '',\r\n          hasMultiCabangAccess: user.hasMultiCabangAccess || false,\r\n        }\r\n      });\r\n    } else {\r\n      get().resetForm();\r\n    }\r\n  },\r\n  \r\n  // API actions\r\n  fetchUsers: async () => {\r\n    set({ loading: true });\r\n    try {\r\n      const res = await authAPI.getUsers();\r\n      const users = Array.isArray(res.data) ? res.data : [];\r\n      set({ users, loading: false });\r\n    } catch (error) {\r\n      logger.error('Error fetching users:', error);\r\n      set({ loading: false });\r\n    }\r\n  },\r\n  \r\n  createUser: async (data) => {\r\n    set({ submitting: true });\r\n    try {\r\n      await authAPI.createUser(data as any);\r\n      set({ submitting: false });\r\n      get().fetchUsers();\r\n      get().resetForm();\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('Error creating user:', error);\r\n      set({ submitting: false });\r\n      return false;\r\n    }\r\n  },\r\n  \r\n  updateUser: async (id, data) => {\r\n    set({ submitting: true });\r\n    try {\r\n      await authAPI.updateUser(id, data as any);\r\n      set({ submitting: false });\r\n      get().fetchUsers();\r\n      get().resetForm();\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('Error updating user:', error);\r\n      set({ submitting: false });\r\n      return false;\r\n    }\r\n  },\r\n  \r\n  toggleUserStatus: async (id, isActive) => {\r\n    try {\r\n      await authAPI.updateUser(id, { isActive } as any);\r\n      get().fetchUsers();\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('Error toggling user status:', error);\r\n      return false;\r\n    }\r\n  },\r\n  \r\n  deleteUser: async (id) => {\r\n    set({ submitting: true });\r\n    try {\r\n      await authAPI.deleteUser(id);\r\n      set({ submitting: false });\r\n      get().fetchUsers();\r\n      return true;\r\n    } catch (error) {\r\n      logger.error('Error deleting user:', error);\r\n      set({ submitting: false });\r\n      return false;\r\n    }\r\n  },\r\n}));\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Dataku\\Programer\\live\\pelaris.id\\frontend\\vitest.setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
